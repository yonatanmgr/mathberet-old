/** CortexJS Compute Engine 0.12.2 */
var global,factory;global=this,factory=function(e){function i(e){return!("kind"in e)||"symbol"===e.kind}function t(e){return!("kind"in e)||"function"===e.kind}function n(e){return"kind"in e&&"matchfix"===e.kind}function r(e){return"kind"in e&&"infix"===e.kind}function s(e){return"kind"in e&&"prefix"===e.kind}function o(e){return"kind"in e&&"postfix"===e.kind}function a(e){return"kind"in e&&"environment"===e.kind}var u,l,c=9e15,h=1e9,m="0123456789abcdef",f="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",g="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",p={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-c,maxE:c,crypto:!1},d=!0,b="[DecimalError] ",y=b+"Invalid argument: ",v=b+"Precision limit exceeded",N=b+"crypto unavailable",_="[object Decimal]",x=Math.floor,S=Math.pow,w=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,k=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,E=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,I=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,A=1e7,M=f.length-1,q=g.length-1,C={toStringTag:_};function D(e){var i,t,n,r=e.length-1,s="",o=e[0];if(r>0){for(s+=o,i=1;i<r;i++)(t=7-(n=e[i]+"").length)&&(s+=G(t)),s+=n;(t=7-(n=(o=e[i])+"").length)&&(s+=G(t))}else if(0===o)return"0";for(;o%10==0;)o/=10;return s+o}function F(e,i,t){if(e!==~~e||e<i||e>t)throw Error(y+e)}function T(e,i,t,n){var r,s,o,a;for(s=e[0];s>=10;s/=10)--i;return--i<0?(i+=7,r=0):(r=Math.ceil((i+1)/7),i%=7),s=S(10,7-i),a=e[r]%s|0,null==n?i<3?(0==i?a=a/100|0:1==i&&(a=a/10|0),o=t<4&&99999==a||t>3&&49999==a||5e4==a||0==a):o=(t<4&&a+1==s||t>3&&a+1==s/2)&&(e[r+1]/s/100|0)==S(10,i-2)-1||(a==s/2||0==a)&&0==(e[r+1]/s/100|0):i<4?(0==i?a=a/1e3|0:1==i?a=a/100|0:2==i&&(a=a/10|0),o=(n||t<4)&&9999==a||!n&&t>3&&4999==a):o=((n||t<4)&&a+1==s||!n&&t>3&&a+1==s/2)&&(e[r+1]/s/1e3|0)==S(10,i-3)-1,o}function O(e,i,t){for(var n,r,s=[0],o=0,a=e.length;o<a;){for(r=s.length;r--;)s[r]*=i;for(s[0]+=m.indexOf(e.charAt(o++)),n=0;n<s.length;n++)s[n]>t-1&&(void 0===s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/t|0,s[n]%=t)}return s.reverse()}C.absoluteValue=C.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),R(e)},C.ceil=function(){return R(new this.constructor(this),this.e+1,2)},C.clampedTo=C.clamp=function(e,i){var t=this,n=t.constructor;if(e=new n(e),i=new n(i),!e.s||!i.s)return new n(NaN);if(e.gt(i))throw Error(y+i);return t.cmp(e)<0?e:t.cmp(i)>0?i:new n(t)},C.comparedTo=C.cmp=function(e){var i,t,n,r,s=this,o=s.d,a=(e=new s.constructor(e)).d,u=s.s,l=e.s;if(!o||!a)return u&&l?u!==l?u:o===a?0:!o^u<0?1:-1:NaN;if(!o[0]||!a[0])return o[0]?u:a[0]?-l:0;if(u!==l)return u;if(s.e!==e.e)return s.e>e.e^u<0?1:-1;for(i=0,t=(n=o.length)<(r=a.length)?n:r;i<t;++i)if(o[i]!==a[i])return o[i]>a[i]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1},C.cosine=C.cos=function(){var e,i,t=this,n=t.constructor;return t.d?t.d[0]?(e=n.precision,i=n.rounding,n.precision=e+Math.max(t.e,t.sd())+7,n.rounding=1,t=function(e,i){var t,n,r;if(i.isZero())return i;(n=i.d.length)<32?r=""+1/X(4,t=Math.ceil(n/3)):(t=16,r="2.3283064365386962890625e-10"),e.precision+=t,i=J(e,1,i.times(r),new e(1));for(var s=t;s--;){var o=i.times(i);i=o.times(o).minus(o).times(8).plus(1)}return e.precision-=t,i}(n,ee(n,t)),n.precision=e,n.rounding=i,R(2==l||3==l?t.neg():t,e,i,!0)):new n(1):new n(NaN)},C.cubeRoot=C.cbrt=function(){var e,i,t,n,r,s,o,a,u,l,c=this,h=c.constructor;if(!c.isFinite()||c.isZero())return new h(c);for(d=!1,(s=c.s*S(c.s*c,1/3))&&Math.abs(s)!=1/0?n=new h(s.toString()):(t=D(c.d),(s=((e=c.e)-t.length+1)%3)&&(t+=1==s||-2==s?"0":"00"),s=S(t,1/3),e=x((e+1)/3)-(e%3==(e<0?-1:2)),(n=new h(t=s==1/0?"5e"+e:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+e)).s=c.s),o=(e=h.precision)+3;;)if(l=(u=(a=n).times(a).times(a)).plus(c),n=P(l.plus(c).times(a),l.plus(u),o+2,1),D(a.d).slice(0,o)===(t=D(n.d)).slice(0,o)){if("9999"!=(t=t.slice(o-3,o+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(R(n,e+1,1),i=!n.times(n).times(n).eq(c));break}if(!r&&(R(a,e+1,0),a.times(a).times(a).eq(c))){n=a;break}o+=4,r=1}return d=!0,R(n,e,h.rounding,i)},C.decimalPlaces=C.dp=function(){var e,i=this.d,t=NaN;if(i){if(t=7*((e=i.length-1)-x(this.e/7)),e=i[e])for(;e%10==0;e/=10)t--;t<0&&(t=0)}return t},C.dividedBy=C.div=function(e){return P(this,new this.constructor(e))},C.dividedToIntegerBy=C.divToInt=function(e){var i=this.constructor;return R(P(this,new i(e),0,1,1),i.precision,i.rounding)},C.equals=C.eq=function(e){return 0===this.cmp(e)},C.floor=function(){return R(new this.constructor(this),this.e+1,3)},C.greaterThan=C.gt=function(e){return this.cmp(e)>0},C.greaterThanOrEqualTo=C.gte=function(e){var i=this.cmp(e);return 1==i||0===i},C.hyperbolicCosine=C.cosh=function(){var e,i,t,n,r,s=this,o=s.constructor,a=new o(1);if(!s.isFinite())return new o(s.s?1/0:NaN);if(s.isZero())return a;t=o.precision,n=o.rounding,o.precision=t+Math.max(s.e,s.sd())+4,o.rounding=1,(r=s.d.length)<32?i=""+1/X(4,e=Math.ceil(r/3)):(e=16,i="2.3283064365386962890625e-10"),s=J(o,1,s.times(i),new o(1),!0);for(var u,l=e,c=new o(8);l--;)u=s.times(s),s=a.minus(u.times(c.minus(u.times(c))));return R(s,o.precision=t,o.rounding=n,!0)},C.hyperbolicSine=C.sinh=function(){var e,i,t,n,r=this,s=r.constructor;if(!r.isFinite()||r.isZero())return new s(r);if(i=s.precision,t=s.rounding,s.precision=i+Math.max(r.e,r.sd())+4,s.rounding=1,(n=r.d.length)<3)r=J(s,2,r,r,!0);else{e=(e=1.4*Math.sqrt(n))>16?16:0|e,r=J(s,2,r=r.times(1/X(5,e)),r,!0);for(var o,a=new s(5),u=new s(16),l=new s(20);e--;)o=r.times(r),r=r.times(a.plus(o.times(u.times(o).plus(l))))}return s.precision=i,s.rounding=t,R(r,i,t,!0)},C.hyperbolicTangent=C.tanh=function(){var e,i,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(e=n.precision,i=n.rounding,n.precision=e+7,n.rounding=1,P(t.sinh(),t.cosh(),n.precision=e,n.rounding=i)):new n(t.s)},C.inverseCosine=C.acos=function(){var e,i=this,t=i.constructor,n=i.abs().cmp(1),r=t.precision,s=t.rounding;return-1!==n?0===n?i.isNeg()?$(t,r,s):new t(0):new t(NaN):i.isZero()?$(t,r+4,s).times(.5):(t.precision=r+6,t.rounding=1,i=i.asin(),e=$(t,r+4,s).times(.5),t.precision=r,t.rounding=s,e.minus(i))},C.inverseHyperbolicCosine=C.acosh=function(){var e,i,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(e=n.precision,i=n.rounding,n.precision=e+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,d=!1,t=t.times(t).minus(1).sqrt().plus(t),d=!0,n.precision=e,n.rounding=i,t.ln()):new n(t)},C.inverseHyperbolicSine=C.asinh=function(){var e,i,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(e=n.precision,i=n.rounding,n.precision=e+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,d=!1,t=t.times(t).plus(1).sqrt().plus(t),d=!0,n.precision=e,n.rounding=i,t.ln())},C.inverseHyperbolicTangent=C.atanh=function(){var e,i,t,n,r=this,s=r.constructor;return r.isFinite()?r.e>=0?new s(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(e=s.precision,i=s.rounding,n=r.sd(),Math.max(n,e)<2*-r.e-1?R(new s(r),e,i,!0):(s.precision=t=n-r.e,r=P(r.plus(1),new s(1).minus(r),t+e,1),s.precision=e+4,s.rounding=1,r=r.ln(),s.precision=e,s.rounding=i,r.times(.5))):new s(NaN)},C.inverseSine=C.asin=function(){var e,i,t,n,r=this,s=r.constructor;return r.isZero()?new s(r):(i=r.abs().cmp(1),t=s.precision,n=s.rounding,-1!==i?0===i?((e=$(s,t+4,n).times(.5)).s=r.s,e):new s(NaN):(s.precision=t+6,s.rounding=1,r=r.div(new s(1).minus(r.times(r)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=n,r.times(2)))},C.inverseTangent=C.atan=function(){var e,i,t,n,r,s,o,a,u,l=this,c=l.constructor,h=c.precision,m=c.rounding;if(l.isFinite()){if(l.isZero())return new c(l);if(l.abs().eq(1)&&h+4<=q)return(o=$(c,h+4,m).times(.25)).s=l.s,o}else{if(!l.s)return new c(NaN);if(h+4<=q)return(o=$(c,h+4,m).times(.5)).s=l.s,o}for(c.precision=a=h+10,c.rounding=1,e=t=Math.min(28,a/7+2|0);e;--e)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(d=!1,i=Math.ceil(a/7),n=1,u=l.times(l),o=new c(l),r=l;-1!==e;)if(r=r.times(u),s=o.minus(r.div(n+=2)),r=r.times(u),void 0!==(o=s.plus(r.div(n+=2))).d[i])for(e=i;o.d[e]===s.d[e]&&e--;);return t&&(o=o.times(2<<t-1)),d=!0,R(o,c.precision=h,c.rounding=m,!0)},C.isFinite=function(){return!!this.d},C.isInteger=C.isInt=function(){return!!this.d&&x(this.e/7)>this.d.length-2},C.isNaN=function(){return!this.s},C.isNegative=C.isNeg=function(){return this.s<0},C.isPositive=C.isPos=function(){return this.s>0},C.isZero=function(){return!!this.d&&0===this.d[0]},C.lessThan=C.lt=function(e){return this.cmp(e)<0},C.lessThanOrEqualTo=C.lte=function(e){return this.cmp(e)<1},C.logarithm=C.log=function(e){var i,t,n,r,s,o,a,u,l=this,c=l.constructor,h=c.precision,m=c.rounding;if(null==e)e=new c(10),i=!0;else{if(t=(e=new c(e)).d,e.s<0||!t||!t[0]||e.eq(1))return new c(NaN);i=e.eq(10)}if(t=l.d,l.s<0||!t||!t[0]||l.eq(1))return new c(t&&!t[0]?-1/0:1!=l.s?NaN:t?0:1/0);if(i)if(t.length>1)s=!0;else{for(r=t[0];r%10==0;)r/=10;s=1!==r}if(d=!1,o=Q(l,a=h+5),n=i?L(c,a+10):Q(e,a),T((u=P(o,n,a,1)).d,r=h,m))do{if(o=Q(l,a+=10),n=i?L(c,a+10):Q(e,a),u=P(o,n,a,1),!s){+D(u.d).slice(r+1,r+15)+1==1e14&&(u=R(u,h+1,0));break}}while(T(u.d,r+=10,m));return d=!0,R(u,h,m)},C.minus=C.sub=function(e){var i,t,n,r,s,o,a,u,l,c,h,m,f=this,g=f.constructor;if(e=new g(e),!f.d||!e.d)return f.s&&e.s?f.d?e.s=-e.s:e=new g(e.d||f.s!==e.s?f:NaN):e=new g(NaN),e;if(f.s!=e.s)return e.s=-e.s,f.plus(e);if(l=f.d,m=e.d,a=g.precision,u=g.rounding,!l[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!l[0])return new g(3===u?-0:0);e=new g(f)}return d?R(e,a,u):e}if(t=x(e.e/7),c=x(f.e/7),l=l.slice(),s=c-t){for((h=s<0)?(i=l,s=-s,o=m.length):(i=m,t=c,o=l.length),s>(n=Math.max(Math.ceil(a/7),o)+2)&&(s=n,i.length=1),i.reverse(),n=s;n--;)i.push(0);i.reverse()}else{for((h=(n=l.length)<(o=m.length))&&(o=n),n=0;n<o;n++)if(l[n]!=m[n]){h=l[n]<m[n];break}s=0}for(h&&(i=l,l=m,m=i,e.s=-e.s),o=l.length,n=m.length-o;n>0;--n)l[o++]=0;for(n=m.length;n>s;){if(l[--n]<m[n]){for(r=n;r&&0===l[--r];)l[r]=A-1;--l[r],l[n]+=A}l[n]-=m[n]}for(;0===l[--o];)l.pop();for(;0===l[0];l.shift())--t;return l[0]?(e.d=l,e.e=V(l,t),d?R(e,a,u):e):new g(3===u?-0:0)},C.modulo=C.mod=function(e){var i,t=this,n=t.constructor;return e=new n(e),!t.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||t.d&&!t.d[0]?R(new n(t),n.precision,n.rounding):(d=!1,9==n.modulo?(i=P(t,e.abs(),0,3,1)).s*=e.s:i=P(t,e,0,n.modulo,1),i=i.times(e),d=!0,t.minus(i))},C.naturalExponential=C.exp=function(){return H(this)},C.naturalLogarithm=C.ln=function(){return Q(this)},C.negated=C.neg=function(){var e=new this.constructor(this);return e.s=-e.s,R(e)},C.plus=C.add=function(e){var i,t,n,r,s,o,a,u,l,c,h=this,m=h.constructor;if(e=new m(e),!h.d||!e.d)return h.s&&e.s?h.d||(e=new m(e.d||h.s===e.s?h:NaN)):e=new m(NaN),e;if(h.s!=e.s)return e.s=-e.s,h.minus(e);if(l=h.d,c=e.d,a=m.precision,u=m.rounding,!l[0]||!c[0])return c[0]||(e=new m(h)),d?R(e,a,u):e;if(s=x(h.e/7),n=x(e.e/7),l=l.slice(),r=s-n){for(r<0?(t=l,r=-r,o=c.length):(t=c,n=s,o=l.length),r>(o=(s=Math.ceil(a/7))>o?s+1:o+1)&&(r=o,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for((o=l.length)-(r=c.length)<0&&(r=o,t=c,c=l,l=t),i=0;r;)i=(l[--r]=l[r]+c[r]+i)/A|0,l[r]%=A;for(i&&(l.unshift(i),++n),o=l.length;0==l[--o];)l.pop();return e.d=l,e.e=V(l,n),d?R(e,a,u):e},C.precision=C.sd=function(e){var i,t=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(y+e);return t.d?(i=B(t.d),e&&t.e+1>i&&(i=t.e+1)):i=NaN,i},C.round=function(){var e=this,i=e.constructor;return R(new i(e),e.e+1,i.rounding)},C.sine=C.sin=function(){var e,i,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(e=n.precision,i=n.rounding,n.precision=e+Math.max(t.e,t.sd())+7,n.rounding=1,t=function(e,i){var t,n=i.d.length;if(n<3)return i.isZero()?i:J(e,2,i,i);t=(t=1.4*Math.sqrt(n))>16?16:0|t,i=J(e,2,i=i.times(1/X(5,t)),i);for(var r,s=new e(5),o=new e(16),a=new e(20);t--;)r=i.times(i),i=i.times(s.plus(r.times(o.times(r).minus(a))));return i}(n,ee(n,t)),n.precision=e,n.rounding=i,R(l>2?t.neg():t,e,i,!0)):new n(NaN)},C.squareRoot=C.sqrt=function(){var e,i,t,n,r,s,o=this,a=o.d,u=o.e,l=o.s,c=o.constructor;if(1!==l||!a||!a[0])return new c(!l||l<0&&(!a||a[0])?NaN:a?o:1/0);for(d=!1,0==(l=Math.sqrt(+o))||l==1/0?(((i=D(a)).length+u)%2==0&&(i+="0"),l=Math.sqrt(i),u=x((u+1)/2)-(u<0||u%2),n=new c(i=l==1/0?"5e"+u:(i=l.toExponential()).slice(0,i.indexOf("e")+1)+u)):n=new c(l.toString()),t=(u=c.precision)+3;;)if(n=(s=n).plus(P(o,s,t+2,1)).times(.5),D(s.d).slice(0,t)===(i=D(n.d)).slice(0,t)){if("9999"!=(i=i.slice(t-3,t+1))&&(r||"4999"!=i)){+i&&(+i.slice(1)||"5"!=i.charAt(0))||(R(n,u+1,1),e=!n.times(n).eq(o));break}if(!r&&(R(s,u+1,0),s.times(s).eq(o))){n=s;break}t+=4,r=1}return d=!0,R(n,u,c.rounding,e)},C.tangent=C.tan=function(){var e,i,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(e=n.precision,i=n.rounding,n.precision=e+10,n.rounding=1,(t=t.sin()).s=1,t=P(t,new n(1).minus(t.times(t)).sqrt(),e+10,0),n.precision=e,n.rounding=i,R(2==l||4==l?t.neg():t,e,i,!0)):new n(NaN)},C.times=C.mul=function(e){var i,t,n,r,s,o,a,u,l,c=this,h=c.constructor,m=c.d,f=(e=new h(e)).d;if(e.s*=c.s,!(m&&m[0]&&f&&f[0]))return new h(!e.s||m&&!m[0]&&!f||f&&!f[0]&&!m?NaN:m&&f?0*e.s:e.s/0);for(t=x(c.e/7)+x(e.e/7),(u=m.length)<(l=f.length)&&(s=m,m=f,f=s,o=u,u=l,l=o),s=[],n=o=u+l;n--;)s.push(0);for(n=l;--n>=0;){for(i=0,r=u+n;r>n;)a=s[r]+f[n]*m[r-n-1]+i,s[r--]=a%A|0,i=a/A|0;s[r]=(s[r]+i)%A|0}for(;!s[--o];)s.pop();return i?++t:s.shift(),e.d=s,e.e=V(s,t),d?R(e,h.precision,h.rounding):e},C.toBinary=function(e,i){return ie(this,2,e,i)},C.toDecimalPlaces=C.toDP=function(e,i){var t=this,n=t.constructor;return t=new n(t),void 0===e?t:(F(e,0,h),void 0===i?i=n.rounding:F(i,0,8),R(t,e+t.e+1,i))},C.toExponential=function(e,i){var t,n=this,r=n.constructor;return void 0===e?t=z(n,!0):(F(e,0,h),void 0===i?i=r.rounding:F(i,0,8),t=z(n=R(new r(n),e+1,i),!0,e+1)),n.isNeg()&&!n.isZero()?"-"+t:t},C.toFixed=function(e,i){var t,n,r=this,s=r.constructor;return void 0===e?t=z(r):(F(e,0,h),void 0===i?i=s.rounding:F(i,0,8),t=z(n=R(new s(r),e+r.e+1,i),!1,e+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t},C.toFraction=function(e){var i,t,n,r,s,o,a,u,l,c,h,m,f=this,g=f.d,p=f.constructor;if(!g)return new p(f);if(l=t=new p(1),n=u=new p(0),o=(s=(i=new p(n)).e=B(g)-f.e-1)%7,i.d[0]=S(10,o<0?7+o:o),null==e)e=s>0?i:l;else{if(!(a=new p(e)).isInt()||a.lt(l))throw Error(y+a);e=a.gt(i)?s>0?i:l:a}for(d=!1,a=new p(D(g)),c=p.precision,p.precision=s=7*g.length*2;h=P(a,i,0,1,1),1!=(r=t.plus(h.times(n))).cmp(e);)t=n,n=r,r=l,l=u.plus(h.times(r)),u=r,r=i,i=a.minus(h.times(r)),a=r;return r=P(e.minus(t),n,0,1,1),u=u.plus(r.times(l)),t=t.plus(r.times(n)),u.s=l.s=f.s,m=P(l,n,s,1).minus(f).abs().cmp(P(u,t,s,1).minus(f).abs())<1?[l,n]:[u,t],p.precision=c,d=!0,m},C.toHexadecimal=C.toHex=function(e,i){return ie(this,16,e,i)},C.toNearest=function(e,i){var t=this,n=t.constructor;if(t=new n(t),null==e){if(!t.d)return t;e=new n(1),i=n.rounding}else{if(e=new n(e),void 0===i?i=n.rounding:F(i,0,8),!t.d)return e.s?t:e;if(!e.d)return e.s&&(e.s=t.s),e}return e.d[0]?(d=!1,t=P(t,e,0,i,1).times(e),d=!0,R(t)):(e.s=t.s,t=e),t},C.toNumber=function(){return+this},C.toOctal=function(e,i){return ie(this,8,e,i)},C.toPower=C.pow=function(e){var i,t,n,r,s,o,a=this,u=a.constructor,l=+(e=new u(e));if(!(a.d&&e.d&&a.d[0]&&e.d[0]))return new u(S(+a,l));if((a=new u(a)).eq(1))return a;if(n=u.precision,s=u.rounding,e.eq(1))return R(a,n,s);if((i=x(e.e/7))>=e.d.length-1&&(t=l<0?-l:l)<=9007199254740991)return r=Z(u,a,t,n),e.s<0?new u(1).div(r):R(r,n,s);if((o=a.s)<0){if(i<e.d.length-1)return new u(NaN);if(0==(1&e.d[i])&&(o=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=o,a}return(i=0!=(t=S(+a,l))&&isFinite(t)?new u(t+"").e:x(l*(Math.log("0."+D(a.d))/Math.LN10+a.e+1)))>u.maxE+1||i<u.minE-1?new u(i>0?o/0:0):(d=!1,u.rounding=a.s=1,t=Math.min(12,(i+"").length),(r=H(e.times(Q(a,n+t)),n)).d&&T((r=R(r,n+5,1)).d,n,s)&&(i=n+10,+D((r=R(H(e.times(Q(a,i+t)),i),i+5,1)).d).slice(n+1,n+15)+1==1e14&&(r=R(r,n+1,0))),r.s=o,d=!0,u.rounding=s,R(r,n,s))},C.toPrecision=function(e,i){var t,n=this,r=n.constructor;return void 0===e?t=z(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(F(e,1,h),void 0===i?i=r.rounding:F(i,0,8),t=z(n=R(new r(n),e,i),e<=n.e||n.e<=r.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+t:t},C.toSignificantDigits=C.toSD=function(e,i){var t=this.constructor;return void 0===e?(e=t.precision,i=t.rounding):(F(e,1,h),void 0===i?i=t.rounding:F(i,0,8)),R(new t(this),e,i)},C.toString=function(){var e=this,i=e.constructor,t=z(e,e.e<=i.toExpNeg||e.e>=i.toExpPos);return e.isNeg()&&!e.isZero()?"-"+t:t},C.truncated=C.trunc=function(){return R(new this.constructor(this),this.e+1,1)},C.valueOf=C.toJSON=function(){var e=this,i=e.constructor,t=z(e,e.e<=i.toExpNeg||e.e>=i.toExpPos);return e.isNeg()?"-"+t:t};var P=function(){function e(e,i,t){var n,r=0,s=e.length;for(e=e.slice();s--;)n=e[s]*i+r,e[s]=n%t|0,r=n/t|0;return r&&e.unshift(r),e}function i(e,i,t,n){var r,s;if(t!=n)s=t>n?1:-1;else for(r=s=0;r<t;r++)if(e[r]!=i[r]){s=e[r]>i[r]?1:-1;break}return s}function t(e,i,t,n){for(var r=0;t--;)e[t]-=r,r=e[t]<i[t]?1:0,e[t]=r*n+e[t]-i[t];for(;!e[0]&&e.length>1;)e.shift()}return function(n,r,s,o,a,l){var c,h,m,f,g,p,d,b,y,v,N,_,S,w,k,E,I,M,q,C,D=n.constructor,F=n.s==r.s?1:-1,T=n.d,O=r.d;if(!(T&&T[0]&&O&&O[0]))return new D(n.s&&r.s&&(T?!O||T[0]!=O[0]:O)?T&&0==T[0]||!O?0*F:F/0:NaN);for(l?(g=1,h=n.e-r.e):(l=A,g=7,h=x(n.e/g)-x(r.e/g)),q=O.length,I=T.length,v=(y=new D(F)).d=[],m=0;O[m]==(T[m]||0);m++);if(O[m]>(T[m]||0)&&h--,null==s?(w=s=D.precision,o=D.rounding):w=a?s+(n.e-r.e)+1:s,w<0)v.push(1),p=!0;else{if(w=w/g+2|0,m=0,1==q){for(f=0,O=O[0],w++;(m<I||f)&&w--;m++)k=f*l+(T[m]||0),v[m]=k/O|0,f=k%O|0;p=f||m<I}else{for((f=l/(O[0]+1)|0)>1&&(O=e(O,f,l),T=e(T,f,l),q=O.length,I=T.length),E=q,_=(N=T.slice(0,q)).length;_<q;)N[_++]=0;(C=O.slice()).unshift(0),M=O[0],O[1]>=l/2&&++M;do{f=0,(c=i(O,N,q,_))<0?(S=N[0],q!=_&&(S=S*l+(N[1]||0)),(f=S/M|0)>1?(f>=l&&(f=l-1),1==(c=i(d=e(O,f,l),N,b=d.length,_=N.length))&&(f--,t(d,q<b?C:O,b,l))):(0==f&&(c=f=1),d=O.slice()),(b=d.length)<_&&d.unshift(0),t(N,d,_,l),-1==c&&(c=i(O,N,q,_=N.length))<1&&(f++,t(N,q<_?C:O,_,l)),_=N.length):0===c&&(f++,N=[0]),v[m++]=f,c&&N[0]?N[_++]=T[E]||0:(N=[T[E]],_=1)}while((E++<I||void 0!==N[0])&&w--);p=void 0!==N[0]}v[0]||v.shift()}if(1==g)y.e=h,u=p;else{for(m=1,f=v[0];f>=10;f/=10)m++;y.e=m+h*g-1,R(y,a?s+y.e+1:s,o,p)}return y}}();function R(e,i,t,n){var r,s,o,a,u,l,c,h,m,f=e.constructor;e:if(null!=i){if(!(h=e.d))return e;for(r=1,a=h[0];a>=10;a/=10)r++;if((s=i-r)<0)s+=7,o=i,u=(c=h[m=0])/S(10,r-o-1)%10|0;else if((m=Math.ceil((s+1)/7))>=(a=h.length)){if(!n)break e;for(;a++<=m;)h.push(0);c=u=0,r=1,o=(s%=7)-7+1}else{for(c=a=h[m],r=1;a>=10;a/=10)r++;u=(o=(s%=7)-7+r)<0?0:c/S(10,r-o-1)%10|0}if(n=n||i<0||void 0!==h[m+1]||(o<0?c:c%S(10,r-o-1)),l=t<4?(u||n)&&(0==t||t==(e.s<0?3:2)):u>5||5==u&&(4==t||n||6==t&&(s>0?o>0?c/S(10,r-o):0:h[m-1])%10&1||t==(e.s<0?8:7)),i<1||!h[0])return h.length=0,l?(i-=e.e+1,h[0]=S(10,(7-i%7)%7),e.e=-i||0):h[0]=e.e=0,e;if(0==s?(h.length=m,a=1,m--):(h.length=m+1,a=S(10,7-s),h[m]=o>0?(c/S(10,r-o)%S(10,o)|0)*a:0),l)for(;;){if(0==m){for(s=1,o=h[0];o>=10;o/=10)s++;for(o=h[0]+=a,a=1;o>=10;o/=10)a++;s!=a&&(e.e++,h[0]==A&&(h[0]=1));break}if(h[m]+=a,h[m]!=A)break;h[m--]=0,a=1}for(s=h.length;0===h[--s];)h.pop()}return d&&(e.e>f.maxE?(e.d=null,e.e=NaN):e.e<f.minE&&(e.e=0,e.d=[0])),e}function z(e,i,t){if(!e.isFinite())return W(e);var n,r=e.e,s=D(e.d),o=s.length;return i?(t&&(n=t-o)>0?s=s.charAt(0)+"."+s.slice(1)+G(n):o>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):r<0?(s="0."+G(-r-1)+s,t&&(n=t-o)>0&&(s+=G(n))):r>=o?(s+=G(r+1-o),t&&(n=t-r-1)>0&&(s=s+"."+G(n))):((n=r+1)<o&&(s=s.slice(0,n)+"."+s.slice(n)),t&&(n=t-o)>0&&(r+1===o&&(s+="."),s+=G(n))),s}function V(e,i){var t=e[0];for(i*=7;t>=10;t/=10)i++;return i}function L(e,i,t){if(i>M)throw d=!0,t&&(e.precision=t),Error(v);return R(new e(f),i,1,!0)}function $(e,i,t){if(i>q)throw Error(v);return R(new e(g),i,t,!0)}function B(e){var i=e.length-1,t=7*i+1;if(i=e[i]){for(;i%10==0;i/=10)t--;for(i=e[0];i>=10;i/=10)t++}return t}function G(e){for(var i="";e--;)i+="0";return i}function Z(e,i,t,n){var r,s=new e(1),o=Math.ceil(n/7+4);for(d=!1;;){if(t%2&&te((s=s.times(i)).d,o)&&(r=!0),0===(t=x(t/2))){t=s.d.length-1,r&&0===s.d[t]&&++s.d[t];break}te((i=i.times(i)).d,o)}return d=!0,s}function U(e){return 1&e.d[e.d.length-1]}function j(e,i,t){for(var n,r=new e(i[0]),s=0;++s<i.length;){if(!(n=new e(i[s])).s){r=n;break}r[t](n)&&(r=n)}return r}function H(e,i){var t,n,r,s,o,a,u,l=0,c=0,h=0,m=e.constructor,f=m.rounding,g=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==i?(d=!1,u=g):u=i,a=new m(.03125);e.e>-2;)e=e.times(a),h+=5;for(u+=n=Math.log(S(2,h))/Math.LN10*2+5|0,t=s=o=new m(1),m.precision=u;;){if(s=R(s.times(e),u,1),t=t.times(++c),D((a=o.plus(P(s,t,u,1))).d).slice(0,u)===D(o.d).slice(0,u)){for(r=h;r--;)o=R(o.times(o),u,1);if(null!=i)return m.precision=g,o;if(!(l<3&&T(o.d,u-n,f,l)))return R(o,m.precision=g,f,d=!0);m.precision=u+=10,t=s=a=new m(1),c=0,l++}o=a}}function Q(e,i){var t,n,r,s,o,a,u,l,c,h,m,f=1,g=e,p=g.d,b=g.constructor,y=b.rounding,v=b.precision;if(g.s<0||!p||!p[0]||!g.e&&1==p[0]&&1==p.length)return new b(p&&!p[0]?-1/0:1!=g.s?NaN:p?0:g);if(null==i?(d=!1,c=v):c=i,b.precision=c+=10,n=(t=D(p)).charAt(0),!(Math.abs(s=g.e)<15e14))return l=L(b,c+2,v).times(s+""),g=Q(new b(n+"."+t.slice(1)),c-10).plus(l),b.precision=v,null==i?R(g,v,y,d=!0):g;for(;n<7&&1!=n||1==n&&t.charAt(1)>3;)n=(t=D((g=g.times(e)).d)).charAt(0),f++;for(s=g.e,n>1?(g=new b("0."+t),s++):g=new b(n+"."+t.slice(1)),h=g,u=o=g=P(g.minus(1),g.plus(1),c,1),m=R(g.times(g),c,1),r=3;;){if(o=R(o.times(m),c,1),D((l=u.plus(P(o,new b(r),c,1))).d).slice(0,c)===D(u.d).slice(0,c)){if(u=u.times(2),0!==s&&(u=u.plus(L(b,c+2,v).times(s+""))),u=P(u,new b(f),c,1),null!=i)return b.precision=v,u;if(!T(u.d,c-10,y,a))return R(u,b.precision=v,y,d=!0);b.precision=c+=10,l=o=g=P(h.minus(1),h.plus(1),c,1),m=R(g.times(g),c,1),r=a=1}u=l,r+=2}}function W(e){return e.s*e.s/0+""}function Y(e,i){var t,n,r;for((t=i.indexOf("."))>-1&&(i=i.replace(".","")),(n=i.search(/e/i))>0?(t<0&&(t=n),t+=+i.slice(n+1),i=i.substring(0,n)):t<0&&(t=i.length),n=0;48===i.charCodeAt(n);n++);for(r=i.length;48===i.charCodeAt(r-1);--r);if(i=i.slice(n,r)){if(r-=n,e.e=t=t-n-1,e.d=[],n=(t+1)%7,t<0&&(n+=7),n<r){for(n&&e.d.push(+i.slice(0,n)),r-=7;n<r;)e.d.push(+i.slice(n,n+=7));n=7-(i=i.slice(n)).length}else n-=r;for(;n--;)i+="0";e.d.push(+i),d&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function K(e,i){var t,n,r,s,o,a,u,l,c;if(i.indexOf("_")>-1){if(i=i.replace(/(\d)_(?=\d)/g,"$1"),I.test(i))return Y(e,i)}else if("Infinity"===i||"NaN"===i)return+i||(e.s=NaN),e.e=NaN,e.d=null,e;if(k.test(i))t=16,i=i.toLowerCase();else if(w.test(i))t=2;else{if(!E.test(i))throw Error(y+i);t=8}for((s=i.search(/p/i))>0?(u=+i.slice(s+1),i=i.substring(2,s)):i=i.slice(2),o=(s=i.indexOf("."))>=0,n=e.constructor,o&&(s=(a=(i=i.replace(".","")).length)-s,r=Z(n,new n(t),s,2*s)),s=c=(l=O(i,t,A)).length-1;0===l[s];--s)l.pop();return s<0?new n(0*e.s):(e.e=V(l,c),e.d=l,d=!1,o&&(e=P(e,r,4*a)),u&&(e=e.times(Math.abs(u)<54?S(2,u):Ge.pow(2,u))),d=!0,e)}function J(e,i,t,n,r){var s,o,a,u,l=e.precision,c=Math.ceil(l/7);for(d=!1,u=t.times(t),a=new e(n);;){if(o=P(a.times(u),new e(i++*i++),l,1),a=r?n.plus(o):n.minus(o),n=P(o.times(u),new e(i++*i++),l,1),void 0!==(o=a.plus(n)).d[c]){for(s=c;o.d[s]===a.d[s]&&s--;);if(-1==s)break}s=a,a=n,n=o,o=s}return d=!0,o.d.length=c+1,o}function X(e,i){for(var t=e;--i;)t*=e;return t}function ee(e,i){var t,n=i.s<0,r=$(e,e.precision,1),s=r.times(.5);if((i=i.abs()).lte(s))return l=n?4:1,i;if((t=i.divToInt(r)).isZero())l=n?3:2;else{if((i=i.minus(t.times(r))).lte(s))return l=U(t)?n?2:3:n?4:1,i;l=U(t)?n?1:4:n?3:2}return i.minus(r).abs()}function ie(e,i,t,n){var r,s,o,a,l,c,f,g,p,d=e.constructor,b=void 0!==t;if(b?(F(t,1,h),void 0===n?n=d.rounding:F(n,0,8)):(t=d.precision,n=d.rounding),e.isFinite()){for(b?(r=2,16==i?t=4*t-3:8==i&&(t=3*t-2)):r=i,(o=(f=z(e)).indexOf("."))>=0&&(f=f.replace(".",""),(p=new d(1)).e=f.length-o,p.d=O(z(p),10,r),p.e=p.d.length),s=l=(g=O(f,10,r)).length;0==g[--l];)g.pop();if(g[0]){if(o<0?s--:((e=new d(e)).d=g,e.e=s,g=(e=P(e,p,t,n,0,r)).d,s=e.e,c=u),o=g[t],a=r/2,c=c||void 0!==g[t+1],c=n<4?(void 0!==o||c)&&(0===n||n===(e.s<0?3:2)):o>a||o===a&&(4===n||c||6===n&&1&g[t-1]||n===(e.s<0?8:7)),g.length=t,c)for(;++g[--t]>r-1;)g[t]=0,t||(++s,g.unshift(1));for(l=g.length;!g[l-1];--l);for(o=0,f="";o<l;o++)f+=m.charAt(g[o]);if(b){if(l>1)if(16==i||8==i){for(o=16==i?4:3,--l;l%o;l++)f+="0";for(l=(g=O(f,r,i)).length;!g[l-1];--l);for(o=1,f="1.";o<l;o++)f+=m.charAt(g[o])}else f=f.charAt(0)+"."+f.slice(1);f=f+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)f="0"+f;f="0."+f}else if(++s>l)for(s-=l;s--;)f+="0";else s<l&&(f=f.slice(0,s)+"."+f.slice(s))}else f=b?"0p+0":"0";f=(16==i?"0x":2==i?"0b":8==i?"0o":"")+f}else f=W(e);return e.s<0?"-"+f:f}function te(e,i){if(e.length>i)return e.length=i,!0}function ne(e){return new this(e).abs()}function re(e){return new this(e).acos()}function se(e){return new this(e).acosh()}function oe(e,i){return new this(e).plus(i)}function ae(e){return new this(e).asin()}function ue(e){return new this(e).asinh()}function le(e){return new this(e).atan()}function ce(e){return new this(e).atanh()}function he(e,i){e=new this(e),i=new this(i);var t,n=this.precision,r=this.rounding,s=n+4;return e.s&&i.s?e.d||i.d?!i.d||e.isZero()?(t=i.s<0?$(this,n,r):new this(0)).s=e.s:!e.d||i.isZero()?(t=$(this,s,1).times(.5)).s=e.s:i.s<0?(this.precision=s,this.rounding=1,t=this.atan(P(e,i,s,1)),i=$(this,s,1),this.precision=n,this.rounding=r,t=e.s<0?t.minus(i):t.plus(i)):t=this.atan(P(e,i,s,1)):(t=$(this,s,1).times(i.s>0?.25:.75)).s=e.s:t=new this(NaN),t}function me(e){return new this(e).cbrt()}function fe(e){return R(e=new this(e),e.e+1,2)}function ge(e,i,t){return new this(e).clamp(i,t)}function pe(e){if(!e||"object"!=typeof e)throw Error(b+"Object expected");var i,t,n,r=!0===e.defaults,s=["precision",1,h,"rounding",0,8,"toExpNeg",-c,0,"toExpPos",0,c,"maxE",0,c,"minE",-c,0,"modulo",0,9];for(i=0;i<s.length;i+=3)if(t=s[i],r&&(this[t]=p[t]),void 0!==(n=e[t])){if(!(x(n)===n&&n>=s[i+1]&&n<=s[i+2]))throw Error(y+t+": "+n);this[t]=n}if(t="crypto",r&&(this[t]=p[t]),void 0!==(n=e[t])){if(!0!==n&&!1!==n&&0!==n&&1!==n)throw Error(y+t+": "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(N);this[t]=!0}else this[t]=!1}return this}function de(e){return new this(e).cos()}function be(e){return new this(e).cosh()}function ye(e,i){return new this(e).div(i)}function ve(e){return new this(e).exp()}function Ne(e){return R(e=new this(e),e.e+1,3)}function _e(){var e,i,t=new this(0);for(d=!1,e=0;e<arguments.length;)if((i=new this(arguments[e++])).d)t.d&&(t=t.plus(i.times(i)));else{if(i.s)return d=!0,new this(1/0);t=i}return d=!0,t.sqrt()}function xe(e){return e instanceof Ge||e&&e.toStringTag===_||!1}function Se(e){return new this(e).ln()}function we(e,i){return new this(e).log(i)}function ke(e){return new this(e).log(2)}function Ee(e){return new this(e).log(10)}function Ie(){return j(this,arguments,"lt")}function Ae(){return j(this,arguments,"gt")}function Me(e,i){return new this(e).mod(i)}function qe(e,i){return new this(e).mul(i)}function Ce(e,i){return new this(e).pow(i)}function De(e){var i,t,n,r,s=0,o=new this(1),a=[];if(void 0===e?e=this.precision:F(e,1,h),n=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(i=crypto.getRandomValues(new Uint32Array(n));s<n;)(r=i[s])>=429e7?i[s]=crypto.getRandomValues(new Uint32Array(1))[0]:a[s++]=r%1e7;else{if(!crypto.randomBytes)throw Error(N);for(i=crypto.randomBytes(n*=4);s<n;)(r=i[s]+(i[s+1]<<8)+(i[s+2]<<16)+((127&i[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(i,s):(a.push(r%1e7),s+=4);s=n/4}else for(;s<n;)a[s++]=1e7*Math.random()|0;for(e%=7,(n=a[--s])&&e&&(r=S(10,7-e),a[s]=(n/r|0)*r);0===a[s];s--)a.pop();if(s<0)t=0,a=[0];else{for(t=-1;0===a[0];t-=7)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<7&&(t-=7-n)}return o.e=t,o.d=a,o}function Fe(e){return R(e=new this(e),e.e+1,this.rounding)}function Te(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function Oe(e){return new this(e).sin()}function Pe(e){return new this(e).sinh()}function Re(e){return new this(e).sqrt()}function ze(e,i){return new this(e).sub(i)}function Ve(){var e=0,i=arguments,t=new this(i[e]);for(d=!1;t.s&&++e<i.length;)t=t.plus(i[e]);return d=!0,R(t,this.precision,this.rounding)}function Le(e){return new this(e).tan()}function $e(e){return new this(e).tanh()}function Be(e){return R(e=new this(e),e.e+1,1)}C[Symbol.for("nodejs.util.inspect.custom")]=C.toString,C[Symbol.toStringTag]="Decimal";var Ge=C.constructor=function e(i){var t,n,r;function s(e){var i,t,n,r=this;if(!(r instanceof s))return new s(e);if(r.constructor=s,xe(e))return r.s=e.s,void(d?!e.d||e.e>s.maxE?(r.e=NaN,r.d=null):e.e<s.minE?(r.e=0,r.d=[0]):(r.e=e.e,r.d=e.d.slice()):(r.e=e.e,r.d=e.d?e.d.slice():e.d));if("number"==(n=typeof e)){if(0===e)return r.s=1/e<0?-1:1,r.e=0,void(r.d=[0]);if(e<0?(e=-e,r.s=-1):r.s=1,e===~~e&&e<1e7){for(i=0,t=e;t>=10;t/=10)i++;return void(d?i>s.maxE?(r.e=NaN,r.d=null):i<s.minE?(r.e=0,r.d=[0]):(r.e=i,r.d=[e]):(r.e=i,r.d=[e]))}return 0*e!=0?(e||(r.s=NaN),r.e=NaN,void(r.d=null)):Y(r,e.toString())}if("string"!==n)throw Error(y+e);return 45===(t=e.charCodeAt(0))?(e=e.slice(1),r.s=-1):(43===t&&(e=e.slice(1)),r.s=1),I.test(e)?Y(r,e):K(r,e)}if(s.prototype=C,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=pe,s.clone=e,s.isDecimal=xe,s.abs=ne,s.acos=re,s.acosh=se,s.add=oe,s.asin=ae,s.asinh=ue,s.atan=le,s.atanh=ce,s.atan2=he,s.cbrt=me,s.ceil=fe,s.clamp=ge,s.cos=de,s.cosh=be,s.div=ye,s.exp=ve,s.floor=Ne,s.hypot=_e,s.ln=Se,s.log=we,s.log10=Ee,s.log2=ke,s.max=Ie,s.min=Ae,s.mod=Me,s.mul=qe,s.pow=Ce,s.random=De,s.round=Fe,s.sign=Te,s.sin=Oe,s.sinh=Pe,s.sqrt=Re,s.sub=ze,s.sum=Ve,s.tan=Le,s.tanh=$e,s.trunc=Be,void 0===i&&(i={}),i&&!0!==i.defaults)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)i.hasOwnProperty(n=r[t++])||(i[n]=this[n]);return s.config(i),s}(p);function Ze(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}f=new Ge(f),g=new Ge(g);var Ue={exports:{}};!function(e,i){!function(i){var t=Math.cosh||function(e){return Math.abs(e)<1e-9?1-e:.5*(Math.exp(e)+Math.exp(-e))},n=Math.sinh||function(e){return Math.abs(e)<1e-9?e:.5*(Math.exp(e)-Math.exp(-e))},r=function(){throw SyntaxError("Invalid Param")};function s(e,i){var t=Math.abs(e),n=Math.abs(i);return 0===e?Math.log(n):0===i?Math.log(t):t<3e3&&n<3e3?.5*Math.log(e*e+i*i):.5*Math.log((e/=2)*e+(i/=2)*i)+Math.LN2}function o(e,i){if(!(this instanceof o))return new o(e,i);var t=function(e,i){var t={re:0,im:0};if(null==e)t.re=t.im=0;else if(void 0!==i)t.re=e,t.im=i;else switch(typeof e){case"object":if("im"in e&&"re"in e)t.re=e.re,t.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return o.INFINITY;t.re=e.abs*Math.cos(e.arg),t.im=e.abs*Math.sin(e.arg)}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return o.INFINITY;t.re=e.r*Math.cos(e.phi),t.im=e.r*Math.sin(e.phi)}else 2===e.length?(t.re=e[0],t.im=e[1]):r();break;case"string":t.im=t.re=0;var n=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),s=1,a=0;null===n&&r();for(var u=0;u<n.length;u++){var l=n[u];" "===l||"\t"===l||"\n"===l||("+"===l?s++:"-"===l?a++:"i"===l||"I"===l?(s+a===0&&r()," "===n[u+1]||isNaN(n[u+1])?t.im+=parseFloat((a%2?"-":"")+"1"):(t.im+=parseFloat((a%2?"-":"")+n[u+1]),u++),s=a=0):((s+a===0||isNaN(l))&&r(),"i"===n[u+1]||"I"===n[u+1]?(t.im+=parseFloat((a%2?"-":"")+l),u++):t.re+=parseFloat((a%2?"-":"")+l),s=a=0))}s+a>0&&r();break;case"number":t.im=0,t.re=e;break;default:r()}return isNaN(t.re)||t.im,t}(e,i);this.re=t.re,this.im=t.im}o.prototype={re:0,im:0,sign:function(){var e=this.abs();return new o(this.re/e,this.im/e)},add:function(e,i){var t=new o(e,i);return this.isInfinite()&&t.isInfinite()?o.NAN:this.isInfinite()||t.isInfinite()?o.INFINITY:new o(this.re+t.re,this.im+t.im)},sub:function(e,i){var t=new o(e,i);return this.isInfinite()&&t.isInfinite()?o.NAN:this.isInfinite()||t.isInfinite()?o.INFINITY:new o(this.re-t.re,this.im-t.im)},mul:function(e,i){var t=new o(e,i);return this.isInfinite()&&t.isZero()||this.isZero()&&t.isInfinite()?o.NAN:this.isInfinite()||t.isInfinite()?o.INFINITY:0===t.im&&0===this.im?new o(this.re*t.re,0):new o(this.re*t.re-this.im*t.im,this.re*t.im+this.im*t.re)},div:function(e,i){var t=new o(e,i);if(this.isZero()&&t.isZero()||this.isInfinite()&&t.isInfinite())return o.NAN;if(this.isInfinite()||t.isZero())return o.INFINITY;if(this.isZero()||t.isInfinite())return o.ZERO;e=this.re,i=this.im;var n,r,s=t.re,a=t.im;return 0===a?new o(e/s,i/s):Math.abs(s)<Math.abs(a)?new o((e*(r=s/a)+i)/(n=s*r+a),(i*r-e)/n):new o((e+i*(r=a/s))/(n=a*r+s),(i-e*r)/n)},pow:function(e,i){var t=new o(e,i);if(e=this.re,i=this.im,t.isZero())return o.ONE;if(0===t.im){if(0===i&&e>0)return new o(Math.pow(e,t.re),0);if(0===e)switch((t.re%4+4)%4){case 0:return new o(Math.pow(i,t.re),0);case 1:return new o(0,Math.pow(i,t.re));case 2:return new o(-Math.pow(i,t.re),0);case 3:return new o(0,-Math.pow(i,t.re))}}if(0===e&&0===i&&t.re>0&&t.im>=0)return o.ZERO;var n=Math.atan2(i,e),r=s(e,i);return e=Math.exp(t.re*r-t.im*n),i=t.im*r+t.re*n,new o(e*Math.cos(i),e*Math.sin(i))},sqrt:function(){var e,i,t=this.re,n=this.im,r=this.abs();if(t>=0){if(0===n)return new o(Math.sqrt(t),0);e=.5*Math.sqrt(2*(r+t))}else e=Math.abs(n)/Math.sqrt(2*(r-t));return i=t<=0?.5*Math.sqrt(2*(r-t)):Math.abs(n)/Math.sqrt(2*(r+t)),new o(e,n<0?-i:i)},exp:function(){var e=Math.exp(this.re);return this.im,new o(e*Math.cos(this.im),e*Math.sin(this.im))},expm1:function(){var e=this.re,i=this.im;return new o(Math.expm1(e)*Math.cos(i)+function(e){var i=Math.PI/4;if(-i>e||e>i)return Math.cos(e)-1;var t=e*e;return t*(t*(t*(t*(t*(t*(t*(t/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-.5)}(i),Math.exp(e)*Math.sin(i))},log:function(){var e=this.re,i=this.im;return new o(s(e,i),Math.atan2(i,e))},abs:function(){return e=this.re,i=this.im,t=Math.abs(e),n=Math.abs(i),t<3e3&&n<3e3?Math.sqrt(t*t+n*n):(t<n?(t=n,n=e/i):n=i/e,t*Math.sqrt(1+n*n));var e,i,t,n},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var e=this.re,i=this.im;return new o(Math.sin(e)*t(i),Math.cos(e)*n(i))},cos:function(){var e=this.re,i=this.im;return new o(Math.cos(e)*t(i),-Math.sin(e)*n(i))},tan:function(){var e=2*this.re,i=2*this.im,r=Math.cos(e)+t(i);return new o(Math.sin(e)/r,n(i)/r)},cot:function(){var e=2*this.re,i=2*this.im,r=Math.cos(e)-t(i);return new o(-Math.sin(e)/r,n(i)/r)},sec:function(){var e=this.re,i=this.im,r=.5*t(2*i)+.5*Math.cos(2*e);return new o(Math.cos(e)*t(i)/r,Math.sin(e)*n(i)/r)},csc:function(){var e=this.re,i=this.im,r=.5*t(2*i)-.5*Math.cos(2*e);return new o(Math.sin(e)*t(i)/r,-Math.cos(e)*n(i)/r)},asin:function(){var e=this.re,i=this.im,t=new o(i*i-e*e+1,-2*e*i).sqrt(),n=new o(t.re-i,t.im+e).log();return new o(n.im,-n.re)},acos:function(){var e=this.re,i=this.im,t=new o(i*i-e*e+1,-2*e*i).sqrt(),n=new o(t.re-i,t.im+e).log();return new o(Math.PI/2-n.im,n.re)},atan:function(){var e=this.re,i=this.im;if(0===e){if(1===i)return new o(0,1/0);if(-1===i)return new o(0,-1/0)}var t=e*e+(1-i)*(1-i),n=new o((1-i*i-e*e)/t,-2*e/t).log();return new o(-.5*n.im,.5*n.re)},acot:function(){var e=this.re,i=this.im;if(0===i)return new o(Math.atan2(1,e),0);var t=e*e+i*i;return 0!==t?new o(e/t,-i/t).atan():new o(0!==e?e/0:0,0!==i?-i/0:0).atan()},asec:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new o(0,1/0);var t=e*e+i*i;return 0!==t?new o(e/t,-i/t).acos():new o(0!==e?e/0:0,0!==i?-i/0:0).acos()},acsc:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new o(Math.PI/2,1/0);var t=e*e+i*i;return 0!==t?new o(e/t,-i/t).asin():new o(0!==e?e/0:0,0!==i?-i/0:0).asin()},sinh:function(){var e=this.re,i=this.im;return new o(n(e)*Math.cos(i),t(e)*Math.sin(i))},cosh:function(){var e=this.re,i=this.im;return new o(t(e)*Math.cos(i),n(e)*Math.sin(i))},tanh:function(){var e=2*this.re,i=2*this.im,r=t(e)+Math.cos(i);return new o(n(e)/r,Math.sin(i)/r)},coth:function(){var e=2*this.re,i=2*this.im,r=t(e)-Math.cos(i);return new o(n(e)/r,-Math.sin(i)/r)},csch:function(){var e=this.re,i=this.im,r=Math.cos(2*i)-t(2*e);return new o(-2*n(e)*Math.cos(i)/r,2*t(e)*Math.sin(i)/r)},sech:function(){var e=this.re,i=this.im,r=Math.cos(2*i)+t(2*e);return new o(2*t(e)*Math.cos(i)/r,-2*n(e)*Math.sin(i)/r)},asinh:function(){var e=this.im;this.im=-this.re,this.re=e;var i=this.asin();return this.re=-this.im,this.im=e,e=i.re,i.re=-i.im,i.im=e,i},acosh:function(){var e=this.acos();if(e.im<=0){var i=e.re;e.re=-e.im,e.im=i}else i=e.im,e.im=-e.re,e.re=i;return e},atanh:function(){var e=this.re,i=this.im,t=e>1&&0===i,n=1-e,r=1+e,a=n*n+i*i,u=0!==a?new o((r*n-i*i)/a,(i*n+r*i)/a):new o(-1!==e?e/0:0,0!==i?i/0:0),l=u.re;return u.re=s(u.re,u.im)/2,u.im=Math.atan2(u.im,l)/2,t&&(u.im=-u.im),u},acoth:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new o(0,Math.PI/2);var t=e*e+i*i;return 0!==t?new o(e/t,-i/t).atanh():new o(0!==e?e/0:0,0!==i?-i/0:0).atanh()},acsch:function(){var e=this.re,i=this.im;if(0===i)return new o(0!==e?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var t=e*e+i*i;return 0!==t?new o(e/t,-i/t).asinh():new o(0!==e?e/0:0,0!==i?-i/0:0).asinh()},asech:function(){var e=this.re,i=this.im;if(this.isZero())return o.INFINITY;var t=e*e+i*i;return 0!==t?new o(e/t,-i/t).acosh():new o(0!==e?e/0:0,0!==i?-i/0:0).acosh()},inverse:function(){if(this.isZero())return o.INFINITY;if(this.isInfinite())return o.ZERO;var e=this.re,i=this.im,t=e*e+i*i;return new o(e/t,-i/t)},conjugate:function(){return new o(this.re,-this.im)},neg:function(){return new o(-this.re,-this.im)},ceil:function(e){return e=Math.pow(10,e||0),new o(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)},floor:function(e){return e=Math.pow(10,e||0),new o(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)},round:function(e){return e=Math.pow(10,e||0),new o(Math.round(this.re*e)/e,Math.round(this.im*e)/e)},equals:function(e,i){var t=new o(e,i);return Math.abs(t.re-this.re)<=o.EPSILON&&Math.abs(t.im-this.im)<=o.EPSILON},clone:function(){return new o(this.re,this.im)},toString:function(){var e=this.re,i=this.im,t="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<o.EPSILON&&(e=0),Math.abs(i)<o.EPSILON&&(i=0),0===i?t+e:(0!==e?(t+=e,t+=" ",i<0?(i=-i,t+="-"):t+="+",t+=" "):i<0&&(i=-i,t+="-"),1!==i&&(t+=i),t+"i"))},toVector:function(){return[this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return 0===this.im&&0===this.re},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},o.ZERO=new o(0,0),o.ONE=new o(1,0),o.I=new o(0,1),o.PI=new o(Math.PI,0),o.E=new o(Math.E,0),o.INFINITY=new o(1/0,1/0),o.NAN=new o(NaN,NaN),o.EPSILON=1e-15,Object.defineProperty(o,"__esModule",{value:!0}),o.default=o,o.Complex=o,e.exports=o}()}(Ue);var je=Ze(Ue.exports);const He=8205;function Qe(e){return e===He||65038===e||65039===e||e>=127995&&e<=128e3||e>=129456&&e<=129460||e>=917536&&e<=917632}function We(e){return e>=127462&&e<=127487}class Ye{constructor(e){this.obeyspaces=!1,this.s=function(e){if(/^[\u0020-\u00FF]*$/.test(e))return e;const i=[],t=function(e){const i=[];for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);if(n>=55296&&n<=56319){const i=e.charCodeAt(t+1);i>=56320&&i<=57343&&(n=65536+1024*(n-55296)+(i-56320),t++)}i.push(n)}return i}(e);let n=0;for(;n<t.length;){const e=t[n++],r=t[n];if(r===He){const e=n-1;for(n+=2;t[n]===He;)n+=2;i.push(String.fromCodePoint(...t.slice(e,2*n-e+1)))}else if(Qe(r)){const e=n-1;for(;Qe(t[n]);)n+=t[n]===He?2:1;i.push(String.fromCodePoint(...t.slice(e,2*n-e-1)))}else We(e)?(n+=1,i.push(String.fromCodePoint(...t.slice(n-2,2)))):i.push(String.fromCodePoint(e))}return i}(e),this.pos=0}end(){return this.pos>=this.s.length}get(){return this.pos<this.s.length?this.s[this.pos++]:""}peek(){return this.s[this.pos]}match(e){let i;return i="string"==typeof this.s?e.exec(this.s.slice(this.pos)):e.exec(this.s.slice(this.pos).join("")),i?.[0]?(this.pos+=i[0].length,i[0]):null}next(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]+/))return"<space>";if(this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]/))return"<space>";const e=this.get();if("\\"===e){if(!this.end()){let e=this.match(/^[a-zA-Z*]+/);if(e)this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]*/);else if(e=this.get()," "===e)return"<space>";return"\\"+e}}else{if("{"===e)return"<{>";if("}"===e)return"<}>";if("^"===e){if("^"===this.peek()){this.get();const e=this.match(/^(\^(\^(\^(\^[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f][0-9a-f]/);if(e)return String.fromCodePoint(parseInt(e.slice(e.lastIndexOf("^")+1),16))}return e}if("#"===e){if(!this.end()){let e=!1;if(/[0-9?]/.test(this.peek())&&(e=!0,this.pos+1<this.s.length)){const i=this.s[this.pos+1];e=/[^0-9A-Za-z]/.test(i)}return e?"#"+this.get():"#"}}else if("$"===e)return"$"===this.peek()?(this.get(),"<$$>"):"<$>"}return e}}function Ke(e,i){let t=[],n=e.next();if(n)if("\\relax"===n);else if("\\noexpand"===n)n=e.next(),n&&t.push(n);else if("\\obeyspaces"===n)e.obeyspaces=!0;else if("\\space"===n||"~"===n)t.push("<space>");else if("\\bgroup"===n)t.push("<{>");else if("\\egroup"===n)t.push("<}>");else if("\\string"===n)n=e.next(),n&&("\\"===n[0]?Array.from(n).forEach((e=>t.push("\\"===e?"\\backslash":e))):"<{>"===n?t.push("\\{"):"<space>"===n?t.push("~"):"<}>"===n&&t.push("\\}"));else if("\\csname"===n){for(;"<space>"===e.peek();)e.next();let r="",s=!1,o=[];do{0===o.length&&(/^#[0-9?]$/.test(e.peek())?(o=Je(i?.[e.get().slice(1)]??i?.["?"]??"\\placeholder{}",i),n=o[0]):(n=e.next(),o=n?[n]:[])),s=0===o.length,s||"\\endcsname"!==n||(s=!0,o.shift()),s||(s="<$>"===n||"<$$>"===n||"<{>"===n||"<}>"===n||!!n&&n.length>1&&"\\"===n[0]),s||(r+=o.shift())}while(!s);r&&t.push("\\"+r),t=t.concat(o)}else if("\\endcsname"===n);else if(n.length>1&&"#"===n[0]){const e=n.slice(1);t=t.concat(Je(i?.[e]??i?.["?"]??"\\placeholder{}",i))}else t.push(n);return t}function Je(e,i){const t=e.toString().split(/\r?\n/);let n="",r="";for(const e of t){n+=r,r=" ";const i=e.match(/((?:\\%)|[^%])*/);null!==i&&(n+=i[0])}const s=new Ye(n),o=[];do{o.push(...Ke(s,i))}while(!s.end());return o}function Xe(e){let i="",t="";for(const n of e)n&&(/[a-zA-Z*]/.test(n[0])&&(t+=i),i=/\\[a-zA-Z]+\*?$/.test(n)?" ":"",t+=n);return t}function ei(e){let i=[];if(Array.isArray(e))for(const t of e)Array.isArray(t)?i=[...i,...t]:i.push(t);else i=[e];return Xe(i.map((e=>({"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"}[e]??e))))}function ii(e){return!(null===e||"number"!=typeof e&&!ti(e)&&("string"!=typeof e||!/^[+-]?[0-9]/.test(e)))}function ti(e){return null!==e&&"object"==typeof e&&"num"in e}function ni(e){return null!==e&&"object"==typeof e&&"sym"in e}function ri(e){return null!==e&&"object"==typeof e&&"fn"in e}function si(e){return!/[\u0000-\u0020\u0022\u0060\ufffe\uffff]/.test(e)&&!/^[\u0021\u0022\u0024-\u0029\u002e\u003a\u003f\u0040\u005b\u005d\u005e\u007b\u007d\u007e\+\-[0-9]]/.test(e)}function oi(e){return null==e?null:"object"==typeof e&&"str"in e?e.str:"string"!=typeof e||e.length<2||"'"!==e[0]||"'"!==e[e.length-1]?null:e.substring(1,e.length-1)}function ai(e){if(null==e||null!==oi(e))return null;const i=ui(e);return null!==i?[i,...(ci(e)??[]).map((e=>ai(e))).filter((e=>null!==e))]:e}function ui(e){return null==e?null:Array.isArray(e)?e[0]:ri(e)?e.fn[0]:null}function li(e){const i=ui(e);return"string"==typeof i?i:""}function ci(e){return null==e?null:Array.isArray(e)?e.slice(1):ri(e)?e.fn.slice(1):null}function hi(e,i){return null==e?null:Array.isArray(e)?e[i]??null:ri(e)?e.fn[i]??null:null}function mi(e){return hi(e,1)}function fi(e){return hi(e,2)}function gi(e){return null==e?0:Array.isArray(e)?Math.max(0,e.length-1):ri(e)?Math.max(0,e.fn.length-1):0}function pi(e){if(null==e)return null;if("string"==typeof e){if(/^[+\-\.0-9]/.test(e))return null;if(e.length>=2&&"'"===e[0]&&"'"===e[e.length-1])return null}const i=ni(e)?e.sym:e;return"string"!=typeof i?null:i}function di(e){const i=ui(e);if("KeyValuePair"===i||"Tuple"===i||"Pair"===i){const i=oi(mi(e));return i?[i,fi(e)??"Nothing"]:null}return null}function bi(e){if(null===e)return null;if("object"==typeof e&&"dict"in e)return e.dict;const i=di(e);if(i)return{[i[0]]:i[1]};if("Dictionary"===ui(e)){const i={};for(let t=1;t<gi(e);t++){const n=di(hi(e,t));n&&(i[n[0]]=n[1])}return i}return null}function yi(e){if("nan"===(e=e.toLowerCase().replace(/[nd]$/g,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,"")))return NaN;if("+infinity"===e)return 1/0;if("-infinity"===e)return-1/0;if(/\([0-9]+\)/.test(e)){const[i,t,n,r]=e.match(/(.+)\(([0-9]+)\)(.*)$/)??[];e=t+n.repeat(Math.ceil(16/n.length))+(r??"")}return parseFloat(e)}function vi(e){return null==e?null:"number"==typeof e?e:ti(e)?yi(e.num):"string"==typeof e?yi(e):null}function Ni(e){if(null==e)return null;if("Half"===pi(e))return[1,2];const i=ui(e);if(!i)return null;let t=null,n=null;if("Negate"===i){const i=Ni(mi(e));if(i)return[-i[0],i[1]]}if("Rational"!==i&&"Divide"!==i||(t=vi(mi(e))??NaN,n=vi(fi(e))??NaN),"Power"===i){const i=vi(fi(e));1===i?(t=vi(mi(e)),n=1):-1===i&&(t=1,n=vi(mi(e)))}return"Multiply"===i&&"Power"===ui(fi(e))&&-1===vi(fi(fi(e)))&&(t=vi(mi(e)),n=vi(mi(fi(e)))),null===t||null===n?null:Number.isInteger(t)&&Number.isInteger(n)?[t,n]:null}function _i(e,i){const t=ui(e);if(null!==t)return[_i(t,i),...(ci(e)??[]).map((e=>_i(e,i)))];const n=bi(e);if(null!==n){const e=Object.keys(n),t={};for(const r of e)t[r]=_i(n[r],i);return{dict:t}}const r=pi(e);return r&&i[r]?i[r]:e}function xi(e,i){let t=null;if(Array.isArray(e)&&(t=e),ri(e)&&(t=e.fn),null===t)return[];let n=1;const r=[];for(;n<t.length;)r.push(i(t[n])),n+=1;return r}function Si(e,i,t,n="both"){if("non"===n)return[e,i,t];const r=ui(i),s=ui(t);return"left"===n?r===e?[e,...ci(i)??[],t]:[e,i,t]:"right"===n?s===e?[e,i,...ci(t)??[]]:[e,i,t]:r===e&&s===e?[e,...ci(i)??[],...ci(t)??[]]:r===e?[e,...ci(i)??[],t]:s===e?[e,i,...ci(t)??[]]:[e,i,t]}function wi(e){let i=ui(e);if(null===e)return null;if("Delimiter"===i){if(null===(e=hi(e,1)))return[];if("Sequence"!==ui(e))return[e]}return i=ui(e),"Sequence"===i?ci(e)??[]:null}function ki(e){return null!==e&&"Sequence"===ui(e)&&0===gi(e)}function Ei(e){return null===e||ki(e)?["Error","'missing'"]:e}function Ii(e){return"Square"===e[0]?Ii(e.slice(1))+2:e.reduce(((e,i)=>e+Ai(i)),0)}function Ai(e){if(null===e)return 0;if("number"==typeof e||"string"==typeof e)return 1;if(ii(e)||ni(e)||function(e){return null!==e&&"object"==typeof e&&"str"in e}(e))return 1;if(Array.isArray(e))return Ii(e);if("fn"in e)return Ii(e.fn);const i=bi(e);if(i){const e=Object.keys(i);return 1+e.length+e.reduce(((e,t)=>e+Ai(i[t])),0)}return 0}function Mi(e,i){return i>2?"solidus":"radical"}function qi(e,i){if(i>3)return"inline-solidus";if("Divide"===ui(e)){const[i,t]=[Ai(mi(e)),Ai(fi(e))];if(t<=2&&i>3)return"factor";if(i<=2&&t>3)return"reciprocal"}return"quotient"}function Ci(e,i,t,n){return null===t?"\\sqrt{}":(n=n??2,"solidus"===i?e.wrapShort(t)+"^{1\\/"+e.serialize(n)+"}":"quotient"===i?e.wrapShort(t)+"^{\\frac{1}{"+e.serialize(n)+"}}":2===vi(n)?"\\sqrt{"+e.serialize(t)+"}":"\\sqrt["+e.serialize(n)+"]{"+e.serialize(t)+"}")}function Di(e,i){if(null===i)return"";const t=Ei(hi(i,1)),n=Ei(hi(i,2)),r=qi(i,e.level);if("inline-solidus"===r||"nice-solidus"===r){const i=e.wrapShort(t),s=e.wrapShort(n);return"inline-solidus"===r?`${i}\\/${s}`:`^{${i}}\\!\\!/\\!_{${s}}`}return"reciprocal"===r?1===vi(t)?e.wrap(n)+"^{-1}":e.wrap(t)+e.wrap(n)+"^{-1}":"factor"===r?1===vi(n)?e.wrap(t):"\\frac{1}{"+e.serialize(n)+"}"+e.wrap(t):`\\frac{${e.serialize(t)}}{${e.serialize(n)}}`}function Fi(e,i){const t=ui(i),n=Ei(hi(i,1));if("Sqrt"===t)return Ci(e,Mi(0,e.level-1),n,2);const r=Ei(hi(i,2));if("Root"===t)return Ci(e,Mi(0,e.level-1),n,r);const s=vi(r)??1;if(-1===s)return e.serialize(["Divide","1",n]);if(s<0)return e.serialize(["Divide","1",["Power",n,-s]]);if("Divide"===ui(r)||"Rational"===ui(r)){if(1===vi(hi(r,1)))return Ci(e,Mi(0,e.level),n,hi(r,2));if(2===vi(hi(r,2)))return`${e.serialize(["Sqrt",n])}^{${e.serialize(hi(r,1))}}`}else if("Power"===ui(r)&&-1===vi(hi(r,2)))return Ci(e,Mi(0,e.level),n,hi(r,1));return e.wrapShort(n)+"^{"+e.serialize(r)+"}"}const Ti=[{name:"CatalanConstant",serialize:"G"},{name:"GoldenRatio",serialize:"\\varphi"},{name:"EulerGamma",serialize:"\\gamma"},{name:"Degrees",trigger:["\\degree"],kind:"postfix",precedence:880,parse:(e,i)=>["Degrees",i],serialize:(e,i)=>Xe([e.serialize(hi(i,1)),"\\degree"])},{trigger:["\\deg"],kind:"postfix",precedence:880,parse:(e,i)=>["Degrees",i]},{trigger:["^","<{>","\\circ","<}>"],kind:"postfix",parse:(e,i)=>["Degrees",i]},{trigger:["^","\\circ"],kind:"postfix",parse:(e,i)=>["Degrees",i]},{trigger:["\xb0"],kind:"postfix",precedence:880,parse:(e,i)=>["Degrees",i]},{trigger:["\\ang"],parse:e=>{const i=e.matchRequiredLatexArgument();return null===i?["Degrees"]:["Degrees",i]}},{trigger:["\\infty"],parse:{num:"+Infinity"}},{name:"ComplexInfinity",trigger:["\\tilde","\\infty"],serialize:"\\tilde\\infty"},{trigger:["\\tilde","<{>","\\infty","<}>"],parse:"ComplexInfinity"},{name:"Pi",trigger:["\\pi"]},{trigger:["\u03c0"],parse:"Pi"},{name:"ExponentialE",trigger:["\\exponentialE"],parse:"ExponentialE",serialize:"\\exponentialE"},{name:"ImaginaryUnit",trigger:["\\imaginaryI"]},{name:"Abs",kind:"matchfix",openDelimiter:"|",closeDelimiter:"|",parse:(e,i)=>ki(i)?null:["Abs",i]},{trigger:"abs",kind:"function",parse:e=>{const i=e.matchArguments("enclosure");return null===i?"Abs":["Abs",...i]}},{name:"Add",trigger:["+"],kind:"infix",associativity:"both",precedence:275,parse:(e,i,t)=>{if(275<i.minPrec)return null;const n=e.matchExpression({...i,minPrec:275});return null===n?null:Si("Add",t,n)},serialize:function(e,i){e.level-=1;const t=ui(i);let n="",r=hi(i,1);if("Negate"===t)n="-"+e.wrap(r,276);else if("Add"===t){if(2===gi(i)){let t,r;if(vi(hi(i,1))&&Ni(hi(i,2))?(t=hi(i,1),r=hi(i,2)):vi(hi(i,2))&&Ni(hi(i,1))&&(t=hi(i,2),r=hi(i,1)),t&&r){const i=vi(t)??NaN,s=Ni(r)??[NaN,NaN];if(isFinite(i)&&Number.isInteger(i)&&i>=0&&i<=1e3&&isFinite(s[0])&&isFinite(s[1])&&s[0]>0&&s[0]<=100&&s[1]<=100)return n=Xe([e.serialize(t),e.options.invisiblePlus,e.serialize(r)]),e.level+=1,n}}let t=vi(r)??NaN;n=e.serialize(r);const s=gi(i)+1;for(let o=2;o<s;o++)if(r=hi(i,o),t=vi(r)??NaN,t<0)n+=e.serialize(r);else if("Negate"===ui(r))n+=e.wrap(r,275);else{const i=e.wrap(r,275);"-"===i[0]||"+"===i[0]?n+=i:n+="+"+i}}else if("Subtract"===t){n=e.wrap(r,275);const t=hi(i,2);if(null!==t){const i=e.wrap(t,275);"-"===i[0]?n+="+"+i.slice(1):"+"===i[0]?n+="-"+i.slice(1):n=n+"-"+i}}return e.level+=1,n}},{kind:"prefix",trigger:["+"],precedence:275,parse:(e,i)=>275<i.minPrec?null:e.matchExpression({...i,minPrec:400})},{name:"Ceil",kind:"matchfix",openDelimiter:"\\lceil",closeDelimiter:"\\rceil"},{trigger:"ceil",kind:"function",parse:e=>{const i=e.matchArguments("enclosure");return null===i?"Ceil":["Ceil",...i]}},{name:"Complex",precedence:274,serialize:(e,i)=>{const t=vi(hi(i,1)),n=vi(hi(i,2));if(0===n)return e.serialize(hi(i,1));const r=1===n?"\\imaginaryI":-1===n?"-\\imaginaryI":Xe([e.serialize(hi(i,2)),"\\imaginaryI"]);return 0===t?r:Xe(null!==n&&n<0?[e.serialize(hi(i,1)),r]:[e.serialize(hi(i,1)),"+",r])}},{name:"Divide",trigger:"\\frac",precedence:660,parse:function(e){const i=Ei(e.matchRequiredLatexArgument()),t=Ei(e.matchRequiredLatexArgument());if("PartialDerivative"===ui(i)&&("PartialDerivative"===ui(t)||"Multiply"===ui(t)&&"PartialDerivative"===ui(hi(t,1)))){const n=hi(i,3)??null;let r=hi(i,1);null===r&&(r=Ei(e.matchExpression()));let s=[];if("Multiply"===ui(t)){for(const e of ci(t)??[])if("PartialDerivative"===ui(e)){const i=hi(e,2);i&&s.push(i)}}else{const e=hi(t,2);e&&s.push(e)}return s.length>1&&(s=["List",...s]),["PartialDerivative",r,...s,null===n?1:n]}return["Divide",i,t]},serialize:Di},{kind:"infix",trigger:"\\over",precedence:660,parse:"Divide"},{trigger:["\\/"],kind:"infix",associativity:"non",precedence:660,parse:"Divide"},{trigger:["/"],kind:"infix",associativity:"non",precedence:660,parse:"Divide"},{trigger:["\\div"],kind:"infix",associativity:"non",precedence:660,parse:"Divide"},{name:"Exp",serialize:(e,i)=>Xe(["\\exponentialE^{",e.serialize(Ei(hi(i,1))),"}"])},{name:"Factorial",trigger:["!"],kind:"postfix",precedence:810},{name:"Factorial2",trigger:["!","!"],kind:"postfix",precedence:810},{name:"Floor",kind:"matchfix",openDelimiter:"\\lfloor",closeDelimiter:"\\rfloor"},{trigger:"floor",kind:"function",parse:e=>{const i=e.matchArguments("enclosure");return null===i?"Floor":["Floor",...i]}},{name:"Gcd",trigger:"gcd",kind:"function"},{name:"Half",serialize:"\\frac12"},{name:"Lg",trigger:["\\lg"],serialize:(e,i)=>"\\log_{10}"+e.wrapArguments(i),parse:e=>{const i=e.matchArguments("implicit");return null===i?["Lg"]:["Log",...i,10]}},{name:"Lb",trigger:"\\lb",parse:e=>{const i=e.matchArguments("implicit");return null===i?["Log"]:["Log",...i,2]}},{name:"Ln",trigger:["\\ln"],serialize:(e,i)=>"\\ln"+e.wrapArguments(i),parse:e=>Ri("Ln",e)},{name:"Log",trigger:["\\log"],parse:e=>Ri("Log",e),serialize:(e,i)=>{const t=fi(i);return t?Xe(["\\log_{",t.toString(),"}",e.wrap(mi(i))]):"\\log"+e.wrapArguments(i)}},{name:"Lcm",trigger:"lcm",kind:"function"},{name:"MinusPlus",trigger:["\\mp"],kind:"infix",associativity:"both",precedence:270},{name:"Multiply",trigger:["\\times"],kind:"infix",associativity:"both",precedence:390,serialize:function e(i,t){if(null===t)return"";i.level-=1;let n="";const[r,s]=function(e){if("Multiply"!==ui(e))return[[],[]];const i=[],t=[],n=ci(e)??[];for(const e of n)if("Power"===ui(e)){const n=hi(e,1),r=hi(e,2);if("Negate"===ui(r)){const e=hi(r,1);n&&e&&t.push(["Power",n,e])}else{const s=vi(r)??NaN;-1===s?n&&t.push(n):s<0?n&&t.push(["Power",n,-s]):i.push(e)}}else if("Rational"===ui(e)&&2===gi(e)){const n=hi(e,1),r=hi(e,2);1!==vi(n)&&i.push(n),1!==vi(r)&&t.push(r)}else{const n=Ni(e);null!==n?(1!==n[0]&&i.push(n[0]),t.push(n[1])):i.push(e)}return[i,t]}(t);if(s.length>0&&(n=1===s.length&&1===s[0]?0===r.length?"1":1===r.length?i.serialize(r[0]):e(i,["Multiply",...r]):i.serialize(["Divide",1===r.length?r[0]:["Multiply",...r],1===s.length?s[0]:["Multiply",...s]])),n)return i.level+=1,n;let o=!1,a=null;const u=gi(t)+1;let l=!1;for(let e=1;e<u;e++){if(a=hi(t,e),null===a)continue;let r;if(ii(a))r=i.serialize(a),"-1"!==r||n?("-"===r[0]&&(r=r.slice(1),o=!o),n=n?Xe([n,i.options.multiply,r]):r):(n="",o=!o),l=!0;else{if("Power"===ui(a)){const e=Ni(hi(a,2));if(e){const[t,r]=e;if(1===t&&null!==r){n+=Ci(i,Mi(0,i.level),hi(a,1),r),l=!1;continue}}}if("Power"!==ui(a)||isNaN(vi(hi(a,1))??NaN)){if("Negate"===ui(a)&&(a=hi(a,1),o=!o),r=i.wrap(a,390),n){const e=ui(a);n=!l||"Divide"!==e&&"Rational"!==e?i.options.invisibleMultiply?Xe([n,i.options.invisibleMultiply,r]):Xe([n,r]):Xe([n,i.options.multiply,r])}else n=r;l=!1}else r=i.serialize(a),n=n?Xe([n,i.options.multiply,r]):r,l=!0}}return i.level+=1,o?"-"+n:n}},{trigger:["\\cdot"],kind:"infix",associativity:"both",precedence:390,parse:(e,i,t)=>{if(391<i.minPrec)return null;const n=e.matchExpression({...i,minPrec:392});return null===n?["Multiply",t,["Error","'missing'"]]:Si("Multiply",t,n)}},{trigger:["*"],kind:"infix",associativity:"both",precedence:390,parse:(e,i,t)=>{if(391<i.minPrec)return null;const n=e.matchExpression({...i,minPrec:392});return null===n?["Multiply",t,["Error","'missing'"]]:Si("Multiply",t,n)}},{name:"Negate",trigger:["-"],kind:"prefix",parse:(e,i)=>276<i.minPrec?null:["Negate",Ei(e.matchExpression({...i,minPrec:400}))],precedence:275},{kind:"matchfix",openDelimiter:"||",closeDelimiter:"||",parse:(e,i)=>ki(i)?null:["Norm",i]},{name:"Norm",kind:"matchfix",openDelimiter:["\\left","\\Vert"],closeDelimiter:["\\right","\\Vert"]},{name:"PlusMinus",trigger:["\\pm"],kind:"infix",associativity:"both",precedence:270},{name:"Power",trigger:["^"],kind:"infix",serialize:Fi},{trigger:"\\prod",precedence:265,name:"Product",parse:Oi("Product"),serialize:Pi("\\prod")},{name:"Rational",precedence:660,serialize:(e,i)=>i&&1===gi(i)?"\\mathrm{Rational}"+e.wrapArguments(i):Di(e,i)},{name:"Root",serialize:Fi},{name:"Round",trigger:"round",kind:"function"},{name:"Square",precedence:720,serialize:(e,i)=>e.wrapShort(hi(i,1))+"^2"},{trigger:"\\sum",precedence:265,name:"Sum",parse:Oi("Sum"),serialize:Pi("\\sum")},{name:"Sign",trigger:"sgn",kind:"function"},{name:"Sqrt",trigger:["\\sqrt"],parse:function(e){const i=e.matchOptionalLatexArgument(),t=e.matchRequiredLatexArgument();return null===t||ki(t)?null!==i?["Root",["Error","'missing'"],Ei(i)]:["Sqrt",["Error","'missing'"]]:null!==i?["Root",t,i]:["Sqrt",t]},serialize:Fi},{name:"Subtract",trigger:["-"],kind:"infix",associativity:"both",precedence:275,parse:(e,i,t)=>276<i.minPrec?null:["Subtract",t,Ei(e.matchExpression({...i,minPrec:277}))]}];function Oi(e){return i=>{i.skipSpace();let t=null,n=null;for(;!(n&&t||"_"!==i.peek&&"^"!==i.peek);)i.match("_")?n=i.matchRequiredLatexArgument():i.match("^")&&(t=i.matchRequiredLatexArgument()),i.skipSpace();("Nothing"===n||ki(n))&&(n=null),("Nothing"===t||ki(t))&&(t=null);let r=null,s=null;"Equal"===ui(n)?(r=hi(n,1),s=hi(n,2)):r=n;const o=pi(r);o&&i.computeEngine?.pushScope({[o]:{domain:"Integer"}});const a=i.matchExpression({minPrec:266});return o&&i.computeEngine?.popScope(),a?t?[e,a,["Tuple",r?["Hold",r]:"Nothing",s??1,t]]:s?[e,a,["Tuple",r?["Hold",r]:"Nothing",s]]:r?[e,a,["Tuple",["Hold",r]]]:[e,a]:[e]}}function Pi(e){return(i,t)=>{if(!hi(t,1))return e;let n=hi(t,2);const r=ui(n);"Tuple"!==r&&"Triple"!==r&&"Pair"!==r&&"Single"!==r&&(n=null);let s=hi(n,1);s&&"Hold"===ui(s)&&(s=hi(s,1));const o=hi(t,1);if(!n)return hi(t,2)?Xe([e,"_{",i.serialize(hi(t,2)),"}",i.serialize(o)]):Xe([e,"_n",i.serialize(o)]);const a=hi(n,2);let u=[];s&&"Nothing"!==pi(s)&&a?u=[i.serialize(s),"=",i.serialize(a)]:s&&"Nothing"!==pi(s)?u=[i.serialize(s)]:a&&(u=[i.serialize(a)]),u.length>0&&(u=["_{",...u,"}"]);let l=[];return hi(n,3)&&(l=["^{",i.serialize(hi(n,3)),"}"]),Xe([e,...l,...u,i.serialize(o)])}}function Ri(e,i){let t=null,n=null;i.match("_")&&(t=i.matchStringArgument()??i.next(),n=Number.parseFloat(t??"10"));const r=i.matchArguments("implicit");return null===r?[e]:10===n?["Log",r[0]]:2===n?["Lb",...r]:null===t?[e,...r]:["Log",...r,t]}function zi(e,i,t,n,r){if(i.minPrec>=n)return null;const s=[t];let o=!1;for(;!o;){for(o=!0,e.skipSpace();e.match(r);)s.push("Nothing"),e.skipSpace();if(e.atTerminator(i))s.push("Nothing");else{const t=e.matchExpression({...i,minPrec:n});s.push(t??"Nothing"),o=null===t}o||(e.skipSpace(),o=!e.match(r))}return s}function Vi(e=""){return(i,t)=>(ci(t)??[]).map((e=>i.serialize(e))).join(e)}const Li=[{trigger:["\\placeholder"],parse:e=>{if(e.skipSpaceTokens(),e.match("["))for(;!e.match("]")&&!e.atBoundary;)e.next();if(e.skipSpaceTokens(),e.match("<{>"))for(;!e.match("<}>")&&!e.atBoundary;)e.next();return"Nothing"}},{name:"BaseForm",kind:"function",serialize:(e,i)=>{const t=vi(hi(i,2))??NaN;if(isFinite(t)&&t>=2&&t<=36){const e=vi(hi(i,1))??NaN;if(isFinite(e)&&Number.isInteger(e)){let i=Number(e).toString(t),n=0;if(2===t||10===t?n=4:16===t?n=2:t>16&&(n=4),n>0){const e=i;i="";for(let t=0;t<e.length;t++)t>0&&t%n==0&&(i="\\, "+i),i=e[e.length-t-1]+i}return`(\\text{${i}}_{${t}}`}}return"\\operatorname{BaseForm}("+e.serialize(hi(i,1))+", "+e.serialize(hi(i,2))+")"}},{name:"Delimiter",serialize:(e,i)=>{const t=gi(i);if(0===t)return"";const n=e.options.groupStyle(i,e.level+1),r=hi(i,1);if(1===t)return e.wrapString(e.serialize(r),n);let s="",o="",a="";if(t>1){const e=oi(hi(i,2))??"";o=e[0]??"",a=e[1]??"",s=e[2]??""}const u="List"===ui(r)?Vi(s)(e,r):e.serialize(r);return e.wrapString(u,n,oi(hi(i,2))??void 0),o&&a?`${o} ${u} ${a}`:e.wrapString(u,n)}},{name:"Domain",serialize:(e,i)=>"Error"===ui(i)?e.serialize(i):`\\mathbf{${e.serialize(hi(i,1))}}`},{trigger:["\\mathtip"],parse:e=>{const i=e.matchRequiredLatexArgument();return e.matchRequiredLatexArgument(),i}},{trigger:["\\texttip"],parse:e=>{const i=e.matchRequiredLatexArgument();return e.matchRequiredLatexArgument(),i}},{trigger:["\\error"],parse:e=>e.matchRequiredLatexArgument()},{name:"Error",serialize:(e,i)=>{if("missing"===oi(hi(i,1)))return`\\error{${e.options.missingSymbol??"\\placeholder{}"}}`;const t=function(e,i){const t=hi(i,2);return t?"Latex"===ui(t)?`\\texttt{${Bi(oi(hi(t,1))??"")}}`:"Hold"===ui(t)?e.serialize(hi(t,1)):e.serialize(t):""}(e,i)||"\\blacksquare",n=hi(i,1),r="ErrorCode"===ui(n)?oi(hi(n,1)):oi(n);return"incompatible-domain"===r?`\\mathtip{\\error{${t}}}{\\in ${e.serialize(hi(n,3))}\\notin ${e.serialize(hi(n,2))}}`:"missing"===r?`\\mathtip{\\error{${t}}}{${e.serialize(hi(n,2))}\\text{ missing}}`:`\\error{${t}}`}},{name:"ErrorCode",serialize:(e,i)=>{const t=oi(hi(i,1));return"missing"===t?e.options.missingSymbol??"\\placeholder{}":"unexpected-command"===t||"unexpected-operator"===t||"unexpected-token"===t||"invalid-symbol-name"===t||"unknown-environment"===t||"unexpected-base"===t||"incompatible-domain"===t||"invalid-domain-expression"===t?"":`\\texttip{\\error{\\blacksquare}}{\\mathtt{${t}}}`}},{name:"FromLatex",serialize:(e,i)=>`\\texttt{${Bi(oi(hi(i,1)))}}`},{name:"Latex",serialize:(e,i)=>null===i?"":Xe(xi(i,(i=>oi(i)??e.serialize(i))))},{name:"LatexString",serialize:(e,i)=>null===i?"":Xe(xi(i,(i=>e.serialize(i))))},{name:"LatexTokens",serialize:function(e,i){return null===i?"":Xe(xi(i,(i=>{const t=oi(i);return null===t?e.serialize(i):"<{>"===t?"{":"<}>"===t?"}":"<$>"===t?"$":"<$$>"===t?"$$":"<space>"===t?" ":t})))}},{name:"List",kind:"matchfix",openDelimiter:"[",closeDelimiter:"]",parse:(e,i)=>null===i?["List"]:"Sequence"!==ui(i)&&"List"!==ui(i)?["List",i]:["List",...ci(i)??[]],serialize:(e,i)=>Xe(["\\lbrack",Vi(", ")(e,i),"\\rbrack"])},{kind:"matchfix",openDelimiter:"(",closeDelimiter:")",parse:(e,i)=>null===i?null:"Sequence"===ui(i)||"List"===ui(i)?0===gi(i)?["Delimiter"]:["Delimiter",["Sequence",...ci(i)??[]]]:["Delimiter",i]},{trigger:[","],kind:"infix",precedence:20,parse:(e,i,t)=>{const n=zi(e,i,t,20,",");return null===n?null:["Sequence",...n]}},{name:"Sequence",serialize:Vi("")},{trigger:[";"],kind:"infix",precedence:19,parse:(e,i,t)=>{const n=zi(e,i,t,19,";");return null===n?null:["Sequence",...n.map((e=>"Sequence"===ui(e)?["List",...ci(e)??[]]:e))]}},{name:"String",trigger:["\\text"],parse:e=>$i(e),serialize:(e,i)=>{const t=ci(i);return null===t||0===t.length?"\\text{}":Xe(["\\text{",t.map((i=>e.serialize(i))).join(""),"}"])}},{name:"Subscript",trigger:["_"],kind:"infix",serialize:(e,i)=>2===gi(i)?e.serialize(hi(i,1))+"_{"+e.serialize(hi(i,2))+"}":"_{"+e.serialize(hi(i,1))+"}"},{name:"Superplus",trigger:["^","+"],kind:"postfix"},{name:"Subplus",trigger:["_","+"],kind:"postfix"},{name:"Superminus",trigger:["^","-"],kind:"postfix"},{name:"Subminus",trigger:["_","-"],kind:"postfix"},{trigger:["^","*"],kind:"postfix",parse:(e,i)=>["Superstar",i]},{name:"Superstar",trigger:["^","\\star"],kind:"postfix"},{trigger:["_","*"],kind:"postfix",parse:(e,i)=>["Substar",i]},{name:"Substar",trigger:["_","\\star"],kind:"postfix"},{name:"Superdagger",trigger:["^","\\dagger"],kind:"postfix"},{trigger:["^","\\dag"],kind:"postfix",parse:(e,i)=>["Superdagger",i]},{name:"Prime",trigger:["^","\\prime"],kind:"postfix"},{trigger:["^","\\doubleprime"],kind:"postfix",parse:(e,i)=>["Prime",Ei(i),2]},{name:"InverseFunction",serialize:(e,i)=>e.serialize(hi(i,1))+"^{-1}"},{name:"Derivative",serialize:(e,i)=>{const t=vi(hi(i,1))??NaN;if(!isFinite(t))return"";const n=e.serialize(hi(i,2));return 1===t?n+"^{\\prime}":2===t?n+"^{\\doubleprime}":n+"^{("+Number(t).toString()+")}"}},{name:"Which",trigger:"cases",kind:"environment",parse:e=>{const i=e.matchTabular("cases");if(!i)return["Which"];const t=["Which"];for(const e of i)if(1===e.length)t.push("True"),t.push(e[0]);else if(2===e.length){const i=oi(e[1]);t.push(i?"True":ai(e[1])??"True"),t.push(e[0])}return t},serialize:(e,i)=>{if("List"!==ui(hi(i,1)))return"";const t=ci(hi(i,1))??[],n=[];let r="";for(const i of t){if(("Tuple"===ui(i)||"Pair"===ui(i))&&(n.push(r),hi(i,2))){n.push(e.serialize(hi(i,2)));const t=hi(i,1);null!==t&&n.push("&",e.serialize(t))}r="\\\\"}return Xe(["\\begin{cases}",...n,"\\end{cases}"])}}];function $i(e,i){if(!e.match("<{>"))return"''";const t=[];let n,r="",s=null;for(;!e.atEnd&&!e.match("<}>");)if("<{>"===e.peek)t.push($i(e));else if(e.match("\\textbf")&&e.match("<{>"))t.push($i(e,{"font-weight":"bold"}));else if(e.match("\\color")&&e.match("<{>")){const i=e.matchColor();i&&e.match("<}>")&&(null!==s&&r?t.push(["Style",r,{dict:s}]):r&&t.push(["String",r]),r="",s={color:i})}else if(e.match("<space>"))r+=" ";else if(e.match("<$>")){const i=e.index,n=e.matchExpression()??["Sequence"];e.skipSpace(),e.match("<$>")?t.push(n):(r+="$",e.index=i)}else if(e.match("<$$>")){const i=e.index,n=e.matchExpression()??["Sequence"];e.skipSpace(),e.match("<$$>")?t.push(n):(r+="$$",e.index=i)}else r+=e.matchChar()??"";return null!==s&&r?t.push(["Style",`'${r}'`,{dict:s}]):r&&t.push(`'${r}'`),n=1===t.length?t[0]:t.every((e=>null!==oi(e)))?"'"+t.map((e=>oi(e))).join()+"'":["String",...t],i?["Style",n,{dict:i}]:n}function Bi(e){return null===e?"":e.replace(/[{}\[\]\\:\-\$%]/g,(e=>({"{":"\\lbrace ","}":"\\rbrace ","[":"\\lbrack ","]":"\\rbrack ",":":"\\colon ","\\":"\\backslash "}[e]??"\\"+e)))}function Gi(e){return i=>{const t=i.matchRequiredLatexArgument();return null===t?[e]:[e,t]}}const Zi=[{name:"Overscript",trigger:["\\overset"],kind:"infix",precedence:700},{name:"Underscript",trigger:["\\underset"],kind:"infix",precedence:700},{name:"Increment",trigger:["+","+"],kind:"postfix",precedence:880},{name:"Decrement",trigger:["-","-"],kind:"postfix",precedence:880},{name:"PreIncrement",trigger:["+","+"],kind:"prefix",precedence:880},{name:"PreDecrement",trigger:["-","-"],kind:"prefix",precedence:880},{name:"Ring",trigger:["\\circ"],kind:"infix",precedence:265},{name:"Transpose",trigger:["^","T"],kind:"infix"},{name:"ConjugateTranspose",trigger:["^","H"],kind:"infix"},{name:"StringJoin",trigger:["\\lt","\\gt"],kind:"infix",precedence:780},{name:"Starstar",trigger:["\\star","\\star"],kind:"infix",precedence:780},{name:"PartialDerivative",trigger:["\\partial"],kind:"prefix",parse:e=>{let i=!1,t="Nothing",n="Nothing";for(;!i;)e.skipSpace(),e.match("_")?n=e.matchRequiredLatexArgument():e.match("^")?t=e.matchRequiredLatexArgument():i=!0;const r=wi(n);if(r&&(n=["List",...r]),null===n||null===t)return null;let s=e.matchRequiredLatexArgument()??"Nothing";return"Nothing"===s||ki(s)||(s=[s,...e.matchArguments("enclosure")??["Nothing"]]),["PartialDerivative",s,n,t]},serialize:(e,i)=>{let t="\\partial";const n=hi(i,1),r=hi(i,2),s=hi(i,3);return null!==r&&"Nothing"!==r&&("List"===ui(r)?t+="_{"+e.serialize(["Sequence",...ci(r)??[]])+"}":t+="_{"+e.serialize(r)+"}"),null!==s&&"Nothing"!==s&&(t+="^{"+e.serialize(s)+"}"),null!==n&&"Nothing"!==n&&(t+=e.serialize(n)),t},precedence:740},{name:"OverBar",trigger:["\\overline"],parse:Gi("OverBar")},{name:"UnderBar",trigger:["\\underline"],parse:Gi("UnderBar")},{name:"OverVector",trigger:["\\vec"],parse:Gi("OverVector")},{name:"OverTilde",trigger:["\\tilde"],parse:Gi("OverTilde")},{name:"OverHat",trigger:["\\hat"],parse:Gi("OverHat")},{name:"OverRightArrow",trigger:["\\overrightarrow"],parse:Gi("OverRightArrow")},{name:"OverLeftArrow",trigger:["\\overleftarrow"],parse:Gi("OverLeftArrow")},{name:"OverRightDoubleArrow",trigger:["\\Overrightarrow"],parse:Gi("OverRightDoubleArrow")},{name:"OverLeftHarpoon",trigger:["\\overleftharpoon"],parse:Gi("OverLeftHarpoon")},{name:"OverRightHarpoon",trigger:["\\overrightharpoon"],parse:Gi("OverRightHarpoon")},{name:"OverLeftRightArrow",trigger:["\\overleftrightarrow"],parse:Gi("OverLeftRightArrow")},{name:"OverBrace",trigger:["\\overbrace"],parse:Gi("OverBrace")},{name:"OverLineSegment",trigger:["\\overlinesegment"],parse:Gi("OverLineSegment")},{name:"OverGroup",trigger:["\\overgroup"],parse:Gi("OverGroup")},{trigger:["\\displaystyle"],parse:()=>["Sequence"]},{trigger:["\\textstyle"],parse:()=>["Sequence"]},{trigger:["\\scriptstyle"],parse:()=>["Sequence"]},{trigger:["\\scriptscriptstyle"],parse:()=>["Sequence"]},{trigger:["\\tiny"],parse:()=>["Sequence"]},{trigger:["\\scriptsize"],parse:()=>["Sequence"]},{trigger:["\\footnotesize"],parse:()=>["Sequence"]},{trigger:["\\small"],parse:()=>["Sequence"]},{trigger:["\\normalsize"],parse:()=>["Sequence"]},{trigger:["\\large"],parse:()=>["Sequence"]},{trigger:["\\Large"],parse:()=>["Sequence"]},{trigger:["\\LARGE"],parse:()=>["Sequence"]},{trigger:["\\huge"],parse:()=>["Sequence"]},{trigger:["\\Huge"],parse:()=>["Sequence"]},{name:"Style",serialize:(e,i)=>{let t=e.serialize(hi(i,1));const n=bi(hi(i,2));if(null===n)return t;"block"===oi(n.display)?t=Xe(["{\\displaystyle",t,"}"]):"inline"===oi(n.display)?t=Xe(["{\\textstyle",t,"}"]):"script"===oi(n.display)?t=Xe(["{\\scriptstyle",t,"}"]):"scriptscript"===oi(n.display)&&(t=Xe(["{\\scriptscriptstyle",t,"}"]));const r=vi(n.size);return null!==r&&r>=1&&r<=10&&(t=Xe(["{",{1:"\\tiny",2:"\\scriptsize",3:"\\footnotesize",4:"\\small",5:"\\normalsize",6:"\\large",7:"\\Large",8:"\\LARGE",9:"\\huge",10:"\\Huge"}[r],t,"}"])),t}},{trigger:["\\!"],parse:()=>["HorizontalSpacing",-3]},{trigger:["\\ "],parse:()=>["HorizontalSpacing",6]},{trigger:["\\:"],parse:()=>["HorizontalSpacing",4]},{trigger:["\\enskip"],parse:()=>["HorizontalSpacing",9]},{trigger:["\\quad"],parse:()=>["HorizontalSpacing",18]},{trigger:["\\qquad"],parse:()=>["HorizontalSpacing",36]},{trigger:["\\,"],parse:()=>["HorizontalSpacing",3]},{trigger:["\\;"],parse:()=>["HorizontalSpacing",5]},{trigger:["\\enspace"],parse:()=>["HorizontalSpacing",9]},{name:"HorizontalSpacing",serialize:(e,i)=>{if(hi(i,2))return e.serialize(hi(i,1));const t=vi(hi(i,1));return null===t?"":{"-3":"\\!",6:"\\ ",3:"\\,",4:"\\:",5:"\\;",9:"\\enspace",18:"\\quad",36:"\\qquad"}[t]??""}}];function Ui(e){return i=>{let t=!1,n=0,r=null;if(i.skipSpace(),i.match("^")){i.skipSpace();const e=i.index;if(i.match("<{>")){if(i.skipSpace(),i.match("-")&&i.match("1")&&(i.skipSpace(),i.match("<}>")&&(t=!0)),!t){let e=!1;for(;!e;)i.skipSpace(),i.match("\\doubleprime")?n+=2:i.match("\\prime")||i.match("'")?n+=1:e=!0;i.match("<}>")||(n=0)}if(0!==n||t||(i.index=e,r=i.matchRequiredLatexArgument()),0===n){let e=!1;for(;!e;)i.skipSpace(),i.match("\\doubleprime")?n+=2:i.match("\\prime")||i.match("'")?n+=1:e=!0}}}let s={"\\arcsin":"Arcsin","\\arccos":"Arccos","\\arctan":"Arctan","\\arctg":"Arctan","\\arcctg":"Arctan","\\arcsec":"Arcsec","\\arccsc":" Arccsc","\\arsinh":"Arsinh","\\arcosh":"Arcosh","\\artanh":"Artanh","\\arcsech":"Arcsech","\\arccsch":"Arcsch","\\ch":"Cosh","\\cos":"Cos","\\cosec":"Csc","\\cosh":"Csch","\\cot":"Cot","\\cotg":"Cot","\\coth":"Coth","\\csc":"Csc","\\ctg":"Cot","\\cth":"Coth","\\sec":"Sec","\\sin":"Sin","\\sinh":"Sinh","\\sh":"Sinh","\\tan":"Tan","\\tanh":"Tanh","\\tg":"Tan","\\th":"Tanh"}[e??""]??e??"";t&&(s=["InverseFunction",s]),n>=1&&(s=["Derivative",n,s]);const o=i.matchArguments("implicit");return null===o?r?[["Power",[s,"_"],r]]:s:r?["Power",[s,...o],r]:[s,...o]}}const ji=[{name:"Arcsin",trigger:["\\arcsin"],parse:Ui("Arcsin")},{name:"Arccos",trigger:["\\arccos"],parse:Ui("Arccos")},{name:"Arctan",trigger:["\\arctan"],parse:Ui("Arctan")},{trigger:["\\arctg"],parse:Ui("Arctan")},{name:"Arccot",trigger:["\\arcctg"],parse:Ui("Arccot")},{name:"Arcsec",trigger:"arcsec",parse:Ui("Arcsec")},{name:"Arccsc",trigger:["\\arccsc"],parse:Ui("Arccsc")},{name:"Arsinh",trigger:["\\arsinh"],parse:Ui("Arsinh")},{name:"Arcosh",trigger:["\\arcosh"],parse:Ui("Arcosh")},{name:"Artanh",trigger:["\\artanh"],parse:Ui("Artanh")},{name:"Arsech",trigger:["\\arsech"],parse:Ui("Arsech")},{name:"Arcsch",trigger:["\\arcsch"],parse:Ui("Arcsch")},{trigger:["\\ch"],parse:Ui("Cosh")},{name:"Cosec",trigger:["\\cosec"],parse:Ui("Cosec")},{name:"Cosh",trigger:["\\cosh"],parse:Ui("Cosh")},{name:"Cot",trigger:["\\cot"],parse:Ui("Cot")},{trigger:["\\cotg"],parse:Ui("Cot")},{name:"Coth",trigger:["\\coth"],parse:Ui("Coth")},{name:"Csc",trigger:["\\csc"],parse:Ui("Csc")},{trigger:["\\ctg"],parse:Ui("Cot")},{trigger:["\\cth"],parse:Ui("Cotanh")},{name:"Sec",trigger:["\\sec"],parse:Ui("Sec")},{name:"Sinh",trigger:["\\sinh"],parse:Ui("Sinh")},{trigger:["\\sh"],parse:Ui("Sinh")},{name:"Tan",trigger:["\\tan"],parse:Ui("Tan")},{trigger:["\\tg"],parse:Ui("Tan")},{name:"Tanh",trigger:["\\tanh"],parse:Ui("Tanh")},{trigger:["\\th"],parse:Ui("Tanh")},{name:"Cos",trigger:["\\cos"],parse:Ui("Cos")},{name:"Sin",trigger:["\\sin"],parse:Ui("Sin")}],Hi=[{name:"AlgebraicNumber",trigger:"\\bar\\Q"},{name:"ComplexNumber",trigger:["\\C"]},{trigger:"\\mathbb{C}",parse:"ComplexNumber"},{name:"ImaginaryNumber",trigger:["\\imaginaryI\\R"]},{name:"ExtendedComplexNumber",trigger:["\\bar\\C"]},{name:"EmptySet",trigger:["\\emptyset"]},{trigger:["\\varnothing"],parse:"EmptySet"},{name:"Integer",trigger:["\\Z"]},{trigger:"\\mathbb{Z}",parse:"Integer"},{name:"RationalNumber",trigger:["\\Q"]},{name:"RealNumber",trigger:["\\R"]},{trigger:"\\mathbb{R}",parse:"RealNumber"},{name:"ExtendedRealNumber",trigger:["\\bar\\R"]},{name:"TranscendentalNumber",trigger:"\\R-\\bar\\Q"},{trigger:"\\R\\backslash\\bar\\Q",parse:"TranscendentalNumber"},{name:"NegativeNumber",trigger:"\\R^-"},{trigger:"\\R^{-}",parse:"NegativeNumber"},{trigger:"\\R_-",parse:"NegativeNumber"},{trigger:"\\R_{-}",parse:"NegativeNumber"},{trigger:"\\R^{\\lt}",parse:"NegativeNumber"},{name:"PositiveNumber",trigger:"\\R^+"},{trigger:"\\R^{+}",parse:"PositiveNumber"},{trigger:"\\R_+",parse:"PositiveNumber"},{trigger:"\\R_{+}",parse:"PositiveNumber"},{trigger:"\\R^{\\gt}",parse:"PositiveNumber"},{name:"NonPositiveNumber",trigger:"\\R^{0-}"},{trigger:"\\R^{-0}",parse:"NonPositiveNumber"},{trigger:"\\R^{\\leq}",parse:"NonPositiveNumber"},{name:"NegativeInteger",trigger:"\\Z^-"},{trigger:"\\Z^-",parse:"NegativeInteger"},{trigger:"\\Z^{-}",parse:"NegativeInteger"},{trigger:"\\Z_-",parse:"NegativeInteger"},{trigger:"\\Z_{-}",parse:"NegativeInteger"},{trigger:"\\Z^{\\lt}",parse:"NegativeInteger"},{name:"PositiveInteger",trigger:"\\Z^+"},{trigger:"\\Z^{+}",parse:"PositiveInteger"},{trigger:"\\Z_+",parse:"PositiveInteger"},{trigger:"\\Z_{+}",parse:"PositiveInteger"},{trigger:"\\Z^{\\gt}",parse:"PositiveInteger"},{trigger:"\\Z^{\\gt0}",parse:"PositiveInteger"},{trigger:"\\N^+",parse:"PositiveInteger"},{trigger:"\\N^{+}",parse:"PositiveInteger"},{trigger:"\\N^*",parse:"PositiveInteger"},{trigger:"\\N^{*}",parse:"PositiveInteger"},{trigger:"\\N^\\star",parse:"PositiveInteger"},{trigger:"\\N^{\\star}",parse:"PositiveInteger"},{trigger:"\\N_1",parse:"PositiveInteger"},{trigger:"\\N_{1}",parse:"PositiveInteger"},{name:"NonNegativeInteger",trigger:["\\N"]},{trigger:"\\Z^{+0}",parse:"NonNegativeInteger"},{trigger:"\\Z^{\\geq}",parse:"NonNegativeInteger"},{trigger:"\\Z^{\\geq0}",parse:"NonNegativeInteger"},{trigger:"\\Z^{0+}",parse:"NonNegativeInteger"},{trigger:"\\mathbb{N}",parse:"NonNegativeInteger"},{trigger:"\\N_0",parse:"NonNegativeInteger"},{trigger:"\\N_{0}",parse:"NonNegativeInteger"},{name:"CartesianProduct",trigger:["\\times"],kind:"infix",associativity:"right",precedence:390,parse:(e,i,t)=>{if(390<i.minPrec)return null;const n=e.computeEngine;if(!n||!n.box(t).domain.isCompatible("Set"))return null;const r=e.index,s=e.matchExpression({...i,minPrec:390});return null===s||!0!==n.box(t).domain.isCompatible("Set")?(e.index=r,null):["CartesianProduct",t,s]}},{name:"Complement",trigger:["^","\\complement"],kind:"infix"},{name:"Intersection",trigger:["\\cap"],kind:"infix",precedence:350},{name:"Interval",serialize:Qi},{name:"Multiple",serialize:Qi},{name:"Union",trigger:["\\cup"],kind:"infix",precedence:350},{name:"Range",serialize:Qi},{name:"SetMinus",trigger:["\\setminus"],kind:"infix",precedence:650},{name:"SymmetricDifference",trigger:["\\triangle"],kind:"infix",precedence:260},{trigger:["\\ni"],kind:"infix",associativity:"right",precedence:160,parse:(e,i,t)=>{const n=e.matchExpression(i);return null===n?null:["Element",n,t]}},{name:"Element",trigger:["\\in"],kind:"infix",precedence:240},{name:"NotElement",trigger:["\\notin"],kind:"infix",precedence:240},{name:"NotSubset",trigger:["\\nsubset"],kind:"infix",associativity:"right",precedence:240},{name:"NotSuperset",trigger:["\\nsupset"],kind:"infix",associativity:"right",precedence:240},{name:"NotSubsetNotEqual",trigger:["\\nsubseteq"],kind:"infix",associativity:"right",precedence:240},{name:"NotSupersetNotEqual",trigger:["\\nsupseteq"],kind:"infix",associativity:"right",precedence:240},{name:"SquareSubset",trigger:["\\sqsubset"],kind:"infix",associativity:"right",precedence:265},{name:"SquareSubsetEqual",trigger:["\\sqsubseteq"],kind:"infix",associativity:"right",precedence:265},{name:"SquareSuperset",trigger:["\\sqsupset"],kind:"infix",associativity:"right",precedence:265},{name:"SquareSupersetEqual",trigger:["\\sqsupseteq"],kind:"infix",associativity:"right",precedence:265},{name:"Subset",trigger:["\\subset"],kind:"infix",associativity:"right",precedence:240},{trigger:["\\subsetneq"],kind:"infix",associativity:"right",precedence:240,parse:"Subset"},{trigger:["\\varsubsetneqq"],kind:"infix",associativity:"right",precedence:240,parse:"Subset"},{name:"SubsetEqual",trigger:["\\subseteq"],kind:"infix",precedence:240},{name:"Superset",trigger:["\\supset"],kind:"infix",associativity:"right",precedence:240},{trigger:["\\supsetneq"],kind:"infix",associativity:"right",precedence:240,parse:"Superset"},{trigger:["\\varsupsetneq"],kind:"infix",associativity:"right",precedence:240,parse:"Superset"},{name:"SupersetEqual",trigger:["\\supseteq"],kind:"infix",associativity:"right",precedence:240}];function Qi(e,i){if(null===i)return"";const t=ui(i);if(null===t)return"";if("Set"===t)return 0===gi(i)?"\\emptyset":2===gi(i)&&"Condition"===ui(hi(i,2))?Xe(["\\left\\lbrace",e.serialize(hi(i,1)),"\\middle\\mid",e.serialize(hi(i,2)),"\\right\\rbrace"]):Xe(["\\left\\lbrace",...(ci(i)??[]).map((i=>e.serialize(i)+" ,")),"\\right\\rbrace"]);if("Range"===t)return Xe(["\\mathopen\\lbrack",e.serialize(hi(i,1)),", ",e.serialize(hi(i,2)),"\\mathclose\\rbrack"]);if("Interval"===t){let t=hi(i,1),n=hi(i,2),r=!1,s=!1;return"Open"===ui(t)&&(t=hi(t,1),r=!0),"Open"===ui(n)&&(n=hi(n,1),s=!0),Xe(["\\mathopen"+(r?"\\rbrack":"\\lbrack"),e.serialize(t),", ",e.serialize(n),"\\mathclose"+(s?"\\lbrack":"\\rbrack")])}return e.numericSetStyle(i,e.level),""}function Wi(e){return i=>{i.skipSpace();let t=null,n=null;for(;!(null!==n&&null!==t||"_"!==i.peek&&"^"!==i.peek);)i.match("_")?n=i.matchRequiredLatexArgument():i.match("^")&&(t=i.matchRequiredLatexArgument()),i.skipSpace();("Nothing"===n||ki(n))&&(n=null),("Nothing"===t||ki(t))&&(t=null);let[r,s]=function(e){const i=e.index;let t=!1,n=e.matchExpression({minPrec:266,condition:()=>(e.matchAll(["\\mathrm","<{>","d","<}>"])&&(t=!0),t)});return t||(e.index=i,n=e.matchExpression({minPrec:266,condition:()=>(e.match("d")&&(t=!0),t)})),n&&!t?Ki(n):[n,t?pi(e.matchSymbol()):null]}(i);if(r&&!s&&("Add"===ui(r)||"Subtract"===ui(r))){const o=[],a=[];for(const e of ci(r)??[])if(s)a.push(e);else{let i;[i,s]=Ki(e),o.push(i??e)}if(null!==s&&a.length>0)return["Add",Yi(i,e,["Add",...o],s,n,t),...a]}return Yi(i,e,r,s,n,t)}}function Yi(e,i,t,n,r,s){if(t&&null===s&&null===r&&!n)return[i,t];if(t??(t="Nothing"),e.computeEngine){const i=e.computeEngine;n&&i.pushScope({[n]:{domain:"ExtendedRealNumber"}}),t=i.box(t).json,n&&i.popScope()}const o=n?["Hold",n]:null;return null!==s?[i,t,["Tuple",o??"Nothing",r??"Nothing",s]]:null!==r?[i,t,["Tuple",o??"Nothing",r]]:o?[i,t,o]:[i,t]}function Ki(e){const i=ui(e),t=hi(e,1);if(!t)return[e,null];if("Multiply"===i){const i=ci(e);if(i&&i.length>1){if("d"===pi(i[i.length-2]))return 2===i.length?[null,pi(i[1])]:3===i.length?[i[0],pi(i[2])]:[["Multiply",...i.slice(0,-2)],pi(i[i.length-1])];const[e,t]=Ki(i[i.length-1]);if(e)return[["Multiply",...i.slice(0,-1),e],t]}}else if("Delimiter"===i){const[i,n]=Ki(t);if(n)return i?[["Delimiter",i,...ci(e).slice(1)],n]:[null,n]}else if("Add"===i){const i=ci(e);if(i&&i.length>0){const[e,t]=Ki(i[i.length-1]);if(t){if(e)return[["Add",...i.slice(0,-1),e],t];if(i.length>2)return[["Add",...i.slice(0,-1)],t];if(i.length>2)return[i[0],t]}}}else if("Negate"===i){const[e,i]=Ki(t);if(i)return[e?["Negate",e]:null,i]}else if("Divide"===i){const[i,n]=Ki(t);if(n)return[["Divide",i??1,hi(e,2)],n]}else{const i=ci(e);if(1===i?.length){const[t,n]=Ki(i[0]);if(n)return[[ui(e),t],n]}}return[e,null]}function Ji(e){return(i,t)=>{if(!hi(t,1))return e;let n=hi(t,2);const r=ui(n);let s=null;"Tuple"!==r&&"Triple"!==r&&"Pair"!==r&&"Single"!==r?(s=pi(n),n=null):s=pi(hi(n,1))??"x";let o=hi(t,1);if("Lambda"===ui(o)&&hi(o,1)&&(o=_i(hi(o,1),{_:s??"x",_1:s??"x"})),!n)return Xe(s?[e,i.serialize(o),"\\mathrm{d}",s]:[e,i.serialize(o)]);let a=n?[i.serialize(hi(n,2))]:[];a.length>0&&(a=["_{",...a,"}"]);let u=[];return hi(n,3)&&(u=["^{",i.serialize(hi(n,3)),"}"]),Xe([e,...u,...a,i.serialize(o),...s&&"Nothing"!==pi(s)?["\\,\\mathrm{d}",i.serialize(s)]:[]])}}const Xi=[{name:"Integrate",trigger:["\\int"],parse:Wi("Integrate"),serialize:Ji("\\int")},{trigger:["\\iint"],parse:Wi("Integrate")},{name:"CircularIntegrate",trigger:["\\oint"],parse:Wi("CircularIntegrate"),serialize:Ji("\\oint")}],et=[["Alpha","\\alpha",945],["Beta","\\beta",946],["Gamma","\\gamma",947],["Delta","\\delta",948],["Epsilon","\\epsilon",949],["EpsilonSymbol","\\varepsilon",1013],["Zeta","\\zeta",950],["Eta","\\eta",951],["Theta","\\theta",952],["ThetaSymbol","\\vartheta",977],["Iota","\\iota",953],["Kappa","\\kappa",954],["KappaSymbol","\\varkappa",1008],["Lambda","\\lambda",955],["Mu","\\mu",956],["Nu","\\nu",957],["Xi","\\xi",958],["Omicron","\\omicron",959],["PiSymbol","\\varpi",982],["Rho","\\rho",961],["RhoSymbol","\\varrho",1009],["Sigma","\\sigma",963],["FinalSigma","\\varsigma",962],["Tau","\\tau",964],["Phi","\\phi",981],["PhiLetter","\\varphi",966],["Upsilon","\\upsilon",965],["Chi","\\chi",967],["Psi","\\psi",968],["Omega","\\omega",969],["CapitalAlpha","\\Alpha",913],["CapitalBeta","\\Beta",914],["CapitalGamma","\\Gamma",915],["CapitalDelta","\\Delta",916],["CapitalEpsilon","\\Epsilon",917],["CapitalZeta","\\Zeta",918],["CapitalEta","\\Eta",919],["CapitalTheta","\\Theta",920],["CapitaIota","\\Iota",921],["CapitalKappa","\\Kappa",922],["CapitalLambda","\\Lambda",923],["CapitalMu","\\Mu",924],["CapitalNu","\\Nu",925],["CapitalXi","\\Xi",926],["CapitalOmicron","\\Omicron",927],["CapitalPi","\\Pi",928],["CapitalRho","\\Rho",929],["CapitalSigma","\\Sigma",931],["CapitalTau","\\Tau",932],["CapitalPhi","\\Phi",934],["CapitalUpsilon","\\Upsilon",933],["CapitalChi","\\Chi",935],["CapitalPsi","\\Psi",936],["CapitalOmega","\\Omega",937],["Digamma","\\digamma",989],["Alef","\\aleph",8501],["Bet","\\beth",8502],["Gimel","\\gimel",8503],["Dalet","\\daleth",8504],["TurnedCapitalF","\\Finv",8498],["TurnedCapitalG","\\Game",8513],["Weierstrass","\\wp",8472],["Eth","\\eth",240],["InvertedOhm","\\mho",8487],["BlackClubSuit","\\clubsuit",9827],["WhiteHeartSuit","\\heartsuit",9825],["BlackSpadeSuit","\\spadesuit",9824],["WhiteDiamondSuit","\\diamondsuit",9826],["Sharp","\\sharp",9839],["Flat","\\flat",9837],["Natural","\\natural",9838]],it=[...et.map((([e,i,t])=>({name:e,trigger:[i],parse:e}))),...et.map((([e,i,t])=>({trigger:[String.fromCodePoint(t)],parse:e})))],tt={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","|":"\\vert","||":"\\Vert","\\lceil":"\\lceil","\\lfloor":"\\lfloor","\\rceil":"\\rceil","\\rfloor":"\\rfloor"};function nt(e){return Array.isArray(e)?e.length:1}function rt(e,u){if(!function(e,i){const t=e.name??e.trigger??e.openDelimiter;if(void 0!==e.serialize&&!e.name)return i({severity:"warning",message:["invalid-dictionary-entry",t,"Unexpected serialize property without a name property"]}),!1;if(n(e)){if(e.trigger)return i({severity:"warning",message:["invalid-dictionary-entry",t,`Unexpected 'trigger' "${e.trigger}". 'matchfix' operators use a 'openDelimiter' and 'closeDelimiter' instead of a trigger. `]}),!1;if(!e.openDelimiter||!e.closeDelimiter)return i({severity:"warning",message:["invalid-dictionary-entry",t,"Expected `openDelimiter` and a `closeDelimiter` for matchfix operator"]}),!1;if(typeof e.openDelimiter!=typeof e.closeDelimiter)return i({severity:"warning",message:["invalid-dictionary-entry",t,"Expected `openDelimiter` and `closeDelimiter` to both be strings or array of LatexToken"]}),!1}if(r(e)||o(e)||s(e)){if(Array.isArray(e.trigger)&&("_"===e.trigger[0]||"^"===e.trigger[0])||"string"==typeof e.trigger&&(e.trigger.startsWith("^")||e.trigger.startsWith("_"))){if(void 0!==e.precedence||void 0!==e.associativity)return i({severity:"warning",message:["invalid-dictionary-entry",t,'Unexpected "precedence" or "associativity" for superscript/subscript operator']}),!1}else if(void 0===e.precedence)return i({severity:"warning",message:["invalid-dictionary-entry",t,`Expected a "precedence" for ${e.kind} operator`]}),!1}else if(void 0!==e.associativity)return i({severity:"warning",message:["invalid-dictionary-entry",t,'Unexpected "associativity" operator']}),!1;return n(e)||e.trigger||e.name?void 0!==e.parse||void 0!==e.name||(i({severity:"warning",message:["invalid-dictionary-entry",t,"Expected a 'parse' or 'name'"]}),!1):(i({severity:"warning",message:["invalid-dictionary-entry",t,"Expected at least a 'trigger' or a 'name'"]}),!1)}(e,u))return[null,null];const l={name:e.name,kind:"kind"in e?e.kind:"symbol"};if("matchfix"===l.kind&&n(e)){if(l.openDelimiter=e.openDelimiter,l.closeDelimiter=e.closeDelimiter,"function"==typeof e.serialize)l.serialize=e.serialize;else{const e="string"==typeof l.openDelimiter?tt[l.openDelimiter]:ei(l.openDelimiter),i="string"==typeof l.closeDelimiter?tt[l.closeDelimiter]:ei(l.closeDelimiter);l.serialize=(t,n)=>Xe([e,t.serialize(hi(n,1)),i])}if("function"==typeof e.parse)l.parse=e.parse;else{const i=e.parse??e.name;l.parse=(e,t)=>[i,t]}return[null,l]}if("environment"===l.kind&&a(e)){const i=e.trigger;return l.serialize=e.serialize??((e,t)=>`\\begin{${i}}${e.serialize(hi(t,1))}\\end{${i}}`),l.parse=e.parse??(()=>null),[i,l]}const c="string"==typeof e.trigger?Je(e.trigger,[]):e.trigger,h=c?ei(c):"";if("function"===l.kind&&t(e))return l.serialize=e.serialize,h&&!e.serialize&&(l.serialize=(e,i)=>`\\mathrm{${h}}${e.wrapArguments(i)}`),l.parse=e.parse,!l.parse&&e.name&&(l.parse=i=>{const t=i.matchArguments("enclosure");return null===t?e.name:[e.name,...t]}),[h,l];if(e.trigger,"symbol"===l.kind&&i(e)&&(l.precedence=e.precedence??1e4),"infix"!==l.kind&&"prefix"!==l.kind&&"postfix"!==l.kind||!(r(e)||s(e)||o(e))||(!c||"^"!==c[0]&&"_"!==c[0]?l.precedence=e.precedence??1e4:l.precedence=720),"infix"===l.kind&&r(e))if(l.associativity=e.associativity??"non","function"==typeof e.parse)l.parse=e.parse;else if(!c||"^"!==c[0]&&"_"!==c[0]){const i=e.parse??e.name,t=l.precedence,n=l.associativity;l.parse=(e,r,s)=>{if(t<r.minPrec)return null;const o=Ei(e.matchExpression({...r,minPrec:t}));return"string"==typeof i?Si(i,s,o,n):[i,s,o]}}else{const i=e.parse??e.name;l.parse=(e,t,n)=>[i,Ei(hi(n,1)),Ei(hi(n,2))]}else if("function"==typeof e.parse)l.parse=e.parse;else if(void 0!==e.parse)l.parse=()=>e.parse;else if(void 0===e.parse&&void 0!==e.name)if("postfix"===l.kind)l.parse=(i,t)=>t?[e.name,t]:null;else if("prefix"===l.kind){const i=l.precedence,t=e.name;l.parse=(e,n)=>{if(i<n.minPrec)return null;const r=e.matchExpression({...n,minPrec:i});return null===r?null:[t,r]}}return"function"==typeof e.serialize||"string"==typeof e.serialize?l.serialize=e.serialize:c&&("postfix"===l.kind?l.serialize="#1"+h:"prefix"===l.kind?l.serialize=h+"#1":"infix"===l.kind?l.serialize="#1"+h+"#2":"symbol"===l.kind?l.serialize=h:l.serialize=""),[c??null,l]}const st={algebra:[{name:"To",trigger:["\\to"],kind:"infix",precedence:270}],arithmetic:Ti,calculus:Xi,core:Li,logic:[{name:"True",trigger:["\\mathrm","<{>","T","r","u","e","<}>"],serialize:"\\mathrm{True}"},{name:"False",trigger:["\\mathrm","<{>","F","a","l","s","e","<}>"],serialize:"\\mathrm{False}"},{name:"Maybe",trigger:["\\mathrm","<{>","M","a","y","b","e","<}>"],serialize:"\\mathrm{Maybe}"}],relop:[{trigger:["!","<"],kind:"infix",associativity:"right",precedence:246,parse:"NotLess"},{name:"NotLess",trigger:["\\nless"],kind:"infix",associativity:"right",precedence:246},{trigger:["<"],kind:"infix",associativity:"right",precedence:245,parse:"Less"},{name:"Less",trigger:["\\lt"],kind:"infix",associativity:"right",precedence:245},{trigger:["<","="],kind:"infix",associativity:"right",precedence:241,parse:"LessEqual"},{name:"LessEqual",trigger:["\\le"],kind:"infix",associativity:"right",precedence:241},{trigger:["\\leq"],kind:"infix",associativity:"right",precedence:241,parse:"Equal"},{trigger:["\\leqslant"],kind:"infix",associativity:"right",precedence:265,parse:"LessEqual"},{name:"LessNotEqual",trigger:["\\lneqq"],kind:"infix",associativity:"right",precedence:260},{name:"NotLessNotEqual",trigger:["\\nleqq"],kind:"infix",associativity:"right",precedence:260},{name:"LessOverEqual",trigger:["\\leqq"],kind:"infix",associativity:"right",precedence:265},{name:"GreaterOverEqual",trigger:["\\geqq"],kind:"infix",associativity:"right",precedence:265,parse:"GreaterEqual"},{name:"Equal",trigger:["="],kind:"infix",associativity:"right",precedence:260},{trigger:["*","="],kind:"infix",associativity:"right",precedence:260,parse:"StarEqual"},{name:"StarEqual",trigger:["\\star","="],kind:"infix",associativity:"right",precedence:260},{name:"PlusEqual",trigger:["+","="],kind:"infix",associativity:"right",precedence:260},{name:"MinusEqual",trigger:["-","="],kind:"infix",associativity:"right",precedence:260},{name:"SlashEqual",trigger:["/","="],kind:"infix",associativity:"right",precedence:260},{name:"EqualEqual",trigger:["=","="],kind:"infix",associativity:"right",precedence:260},{name:"EqualEqualEqual",trigger:["=","=","="],kind:"infix",associativity:"right",precedence:265},{name:"TildeFullEqual",trigger:["\\cong"],kind:"infix",associativity:"right",precedence:260},{name:"NotTildeFullEqual",trigger:["\\ncong"],kind:"infix",associativity:"right",precedence:260},{trigger:[":","="],kind:"infix",associativity:"right",precedence:260,parse:"Assign"},{name:"Assign",trigger:["\\coloneq"],kind:"infix",associativity:"right",precedence:260},{name:"Approx",trigger:["\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"NotApprox",trigger:["\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"ApproxEqual",trigger:["\\approxeq"],kind:"infix",associativity:"right",precedence:260},{name:"NotApproxEqual",trigger:["!","\\approxeq"],kind:"infix",associativity:"right",precedence:250},{name:"NotEqual",trigger:["\\ne"],kind:"infix",associativity:"right",precedence:255},{name:"Unequal",trigger:["!","="],kind:"infix",associativity:"right",precedence:260},{name:"GreaterEqual",trigger:["\\ge"],kind:"infix",associativity:"right",precedence:242},{trigger:["\\geq"],kind:"infix",associativity:"right",precedence:242,parse:"GreaterEqual"},{trigger:[">","="],kind:"infix",associativity:"right",precedence:243,parse:"GreaterEqual"},{trigger:["\\geqslant"],kind:"infix",associativity:"right",precedence:265,parse:"GreaterEqual"},{name:"GreaterNotEqual",trigger:["\\gneqq"],kind:"infix",associativity:"right",precedence:260},{name:"NotGreaterNotEqual",trigger:["\\ngeqq"],kind:"infix",associativity:"right",precedence:260},{trigger:[">"],kind:"infix",associativity:"right",precedence:245,parse:"Greater"},{name:"Greater",trigger:["\\gt"],kind:"infix",associativity:"right",precedence:245},{name:"NotGreater",trigger:["\\ngtr"],kind:"infix",associativity:"right",precedence:244},{trigger:["!",">"],kind:"infix",associativity:"right",precedence:244,parse:"NotGreater"},{name:"RingEqual",trigger:["\\circeq"],kind:"infix",associativity:"right",precedence:260},{name:"TriangleEqual",trigger:["\\triangleq"],kind:"infix",associativity:"right",precedence:260},{name:"DotEqual",trigger:["\\doteq"],kind:"infix",associativity:"right",precedence:265},{name:"DotEqualDot",trigger:["\\doteqdot"],kind:"infix",associativity:"right",precedence:265},{name:"FallingDotEqual",trigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:265},{name:"RisingDotEqual",trigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:265},{name:"QuestionEqual",trigger:["\\questeq"],kind:"infix",associativity:"right",precedence:260},{name:"Equivalent",trigger:["\\equiv"],kind:"infix",associativity:"right",precedence:260},{trigger:["\\iff"],kind:"infix",parse:"Equivalent",associativity:"right",precedence:260},{name:"MuchLess",trigger:["\\ll"],kind:"infix",associativity:"right",precedence:260},{name:"MuchGreater",trigger:["\\gg"],kind:"infix",associativity:"right",precedence:260},{name:"Precedes",trigger:["\\prec"],kind:"infix",associativity:"right",precedence:260},{name:"Succeeds",trigger:["\\succ"],kind:"infix",associativity:"right",precedence:260},{name:"PrecedesEqual",trigger:["\\preccurlyeq"],kind:"infix",associativity:"right",precedence:260},{name:"SucceedsEqual",trigger:["\\curlyeqprec"],kind:"infix",associativity:"right",precedence:260},{name:"NotPrecedes",trigger:["\\nprec"],kind:"infix",associativity:"right",precedence:260},{name:"NotSucceeds",trigger:["\\nsucc"],kind:"infix",associativity:"right",precedence:260},{name:"Between",trigger:["\\between"],kind:"infix",associativity:"right",precedence:265}],other:Zi,physics:[{name:"mu-0",trigger:"\\mu_0"}],sets:Hi,symbols:it,trigonometry:ji},ot={"(":["\\lparen","("],")":["\\rparen",")"],"[":["\\lbrack"],"]":["\\rbrack"],"<":["<","\\langle"],">":[">","\\rangle"],"{":["\\{","\\lbrace"],"}":["\\}","\\rbrace"],":":[":","\\colon"],"|":["|","\\|","\\lvert","\\rvert"],"||":["||","\\Vert","\\lVert","\\rVert"],"\\lfloor":["\\lfloor"],"\\rfloor":["\\rfloor"],"\\lceil":["\\lceil"],"\\rceil":["\\rceil"],"\\ulcorner":["\\ulcorner"],"\\urcorner":["\\urcorner"],"\\llcorner":["\\llcorner"],"\\lrcorner":["\\lrcorner"],"\\lgroup":["\\lgroup"],"\\rgroup":["\\rgroup"],"\\lmoustache":["\\lmoustache"],"\\rmoustache":["\\rmoustache"]},at={":":[":","\\colon"],"|":["|","\\|","\\mid","\\mvert"]},ut={"\\left":"\\right","\\bigl":"\\bigr","\\Bigl":"\\Bigr","\\biggl":"\\biggr","\\Biggl":"\\Biggr","\\big":"\\big","\\Big":"\\Big","\\bigg":"\\bigg","\\Bigg":"\\Bigg"},lt=["\\middle","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],ct={"(":")","[":"]","\\{":"\\}","\\lbrace":"\\rbrace","\\lparen":"\\rparen","\\langle":"\\rangle","\\lfloor":"\\rfloor","\\lceil":"\\rceil","\\vert":"\\vert","\\lvert":"\\rvert","\\Vert":"\\Vert","\\lVert":"\\rVert","\\lbrack":"\\rbrack","\\ulcorner":"\\urcorner","\\llcorner":"\\lrcorner","\\lgroup":"\\rgroup","\\lmoustache":"\\rmoustache"},ht={precision:6,positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalMarker:".",groupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",notation:"auto",truncationMarker:"\\ldots",beginRepeatingDigits:"\\overline{",endRepeatingDigits:"}",imaginaryUnit:"\\imaginaryI",avoidExponentsInRange:[-7,20]},mt={applyInvisibleOperator:"auto",skipSpace:!0,parseArgumentsOfUnknownLatexCommands:!0,parseNumbers:!0,parseUnknownIdentifier:(e,i)=>void 0!==i.computeEngine?.lookupFunction(e)?"function":/^[a-zA-Z]/.test(e)?"symbol":"unknown",preserveLatex:!1};class ft{constructor(e,i,t,n){this.index=0,this._boundaries=[],this._lastPeek="",this._peekCounter=0,this._tokens=e,this.options={...ht,...mt,...i},this._dictionary=t,this.computeEngine=n,this._positiveInfinityTokens=Je(this.options.positiveInfinity,[]),this._negativeInfinityTokens=Je(this.options.negativeInfinity,[]),this._notANumberTokens=Je(this.options.notANumber,[]),this._decimalMarkerTokens=Je(this.options.decimalMarker,[]),this._groupSeparatorTokens=Je(this.options.groupSeparator,[]),this._exponentProductTokens=Je(this.options.exponentProduct,[]),this._beginExponentMarkerTokens=Je(this.options.beginExponentMarker,[]),this._endExponentMarkerTokens=Je(this.options.endExponentMarker,[]),this._truncationMarkerTokens=Je(this.options.truncationMarker,[]),this._beginRepeatingDigitsTokens=Je(this.options.beginRepeatingDigits,[]),this._endRepeatingDigitsTokens=Je(this.options.endRepeatingDigits,[]),this._imaginaryNumberTokens=Je(this.options.imaginaryUnit,[])}updateOptions(e){for(const[i,t]of Object.entries(e)){if(!(i in this.options))throw Error(`Unexpected option "${i}"`);this.options[i]=t,"string"==typeof t&&("positiveInfinity"===i&&(this._positiveInfinityTokens=Je(t,[])),"negativeInfinity"===i&&(this._negativeInfinityTokens=Je(t,[])),"notANumber"===i&&(this._notANumberTokens=Je(t,[])),"decimalMarker"===i&&(this._decimalMarkerTokens=Je(t,[])),"groupSeparator"===i&&(this._groupSeparatorTokens=Je(t,[])),"exponentProduct"===i&&(this._exponentProductTokens=Je(t,[])),"beginExponentMarker"===i&&(this._beginExponentMarkerTokens=Je(t,[])),"endExponentMarker"===i&&(this._endExponentMarkerTokens=Je(t,[])),"truncationMarker"===i&&(this._truncationMarkerTokens=Je(t,[])),"beginRepeatingDigits"===i&&(this._beginRepeatingDigitsTokens=Je(t,[])),"endRepeatingDigits"===i&&(this._endRepeatingDigitsTokens=Je(t,[])),"imaginaryNumber"===i&&(this._imaginaryNumberTokens=Je(t,[])))}}get atEnd(){return this.index>=this._tokens.length}get peek(){const e=this._tokens[this.index];if(e===this._lastPeek?this._peekCounter+=1:this._peekCounter=0,this._peekCounter>=1024)throw Error(`Infinite loop detected while parsing "${this.latex(0)}" at ${this._lastPeek} (index ${this.index})`);return this._lastPeek=e,e}next(){return this._tokens[this.index++]}atTerminator(e){return!!this.atBoundary||!(!e?.condition||!e.condition(this))}get atBoundary(){if(this.atEnd)return!0;const e=this.index;for(const i of this._boundaries)if(this.matchAll(i.tokens))return this.index=e,!0;return!1}addBoundary(e){this._boundaries.push({index:this.index,tokens:e})}removeBoundary(){this._boundaries.pop()}matchBoundary(){const e=this._boundaries[this._boundaries.length-1],i=e&&this.matchAll(e.tokens);return i&&this._boundaries.pop(),i}boundaryError(e){const i=this._boundaries[this._boundaries.length-1];return this._boundaries.pop(),this.error(e,i.index)}latex(e,i){return ei(this._tokens.slice(e,i))}latexAhead(e){return this.latex(this.index,this.index+e)}latexBefore(){return this.latex(0,this.index)}latexAfter(){return this.latex(this.index)}lookAhead(){let e=Math.min(this._dictionary.lookahead,this._tokens.length-this.index);if(e<0)return[];const i=Array(e+1);for(;e>0;)i[e]=this.latexAhead(e--);return i}peekDefinitions(e){let i;if("function"===e){const e=this.index;if(this.match("\\operatorname")||this.match("\\mathrm")||this.match("\\mathit")){const i=this.matchStringArgument(),t=this.index-e;return this.index=e,null!==i&&this._dictionary.function.has(i)?this._dictionary.function.get(i).map((e=>[e,t])):null}return null}i="operator"===e?this.lookAhead().map(((e,i)=>this._dictionary.infix[i]?.get(e)??this._dictionary.postfix[i]?.get(e)??this._dictionary.prefix[i]?.get(e))):this.lookAhead().map(((i,t)=>this._dictionary[e][t]?.get(i)));const t=[];for(let e=i.length;e>0;e--)if(void 0!==i[e])for(const n of i[e])t.push([n,e]);return 0===t.length?null:t}skipSpaceTokens(){for(;this.match("<space>"););}skipSpace(){if(!this.options.skipSpace)return!1;if(!this.atEnd&&"<{>"===this.peek){const e=this.index;for(this.next();this.match("<space>"););if("<}>"===this.next())return this.skipSpace(),!0;this.index=e}let e=!1;for(;this.match("<space>");)e=!0;return e&&this.skipSpace(),e}skipVisualSpace(){this.options.skipSpace&&(this.skipSpace(),["\\!","\\,","\\:","\\;","\\enskip","\\enspace","\\space","\\quad","\\qquad"].includes(this.peek)&&(this.next(),this.skipVisualSpace()),this.skipSpace())}matchChar(){const e=this.index;let i=0;for(;this.match("^");)i+=1;if(i>=2){let e="",t=0;for(;t!=i;){const i=this.matchAny(["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]);if(!i)break;e+=i,t+=1}if(e.length===i)return String.fromCodePoint(Number.parseInt(e,16))}else{if(this.match("\\char")){let e=Math.floor(this.matchLatexNumber()??NaN);return(!Number.isFinite(e)||e<0||e>1114111)&&(e=10067),String.fromCodePoint(e)}if(this.match("\\unicode"))if(this.skipSpaceTokens(),"<{>"===this.peek){this.next();const e=this.matchLatexNumber();if(this.match("<}>")&&null!==e&&e>=0&&e<=1114111)return String.fromCodePoint(e)}else{const e=this.matchLatexNumber();if(null!==e&&e>=0&&e<=1114111)return String.fromCodePoint(e)}}return this.index=e,this.next()}matchColor(e=!1){let i="";for(;!this.atEnd&&"}"!==this.peek;)i+=this.next();return i}matchLatexDimension(){return null}match(e){return this._tokens[this.index]===e&&(this.index++,!0)}matchAll(e){if("string"==typeof e&&(e=[e]),0===e.length)return!1;let i=!0,t=0;do{i=this._tokens[this.index+t]===e[t++]}while(i&&t<e.length);return i&&(this.index+=t),i}matchAny(e){return e.includes(this._tokens[this.index])?this._tokens[this.index++]:""}matchSequence(e){const i=[];for(;e.includes(this._tokens[this.index]);)i.push(this._tokens[this.index++]);return i}matchOptionalSign(){let e=!!this.matchAny(["-","\u2212"]);for(;this.matchAny(["+","\ufe62"])||this.skipSpace();)this.matchAny(["-","\u2212"])&&(e=!e);return e?"-":"+"}matchDecimalDigits(e){e??(e={}),e.withGrouping??(e.withGrouping=!1);const i=[];let t=!1;for(;!t;){for(;/^[0-9]$/.test(this.peek);)i.push(this.next()),this.skipVisualSpace();if(t=!0,e.withGrouping&&this.options.groupSeparator){const e=this.index;this.skipVisualSpace(),this.matchAll(this._groupSeparatorTokens)&&(this.skipVisualSpace(),/^[0-9]$/.test(this.peek)?t=!1:this.index=e)}}return i.join("")}matchSignedInteger(e){e??(e={}),e.withGrouping??(e.withGrouping=!1);const i=this.index,t=this.matchOptionalSign(),n=this.matchDecimalDigits(e);return n?"-"===t?"-"+n:n:(this.index=i,"")}matchExponent(){const e=this.index;if(this.matchAny(["e","E"])){const e=this.matchSignedInteger({withGrouping:!1});if(e)return"e"+e}if(this.index=e,this.match("\\times")&&(this.skipSpaceTokens(),this.match("1")&&this.match("0")&&this.match("^"))){if(/^[0-9]$/.test(this.peek))return"e"+this.next();if(this.match("<{>")){this.skipSpaceTokens();const e=this.matchSignedInteger();if(this.skipSpaceTokens(),this.match("<}>")&&e)return"e"+e}}if(this.index=e,this.skipSpaceTokens(),this.match("\\%"))return"e-2";if(this.index=e,this.matchAll(this._exponentProductTokens)&&(this.skipSpaceTokens(),this.matchAll(this._beginExponentMarkerTokens))){this.skipSpaceTokens();const e=this.matchSignedInteger();if(this.skipSpaceTokens(),this.matchAll(this._endExponentMarkerTokens)&&e)return"e"+e}return this.index=e,""}matchRepeatingDecimal(){const e=this.index;let i="";return this.match("(")?(i=this.matchDecimalDigits(),i&&this.match(")")?"("+i+")":(this.index=e,"")):(this.index=e,this.matchAll(["\\left","("])?(i=this.matchDecimalDigits(),i&&this.matchAll(["\\right",")"])?"("+i+")":(this.index=e,"")):(this.index=e,this.matchAll(["\\overline","<{>"])?(i=this.matchDecimalDigits(),i&&this.match("<}>")?"("+i+")":(this.index=e,"")):(this.index=e,this.matchAll(this._beginRepeatingDigitsTokens)?(i=this.matchDecimalDigits(),i&&this.matchAll(this._endRepeatingDigitsTokens)?"("+i+")":(this.index=e,"")):(this.index=e,""))))}matchNumber(){if(!this.options.parseNumbers)return"";const e=this.index;this.skipVisualSpace(),this.match("+");let i="",t=!1;if(this.match(".")||this.matchAll(this._decimalMarkerTokens)){const i=this.peek;if("\\overline"!==i&&i!==this._beginRepeatingDigitsTokens[0]&&!/[0-9\(]/.test(i))return this.index=e,"";t=!0}else if(i=this.matchDecimalDigits({withGrouping:!0}),!i)return this.index=e,"";let n=!0;if(t||!this.match(".")&&!this.matchAll(this._decimalMarkerTokens)?t?i="0."+this.matchDecimalDigits({withGrouping:!0}):n=!1:i+="."+this.matchDecimalDigits({withGrouping:!0}),n){const e=this.matchRepeatingDecimal();e?i+=e:this.match("\\ldots")||this.matchAll(this._truncationMarkerTokens)}return this.skipVisualSpace(),i+this.matchExponent()}matchLatexNumber(e=!0){let i=!1,t=this.peek;for(;"<space>"===t||"+"===t||"-"===t;)"-"===t&&(i=!i),this.next(),t=this.peek;let n=10,r=["0","1","2","3","4","5","6","7","8","9"];if(this.match("'"))n=8,r=["0","1","2","3","4","5","6","7"],e=!0;else if(this.match('"')||this.match("x"))n=16,r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],e=!0;else if(this.match("`"))return t=this.next(),t?t.startsWith("\\")&&2===t.length?(i?-1:1)*(t.codePointAt(1)??0):(i?-1:1)*(t.codePointAt(0)??0):null;let s="";for(;r.includes(this.peek);)s+=this.next();if(!e&&this.match("."))for(s+=".";r.includes(this.peek);)s+=this.next();const o=e?Number.parseInt(s,n):Number.parseFloat(s);return Number.isNaN(o)?null:i?-o:o}matchPrefixOperator(e){e||(e={minPrec:0}),e.minPrec||(e={...e,minPrec:0});const i=this.peekDefinitions("prefix");if(null===i)return null;const t=this.index;for(const[n,r]of i){this.index=t+r;const i=n.parse(this,e);if(i)return i}return this.index=t,null}matchInfixOperator(e,i){i||(i={minPrec:0}),i.minPrec||(i={...i,minPrec:0});const t=this.peekDefinitions("infix");if(null===t)return null;const n=this.index;for(const[r,s]of t)if(r.precedence>=i.minPrec){this.index=n+s;const t=r.parse(this,i,e);if(t)return t}return this.index=n,null}matchArguments(e){if(!e)return null;const i=this.index,t=this.matchEnclosure();if("enclosure"===e&&"Delimiter"===ui(t))return"Sequence"===hi(t,1)?ci(hi(t,1))??[]:[hi(t,1)??["Sequence"]];if("implicit"===e){if("Delimiter"===ui(t))return"Sequence"===ui(hi(t,1))?wi(t)??[]:[hi(t,1)??["Sequence"]];if(null!==t)return[t];const e=this.matchExpression({minPrec:390});return null!==e?[e]:null}return this.index=i,null}matchFunctionSuffix(){return null}matchOpenDelimiter(e,i){const t=this.index,n=ut[this.peek];n&&this.next();const r=ot[e]??[e],s=n?[n]:[];return r.includes("||")&&this.matchAll(["|","|"])?(s.push("|"),s.push("|"),s):r.includes(this.peek)?(ct[e]===i?s.push(ct[this.peek]):s.push(i),this.next(),s):(this.index=t,null)}matchMiddleDelimiter(e){const i=at[e]??[e];if(lt.includes(this.peek)){const e=this.index;return this.next(),i.includes(this.peek)?(this.next(),!0):(this.index=e,!1)}return!!i.include(this.peek)&&(this.next(),!0)}matchEnclosureOpen(){const e=this._dictionary.matchfix;if(0===e.length)return null;const i=this.index;for(const t of e){if(this.index=i,Array.isArray(t.openDelimiter)){if(this.matchAll(t.openDelimiter))return ei(t.closeDelimiter);continue}const e=this.matchOpenDelimiter(t.openDelimiter,t.closeDelimiter);if(null!==e)return ei(e)}return this.index=i,null}matchEnclosureClose(){const e=this._dictionary.matchfix;if(0===e.length)return null;const i=this.index;for(const t of e){if(this.index=i,Array.isArray(t.closeDelimiter)){if(this.matchAll(t.closeDelimiter))return ei(t.openDelimiter);continue}this.index=i;let e=this.peek;const n=Object.keys(ut).find((i=>ut[i]===e));n&&this.next();let r=[];e=this.peek;const s=Object.keys(ct).find((i=>ct[i]===e));if(s&&(r=[s]),n&&(r=[n,...r]),r.length>0)return this.next(),ei(r)}return this.index=i,null}matchEnclosure(){const e=this._dictionary.matchfix;if(0===e.length)return null;const i=this.index;for(const t of e){if(this.index=i,Array.isArray(t.openDelimiter)){if(!this.matchAll(t.openDelimiter))continue;this.addBoundary(t.closeDelimiter);const e=this.matchExpression();if(this.skipSpace(),!this.matchBoundary()){this.removeBoundary();continue}const i=t.parse(this,e??["Sequence"]);if(null===i)continue;return i}const e=this.matchOpenDelimiter(t.openDelimiter,t.closeDelimiter);if(null===e)continue;if(this.matchAll(e)){const e=t.parse(this,["Sequence"]);if(null===e)continue;return e}this.addBoundary(e);const n=this.index;let r=this.matchExpression();if(this.skipSpace(),!this.matchBoundary()&&(this.removeBoundary(),this.index=n,r=this.matchExpression(),!this.matchAll(e))){if(!this.atEnd)continue;return this.index=i,null}const s=t.parse(this,r??["Sequence"]);if(null!==s)return s}return this.index=i,null}matchIdentifier(){if(this.match("\\operatorname")||this.match("\\mathit")||this.match("\\mathrm")){const e=this.index,i=this.matchStringArgument();return null===i?this.error("expected-string-argument",e):null!==i&&si(i)?i:this.error("invalid-symbol-name",e)}return/^[a-zA-Z]$/.test(this.peek)?this.next():null}matchFunction(){const e=this.index,i=this.peekDefinitions("function");if(i)for(const[t,n]of i){if(this.index=e+n,"function"!=typeof t.parse){const e=this.matchArguments("enclosure");return e?[t.name,...e]:t.name}{const e=t.parse(this);if(e)return e}}this.index=e;const t=this.matchIdentifier();if(null===t)return this.index=e,null;if("string"!=typeof t)return t;if("function"===this.options.parseUnknownIdentifier?.(t,this)){const e=this.matchArguments("enclosure");return e?[t,...e]:t}return this.index=e,null}matchSymbol(){const e=this.index,i=this.peekDefinitions("symbol");if(i)for(const[t,n]of i){if(this.index=e+n,"function"!=typeof t.parse)return t.name;{const e=t.parse(this);if(e)return e}}this.index=e;const t=this.matchIdentifier();return null===t?(this.index=e,null):"string"!=typeof t||t&&"symbol"===this.options.parseUnknownIdentifier?.(t,this)?t:(this.index=e,null)}matchOptionalLatexArgument(){const e=this.index;if(this.skipSpaceTokens(),this.match("[")){this.addBoundary(["]"]);const e=this.matchExpression();return this.skipSpace(),this.matchBoundary()?e:this.boundaryError("expected-closing-delimiter")}return this.index=e,null}matchRequiredLatexArgument(e){e||(e=[...'!"#$%&(),/;:?@[]`|~'.split(""),"\\left","\\bigl"]);const i=this.index;if(this.skipSpaceTokens(),this.match("<{>")){this.addBoundary(["<}>"]);const e=this.matchExpression();return this.skipSpace(),this.matchBoundary()?e??["Sequence"]:this.boundaryError("expected-closing-delimiter")}return e.includes(this.peek)?(this.index=i,null):/^[0-9]$/.test(this.peek)?parseInt(this.next()):/^[^\\#]$/.test(this.peek)?this.next():this.matchSymbol()||(this.index=i,null)}matchSupsub(e){if(null===e)return null;const i=this.index;this.skipSpace();const t=[],n=[];let r=i;for(;"_"===this.peek||"^"===this.peek;){if(this.match("_"))if(r=this.index,this.match("_")||this.match("^"))n.push(this.error("syntax-error",r));else{const e=this.matchRequiredLatexArgument()??this.matchStringArgument();if(null===e)return this.error("missing",i);n.push(e)}else if(this.match("^"))if(r=this.index,this.match("_")||this.match("^"))t.push(this.error("syntax-error",r));else{const e=this.matchRequiredLatexArgument();if(null===e)return this.error("missing",i);t.push(e)}r=this.index,this.skipSpace()}if(0===t.length&&0===n.length)return this.index=i,e;let s=e;if(n.length>0){const e=this._dictionary.infix[1]?.get("_");if(e){const i=["Subscript",s,1===n.length?n[0]:["List",...n]];for(const t of e)if(s="function"==typeof t.parse?t.parse(this,{minPrec:0},i):i,s)break}}if(t.length>0){const e=this._dictionary.infix[1]?.get("^");if(e){const i=["Superscript",s,1===t.length?t[0]:["List",...t]];for(const t of e)if(s="function"==typeof t.parse?t.parse(this,{minPrec:0},i):i,s)break}}return null===s&&(this.index=i),s}matchPostfix(e){if(null===e)return null;const i=this.peekDefinitions("postfix");if(null===i)return null;const t=this.index;for(const[n,r]of i){this.index=t+r;const i=n.parse(this,e);if(null!==i)return i}return this.index=t,null}matchString(){let e="";for(;!this.atBoundary;){const i=this.peek;if("<$>"===i||"<$$>"===i)return"";"<space>"===i?(this.next(),e+=" "):(i[0],e+=this.next())}return e}matchStringArgument(){const e=this.index;if(this.skipSpaceTokens(),this.match("<{>")){for(this.addBoundary(["<}>"]);this.match("<space>"););const e=this.matchString();if(this.matchBoundary())return e.trimEnd();this.removeBoundary()}return this.index=e,null}matchTabular(){const e=[];let i=[],t=null;for(;!this.atBoundary;)if(this.skipSpace(),this.match("&"))i.push(t??"Nothing"),t=null;else if(this.match("\\\\")||this.match("\\cr"))this.skipSpace(),this.matchOptionalLatexArgument(),null!==t&&i.push(t),e.push(i),i=[],t=null;else{const e=[];let i=this.peek;for(;"&"!==i&&"\\\\"!==i&&"\\cr"!==i&&!this.atBoundary;)t=this.matchExpression({condition:e=>{const i=e.peek;return"&"===i||"\\\\"===i||"\\cr"===i}}),t?e.push(t):(e.push(["Error",["'unexpected-token'",i]]),this.next()),this.skipSpace(),i=this.peek;t=e.length>1?["Sequence",...e]:e[0]??"Nothing"}return null!==t&&i.push(t),i.length>0&&e.push(i),e}matchEnvironment(){const e=this.index;if(!this.match("\\begin"))return null;const i=this.matchStringArgument();if(null===i)return this.error("expected-environment-name",e);this.addBoundary(["\\end","<{>",...i.split(""),"<}>"]);const t=this._dictionary.environment.get(i);if(!t)return this.matchTabular(),this.skipSpace(),this.matchBoundary()?this.error(["unknown-environment",{str:i}],e):this.boundaryError("unbalanced-environment");const n=t.parse(this,[],[]);return this.skipSpace(),this.matchBoundary()?null!==n?this.decorate(n,e):(this.index=e,null):this.boundaryError("unbalanced-environment")}applyInvisibleOperator(e,i){if(null===i||"Error"===ui(i)||"Nothing"===pi(i)||ki(i)||this.atTerminator(e)||null===this.options.applyInvisibleOperator)return null;if(null!==this.peekDefinitions("operator"))return null;const t=this.index,n=this.matchExpression({...e,minPrec:390});if(null===n||"Nothing"===pi(n)||ki(n))return this.index=t,null;if("Error"===ui(n))return Si("Sequence",i,n);if("function"==typeof this.options.applyInvisibleOperator)return this.options.applyInvisibleOperator(this,i,n);const r=pi(i);if(r&&"function"===this.options.parseUnknownIdentifier(r,this)){const e=wi(n);return e?[i,...e]:r}const s=vi(i);if(null!==s&&Number.isInteger(s)){const e=ui(n);if("Divide"===e||"Rational"===e){const[e,t]=[vi(hi(n,1)),vi(hi(n,2))];if(null!==e&&null!==t&&e>0&&e<=1e3&&t>1&&t<=1e3&&Number.isInteger(e)&&Number.isInteger(t))return["Add",i,n]}}if("Delimiter"===ui(n)){if("Sequence"===ui(hi(n,1)))return[r??i,...ci(hi(n,1))??[]];if(!hi(n,1)||"Nothing"===pi(hi(n,1)))return Si("Sequence",i,this.error("expected-expression",t))}return"Sequence"===ui(n)||"Sequence"===ui(i)||null!==oi(i)||null!==oi(n)||null!==bi(i)||null!==bi(n)?Si("Sequence",i,n):Si("Multiply",i,n)}matchUnexpectedLatexCommand(){const e=this.index;let i=this.peekDefinitions("operator");if(i){if(i=this.peekDefinitions("postfix"),i){const[t,n]=i[0];if(this.index+=n,"function"==typeof t.parse){const i=t.parse(this,this.error("missing",e));if(i)return i}return t.name?[t.name,this.error("missing",e)]:this.error("unexpected-operator",e)}if(i=this.peekDefinitions("prefix"),i){const[t,n]=i[0];if(this.index+=n,"function"==typeof t.parse){const e=t.parse(this,{minPrec:0});if(e)return e}return t.name?[t.name,this.matchExpression()??this.error("missing",e)]:this.error("unexpected-operator",e)}if(i=this.peekDefinitions("infix"),i){const[t,n]=i[0];if(this.index+=n,"function"==typeof t.parse){const i=t.parse(this,{minPrec:0},this.error("missing",e));if(i)return i}return t.name?[t.name,this.error("missing",e),this.matchExpression()??this.error("missing",e)]:this.error("unexpected-operator",e)}}const t=this.peek;if(!t||"\\"!==t[0])return null;if(this.next(),this.skipSpaceTokens(),"\\end"===t){const i=this.matchStringArgument();return null===i?this.error("expected-environment-name",e):this.error(["unbalanced-environment",{str:i}],e)}for(;this.match("[");){let e=0;for(;!this.atEnd&&0===e&&"]"!==this.peek;)"["===this.peek&&(e+=1),"]"===this.peek&&(e-=1),this.next();this.match("]")}const n=this.index;this.index=e;const r=this.matchEnclosureOpen();if(r)return this.error(["expected-close-delimiter",r],n);const s=this.matchEnclosureClose();if(s)return this.error(["expected-open-delimiter",s],e);for(this.index=n;this.match("<{>");){let e=0;for(;!this.atEnd&&0===e&&"<}>"!==this.peek;)"<{>"===this.peek&&(e+=1),"<}>"===this.peek&&(e-=1),this.next();this.match("<}>")}return this.error(["unexpected-command",{str:t}],e)}matchPrimary(){if(this.atBoundary)return null;let e=null;const i=this.index;if(this.match("<}>"))return this.error("unexpected-closing-delimiter",i);if(this.match("<{>")){if(this.addBoundary(["<}>"]),e=this.matchExpression(),null===e)return this.boundaryError("expected-expression");if(!this.matchBoundary())return this.decorate(["Sequence",e,this.boundaryError("expected-closing-delimiter")],i)}if(null===e){const i=this.matchNumber();i&&(e={num:i})}if(null===e&&(e=this.matchEnclosure()),null===e&&(e=this.matchEnvironment()),null===e&&this.matchAll(this._positiveInfinityTokens)&&(e={num:"+Infinity"}),null===e&&this.matchAll(this._negativeInfinityTokens)&&(e={num:"-Infinity"}),null===e&&this.matchAll(this._notANumberTokens)&&(e={num:"NaN"}),null===e&&(e=this.matchFunction()??this.matchSymbol()),null!==e){e=this.decorate(e,i);let t=null,n=this.index;do{if(t=this.matchPostfix(e),e=t??e,this.index===n&&null!==t)break;n=this.index}while(null!==t)}return null===e&&(e=this.matchUnexpectedLatexCommand()),null!==e&&(e=this.matchSupsub(e)),this.decorate(e,i)}matchExpression(e){const i=this.index;if(this.skipSpace(),this.atBoundary)return this.index=i,null;e||(e={minPrec:0}),void 0===e.minPrec&&(e.minPrec=0);let t=this.matchPrefixOperator({...e,minPrec:0});if(null===t&&(t=this.matchPrimary(),"Sequence"===ui(t)&&0===gi(t)&&(t=null)),t){let i=!1;for(;!i&&!this.atTerminator(e);){this.skipSpace();let n=this.matchInfixOperator(t,e);null===n&&(n=this.applyInvisibleOperator(e,t)),null!==n?t=n:i=!0}}return this.decorate(t,i)}decorate(e,i){if(null===e)return null;if(!this.options.preserveLatex)return e;const t=this.latex(i,this.index);return Array.isArray(e)?e={latex:t,fn:e}:"number"==typeof e?e={latex:t,num:Number(e).toString()}:"string"==typeof e?e={latex:t,sym:e}:"object"==typeof e&&null!==e&&(e.latex=t),e}error(e,i){return"string"==typeof e?["Error",{str:e},["Latex",{str:this.latex(i,this.index)}]]:["Error",["ErrorCode",{str:e[0]},...e.slice(1)],["Latex",{str:this.latex(i,this.index)}]]}}function gt(e,i){const t=e.length,n=e;if(i.beginRepeatingDigits&&i.endRepeatingDigits){e=e.slice(0,-1);for(let t=0;t<e.length-16;t++){const n=e.substring(0,t);for(let r=0;r<17;r++){const s=e.substring(t,t+r+1),o=Math.floor((e.length-n.length)/s.length);if(o<=3)break;if((n+s.repeat(o+1)).startsWith(e))return"0"===s?n.replace(/(\d{3})/g,"$1"+i.groupSeparator):n.replace(/(\d{3})/g,"$1"+i.groupSeparator)+i.beginRepeatingDigits+s+i.endRepeatingDigits}}}const r=t>i.precision-1;return e=n,r&&(e=e.substring(0,i.precision-1)),i.groupSeparator&&(e=e.replace(/(\d{3})/g,"$1"+i.groupSeparator)).endsWith(i.groupSeparator)&&(e=e.slice(0,-i.groupSeparator.length)),r?e+i.truncationMarker:e}function pt(e,i){return e?i.beginExponentMarker?i.beginExponentMarker+e+(i.endExponentMarker??""):"10^{"+e+"}":""}function dt(e,i,t=1){let n=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/);if(!n){let i="";if("-"===e[0]?(i="-",e=e.substring(1)):"+"===e[0]&&(e=e.substring(1)),e.indexOf(".")<0)e=1===e.length?i+e+"e+0":i+e[0]+"."+e.slice(1)+"e+"+(e.length-1);else{let[t,n,r]=e.match(/^(.*)\.(.*)$/);for(r||(r="");n.startsWith("0");)n=n.substring(1);e=n?i+n[0]+"."+n.slice(1)+r+"e+"+(n.length-1):i+"0."+r+"e+0"}n=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/)}if(!n)return bt(e,i);let r=parseInt(n[2]),s=n[1];if(Math.abs(r)%t!=0){const e=r>0?r%t:-(t+r)%t;r=r>=0?r-e:r+e;let[i,n,o]=s.match(/^(.*)\.(.*)$/)??["",s,""];s=n+(o+"00000000000000000").slice(0,Math.abs(e))+"."+o.slice(Math.abs(e))}const o=i.avoidExponentsInRange;if(o&&r>=o[0]&&r<=o[1])return;let a="",u=s;n=u.match(/^(.*)\.(.*)$/),n&&(u=n[1],a=n[2]);const l=0!==r?pt(Number(r).toString(),i):"";return i.groupSeparator&&(u=u.replace(/\B(?=(\d{3})+(?!\d))/g,i.groupSeparator),a=gt(a,i)),a&&(a=i.decimalMarker+a),l?"1"!==u||a?u+a+i.exponentProduct+l:l:u+a}function bt(e,i){let t,n=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/i);n?.[1]&&n[2]&&(t=pt(n[2],i));let r=n?.[1]??e,s="";return n=(t?n[1]:e).match(/^(.*)\.(.*)$/),n?.[1]&&n[2]&&(r=n[1],s=n[2]),i.groupSeparator&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,i.groupSeparator),s=gt(s,i)),s&&(s=i.decimalMarker+s),t?"1"!==r||s?r+s+i.exponentProduct+t:t:r+s}class yt{constructor(e,i,t){this.level=-1,this.options=e,e.invisibleMultiply&&(/#1/.test(e.invisibleMultiply)&&/#2/.test(e.invisibleMultiply)||t([{severity:"warning",message:["expected-argument","invisibleMultiply"]}])),this.onError=t,this.dictionary=i}updateOptions(e){for(const i of Object.keys(this.options))i in e&&(this.options[i]=e[i])}wrap(e,i){if(null===e)return"";if(void 0===i)return this.wrapString(this.serialize(e),this.options.groupStyle(e,this.level+1));if("number"==typeof e||ti(e)||"string"==typeof e||ni(e))return this.serialize(e);const t=ui(e);if("string"==typeof t&&"Delimiter"!==t&&"Subscript"!==t){const n=this.dictionary.name.get(t);if(n&&("symbol"===n.kind||"prefix"===n.kind||"infix"===n.kind||"postfix"===n.kind)&&n.precedence<i)return this.wrapString(this.serialize(e),this.options.applyFunctionStyle(e,this.level))}return this.serialize(e)}wrapShort(e){if(null===e)return"";const i=this.serialize(e);return"Delimiter"===ui(e)&&1===gi(e)||ii(e)||/(^(.|\\[a-zA-Z*]+))$/.test(i)?i:this.wrapString(i,this.options.groupStyle(e,this.level+1))}wrapString(e,i,t){if("none"===i)return e;const n=t?.[0]??"(",r=t?.[1]??")";return"."!==n&&"."!==r||"paren"!==i||(i="leftright"),"leftright"===i?`${"."===n?"":"\\left("+n}${e}${"."===r?"":"\\right("+r})`:"big"===i?`${"."===n?"":"\\Bigl("+n}${e}${"."===r?"":"\\Bigr("+r})`:n+e+r}wrapArguments(e){return this.wrapString((ci(e)??[]).map((e=>this.serialize(e))).join(", "),this.options.applyFunctionStyle(e,this.level))}serializeSymbol(e,i){return ui(e)?this.serializeFunction(e,i):"string"==typeof i?.serialize?i.serialize:"function"==typeof i?.serialize?i.serialize(this,e):_t(pi(e),"upright.")??""}serializeFunction(e,i){const t=ui(e);if(!t)return this.serializeSymbol(e,i);const n=ci(e)??[];if(i)return"function"==typeof i.serialize?i.serialize(this,e):Xe([i.serialize??t,this.wrapArguments(e)]);if("string"==typeof t&&t.length>0&&"\\"===t[0])return Xe([t,...n.map((e=>`{${this.serialize(e)}}`))]);if("string"==typeof t)return _t(t,"upright.")+this.wrapArguments(e);const r=this.options.applyFunctionStyle(e,this.level);return"\\mathrm{Apply}"+this.wrapString(this.serialize(t)+", "+this.serialize(["List",...n]),r)}serializeDictionary(e){return`\\left\\lbrack\\begin{array}{lll}${Object.keys(e).map((i=>`\\textbf{${i}} & \\rightarrow & ${this.serialize(e[i])}`)).join("\\\\")}\\end{array}\\right\\rbrack`}serialize(e){if(null==e)return"";this.level+=1;try{const i=(()=>{const i=function(e,i){if(null===e)return"";let t;if("number"==typeof e||"string"==typeof e)t=e;else{if("object"!=typeof e||!("num"in e))return"";t=e.num}if("number"==typeof t){if(t===1/0)return i.positiveInfinity;if(t===-1/0)return i.negativeInfinity;if(Number.isNaN(t))return i.notANumber;let e;return"engineering"===i.notation?e=dt(t.toExponential(),i,3):"scientific"===i.notation&&(e=dt(t.toExponential(),i)),e??bt(t.toString(),i)}if(t=t.toLowerCase().replace(/[\u0009-\u000d\u0020\u00a0]/g,""),"infinity"===t||"+infinity"===t)return i.positiveInfinity;if("-infinity"===t)return i.negativeInfinity;if("nan"===t)return i.notANumber;if(!/^[-+\.]?[0-9]/.test(t))return"";if(t=t.replace(/[nd]$/,""),/\([0-9]+\)/.test(t)){const[e,n,r,s]=t.match(/(.+)\(([0-9]+)\)(.*)$/)??[];t=n+r.repeat(Math.ceil(i.precision/r.length))+s}let n,r="";for("-"===t[0]?(r="-",t=t.substring(1)):"+"===t[0]&&(t=t.substring(1));"0"===t[0];)t=t.substring(1);return 0===t.length?t=r+"0":"."===t[0]&&(t=r+"0"+t),"engineering"===i.notation?n=dt(t,i,3):"scientific"===i.notation&&(n=dt(t,i)),r+(n??bt(t,i))}(e,this.options);if(i)return i;const t=oi(e);if(null!==t)return`\\text{${t}}`;const n=pi(e);if(null!==n){const i=this.dictionary.name.get(n);if("symbol"===i?.kind)return this.serializeSymbol(e,i);if("function"===i?.kind)return this.serializeFunction(e,i)}const r=bi(e);if(null!==r)return this.serializeDictionary(r);const s=li(e);if(s){if("\\"===s[0]){const i=ci(e)??[];return 0===i.length?s:s+"{"+i.map((e=>this.serialize(e))).filter((e=>!!e)).join("}{")+"}"}const i=this.dictionary.name.get(s);if(i)return"function"==typeof i.serialize?i.serialize(this,e):"infix"===i.kind||"postfix"===i.kind||"prefix"===i.kind?function(e,i,t){let n="";const r=gi(i),s=li(i);if("postfix"===t.kind)return 1!==r&&e.onError([{severity:"warning",message:["postfix-operator-requires-one-operand",e.serializeSymbol(s)]}]),vt(t.serialize,[e.wrap(hi(i,1),t.precedence)]);if("prefix"===t.kind)return 1!==r&&e.onError([{severity:"warning",message:["prefix-operator-requires-one-operand",e.serializeSymbol(s)]}]),vt(t.serialize,[e.wrap(hi(i,1),t.precedence+1)]);if("infix"===t.kind){n=e.wrap(hi(i,1),t.precedence);for(let s=2;s<r+1;s++){const r=hi(i,s);null!==r&&(n=vt(t.serialize,[n,e.wrap(r,t.precedence)]))}}return n}(this,e,i):"symbol"===i.kind?this.serializeSymbol(e,i):"function"===i.kind?this.serializeFunction(e,i):""}if(Array.isArray(e)||ri(e)||null!==pi(e))return this.serializeSymbol(e);this.onError([{severity:"warning",message:["syntax-error",e?JSON.stringify(e):"undefined"]}])})();return this.level-=1,i??""}catch(e){}return this.level-=1,""}applyFunctionStyle(e,i){return this.options.applyFunctionStyle(e,i)}groupStyle(e,i){return this.options.groupStyle(e,i)}rootStyle(e,i){return this.options.rootStyle(e,i)}fractionStyle(e,i){return this.options.fractionStyle(e,i)}logicStyle(e,i){return this.options.logicStyle(e,i)}powerStyle(e,i){return this.options.powerStyle(e,i)}numericSetStyle(e,i){return this.options.numericSetStyle(e,i)}}function vt(e,i){let t=e;for(let e=0;e<i.length;e++){let n=i[e]??"";if(/[a-zA-Z*]/.test(n[0])){const i=t.match(RegExp("(.*)#"+Number(e+1).toString()));i&&/\\[a-zA-Z*]+/.test(i[1])&&(n=" "+n)}t=t.replace("#"+Number(e+1).toString(),n)}return t}const Nt=["alpha","beta","gamma","Gamma","delta","Delta","epsilon","zeta","eta","theta","Theta","iota","kappa","lambda","Lambda","mu","nu","xi","Xi","pi","Pi","rho","sigma","Sigma","tau","upsilon","phi","Phi","varphi","chi","psi","Psi","omega","Omega","aleph","ast","blacksquare","bot","bullet","circ","diamond","times","top","square","star"];function _t(e,i="italic."){if(null===e)return null;const t=e.match(/^(_+)(.*)/);if(t)return`\\text{${"\\_".repeat(t[1].length)+xt(t[2])}}`;let n;[n,e]=function(e){const i=e.match(/^([a-zA-Z-]+\.)(.*)/);return i?[i[1],i[2]]:["",e]}(e);const r=xt(e);return 1!==r.length||n?(n||(n=i),({"upright.":"\\mathrm{_}","italic.":"\\mathit{_}","bold-italic.":"\\mathbf{\\mathit{_}}","script.":"\\mathscr{_}","calligraphic.":"\\mathcal{_}","bold-script.":"\\mathbf{\\mathscr{_}}","bold-calligraphic.":"\\mathbf{\\mathcal{_}}","fraktur.":"\\mathfrak{_}","gothic.":"\\mathfrak{_}","bold-gothic.":"\\mathbf{\\mathfrak{_}}","bold-fraktur.":"\\mathbf{\\mathfrak{_}}","sans-serif.":"\\mathsf{_}","bold-sans-serif.":"\\mathbf{\\mathsf{_}}","italic-sans-serif.":"\\mathit{\\mathsf{_}}","monospace.":"\\mathtt{_}","blackboard.":"\\mathbb{_}","double-struck.":"\\mathbb{_}"}[n]??"\\mathit{_}").replace("_",r)):r}function xt(e){const i=e.indexOf("_");if(i>0){const t=e.substring(0,i),n=e.substring(i+1);return n?n.startsWith('"')&&n.endsWith('"')?`${xt(t)}_\\mathrm{${xt(n.substring(1,-1))}}`:`${xt(t)}_{${xt(n)}}`:_t(t)+"\\_"}const t=e.match(/(.*?)(-?[0-9]+)$/);return t?0===t[1].length?e:`${xt(t[1])}_{${t[2]}}`:Nt.includes(e)?"\\"+e:e=e.replace(/[{}\[\]\\:\-\$%]/g,(e=>({"{":"\\lbrace ","}":"\\rbrace ","[":"\\lbrack ","]":"\\rbrack ",":":"\\colon ","\\":"\\backslash ","-":'\\unicode{"2013}'}[e]??"\\"+e)))}const St={invisibleMultiply:"",invisiblePlus:"",multiply:"\\times",missingSymbol:"\\blacksquare",applyFunctionStyle:function(e,i){return"paren"},groupStyle:function(e,i){return"paren"},rootStyle:Mi,fractionStyle:qi,logicStyle:function(e,i){return"boolean"},powerStyle:function(e,i){return"solidus"},numericSetStyle:function(e,i){return"compact"}};class wt{constructor(e){this.onError=e.onError??(e=>{if("undefined"!=typeof window)for(const i of e);}),this.computeEngine=e.computeEngine;const i={...e};delete i.dictionary,delete i.onError,this.options={...ht,...mt,...St,...i},this.dictionary=function(e,i){const t={lookahead:1,name:new Map,function:new Map,symbol:[],infix:[],prefix:[],postfix:[],environment:new Map,matchfix:[]};for(const n of e){const[e,r]=rt(n,i);if(null!==r)if(void 0!==r.name&&(t.name.has(r.name)&&i({severity:"warning",message:["invalid-dictionary-entry",r.name,"Duplicate definition"]}),t.name.set(r.name,r)),"matchfix"===r.kind)t.matchfix.push(r);else if("environment"===r.kind){const e=ei(n.trigger??"");t.environment.has(e)&&i({severity:"warning",message:["invalid-dictionary-entry",e,"Duplicate environment definition"]}),t.environment.set(e,r)}else if(e){const i=ei(n.trigger??""),s=nt(e);if(t.lookahead=Math.max(t.lookahead,s),"function"===r.kind)t.function.has(i)?t.function.set(i,[...t.function.get(i),r]):t.function.set(i,[r]);else if("symbol"===r.kind){void 0===t.symbol[s]&&(t.symbol[s]=new Map);const e=t.symbol[s];e.has(i)?e.get(i).push(r):e.set(i,[r])}else if("prefix"===r.kind){void 0===t.prefix[s]&&(t.prefix[s]=new Map);const e=t.prefix[s];e.has(i)?e.get(i).push(r):e.set(i,[r])}else if("infix"===r.kind){void 0===t.infix[s]&&(t.infix[s]=new Map);const e=t.infix[s];e.has(i)?e.get(i).push(r):e.set(i,[r])}else if("postfix"===r.kind){void 0===t.postfix[s]&&(t.postfix[s]=new Map);const e=t.postfix[s];e.has(i)?e.get(i).push(r):e.set(i,[r])}}}return t}(e.dictionary??wt.getDictionary(),(e=>this.onError([e])))}updateOptions(e){for(const i of Object.keys(this.options))i in e&&(this.options[i]=e[i]);this.serializer.updateOptions(e)}static getDictionary(e="all"){if("all"===e){const e=[];for(const i of Object.keys(st))st[i]&&e.push(...st[i]);return e}return st[e]?[...st[e]]:[]}parse(e){const i=new ft(Je(e,[]),this.options,this.dictionary,this.computeEngine);let t=i.matchExpression();if(!i.atEnd){const e=i.peekDefinitions("infix");if(e){const n=i.index,[r,s]=e[0];i.index+=s;const o=r.parse(i,{minPrec:0},t??i.error("missing",n));if(o)return o;if(r.name)return[r.name,t??i.error("missing",n),i.error("missing",n)];i.index=n}const n=i.index,r=i.matchEnclosureOpen();if(r){const e=i.error(["expected-close-delimiter",r],n);return t?["Sequence",t,e]:e}const s=i.matchEnclosureClose();if(s){const e=i.error(["expected-open-delimiter",s],n);return t?["Sequence",t,e]:e}const o=i.index,a=i.next();for(;!i.atEnd;)i.next();const u=i.error([a.length>1&&a.startsWith("\\")?"unexpected-command":"unexpected-token",{str:ei([a])}],o);t=t?["Sequence",t,u]:u}return t??(t=["Sequence"]),this.options.preserveLatex&&(Array.isArray(t)?t={latex:e,fn:t}:"number"==typeof t?t={latex:e,num:Number(t).toString()}:"string"==typeof t?t={latex:e,sym:t}:"object"==typeof t&&null!==t&&(t.latex=e)),t??["Sequence"]}serialize(e){return this.serializer.serialize(e)}get serializer(){return this._serializer||(this._serializer=new yt(this.options,this.dictionary,this.onError)),this._serializer}}const kt=Math.log10(Math.pow(2,53)),Et=1e-10,It=1e6,At=1e6,Mt=new Set([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257,3259,3271,3299,3301,3307,3313,3319,3323,3329,3331,3343,3347,3359,3361,3371,3373,3389,3391,3407,3413,3433,3449,3457,3461,3463,3467,3469,3491,3499,3511,3517,3527,3529,3533,3539,3541,3547,3557,3559,3571,3581,3583,3593,3607,3613,3617,3623,3631,3637,3643,3659,3671,3673,3677,3691,3697,3701,3709,3719,3727,3733,3739,3761,3767,3769,3779,3793,3797,3803,3821,3823,3833,3847,3851,3853,3863,3877,3881,3889,3907,3911,3917,3919,3923,3929,3931,3943,3947,3967,3989,4001,4003,4007,4013,4019,4021,4027,4049,4051,4057,4073,4079,4091,4093,4099,4111,4127,4129,4133,4139,4153,4157,4159,4177,4201,4211,4217,4219,4229,4231,4241,4243,4253,4259,4261,4271,4273,4283,4289,4297,4327,4337,4339,4349,4357,4363,4373,4391,4397,4409,4421,4423,4441,4447,4451,4457,4463,4481,4483,4493,4507,4513,4517,4519,4523,4547,4549,4561,4567,4583,4591,4597,4603,4621,4637,4639,4643,4649,4651,4657,4663,4673,4679,4691,4703,4721,4723,4729,4733,4751,4759,4783,4787,4789,4793,4799,4801,4813,4817,4831,4861,4871,4877,4889,4903,4909,4919,4931,4933,4937,4943,4951,4957,4967,4969,4973,4987,4993,4999,5003,5009,5011,5021,5023,5039,5051,5059,5077,5081,5087,5099,5101,5107,5113,5119,5147,5153,5167,5171,5179,5189,5197,5209,5227,5231,5233,5237,5261,5273,5279,5281,5297,5303,5309,5323,5333,5347,5351,5381,5387,5393,5399,5407,5413,5417,5419,5431,5437,5441,5443,5449,5471,5477,5479,5483,5501,5503,5507,5519,5521,5527,5531,5557,5563,5569,5573,5581,5591,5623,5639,5641,5647,5651,5653,5657,5659,5669,5683,5689,5693,5701,5711,5717,5737,5741,5743,5749,5779,5783,5791,5801,5807,5813,5821,5827,5839,5843,5849,5851,5857,5861,5867,5869,5879,5881,5897,5903,5923,5927,5939,5953,5981,5987,6007,6011,6029,6037,6043,6047,6053,6067,6073,6079,6089,6091,6101,6113,6121,6131,6133,6143,6151,6163,6173,6197,6199,6203,6211,6217,6221,6229,6247,6257,6263,6269,6271,6277,6287,6299,6301,6311,6317,6323,6329,6337,6343,6353,6359,6361,6367,6373,6379,6389,6397,6421,6427,6449,6451,6469,6473,6481,6491,6521,6529,6547,6551,6553,6563,6569,6571,6577,6581,6599,6607,6619,6637,6653,6659,6661,6673,6679,6689,6691,6701,6703,6709,6719,6733,6737,6761,6763,6779,6781,6791,6793,6803,6823,6827,6829,6833,6841,6857,6863,6869,6871,6883,6899,6907,6911,6917,6947,6949,6959,6961,6967,6971,6977,6983,6991,6997,7001,7013,7019,7027,7039,7043,7057,7069,7079,7103,7109,7121,7127,7129,7151,7159,7177,7187,7193,7207,7211,7213,7219,7229,7237,7243,7247,7253,7283,7297,7307,7309,7321,7331,7333,7349,7351,7369,7393,7411,7417,7433,7451,7457,7459,7477,7481,7487,7489,7499,7507,7517,7523,7529,7537,7541,7547,7549,7559,7561,7573,7577,7583,7589,7591,7603,7607,7621,7639,7643,7649,7669,7673,7681,7687,7691,7699,7703,7717,7723,7727,7741,7753,7757,7759,7789,7793,7817,7823,7829,7841,7853,7867,7873,7877,7879,7883,7901,7907,7919]);function qt(e){if(e<=3)return{[e]:1};const i={};let t=0;for(;e%2==0;)t+=1,e/=2;for(t>0&&(i[2]=t),t=0;e%3==0;)t+=1,e/=3;t>0&&(i[3]=t);let n=!1;for(;!n;){if(1===e)return i;const t=Math.sqrt(e);n=!0;for(let r=6;r<=t+6;r+=6){if(e%(r-1)==0){i[r-1]=(i[r-1]??0)+1,e/=r-1,n=!1;break}if(e%(r+1)==0){i[r+1]=(i[r+1]??0)+1,e/=r+1,n=!1;break}}}return void 0!==i[e]?i[e]+=1:i[e]=1,i}function Ct(e,i){if(e>=Number.MAX_SAFE_INTEGER)return[1,e];const t=qt(e);let n=1,r=1;for(const e of Object.keys(t)){const s=parseInt(e);n*=Math.pow(s,Math.floor(t[e]/i)),r*=Math.pow(s,t[e]%i)}return[n,r]}const Dt=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],Ft=[.999999999999997,57.15623566586292,-59.59796035547549,14.13609797474174,-.4919138160976202,3399464998481188e-20,4652362892704857e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.0002174396181152126,-.0001643181065367639,8441822398385274e-20,-261908384015814e-19,3689918265953162e-21];function Tt(e){if(e<0)return NaN;let i=Ft[0];for(let t=14;t>0;--t)i+=Ft[t]/(e+t);const t=e+4.7421875+.5;return.9189385332046727+(e+.5)*Math.log(t)-t+Math.log(i)-Math.log(e)}function Ot(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*Ot(1-e));if(e>100)return Math.exp(Tt(e));e-=1;let i=Dt[0];for(let t=1;t<9;t++)i+=Dt[t]/(e+t);const t=e+7+.5;return 2.5066282746310002*Math.pow(t,e+.5)*Math.exp(-t)*i}function Pt(e,i=10){let t=0;for(let n=0;n<e.length;n++){const r={" ":-1,"\xa0":-1,"\u2000":-1,"\u2001":-1,"\u2002":-1,"\u2003":-1,"\u2004":-1,"\u2005":-1,"\u2006":-1,"\u2007":-1,"\u2008":-1,"\u2009":-1,"\u200a":-1,"\u200b":-1,"\u202f":-1,"\u205f":-1,_:-1,",":-1,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35}[e[n]];if(-1!==r){if(void 0===r)return[t,e.substring(n)];if(r>=i)return[t,e.substring(n)];t=t*i+r}}return[t,""]}function Rt(e){const i=e.numericValue;if(null===i)return null;if("number"==typeof i)return i;if(i instanceof Ge)return i.toNumber();if(Array.isArray(i)){const[e,t]=i;return"number"==typeof e&&"number"==typeof t?e/t:Number(e)/Number(t)}return null}function zt(e){const i=e.numericValue;if(null===i)return null;if(i instanceof Ge)return i;if("number"==typeof i)return e.engine.bignum(i);if(Array.isArray(i)){const[t,n]=i;return"number"==typeof t&&"number"==typeof n?e.engine.bignum(t/n):e.engine.bignum(t).div(n.toString())}return null}function Vt(e){const i=e.numericValue;if(null===i)return null;if("number"==typeof i)return Number.isInteger(i)&&i>=-1e6&&i<=It?i:null;if(i instanceof Ge){if(i.isInteger()){const e=i.toNumber();if(e>=-1e6&&e<=It)return e}return null}if(e.isCanonical)return null;const t=i;if(Array.isArray(t)){const[e,i]=t;let n;return n="number"==typeof e&&"number"==typeof i?e/i:Number(e)/Number(i),Number.isInteger(n)&&n>=-1e6&&n<=It?n:null}return null}function Lt(e,i){return"number"==typeof e&&Math.abs(e)<=i||e instanceof Ge&&e.abs().lte(i)||e instanceof je&&Math.abs(e.re)<=i&&Math.abs(e.im)<=i?0:e}function $t(e){if("bigint"==typeof e)return e;if(e instanceof Ge)return $t(e.toString());let i=e.toString();const t=i.match(/([^\.]+)(?:\.([0-9]+))?e(.+)$/);return t&&(i=t[1]+(t[2]??"")+"0".repeat(parseInt(t[3])-(t[2]?t[2].length:0))),BigInt(i)}const Bt=[BigInt(4),BigInt(2),BigInt(4),BigInt(2),BigInt(4),BigInt(6),BigInt(2),BigInt(6)];function Gt(e,i){const t=function(e){if(e<Number.MAX_SAFE_INTEGER){const i=qt(Number(e)),t=new Map;for(const e of Object.keys(i))t.set($t(e),i[e]);return t}let i=e;const t=new Map;let n=0,r=0,s=0,o=BigInt(10);for(;i%o===BigInt(0);)n+=1,s+=1,i/=o;for(o=BigInt(5);i%o===BigInt(0);)s+=1,i/=o;for(o=BigInt(3);i%o===BigInt(0);)r+=1,i/=o;for(o=BigInt(2);i%o===BigInt(0);)n+=1,i/=o;n>0&&t.set("2",n),r>0&&t.set("3",r),s>0&&t.set("5",s),o=BigInt(7);let a="",u=0;for(;o*o<i;)i%o===BigInt(0)?(a||(a=o.toString()),t.set(a,(t.get(a)??0)+1),i/=o):(o+=Bt[u],a="",u=u<7?u+1:0);i!==BigInt(1)&&t.set(i.toString(),(t.get(i.toString())??0)+1);const l=new Map;for(const[e,i]of t)l.set($t(e),i);return l}(e);let n=BigInt(1),r=BigInt(1);const s=$t(i);for(const[e,i]of t){const t=$t(i);n*=e**(t/s),r*=e**(t%s)}return[n,r]}function Zt(e){return"string"==typeof e&&e.startsWith("$")&&e.endsWith("$")}function Ut(e){return"string"==typeof e&&e.startsWith("$")&&e.endsWith("$")?e.slice(1,-1):null}function jt(e){if("ImaginaryUnit"===e.symbol)return 1;const i=e.numericValue;if(null!==i&&i instanceof je&&0===i.re)return i.im;if("Negate"===e.head){const i=jt(e.op1);return null===i?null:-i}if("Multiply"===e.head&&2===e.nops){if("ImaginaryUnit"===e.op1.symbol)return Rt(e.op2);if("ImaginaryUnit"===e.op2.symbol)return Rt(e.op1)}return 0}function Ht(e,i){if(e.symbol)void 0===e.engine.lookupSymbol(e.symbol)?.value&&i.add(e.symbol);else if(e.ops||e.keys){if(e.ops)for(const t of e.ops)Ht(t,i);if(e.keys)for(const t of e.keys)Ht(e.getKey(t),i)}}function Qt(e,i){if(e.symbol)i.add(e.symbol);else if(e.ops||e.keys){if(e.ops)for(const t of e.ops)Qt(t,i);if(e.keys)for(const t of e.keys)Qt(e.getKey(t),i)}}function Wt(e,i){const t=i&&e.head!==i?[]:[e];if(e.ops)for(const n of e.ops)t.push(...Wt(n,i));else if(e.keys)for(const n of e.keys)t.push(...Wt(e.getKey(n),i));return t}function Yt(e){return"bignum"===e.numericMode||"auto"===e.numericMode}function Kt(e){return"auto"===e.numericMode||"complex"===e.numericMode}function Jt(e){let i=0;for(let t=0;t<e.length;t++)i=Math.imul(31,i)+e.charCodeAt(t)|0;return Math.abs(i)}function Xt(e,i){if(null==i)return null;if("number"==typeof i)return Number.isInteger(i)?$t(i):null;if(ii(i)){let t=(ti(i)?i.num.toString():i).toLowerCase().replace(/[nd]$/g,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,"");if(/\([0-9]+\)/.test(t)){const[i,n,r,s]=t.match(/(.+)\(([0-9]+)\)(.*)$/)??[];t=n+r.repeat(Math.ceil(e.precision/r.length))+(s??"")}return"nan"===t||"infinity"===t||"+infinity"===t||"-infinity"===t||t.includes(".")?null:$t(t)}return null}function en(e){const i=e.numericValue;return null===i?null:"number"==typeof i&&Number.isInteger(i)||i instanceof Ge&&i.isInteger()?$t(i):null}function tn(e,i){const t=new Set;for(const[n,r,s]of i){let i;const o=Ut(s?.condition);if(o){const t=e.pattern(o);i=e=>"True"===t.subs(e).value?.symbol}else i=s?.condition;t.add([e.pattern(n),e.pattern(r),s?.priority??0,i])}return t}function nn([e,i,t,n],r,s,o){const a=e.match(r,{substitution:s,...o});return null===a?null:"function"!=typeof n||n(a)?i.subs(a,{canonical:!0}):null}function rn(e,i,t){const n=t?.iterationLimit??1;let r=0;const s=t?.once??!1;let o=!1,a=!1;try{for(;!o&&r<n;){o=!0;for(const n of i){const i=nn(n,e,{},t);if(null!==i&&i!==e){if(s)return i;o=!1,a=!0,e=i}}r+=1}}catch(e){}return a?e:null}function sn(e){return null!==e&&Array.isArray(e)}function on(e){return null!==e&&Array.isArray(e)&&"number"==typeof e[0]}function an(e){return null!==e&&Array.isArray(e)&&"bigint"==typeof e[0]}function un(e){return 0==e[0]}function ln(e){return e[0]===e[1]}function cn(e){return e[0]===-e[1]}function hn(e){return Number(e[0])}function mn(e){return Number(e[1])}function fn(e){return e[0]<0}function gn(e){return[-e[0],e[1]]}function pn(e){return e[0]<0?[-e[1],-e[0]]:[e[1],e[0]]}function dn(e){const i=e.numericValue;if(null!==i)return Array.isArray(i)?i:"number"==typeof i&&Number.isInteger(i)?[i,1]:i instanceof Ge&&i.isInteger()?[$t(i),BigInt(1)]:void 0}function bn(e){return[Number(e[0]),Number(e[1])]}function yn(e,i){if(Array.isArray(i))return an(i)?(e=[$t(e[0]),$t(e[1])],[i[1]*e[0]+i[0]*e[1],i[1]*e[1]]):an(e)?[(i=[$t(i[0]),$t(i[1])])[1]*e[0]+i[0]*e[1],i[1]*e[1]]:[i[1]*e[0]+i[0]*e[1],i[1]*e[1]];let t=i.numericValue;return null!==t&&"number"==typeof t?on(e)?[e[0]+e[1]*t,e[1]]:[e[0]+e[1]*$t(t),e[1]]:t instanceof Ge?(on(e)&&(e=[$t(e[0]),$t(e[1])]),[e[0]+e[1]*$t(t.toString()),e[1]]):Array.isArray(t)?(on(t)&&(t=[$t(t[0]),$t(t[1])]),on(e)&&(e=[$t(e[0]),$t(e[1])]),[t[1]*e[0]+t[0]*e[1],t[1]*e[1]]):e}function vn(e,i){if(Array.isArray(i))return on(e)&&on(i)||(on(e)&&(e=[$t(e[0]),$t(e[1])]),on(i)&&(i=[$t(i[0]),$t(i[1])])),[e[0]*i[0],e[1]*i[1]];const t=i.numericValue;return null!==t&&"number"==typeof t?on(e)?[e[0]*t,e[1]]:[e[0]*$t(t),e[1]]:t instanceof Ge?on(e)?[$t(t.toString())*$t(e[0]),$t(e[1])]:[$t(t.toString())*e[0],e[1]]:Array.isArray(t)?an(t)?[t[0]*$t(e[0]),t[1]*$t(e[1])]:on(e)?[e[0]*t[0],e[1]*t[1]]:[e[0]*$t(t[0]),e[1]*$t(t[1])]:e}function Nn(e,i){if(0===i)return[1,1];if(i<0&&(e=pn(e),i=-i),1===i)return e;if(on(e))return[Math.pow(e[0],i),Math.pow(e[1],i)];const t=$t(i);return[e[0]**t,e[1]**t]}function _n(e){if(on(e)){if(1===e[0]||1===e[1])return e;if(e[1]<0&&(e=[-e[0],-e[1]]),!Number.isFinite(e[1]))return[0,1];const i=function(e,i){if(0===e)return i;if(0===i)return e;if(e===i)return e;if(!Number.isInteger(e)||!Number.isInteger(i))return NaN;for(;0!==i;)[e,i]=[i,e%i];return e<0?-e:e}(e[0],e[1]);return i<=1?e:[e[0]/i,e[1]/i]}if(e[0]===BigInt(1)||e[1]===BigInt(1))return e;e[1]<0&&(e=[-e[0],-e[1]]);const i=function(e,i){for(;i!==BigInt(0);)[e,i]=[i,e%i];return e<0?-e:e}(e[0],e[1]);return i<=1?e:[e[0]/i,e[1]/i]}function xn(e){const i=e.engine;if("Multiply"===e.head){const t=[];let n=[1,1];for(const i of e.ops){const e=i.numericValue;null!==e&&("number"==typeof e&&Number.isInteger(e)||e instanceof Ge&&e.isInteger()||sn(e))?n=vn(n,i):t.push(i)}return n=_n(n),ln(n)?[[1,1],e]:0===t.length?[n,i._ONE]:1===t.length?[n,t[0]]:[n,i.mul(t)]}if("Divide"===e.head){let[t,n]=xn(e.op1);const[r,s]=xn(e.op2),o=_n(vn(t,pn(r)));return s.isOne?[o,n]:[o,i.div(n,s)]}if("Power"===e.head){if(null===e.op2.numericValue)return[[1,1],e];let[t,n]=xn(e.op1);if(ln(t))return[[1,1],e];const r=e.op2,s=Vt(r);if(-1===s)return[pn(t),i.inv(n)];if(null!==s)return[Nn(t,s),i.pow(n,r)];if(null!==r.numericValue&&Array.isArray(r.numericValue)){const[s,o]=bn(r.numericValue),[a,u]=bn(t);if(a>0&&1===Math.abs(s)){const[t,l]=Ct(a,o),[c,h]=Ct(u,o);return 1===t&&1===c?[[1,1],e]:[1===s?[t,c]:[c,t],i.pow(i.mul([i.number([l,h]),n]),r)]}}return[[1,1],e]}if(e.head,"Negate"===e.head){const[i,t]=xn(e.op1);return[gn(i),t]}const t=e.numericValue;if(null!==t){if(t instanceof Ge){if(t.isInteger())return[[$t(t.toString()),BigInt(1)],i._ONE];if(t.isNegative())return[[-1,1],i.number(t.neg())]}if("number"==typeof t){if(Number.isInteger(t))return[[t,1],i._ONE];if(t<0)return[[-1,1],i.number(-t)]}if(sn(t))return[t,i._ONE];if(t instanceof je&&t.re<0)return[[-1,1],i.number(i.complex(-t.re,-t.im))]}return[[1,1],e]}function Sn(e,i,t){if(e===i)return 0;const n=e.N(),r=i.N(),s=n.numericValue,o=r.numericValue;if(null===s||null===o){const t=e.sgn,n=i.sgn;if("number"!=typeof t||"number"!=typeof n)return;return 0===t&&0===n?0:t<0&&n>0?-1:t>0&&n<0?1:void 0}if(t??(t=e.engine.tolerance),s instanceof je&&o instanceof je)return 0===Lt(s.re-o.re,t)&&0===Lt(s.im-o.im,t)?0:void 0;if(s instanceof je||o instanceof je)return;if(sn(s)||sn(o))return;if("number"==typeof s&&"number"==typeof o)return 0===Lt(o-s,t)?0:s<o?-1:1;const a=e.engine,u=a.bignum(o).sub(a.bignum(s));return 0===Lt(u,t)?0:u.isPos()?1:-1}function wn(e,i){if(!i)return e;if(e.every((e=>!e.ops||e.head!==i)))return e;const t=[];for(const n of e)n.ops&&n.head===i?t.push(...wn(n.ops,i)):t.push(n);return t.length===e.length?e:t}function kn(e){if(e.every((e=>"Sequence"!==e.head)))return e;const i=[];for(const t of e)t.isValid&&"Sequence"===t.head?t.ops&&i.push(...t.ops):i.push(t);return i}function En(e){return e.every((e=>e.isCanonical))?e:e.map((e=>e.canonical))}function In(e,i){if("Negate"===e.head)return e.op1;if(null!==e.numericValue)return function(e,i){let t=e.numericValue;return null===t?null:("number"==typeof t?t=-t:t instanceof Ge||t instanceof Ue.exports.Complex?t=t.neg():Array.isArray(t)&&(t=gn(t)),e.engine.number(t,{metadata:i}))}(e,i);if("Add"===e.head){let t=e.ops.map((e=>In(e)));return t=wn(t,"Add"),e.engine.add(t,i)}return"Multiply"===e.head?function(e,i){let t=[],n=!1;for(const e of i)n||"Negate"!==e.head?t.push(e):(n=!0,t.push(e.op1));if(n)return e.mul(t);t=[];for(const e of i)n||null===e.numericValue||!e.isInteger?t.push(e):(n=!0,t.push(In(e)));if(n)return e.mul(t);t=[];for(const e of i)n||null===e.numericValue||!e.isNumber?t.push(e):(n=!0,t.push(In(e)));return n?e.mul(t):e._fn("Negate",[e._fn("Multiply",i)])}(e.engine,e.ops):"Divide"===e.head?e.engine._fn("Divide",[In(e.op1),e.op2]):e.engine._fn("Negate",[e],i)}function An(e,i,t="simplify"){return In(i)}function Mn(e,i){const t=e.engine;return"Negate"===e.head&&"Negate"===i.head?Mn(e.op1,i.op1):"Negate"===e.head?In(Mn(e.op1,i)):"Negate"===i.head?In(Mn(e,i.op1)):(e=Cn(e),i=Cn(i),"Add"===e.head?t.add(e.ops.map((e=>Mn(e,i)))):"Add"===i.head?t.add(i.ops.map((i=>Mn(e,i)))):t.mul([e,i]))}function qn(e,i){if(1===i)return e;const t=Mn(e,e);return 2===i?t:i%2==0?qn(t,i/2):Mn(qn(t,Math.round(i/2)-1),e)}function Cn(e){const i=(e=e.simplify()).engine;if("Add"===e.head)return i.add(e.ops.map((e=>Cn(e)))).simplify();if("Negate"===e.head)return Mn(i._NEGATIVE_ONE,e.op1).simplify();if("Subtract"===e.head)return i.add([Cn(e.op1),Mn(i._NEGATIVE_ONE,e.op1)]).simplify();if("Divide"===e.head)return i.div(Cn(e.op1),Cn(e.op2)).simplify();if("Multiply"===e.head)return 2===e.nops?Mn(e.op1,e.op2):e.ops.reduce(((e,i)=>Mn(e,i)),i._ONE).simplify();if("Power"===e.head){const t=e.op1.head;if("Multiply"===t)return i.mul(e.op1.ops.map((t=>i.pow(t,e.op2)))).simplify();if("Negate"===t){const t=Vt(e.op2);if(null!==t&&t>0)return t%2==0?i.pow(e.op1.op1,e.op2).simplify():i.neg(i.pow(e.op1.op1,e.op2)).simplify()}if("Add"===t){const t=Vt(e.op2);if(null!==t)return t>0?qn(e.op1,t).simplify():i.inv(qn(e.op1,-t)).simplify()}}return e.simplify()}const Dn=[[["Multiply","_x","_a"],["0"]],[["Add","_a","_x"],["Negate","_a"]],[["Add",["Negate","_x"],"_a"],"_a"],[["Add",["Multiply","_x","_a"],"_b"],["Divide",["Negate","_b"],"_a"]],[["Add",["Multiply",["Power","_x",2],"_a"],["Multiply","_x","_b"],"_c"],["Divide",["Add",["Negate","_b"],["Sqrt",["Subtract",["Square","_b"],["Multiply",4,"_a","_c"]]]],["Multiply",2,"_a"]]],[["Add",["Multiply",["Power","_x",2],"_a"],["Multiply","_x","_b"],"_c"],["Divide",["Subtract",["Negate","_b"],["Sqrt",["Subtract",["Square","_b"],["Multiply",4,"_a","_c"]]]],["Multiply",2,"_a"]]],[["Add",["Multiply",["Power","_x",2],"_a"],["Multiply","_x","_b"]],0],[["Add",["Multiply",["Power","_x",2],"_a"],["Multiply","_x","_b"]],["Divide",["Negate","_b"],"_a"]],[["Add",["Multiply",["Power","_x",2],"_a"],"_b"],["Sqrt",["Divide",["Negate","_b"],"_a"]]],[["Add",["Multiply",["Power","_x",2],"_a"],"_b"],["Negate",["Sqrt",["Divide",["Negate","_b"],"_a"]]]]];function Fn(e,i){const t=e.engine;"Equal"===e.head&&(e=t.add([e.op1.canonical,t.neg(e.op2.canonical)]).simplify());const n=t.cache("univariate-roots-rules",(()=>tn(t,Dn))),r=function(e,i,t){const n=[];for(const r of i){const i=nn(r,e,t);null!==i&&n.push(i)}return n}(Cn(e).subs({[i]:"_x"},{canonical:!1}),n,{_x:t.symbol("_x")});return r.map((e=>e.canonical.evaluate()))}function Tn(e){return"Element"===e.head?function(e){const i=e.engine,t=(n=e.op1).symbols.filter((e=>!On(n.engine,e)));var n;if(1===t.length){const n=i.domain(e.op2.evaluate().json);return n.isValid?(n.isCompatible("Function")?i.defineFunction(t[0],{signature:{domain:"Function"}}):i.defineSymbol(t[0],{domain:n}),"ok"):"not-a-predicate"}if(e.op1.symbol&&On(i,e.op1.symbol)){const t=i.domain(e.op2.evaluate().json);if(!t.isValid)return"not-a-predicate";const n=i.lookupSymbol(e.op1.symbol);if(n)return n.domain&&!t.isCompatible(n.domain)?"contradiction":(n.domain=t,"ok");const r=i.lookupFunction(e.op1.symbol);return r?.signature?.domain?t.isCompatible(r.signature.domain)?t.isCompatible(r.signature.domain,"bivariant")?"tautology":"not-a-predicate":"contradiction":"ok"}if(t.length>0)return i.assumptions.set(e,!0),"ok";const r=e.evaluate();return"True"===r.symbol?"tautology":"False"===r.symbol?"contradiction":"not-a-predicate"}(e):"Equal"===e.head?function(e){const i=e.freeVars;if(0===i.length){const i=e.evaluate();return"True"===i.symbol?"tautology":"False"===i.symbol?"contradiction":"not-a-predicate"}const t=e.engine,n=e.op1.symbol;if(n&&!function(e,i){return!e.lookupFunction(i)&&void 0!==e.lookupSymbol(i)?.value}(t,n)&&!e.op2.has(n)){const i=e.op2.evaluate();if(!i.isValid)return"not-a-predicate";const r=t.lookupSymbol(n);return r?r.domain&&!i.domain.isCompatible(r.domain)?"contradiction":(r.value=i,"ok"):(t.defineSymbol(n,{value:i}),"ok")}if(1===i.length){const n=i[0],r=Fn(e,n);0===r.length&&t.assumptions.set(t.box(["Equal",t.add([e.op1.canonical,t.neg(e.op2.canonical)]).simplify(),0]),!0);const s=1===r.length?r[0]:t.box(["List",...r]),o=t.lookupSymbol(n);return o?o.domain&&!r.every((e=>s.domain.isCompatible(e.domain)))?"contradiction":(o.value=s,"ok"):(t.defineSymbol(n,{value:s}),"ok")}return t.assumptions.set(e,!0),"ok"}(e):function(e){const i=e.head;return"string"==typeof i&&["Less","Greater","LessEqual","GreaterEqual"].includes(i)}(e)?function(e){const i=e.engine;if(e.op1.symbol&&!On(i,e.op1.symbol))return e.op2.evaluate().isZero?"Less"===e.head?i.defineSymbol(e.op1.symbol,{domain:i.domain("NegativeNumber")}):"LessEqual"===e.head?i.defineSymbol(e.op1.symbol,{domain:i.domain("NonPositiveNumber")}):"Greater"===e.head?i.defineSymbol(e.op1.symbol,{domain:i.domain("PositiveNumber")}):"GreaterEqual"===e.head&&i.defineSymbol(e.op1.symbol,{domain:i.domain("NonNegativeNumber")}):(i.defineSymbol(e.op1.symbol,{domain:i.domain("ExtendedRealNumber")}),i.assumptions.set(e,!0)),"ok";let t,n,r="";if("Less"===e.head?(t=e.op1,n=e.op2,r="<"):"LessEqual"===e.head?(t=e.op1,n=e.op2,r="<="):"Greater"===e.head?(t=e.op2,n=e.op1,r="<"):"GreaterEqual"===e.head&&(t=e.op2,n=e.op1,r="<="),!r)return"internal-error";const s=i.add([t.canonical,i.neg(n.canonical)]).simplify(),o=i.box(["<"===r?"Less":"LessEqual",s,0]).evaluate();if("True"===o.symbol)return"tautology";if("False"===o.symbol)return"contradiction";const a=o.freeVars;return 0===a.length?"not-a-predicate":(1===a.length&&(i.lookupSymbol(a[0])||i.defineSymbol(a[0],{domain:"ExtendedRealNumber"})),i.assumptions.set(o,!0),"ok")}(e):"not-a-predicate"}function On(e,i){return void 0!==(e.lookupSymbol(i)??e.lookupFunction(i))}class Pn{constructor(e,i){this.engine=e,void 0!==i?.latex&&(this._latex=i.latex),void 0!==i?.wikidata&&(this._wikidata=i.wikidata)}valueOf(){return"True"===this.symbol||"False"!==this.symbol&&(Rt(this)??this.string??this.symbol??JSON.stringify(this.json))}toString(){if(this.symbol)return this.symbol;if(this.string)return this.string;const e=this.numericValue;if(null!==e){if("number"==typeof e)return e.toString();if(on(e))return`${e[0].toString()}/${e[1].toString()}`;if(an(e))return`${e[0].toString()}/${e[1].toString()}`;if(e instanceof Ue.exports.Complex){const i=1===e.im?"":-1===e.im?"-":e.im.toString();return 0===e.re?i+"i":e.im<0?`${e.re.toString()}${i}i`:`${e.re.toString()}+${i}i`}}return JSON.stringify(this.json)}[Symbol.toPrimitive](e){if("number"===e){const e=this.valueOf();return"number"==typeof e?e:null}return this.toString()}toJSON(){return this.json}get scope(){return null}is(e){return null!=e&&this.isSame(this.engine.box(e))}get latex(){return this._latex??this.engine.serialize(this)}set latex(e){this._latex=e}get symbol(){return null}get isNothing(){return!1}get string(){return null}getSubexpressions(e){return Wt(this,e)}get subexpressions(){return this.getSubexpressions("")}get symbols(){const e=new Set;return Qt(this,e),Array.from(e)}get freeVars(){const e=new Set;return Ht(this,e),Array.from(e)}get errors(){return this.getSubexpressions("Error")}get ops(){return null}get nops(){return 0}get op1(){return this.engine.symbol("Nothing")}get op2(){return this.engine.symbol("Nothing")}get op3(){return this.engine.symbol("Nothing")}get isValid(){return!0}get isPure(){return!1}get isExact(){return!0}get isFree(){return!1}get isConstant(){return!1}get canonical(){return this}apply(e,i){return this}subs(e,i){return i?.canonical?this.canonical:this}solve(e){return null}replace(e){return null}has(e){return!1}get isNaN(){}get isZero(){}get isNotZero(){}get isOne(){}get isNegativeOne(){}get isInfinity(){}get isFinite(){}get isEven(){}get isOdd(){}get isPrime(){}get isComposite(){}get numericValue(){return null}get sgn(){return null}isLess(e){}isLessEqual(e){}isGreater(e){}isGreaterEqual(e){}get isPositive(){}get isNonNegative(){}get isNegative(){}get isNonPositive(){}isCompatible(e,i){return!1}get description(){}get url(){}get wikidata(){return this._wikidata}set wikidata(e){this._wikidata=e}get complexity(){}get basedDefinition(){}get symbolDefinition(){}get functionDefinition(){}bind(e){}unbind(){}get keys(){return null}get keysCount(){return 0}getKey(e){}hasKey(e){return!1}get value(){}set value(e){throw Error(`Can't change the value of \\(${this.latex}\\)`)}get domain(){return this.engine.domain("Void")}set domain(e){throw Error(`Can't change the domain of \\(${this.latex}\\)`)}get explicitDomain(){return this.domain}get isNumber(){}get isInteger(){}get isRational(){}get isAlgebraic(){return!1}get isReal(){}get isExtendedReal(){}get isComplex(){}get isImaginary(){}get isExtendedComplex(){}simplify(e){return this}evaluate(e){return this.simplify(e)}N(e){return this.evaluate()}}function Rn(e,i){if(!i.isInteger()||i.isNegative())return e._BIGNUM_NAN;if(i.lessThan(10))return e.bignum([1,1,2,6,24,120,720,5040,40320,362880,3628800][i.toNumber()]);if(i.gt(Number.MAX_SAFE_INTEGER)){let t=e._BIGNUM_ONE,n=e._BIGNUM_TWO;for(;n.lessThan(i);)t=t.mul(n),n=n.add(1);return t}if(i.modulo(2).eq(1))return i.times(Rn(e,i.minus(1)));let t=i.toNumber(),n=i,r=i;for(;t>2;)t-=2,n=n.add(t),r=r.mul(n);return r}function zn(e,i){if(i.isNegative())return e._BIGNUM_NAN;const t=e.cache("gamma-p-ln",(()=>["0.99999999999999709182","57.156235665862923517","-59.597960355475491248","14.136097974741747174","-0.49191381609762019978","0.33994649984811888699e-4","0.46523628927048575665e-4","-0.98374475304879564677e-4","0.15808870322491248884e-3","-0.21026444172410488319e-3","0.2174396181152126432e-3","-0.16431810653676389022e-3","0.84418223983852743293e-4","-0.2619083840158140867e-4","0.36899182659531622704e-5"].map((i=>e.bignum(i)))));let n=t[0];for(let e=t.length-1;e>0;--e)n=n.add(t[e].div(i.add(e)));const r=e.cache("gamma-g-ln",(()=>e.bignum(607).div(128))),s=i.add(r).add(e._BIGNUM_HALF);return e._BIGNUM_NEGATIVE_ONE.acos().mul(e._BIGNUM_TWO).log().mul(e._BIGNUM_HALF).add(s.log().mul(i.add(e._BIGNUM_HALF)).minus(s).add(n.log()).minus(i.log()))}function Vn(e,i){if(i.lessThan(e._BIGNUM_HALF)){const t=e._BIGNUM_NEGATIVE_ONE.acos();return t.div(t.mul(i).sin().mul(Vn(e,e._BIGNUM_ONE.sub(i))))}if(i.greaterThan(100))return zn(e,i).exp();i=i.sub(1);const t=e.cache("lanczos-7-c",(()=>["0.99999999999980993227684700473478","676.520368121885098567009190444019","-1259.13921672240287047156078755283","771.3234287776530788486528258894","-176.61502916214059906584551354","12.507343278686904814458936853","-0.13857109526572011689554707","9.984369578019570859563e-6","1.50563273514931155834e-7"].map((i=>e.bignum(i)))));let n=t[0];for(let e=1;e<9;e++)n=n.add(t[e].div(i.add(e)));const r=i.add(7).add(e._BIGNUM_HALF);return e._BIGNUM_NEGATIVE_ONE.acos().times(e._BIGNUM_TWO).sqrt().mul(n.mul(r.neg().exp()).mul(r.pow(i.add(e._BIGNUM_HALF))))}function Ln(e){return!e.isFinite()||!(e.d.length>3||3===e.d.length&&e.d[0]>=90)&&e.e<308&&e.e>-306}function $n(e){if("Power"===e.head&&null!==e.op2.numericValue){const i=Vt(e.op2);return null!==i&&i>0?i:1}if("Multiply"===e.head){let i=1;for(const t of e.ops){const e=$n(t);e>1&&(i+=e)}return i}return 1}function Bn(e){if("Power"===e.head&&null!==e.op2.numericValue){const i=Vt(e.op2);return null!==i&&i>0?i:1}if("Multiply"===e.head){let i=1;for(const t of e.ops)i=Math.max(i,$n(t));return i}return 1}function Gn(e){return e.symbol?e.symbol:e.ops?("string"==typeof e.head?e.head:Gn(e.head))+'"'+e.ops.map((e=>Gn(e))).filter((e=>e.length>0)).join('"'):""}const Zn=1e5;function Un(e,i){return i.sort(((e,i)=>{const t=Gn(e),n=Gn(i);if(!t&&!n)return jn(e,i);if(!t)return 1;if(!n)return-1;if(t<n)return-1;if(t>n)return 1;const r=$n(e),s=$n(i);if(r!==s)return s-r;const o=Bn(e),a=Bn(i);return o!==a?o-a:jn(e,i)}))}function jn(e,i){if(e===i)return 0;if(null!==e.numericValue&&e.numericValue===i.numericValue)return 0;const t=Rt(e);if(null!==t){const e=Rt(i);return null!==e?t-e:-1}if(e.numericValue instanceof je)return i.numericValue instanceof je?e.numericValue.re===i.numericValue.re?Math.abs(e.numericValue.im)===Math.abs(i.numericValue.im)?e.numericValue.im-i.numericValue.im:Math.abs(e.numericValue.im)-Math.abs(i.numericValue.im):e.numericValue.re-i.numericValue.re:null!==i.numericValue?1:-1;if(e.numericValue)return i.numericValue?1:-1;if("Sqrt"===e.head&&e.op1.numericValue)return"Sqrt"===i.head&&i.op1.numericValue?jn(e.op1,i.op1):-1;if(e.symbol)return i.symbol?e.symbol===i.symbol?0:e.symbol>i.symbol?1:-1:null!==i.numericValue?1:-1;if(e.ops){if(i.ops){const t=e.functionDefinition?.complexity??Zn,n=i.functionDefinition?.complexity??Zn;return t===n?"string"==typeof e.head&&"string"==typeof i.head?e.head===i.head?Hn(e)-Hn(i):e.head<i.head?1:-1:Hn(e)-Hn(i):t-n}return null!==i.numericValue||i.symbol?1:-1}if(e.string)return i.string?e.string.length!==i.string.length?i.string.length-e.string.length:i.string<e.string?-1:e.string>i.string?1:0:i.keys?-1:1;if(e.keys&&i.keys){if(e.keysCount!==i.keysCount)return i.keysCount-e.keysCount;let t=0,n=0;for(const e of i.keys)t+=i.getKey(e).complexity??Zn;for(const i of e.keys)n+=e.getKey(i).complexity??Zn;return n-t}return(e.complexity??Zn)-(i.complexity??Zn)}function Hn(e){return null!==e.keys?1+e.keysCount:e.ops?("string"==typeof e.head?1:Hn(e.head))+[...e.ops].reduce(((e,i)=>e+Hn(i)),0):1}class Qn{constructor(e,i,t){if(this._terms=[],this._hasInfinity=!1,this._hasZero=!1,this._isCanonical=!0,t??(t={}),"canonical"in t||(t.canonical=!0),this._isCanonical=t.canonical,this.engine=e,this._sign=1,this._rational=Yt(e)?[BigInt(1),BigInt(1)]:[1,1],this._complex=je.ONE,this._bignum=e._BIGNUM_ONE,this._number=1,i)for(const e of i)this.addTerm(e)}get isEmpty(){return this._isCanonical?0===this._terms.length&&!1===this._hasInfinity&&!1===this._hasZero&&1===this._sign&&ln(this._rational)&&1===this._complex.re&&0===this._complex.im&&this._bignum.eq(this.engine._BIGNUM_ONE)&&1===this._number:0===this._terms.length}addTerm(e){if("Multiply"===e.head){for(const i of e.ops)this.addTerm(i);return}if(this._isCanonical){if(e.isNothing)return;if(null!==e.numericValue){if(e.isOne)return;if(e.isZero)return void(this._hasZero=!0);if(e.isNegativeOne)return void(this._sign*=-1);if(e.isInfinity)return this._hasInfinity=!0,void(e.isNegative&&(this._sign*=-1));let i=e.numericValue;if("number"==typeof i)return i<0&&(this._sign*=-1,i=-i),void(Number.isInteger(i)?this._rational=vn(this._rational,[i,1]):Yt(this.engine)?this._bignum=this._bignum.mul(i):this._number*=i);if(i instanceof Ge)return i.isNegative()&&(this._sign*=-1,i=i.neg()),void(i.isInteger()?this._rational=vn(this._rational,[$t(i),BigInt(1)]):Yt(this.engine)?this._bignum=this._bignum.mul(i):this._number*=i.toNumber());if(i instanceof je)return void(this._complex=this._complex.mul(i));if(sn(i))return this._rational=vn(this._rational,i),void(fn(this._rational)&&(this._sign*=-1,this._rational=gn(this._rational)))}}let i=e;if(this._isCanonical){let t;[t,i]=xn(e),this._rational=vn(this._rational,t),fn(this._rational)&&(this._sign*=-1,this._rational=gn(this._rational))}if(null!==i.numericValue&&i.isOne)return;let t=[1,1];if("Power"===i.head){const e=dn(i.op2);e&&(t=e,i=i.op1)}else"Divide"===i.head&&(this.addTerm(i.op1),t=[-1,1],i=i.op2);let n=!1;for(const e of this._terms)if(e.term.isSame(i)){e.exponent=yn(e.exponent,t),n=!0;break}n||this._terms.push({term:i,exponent:t})}unitTerms(e){const i=this.engine;if("numeric"===e){if(!Kt(i)&&0!==this._complex.im)return null;if(Yt(i)){let e=i._BIGNUM_ONE;if(ln(this._rational)||(e=an(this._rational)?i.bignum(this._rational[0].toString()).div(i.bignum(this._rational[1].toString())):i.bignum(this._rational[0]).div(this._rational[1])),e=e.mul(this._bignum).mul(this._sign*this._number),0!==this._complex.im){const t=this._complex.mul(e.toNumber());return t.equals(1)?[]:[{exponent:[1,1],terms:[i.number(t)]}]}return e=e.mul(this._complex.re),e.equals(1)?[]:[{exponent:[1,1],terms:[i.number(e)]}]}let e=1;if(ln(this._rational)||(e=an(this._rational)?Number(this._rational[0])/Number(this._rational[1]):this._rational[0]/this._rational[1]),e*=this._sign*this._number*this._bignum.toNumber(),0!==this._complex.im){const t=this._complex.mul(e);return t.equals(1)?[]:[{exponent:[1,1],terms:[i.number(t)]}]}return e*=this._complex.re,1===e?[]:[{exponent:[1,1],terms:[i.number(e)]}]}const t=[],n=[];this._hasInfinity&&n.push(i._POSITIVE_INFINITY),this._rational=_n(this._rational),1===this._complex.re&&0===this._complex.im||(0===this._complex.im&&(this._number*=Math.abs(this._complex.re)),this._complex.re<0?this._rational=gn(this._rational):n.push(i.number(this._complex)));let r=this._sign*this._number,s=this._bignum;return ln(this._rational)||("rational"===e?(1!==hn(this._rational)&&(an(this._rational)?s=s.mul(i.bignum(this._rational[0])):r*=this._rational[0]),1!==mn(this._rational)&&t.push({exponent:[-1,1],terms:[i.number(this._rational[1])]})):-1===r?(n.push(i.number(gn(this._rational))),r=1):n.push(i.number(this._rational))),s.equals(i._BIGNUM_ONE)?1!==r&&n.push(i.number(r)):n.push(i.number(s.mul(r))),n.length>0&&t.push({exponent:[1,1],terms:n}),t}groupedByDegrees(e){e??(e={}),"mode"in e||(e.mode="expression");const i=this.engine;if("numeric"===e.mode){if(0!==this._complex.im&&!Kt(i))return null;if(this._hasInfinity)return[{exponent:[1,1],terms:[i._POSITIVE_INFINITY]}]}const t=this.unitTerms(e.mode??"expression");if(null===t)return null;for(const e of this._terms){const i=_n(e.exponent);if(0===i[0])continue;let n=!1;for(const r of t)if(i[0]===r.exponent[0]&&i[1]===r.exponent[1]){r.terms.push(e.term),n=!0;break}n||t.push({exponent:i,terms:[e.term]})}return t}asExpression(e="evaluate"){const i=this.engine;if(this._hasInfinity){if(this._hasZero)return i._NAN;if(0===this._terms.length)return hn(this._rational)>0?i._POSITIVE_INFINITY:i._NEGATIVE_INFINITY}if(this._hasZero)return i._ZERO;const t=this.groupedByDegrees({mode:"N"===e?"numeric":"expression"});if(null===t)return i._NAN;const n=Kn(i,t);return 0===n.length?i._ONE:1===n.length?n[0]:this.engine._fn("Multiply",n)}asNumeratorDenominator(){const e=this.groupedByDegrees({mode:"rational"});if(null===e)return[this.engine._NAN,this.engine._NAN];const i=[],t=[];for(const n of e)n.exponent[0]>=0?i.push(n):t.push({exponent:gn(n.exponent),terms:n.terms});const n=this.engine,r=Kn(n,i);let s=n._ONE;1===r.length?s=r[0]:r.length>0&&(s=n._fn("Multiply",r));const o=Kn(n,t);let a=n._ONE;return 1===o.length?a=o[0]:o.length>0&&(a=n._fn("Multiply",o)),[s,a]}asRationalExpression(){const[e,i]=this.asNumeratorDenominator();if(null!==i.numericValue){if(i.isOne)return e;if(i.isNegativeOne)return this.engine.neg(e)}return this.engine._fn("Divide",[e,i])}}function Wn(e){if(ln(e))return 0;const[i,t]=[hn(e),mn(e)];return i>0&&Number.isInteger(i/t)?1:i>0?2:Number.isInteger(i/t)?3:4}function Yn(e,i){const t=Wn(e.exponent),n=Wn(i.exponent);if(t!==n)return t-n;const[r,s]=[hn(e.exponent),mn(e.exponent)],[o,a]=[hn(i.exponent),mn(i.exponent)];return r/s-o/a}function Kn(e,i){const t=i.sort(Yn).map((i=>{const t=wn(i.terms,"Multiply"),n=t.length<=1?t[0]:e._fn("Multiply",t.sort(jn));return ln(i.exponent)?n:e.pow(n,i.exponent)}));return wn(t,"Multiply")??t}function Jn(e,i,t,n){if(null!==i.numericValue){if(sn(i.numericValue))return hn(i.numericValue)<0?Xn(e,"Subtract",[t,e.number(gn(i.numericValue))],n):null;const r=Vt(i);if(null!==r&&r<0)return Xn(e,"Subtract",[t,e.number(-r)],n)}return"Negate"===i.head?Xn(e,"Subtract",[t,i.op1],n):null}function Xn(e,i,t,n){const r=e.jsonSerializationOptions.exclude;if(("Rational"===i||"Divide"===i)&&2===t.length&&1===Vt(t[0])&&2===Vt(t[1])&&!r.includes("Half"))return er(e,"Half",{...n,wikidata:"Q39373172"});if(1===t.length){const n=t[0].numericValue;if("Negate"===i&&null!==n){if("number"==typeof n)return ir(e,-n);if(n instanceof Ge)return ir(e,n.neg());if(n instanceof Ue.exports.Complex)return ir(e,n.neg());if(sn(n))return ir(e,gn(n))}}if("string"==typeof i&&r.includes(i)){if("Rational"===i&&2===t.length)return Xn(e,"Divide",t,n);if("Complex"===i&&2===t.length)return Xn(e,"Add",[t[0],e._fn("Multiply",[t[1],e.symbol("ImaginaryUnit")])],n);if("Sqrt"===i&&1===t.length)return Xn(e,"Power",[t[0],r.includes("Half")?e.number([1,2]):e._HALF],n);if("Root"===i&&2===t.length&&null!==t[1].numericValue){const i=Vt(t[1]);if(2===i)return Xn(e,"Sqrt",[t[0]]);if(null!==i)return i<0?Xn(e,"Divide",[e._ONE,e._fn("Power",[t[0],e.number([1,-i])])],n):Xn(e,"Power",[t[0],e.number([1,-i])],n)}if("Square"===i&&1===t.length)return Xn(e,"Power",[t[0],e.number(2)],n);if("Exp"===i&&1===t.length)return Xn(e,"Power",[e.symbol("ExponentialE"),t[0]],n);if("Subtract"===i&&2===t.length)return Xn(e,"Add",[t[0],e._fn("Negate",[t[1]])],n);if("Subtract"===i&&1===t.length)return Xn(e,"Negate",t,n)}if("Add"===i&&2===t.length&&!r.includes("Subtract")){if(null!==t[1].numericValue){const i=Vt(t[1]);if(null!==i&&i<0)return Xn(e,"Subtract",[t[0],e.number(-i)],n)}if("Negate"===t[1].head)return Xn(e,"Subtract",[t[0],t[1].op1],n)}if("Tuple"===i){if(1===t.length&&!r.includes("Single"))return Xn(e,"Single",t,n);if(2===t.length&&!r.includes("Pair"))return Xn(e,"Pair",t,n);if(3===t.length&&!r.includes("Triple"))return Xn(e,"Triple",t,n)}const s=["string"==typeof i?i:i.json,...t.map((e=>e.json))],o={...n??{}};return e.jsonSerializationOptions.metadata.includes("latex")?o.latex=o.latex??e.serialize({fn:s}):o.latex="",e.jsonSerializationOptions.metadata.includes("wikidata")||(o.wikidata=""),o.latex||o.wikidata||!e.jsonSerializationOptions.shorthands.includes("function")?o.latex&&o.wikidata?{fn:s,latex:o.latex,wikidata:o.wikidata}:o.latex?{fn:s,latex:o.latex}:o.wikidata?{fn:s,wikidata:o.wikidata}:{fn:s}:s}function er(e,i,t){if("Half"===i&&e.jsonSerializationOptions.exclude.includes("Half"))return ir(e,[1,2],t);if(t={...t},e.jsonSerializationOptions.metadata.includes("latex")?(t.latex=t.latex??e.serialize({sym:i}),void 0!==t.latex&&(t.latex=t.latex)):t.latex=void 0,e.jsonSerializationOptions.metadata.includes("wikidata")){if(void 0===t.wikidata){const n=e.lookupSymbol(i)?.wikidata;void 0!==n&&(t.wikidata=n)}}else t.wikidata=void 0;return void 0===t.latex&&void 0===t.wikidata&&e.jsonSerializationOptions.shorthands.includes("symbol")?i:void 0!==t.latex&&void 0!==t.wikidata?{sym:i,latex:t.latex,wikidata:t.wikidata}:void 0!==t.latex?{sym:i,latex:t.latex}:void 0!==t.wikidata?{sym:i,wikidata:t.wikidata}:{sym:i}}function ir(e,i,t){t={...t},e.jsonSerializationOptions.metadata.includes("latex")||(t.latex=void 0);const n=void 0===t.latex&&void 0===t.wikidata&&!e.jsonSerializationOptions.metadata.includes("latex")&&e.jsonSerializationOptions.shorthands.includes("number");let r="";if(i instanceof Ge){if(i.isNaN())r="NaN";else if(i.isFinite()){if(n&&Ln(i))return i.toNumber();if(i.isInteger()&&i.e<i.precision()+4)r=i.toFixed(0);else{const t=e.jsonSerializationOptions.precision;if(r=tr(e,"max"===t?i.toString():i.toPrecision("auto"===t?e.precision:t)),n){const e=i.toNumber();if(e.toString()===r)return e}}}else r=i.isPositive()?"+Infinity":"-Infinity";return e.jsonSerializationOptions.metadata.includes("latex")&&(t.latex=t.latex??e.serialize({num:r})),void 0!==t.latex?{num:r,latex:t.latex}:n?r:{num:r}}if(i instanceof Ue.exports.Complex)return i.isInfinite()?er(e,"ComplexInfinity",t):i.isNaN()?(r="NaN",e.jsonSerializationOptions.metadata.includes("latex")&&(t.latex=t.latex??e.serialize({num:r})),void 0!==t.latex?{num:r,latex:t.latex}:{num:r}):Xn(e,"Complex",[e.number(i.re),e.number(i.im)],{...t,wikidata:"Q11567"});if(sn(i))return n&&e.jsonSerializationOptions.shorthands.includes("function")&&on(i)?["Rational",i[0],i[1]]:Xn(e,"Rational",[e.number(i[0]),e.number(i[1])],{...t});if(Number.isNaN(i))r="NaN";else if(Number.isFinite(i)){if(n)return i;r=tr(e,i.toString())}else r=i>0?"+Infinity":"-Infinity";return e.jsonSerializationOptions.metadata.includes("latex")&&(t.latex=t.latex??e.serialize({num:r})),void 0!==t.latex?{num:r,latex:t.latex}:{num:r}}function tr(e,i){if(!e.jsonSerializationOptions.repeatingDecimals)return i;let[t,n,r,s]=i.match(/^(.*)\.([0-9]+)([e|E][-+]?[0-9]+)?$/)??[];if(!r)return i.toLowerCase();const o=r[r.length-1];r=r.slice(0,-1);let a="";for(let e=0;e<r.length-16;e++){a=r.substring(0,e);for(let t=0;t<=16;t++){const u=r.substring(e,e+t+1),l=Math.floor((r.length-a.length)/u.length);if(l<3)break;if((a+u.repeat(l+1)).startsWith(r))return"0"===u?"0"===o?n+"."+a+(s??""):i:n+"."+a+"("+u+")"+(s??"")}}for(r+=o;r.endsWith("0");)r=r.slice(0,-1);return s?`${n}.${r}${s.toLowerCase()}`:`${n}.${r}`}class nr extends Pn{constructor(e,i,t){t??(t={}),super(e,t.metadata),this._value=new Map;const n=t.canonical??!0;for(const t of Object.keys(i))this._value.set(t,e.box(i[t],{canonical:n}));e._register(this)}unbind(){for(const[e,i]of this._value)i.unbind()}get hash(){let e=Jt("Dictionary");for(const[i,t]of this._value)e^=Jt(i)^t.hash;return e}get complexity(){return 97}get head(){return"Dictionary"}get isPure(){return!1}getKey(e){return this._value.get(e)}hasKey(e){return this._value.has(e)}get keys(){return this._value.keys()}get keysCount(){return this._value.size}has(e){for(const[i,t]of this._value)if(t.has(e))return!0;return!1}get domain(){const e=["Dictionary"];for(const[i,t]of this._value)e.push(["Tuple",i,t.domain]);return this.engine.domain(e)}get json(){if(this.engine.jsonSerializationOptions.shorthands.includes("dictionary")){const e={};for(const i of this._value.keys())e[i]=this._value.get(i).json;return{dict:e}}const e=[];for(const i of this._value.keys())e.push(this.engine._fn("KeyValuePair",[this.engine.string(i),this._value.get(i)]));return Xn(this.engine,"Dictionary",e,{latex:this._latex})}isSame(e){if(this===e)return!0;if(!(e instanceof nr))return!1;if(this._value.size!==e._value.size)return!1;for(const[i,t]of this._value){const n=e.getKey(i);if(!n||!t.isSame(n))return!1}return!0}match(e,i){if(!(e instanceof nr))return null;if(this._value.size!==e._value.size)return null;let t={};for(const[i,n]of this._value){const r=e.getKey(i);if(!r)return null;const s=n.match(r);if(null===s)return null;t={...t,...s}}return t}isEqual(e){if(this===e)return!0;if(!(e instanceof nr))return!1;if(!e.keys||this._value.size!==e._value.size)return!1;for(const[i,t]of this._value){const n=e.getKey(i);if(!n||!t.isEqual(n))return!1}return!0}apply(e,i){const t={};for(const i of this.keys)t[i]=this.engine.box(e(this.getKey(i)));return i?this.engine.fn(i,[{dict:t}]):new nr(this.engine,t)}evaluate(e){return this.apply((i=>i.evaluate(e)??i))}get isCanonical(){return this._isCanonical}set isCanonical(e){this._isCanonical=e}get canonical(){if(this.isCanonical)return this;const e=this.apply((e=>e.canonical));return e.isCanonical=!0,e}simplify(e){return e?.recursive??1?this.apply((i=>i.simplify(e)??i)):this}N(e){return this.apply((i=>i.N(e)))}replace(e,i){let t=0;const n={};for(const r of this.keys){const s=this.getKey(r),o=s.replace(e,i);null!==o&&(t+=1),n[r]=o??s}return 0===t?null:new nr(this.engine,n)}subs(e,i){const t={};for(const n of this.keys)t[n]=this.getKey(n).subs(e,i);return new nr(this.engine,t,i)}}const rr=[];function sr(e,i,t){if(i.length===t)return i;const n=[...i.slice(0,t)];let r=Math.min(t,i.length);for(;r<t;)n.push(e.error("missing")),r+=1;for(;r<i.length;)n.push(e.error("unexpected-argument",i[r])),r+=1;return n}function or(e,i,t){if(!e.strict)return i;let n;if(void 0===t)n=i;else{n=[];for(let r=0;r<=Math.max(t-1,i.length-1);r++)r>t-1?n.push(e.error("unexpected-argument",i[r])):n.push(void 0!==i[r]?e.box(i[r]):e.error(["missing","Number"]))}return n.map((i=>!i.isValid||i.isNumber?i:e.error(["incompatible-domain","Number",i.domain],i)))}function ar(e,i,t){return void 0===t?e.error("unexpected-argument",i):void 0===i?e.error(["missing",t]):i.isValid?i?.domain.isCompatible(t)?i:e.error(["incompatible-domain",t,i.domain],i):i}function ur(e,i,t,n){let r=n.shift();if(void 0===i)return[[...t,e.error("unexpected-argument",r)],n];if(!Array.isArray(i))return r?r.domain.isCompatible(i)?[[...t,r],n]:[[...t,e.error(["incompatible-domain",i,r.domain],r)],n]:[[...t,e.error(["missing",i])],n];const s=i[0];if(void 0===r){let r=!1;if("Union"===s){for(let e=1;e<=i.length-1;e++)if("Nothing"===i[e]){r=!0;break}}else"Maybe"===s&&(r=!0);return r?[[...t,e.symbol("Nothing")],n]:[[...t,e.error(["missing",i])],n]}if("Union"===s){let s=!1;for(let e=1;e<=i.length-1;e++)if(r.domain.isCompatible(i[e])){s=!0;break}return s?[[...t,r],n]:[[...t,e.error(["incompatible-domain",i,r.domain],r)],n]}if("Sequence"===s){const s=i[1];if(!r||!r.domain.isCompatible(s))return[[...t,e.error(["incompatible-domain",s,r.domain],r)],n];let o=!1;const a=[...t,r];for(;!o;)r=n.shift(),r?r.domain.isCompatible(s)?a.push(r):(n.unshift(r),o=!1):o=!1;return[a,n]}return"Maybe"===s?void 0===r||"Nothing"===r.symbol?[[...t,e.symbol("Nothing")],n]:ur(e,i[1],t,[r,...n]):[[...t,r],n]}function lr(e,i,t){if(i.length===t.length&&i.every(((e,i)=>e.domain.isCompatible(t[i]))))return i;const n=[];for(let r=0;r<=t.length-1;r++)n.push(ar(e,i[r],t[r]));for(let r=t.length;r<=i.length-1;r++)n.push(e.error("unexpected-argument",i[r]));return n}function cr(e,i){if(null==i)return e;if(e===i)return e;const t=e.engine,n=t.box(i);return t.costFunction(n)<=1.7*t.costFunction(e)?n:e}class hr extends Pn{constructor(e,i,t,n){if(n??(n={}),n.canonical??(n.canonical=!1),super(e,n.metadata),this._scope=e.context,this._head=i,this._ops=t,this._def=n.def??null,n.canonical&&(this._def||(this._def=e.lookupFunction(i,e.context)),this._canonical=this),this._codomain=null,n.canonical){if("string"!=typeof this._head)this._codomain=this._head.domain.codomain;else if(this._def){const i=this._def.signature;"function"==typeof i.codomain?this._codomain=i.codomain(e,this._ops)??null:this._codomain=i.codomain??null}this._codomain||(this._codomain=e.defaultDomain??e.domain("Void"))}else this._codomain=e.domain("Anything");e._register(this)}get hash(){if(void 0!==this._hash)return this._hash;let e=0;for(const i of this._ops)e=e<<1^i.hash|0;return e="string"==typeof this._head?e^Jt(this._head)|0:e^this._head.hash|0,this._hash=e,e}get isCanonical(){return this._canonical===this}set isCanonical(e){this._canonical=e?this:void 0}get isPure(){if(void 0!==this._isPure)return this._isPure;if(!this.isCanonical)return this._isPure=!1,!1;let e;return void 0!==this.functionDefinition?.pure&&(e=this.functionDefinition.pure),!1!==e&&(e=this._ops.every((e=>e.isPure))),this._isPure=e,e}get json(){return this.isValid&&this._canonical===this?function(e,i,t,n){const r=e.jsonSerializationOptions.exclude;if("Add"===i&&2===t.length&&!r.includes("Subtract")){const i=Jn(e,t[0],t[1],n)??Jn(e,t[1],t[0],n);if(i)return i}if("Divide"===i&&2===t.length&&r.includes("Divide"))return Xn(e,"Multiply",[t[0],e._fn("Power",[t[1],e._NEGATIVE_ONE])],n);if("Multiply"===i&&!r.includes("Negate")&&-1===Rt(t[0]))return Xn(e,"Negate",[e._fn("Multiply",t.slice(1))],n);if("Multiply"===i&&!r.includes("Divide")){const i=new Qn(e,t,{canonical:!1}).asRationalExpression();if("Divide"===i.head)return Xn(e,i.head,i.ops,n)}if("Power"===i){if(!r.includes("Exp")&&"ExponentialE"===t[0]?.symbol)return Xn(e,"Exp",[t[1]],n);if(null!==t[1]?.numericValue){const i=Vt(t[1]);if(2===i&&!r.includes("Square"))return Xn(e,"Square",[t[0]],n);if(null!==i&&i<0&&!r.includes("Divide"))return Xn(e,"Divide",[e._ONE,-1===i?t[0]:e.pow(t[0],-i)],n);const s=t[1].numericValue;if(!r.includes("Sqrt")&&.5===s)return Xn(e,"Sqrt",[t[0]],n);if(!r.includes("Sqrt")&&-.5===s)return Xn(e,"Divide",[e._ONE,e._fn("Sqrt",[t[0]])],n);if(sn(s)){const i=hn(s),o=mn(s);if(1===i){if(!r.includes("Sqrt")&&2===o)return Xn(e,"Sqrt",[t[0]],n);if(!r.includes("Root"))return Xn(e,"Root",[t[0],e.number(s[1])],n)}if(-1===i){if(!r.includes("Sqrt")&&2===o)return Xn(e,"Divide",[e._ONE,e._fn("Sqrt",[t[0]])],n);if(!r.includes("Root"))return Xn(e,"Divide",[e._ONE,e._fn("Root",[t[0],e.number(s[1])])],n)}}}}return Xn(e,i,t,n)}(this.engine,this._head,this._ops,{latex:this._latex,wikidata:this._wikidata}):Xn(this.engine,this._head,this._ops,{latex:this._latex,wikidata:this._wikidata})}get scope(){return this._scope}get head(){return this._head}get ops(){return this._ops}get nops(){return this._ops.length}get op1(){return this._ops[0]??this.engine.symbol("Nothing")}get op2(){return this._ops[1]??this.engine.symbol("Nothing")}get op3(){return this._ops[2]??this.engine.symbol("Nothing")}get isValid(){return"Error"!==this._head&&!("string"!=typeof this._head&&!this._head.isValid)&&this._ops.every((e=>e.isValid))}get canonical(){return this._canonical||(this._canonical=this.isValid?mr(this.engine,this._head,this._ops):this),this._canonical}*map(e){let i=0;for(;i<this._ops.length;)yield e(this._ops[i++])}subs(e,i){i??(i={}),"canonical"in i||(i.canonical=!0);const t=this._ops.map((t=>t.subs(e,i)));return i.canonical&&t.every((e=>e.isValid))?mr(this.engine,this._head,t):new hr(this.engine,this._head,t,{canonical:!1})}replace(e,i){return rn(this,e,i)}has(e){if("string"==typeof this._head)if("string"==typeof e){if(this._head===e)return!0}else if(e.includes(this._head))return!0;for(const i of this._ops)if(i.has(e))return!0;return!1}isSame(e){if(this===e)return!0;if(!(e instanceof hr))return!1;if(this.nops!==e.nops)return!1;if("string"==typeof this.head){if(this.head!==e.head)return!1}else{if("string"==typeof e.head)return!1;if(!e.head||!this.head.isSame(e.head))return!1}const i=this._ops,t=e._ops;for(let e=0;e<i.length;e++)if(!i[e].isSame(t[e]))return!1;return!0}match(e,i){if(!(e instanceof hr))return null;let t={};if("string"==typeof this.head){if(this.head!==e.head)return null}else{if("string"==typeof e.head)return null;{if(!e.head)return null;const n=this.head.match(e.head,i);if(null===n)return null;t={...t,...n}}}const n=this._ops,r=e._ops;for(let e=0;e<n.length;e++){const s=n[e].match(r[e],i);if(null===s)return null;t={...t,...s}}return t}unbind(){this._value=void 0,this._numericValue=void 0}get wikidata(){if(this.isCanonical)return this._wikidata??this.functionDefinition?.wikidata??void 0}get description(){if(!this.isCanonical)return;const e=this.functionDefinition;return e?e.description?"string"==typeof e.description?[e.description]:e.description:void 0:[]}get url(){return this.isCanonical?this.functionDefinition?.url??void 0:""}get complexity(){if(this.isCanonical)return this.functionDefinition?.complexity??Zn}get functionDefinition(){if(this.isCanonical)return null!==this._def?this._def:void 0}bind(e){}get value(){if(this.isCanonical&&this.isPure)return this._value||(this._value=this.evaluate()),this._value}isEqual(e){const i=Sn(this,e);return 0===i||void 0===i&&this.isSame(e)}isLess(e){const i=Sn(this,e);if(void 0!==i)return i<0}isLessEqual(e){const i=Sn(this,e);if(void 0!==i)return i<=0}isGreater(e){const i=Sn(this,e);if(void 0!==i)return i>0}isGreaterEqual(e){const i=Sn(this,e);if(void 0!==i)return i>=0}get isZero(){const e=this.sgn;return null!==e&&("number"==typeof e?0===e:void 0)}get isNotZero(){const e=this.sgn;return null!==e&&("number"==typeof e?0!==e:void 0)}get isOne(){return this.isEqual(this.engine._ONE)}get isNegativeOne(){return this.isEqual(this.engine._NEGATIVE_ONE)}get isPositive(){const e=this.sgn;return null!==e&&("number"==typeof e?e>0:void 0)}get isNonPositive(){const e=this.sgn;return null!==e&&("number"==typeof e?e<=0:void 0)}get isNegative(){const e=this.sgn;return null!==e&&("number"==typeof e?e<0:void 0)}get isNonNegative(){const e=this.sgn;return null!==e&&("number"==typeof e?e>=0:void 0)}get isNumber(){return this.domain.isCompatible("Number")}get isInteger(){return this.domain.isCompatible("Integer")}get isRational(){return this.domain.isCompatible("RationalNumber")}get isAlgebraic(){return this.domain.isCompatible("AlgebraicNumber")}get isReal(){return this.domain.isCompatible("RealNumber")}get isExtendedReal(){return this.domain.isCompatible("ExtendedRealNumber")}get isComplex(){return this.domain.isCompatible("ComplexNumber")}get isImaginary(){return this.domain.isCompatible("ImaginaryNumber")}get sgn(){if(!this.isCanonical)return;const e=this.head;if("Negate"===e){const e=this._ops[0]?.sgn;if(void 0===e)return;return null===e?null:0===e?0:e>0?-1:1}if("Multiply"===e){const e=this._ops.reduce(((e,i)=>e*(i.sgn??NaN)),1);return isNaN(e)?null:e>0?1:e<0?-1:0}if("Add"===e){let e=0,i=0,t=0;const n=this._ops.length;for(const n of this._ops){const r=n.sgn;if(null==r)break;0===r&&(t+=1),r>0&&(e+=1),r<0&&(i+=1)}return t===n?0:e===n?1:i===n?-1:null}if("Divide"===e){const e=this._ops[0]?.sgn,i=this._ops[1]?.sgn;return null===e||null===i||void 0===e||void 0===i?null:0===e?0:e>0&&i>0||e<0&&i<0?1:-1}if("Square"===e)return this._ops[0]?.isImaginary?-1:this._ops[0]?.isZero?0:1;if("Abs"===e)return this._ops[0]?.isZero?0:1;if("Sqrt"===e)return this._ops[0]?.isZero?0:this._ops[0]?.isImaginary?null:1;const i=Rt(this.N());return null!==i?0===i?0:i<0?-1:1:void 0}get domain(){return this._codomain}simplify(e){if(!this.isValid)return this;if(!this.isCanonical){const i=this.canonical;return i.isCanonical&&i.isValid?i.simplify(e):this}const i=this.functionDefinition,t=gr(this._ops,i?.hold??"none",i?.associative?i.name:"",(i=>i.simplify(e)));if("string"!=typeof this._head){const i=fr(this._head,t);return"string"!=typeof i.head?i:i.simplify(e)}let n;if(i)if(i.inert)n=t[0]?.canonical??this;else{const e=i.signature;e?.simplify&&(n=e.simplify(this.engine,t))}n=n?cr(this.engine.fn(this._head,t),n):this.engine.fn(this._head,t),n=cr(this,n);const r=e?.rules??this.engine.cache("standard-simplification-rules",(()=>tn(this.engine,rr)),(e=>{for(const[i,t,n,r]of e)i.unbind(),t.unbind();return e}));let s=0,o=!1;do{const e=n.replace(r);null!==e?(n=cr(e,n),n===e&&(o=!0)):o=!0,s+=1}while(!o&&s<this.engine.iterationLimit);return cr(this,n)}evaluate(e){if(!this.isValid)return this;if(!this.isCanonical){const i=this.canonical;return i.isCanonical&&i.isValid?i.evaluate(e):this}const i=this.functionDefinition,t=gr(this._ops,i?.hold??"none",i?.associative?i.name:"",(i=>i.evaluate(e)));if("string"!=typeof this._head){const i=fr(this._head,t);return"string"!=typeof i.head?i:i.evaluate(e)}if(!i)return this.engine.fn(this._head,t);if(i.inert)return t[0]??this;const n=i.signature;return n&&n.evaluate?"function"!=typeof n.evaluate?fr(n.evaluate,t):n.evaluate(this.engine,t)??this.engine.fn(this._head,t):this.engine.fn(this._head,t)}N(e){if(this._numericValue)return this._numericValue;if(this.engine.strict&&!this.isValid)return this;if(!this.isCanonical){const i=this.canonical;return i.isCanonical&&i.isValid?i.N(e):this}const i=this.functionDefinition,t=gr(this._ops,i?.hold??"none",i?.associative?i.name:"",(i=>i.N(e)));if("string"!=typeof this._head){const i=fr(this._head,t);return"string"!=typeof i.head?i:i.N(e)}if(!i)return this.engine.fn(this._head,t);if(i.inert)return t[0]??this;let n=i.signature?.N?.(this.engine,t)??this.engine.fn(this._head,t).evaluate();const r=n.numericValue;return null!==r&&(!Kt(this.engine)&&r instanceof je?n=this.engine._NAN:!Yt(this.engine)&&r instanceof Ge&&(n=this.engine.number(r.toNumber()))),this.isPure&&(this._numericValue=n),n}solve(e){return 1!==e.length?null:Fn(this.simplify(),e[0])}}function mr(e,i,t,n){if("string"!=typeof i&&(i=i.evaluate().symbol??i),"string"==typeof i){const r=function(e,i,t,n){let r=[];if("Add"===i||"Multiply"===i)r=or(e,wn(kn(e.canonical(t)),i));else if("Negate"===i||"Square"===i||"Sqrt"===i)r=or(e,kn(e.canonical(t)),1);else{if("Divide"!==i&&"Power"!==i)return null;r=or(e,kn(e.canonical(t)),2)}if(!r.every((e=>e.isValid)))return new hr(e,i,r,{metadata:n,canonical:!1});if("Add"===i)return e.add(r,n);if("Negate"===i)return e.neg(r[0]??e.error("missing"),n);if("Multiply"===i)return e.mul(r,n);if("Divide"===i)return e.div(r[0],r[1],n);if("Power"===i)return e.pow(r[0],r[1],n);if("Square"===i)return e.pow(r[0],e.number(2),n);if("Sqrt"===i){const i=r[0].canonical;return sn(i.numericValue)?new hr(e,"Sqrt",[i],{metadata:n,canonical:!0}):e.pow(i,e._HALF,n)}return null}(e,i,t,n);if(r)return r}else if(!i.isValid)return new hr(e,i,t.map((i=>e.box(i,{canonical:!1}))),{metadata:n,canonical:!1});const r=e.lookupFunction(i,e.context);if("string"!=typeof i||!r)return new hr(e,i,kn(t.map((i=>e.box(i)))),{metadata:n,canonical:!0});let s=[];for(let i=0;i<t.length;i++)if(pr(r.hold,t.length-1,i))s.push(e.box(t[i]));else{const n=e.box(t[i],{canonical:!1});"ReleaseHold"===n.head?s.push(n.op1.canonical):s.push(n)}const o=r.signature;if(o.canonical){try{const i=o.canonical(e,s);if(i)return i}catch(e){}return new hr(e,i,s,{metadata:n,canonical:!1})}if(s=kn(s),r.associative&&(s=wn(s,i)),!s.every((e=>e.isValid)))return new hr(e,i,s,{metadata:n,canonical:!1});if(s=function(e,i,t){const n=e.engine;if(!n.strict)return i;const r=i.map((e=>e.domain)),s=n.domain(["Function",...r,"Anything"]);if(e.isCompatible(s))return null;const o=e.domainArgs.slice(0,-1),a=Math.max(o.length,r.length);let u=[],l=[...i];for(let e=0;e<=a-1;e++)[u,l]=ur(n,o[e],u,l);for(;u.length>0&&"Nothing"===u[u.length-1].symbol;)u.pop();return u}(o.domain,s)??s,!s.every((e=>e.isValid)))return new hr(e,i,s,{metadata:n,canonical:!1});if(1===s.length&&s[0].head===i){if(r.involution)return s[0].op1;r.idempotent&&(s=s[0].ops)}return s.length>1&&!0===r.commutative&&(s=s.sort(jn)),new hr(e,i,s,{metadata:n,def:r,canonical:!0})}function fr(e,i){if("Lambda"!==e.head)return e.engine._fn(e.evaluate(),i);const t={__:e.engine.tuple(i),"_#":e.engine.number(i.length)};let n=1;for(const e of i)t["_"+n++]=e;t._=t._1;const r=this.context;this.context=e.scope??null;const s=e.subs(t).evaluate();return this.context=r,s}function gr(e,i,t,n){if(0===e.length)return[];if(e=wn(e,t),"all"===i)return e;if("none"===i){const i=[];for(const t of e){const e=t.head;if("Hold"===e)i.push(t);else{const r="ReleaseHold"===e?t.op1:t;if(r){const e=n(r);null!==e&&i.push(e)}}}return wn(i,t)}const r=[];for(let t=0;t<e.length;t++)if("Hold"===e[t].head)r.push(e[t]);else{let s;if("ReleaseHold"===e[t].head?s=e[t].op1:pr(i,e.length-1,t)?s=e[t]:r.push(e[t]),s){const e=n(s);null!==e&&r.push(e)}}return wn(r,t)}function pr(e,i,t){return"all"!==e&&("none"===e||("first"===e?0!==t:"rest"===e?0===t:"last"===e?t!==i:"most"===e&&t===i))}function dr(e){if(!Number.isInteger(e)||!Number.isFinite(e)||Number.isNaN(e)||e<=1)return!1;if(e<=7919)return Mt.has(e);for(const i of Mt)if(e%i==0)return!1;return e>=0x3ffffffffffe5?!!function(e,i){let t=0,n=e-1;for(;n%2==0;)n/=2,++t;e:do{let i=Math.pow(2+Math.floor(Math.random()*(e-3)),n)%e;if(1!==i&&i!==e-1){for(let n=t-1;n--;){if(i=i*i%e,1===i)return!1;if(i===e-1)continue e}return!1}}while(--i);return!0}(e,30)&&void 0:e===function(e){if(1===e)return 1;if(e%2==0)return 2;if(e%3==0)return 3;if(e%5==0)return 5;const i=Math.floor(Math.sqrt(e));let t=7;for(;t<=i;){if(e%t==0)return t;if(e%(t+4)==0)return t+4;if(e%(t+6)==0)return t+6;if(e%(t+10)==0)return t+10;if(e%(t+12)==0)return t+12;if(e%(t+16)==0)return t+16;if(e%(t+22)==0)return t+22;if(e%(t+24)==0)return t+24;t+=30}return e}(e)}class br extends Pn{constructor(e,i,t){if(super(e,t?.metadata),"number"==typeof i)return this._value=i,void(this._isCanonical=!0);if(sn(i)){const[n,r]=i;t?.canonical??1?(this._value=yr(e,i),this._isCanonical=!0):(this._value=i,this._isCanonical=!1)}else this._value=yr(e,i),this._isCanonical=!0}get hash(){if(void 0!==this._hash)return this._hash;let e=0;return e="number"==typeof this._value?Jt(this._value.toString()):this._value instanceof Ue.exports.Complex?Jt(this._value.re.toString()+" +i "+this._value.im.toString()):this._value instanceof Ge?Jt(this._value.toString()):Jt(this._value[0].toString()+" / "+this._value[1].toString()),this._hash=e,e}get head(){return"Number"}get isPure(){return!0}get isExact(){return"number"==typeof this._value?Number.isInteger(this._value):this._value instanceof Ge?this._value.isInteger():this._value instanceof Ue.exports.Complex?Number.isInteger(this._value.re)&&Number.isInteger(this._value.im):sn(this._value)}get isCanonical(){return this._isCanonical}set isCanonical(e){this._isCanonical=e}get complexity(){return 1}get value(){return this}get numericValue(){return this._value}get domain(){return void 0===this._domain&&(this._domain=this.engine.domain(function(e){if("number"==typeof e&&!isNaN(e))return isFinite(e)?Number.isInteger(e)?e>0?"PositiveInteger":e<0?"NegativeInteger":"Integer":e>0?"PositiveNumber":e<0?"NegativeNumber":"RealNumber":"ExtendedRealNumber";if(e instanceof Ge)return e.isNaN()?"Number":e.isFinite()?e.isInteger()?e.isPositive()?"PositiveInteger":e.isNegative()?"NegativeInteger":"Integer":e.isPositive()?"PositiveNumber":e.isNegative()?"NegativeNumber":"RealNumber":"ExtendedRealNumber";if(e instanceof Ue.exports.Complex)return 0===e.re?"ImaginaryNumber":"ComplexNumber";if(sn(e)){const[i,t]=e;return"RationalNumber"}return"Number"}(this._value))),this._domain}get json(){return ir(this.engine,this._value,{latex:this._latex})}get sgn(){if(this.isZero)return 0;if(this._value instanceof Ue.exports.Complex)return null;if("number"==typeof this._value)return this._value<0?-1:this._value>0?1:null;if(this._value instanceof Ge)return this._value.isNegative()?-1:this._value.isPositive()?1:null;if(Array.isArray(this._value)){const[e,i]=this._value;return 0===e&&0!==i?0:e<0?-1:e>0?1:null}return null}isSame(e){if(this===e)return!0;if(!(e instanceof br))return!1;if(Array.isArray(this._value)){if(!Array.isArray(e._value))return!1;const[i,t]=e._value;return this._value[0]===i&&this._value[1]===t}return this._value instanceof Ge?e._value instanceof Ge&&this._value.eq(e._value):this._value instanceof Ue.exports.Complex?e._value instanceof Ue.exports.Complex&&this._value.equals(e._value):"number"==typeof this._value&&"number"==typeof e._value&&this._value===e._value}isEqual(e){if(this===e)return!0;const i=e.N();return i instanceof br&&0===Sn(this.N(),i)}match(e,i){return this.isEqualWithTolerance(e,i?.numericTolerance??0)?{}:null}isEqualWithTolerance(e,i){return e instanceof br&&0===Sn(this,e,i)}isLess(e){const i=Sn(this,e);if(void 0!==i)return i<0}isLessEqual(e){const i=Sn(this,e);if(void 0!==i)return i<=0}isGreater(e){return e.isLessEqual(this)}isGreaterEqual(e){return e.isLess(this)}get isPositive(){const e=this.sgn;if(null!=e)return e>0}get isNonNegative(){const e=this.sgn;if(null!=e)return e>=0}get isNegative(){const e=this.sgn;if(null!=e)return e<0}get isNonPositive(){const e=this.sgn;if(null!=e)return e<=0}get isZero(){return 0===this._value||(this._value instanceof Ge||this._value instanceof Ue.exports.Complex)&&this._value.isZero()}get isNotZero(){return"number"==typeof this._value&&0!==this._value||(this._value instanceof Ge?!this._value.isZero():!(this._value instanceof Ue.exports.Complex&&this._value.isZero()))}get isOne(){return"number"==typeof this._value?1===this._value:this._value instanceof Ge?this._value.equals(this.engine._BIGNUM_ONE):this._value instanceof Ue.exports.Complex?0===this._value.im&&1===this._value.re:ln(this._value)}get isNegativeOne(){return"number"==typeof this._value?-1===this._value:this._value instanceof Ge?this._value.equals(this.engine._BIGNUM_NEGATIVE_ONE):Array.isArray(this._value)?cn(this._value):this._value.equals(-1)}get isOdd(){return!(!this.isOne&&!this.isNegativeOne)||!this.isZero&&!!this.isInteger&&("number"==typeof this._value?this._value%2!=0:this._value instanceof Ge?!this._value.mod(2).isZero():void 0)}get isEven(){return!this.isOne&&!this.isNegativeOne&&(!!this.isZero||!!this.isInteger&&("number"==typeof this._value?this._value%2==0:this._value instanceof Ge?this._value.mod(2).isZero():void 0))}get isPrime(){return!(!this.isInteger||!this.isFinite||this.isNonPositive||this.isOne||this.isZero)&&("number"==typeof this._value?dr(this._value):this._value instanceof Ge?dr(this._value.toNumber()):void 0)}get isComposite(){return!(!this.isInteger||!this.isFinite||this.isNonPositive||this.isOne||this.isZero)&&("number"==typeof this._value?!dr(this._value):this._value instanceof Ge?!dr(this._value.toNumber()):void 0)}get isInfinity(){return"number"==typeof this._value?!Number.isFinite(this._value)&&!Number.isNaN(this._value):(this._value instanceof Ge||this._value instanceof Ue.exports.Complex)&&!this._value.isFinite()&&!this._value.isNaN()}get isNaN(){return"number"==typeof this._value?Number.isNaN(this._value):(this._value instanceof Ge&&this._value.isNaN(),this._value instanceof Ue.exports.Complex&&this._value.isNaN(),!1)}get isFinite(){return!this.isInfinity&&!this.isNaN}get isNumber(){return!0}get isInteger(){return"number"==typeof this._value?Number.isInteger(this._value):this._value instanceof Ge&&this._value.isInteger()}get isRational(){return!!Array.isArray(this._value)||this.isInteger}get isAlgebraic(){if(this.isRational)return!0}get isReal(){return!(!this.isFinite||this._value instanceof Ue.exports.Complex&&0!==this.engine.chop(this._value.im))}get isExtendedReal(){return this.isInfinity||this.isReal}get isComplex(){return!this.isNaN}get isImaginary(){return this._value instanceof Ue.exports.Complex}get isExtendedComplex(){return this.isInfinity||!this.isNaN}get canonical(){return this._isCanonical?this:this.engine.number(yr(this.engine,this._value))}simplify(e){return this.canonical}N(e){if(!Array.isArray(this._value))return this;const i=this.engine,[t,n]=this._value;return"number"!=typeof t||"number"!=typeof n||Yt(i)?i.number(i.bignum(t).div(i.bignum(n))):i.number(t/n)}}function yr(e,i){if(i instanceof Ge&&Ln(i))return i.toNumber();if(!sn(i))return i;if(an(i=_n(i))){let[t,n]=i;if(!(t>Number.MIN_SAFE_INTEGER&&t<Number.MAX_SAFE_INTEGER&&n>Number.MIN_SAFE_INTEGER&&n<Number.MAX_SAFE_INTEGER))return n<0&&([t,n]=[-t,-n]),n===BigInt(1)?e.bignum(t):n===BigInt(0)?t===n?NaN:t<0?-1/0:1/0:[t,n];i=[Number(t),Number(n)]}let[t,n]=i;return Number.isNaN(t)||Number.isNaN(n)?NaN:(n<0&&([t,n]=[-t,-n]),1===n?t:0===n?0!==t&&Number.isFinite(t)?t<0?-1/0:1/0:NaN:0===t?t:[t,n])}class vr extends Pn{constructor(e,i,t){super(e,t),this._string=i.normalize(),e._register(this)}get hash(){return Jt("String"+this._string)}get json(){return e=this.engine,i=this._string,e.jsonSerializationOptions.shorthands.includes("string")?`'${i}'`:{str:i};var e,i}get head(){return"String"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(e){}get domain(){return this.engine.domain("String")}get complexity(){return 19}get string(){return this._string}isEqual(e){return e.string===this._string}isSame(e){return e.string===this._string}match(e,i){return e instanceof vr&&this._string===e._string?{}:null}}function Nr(e,i,t){if("number"==typeof i||i instanceof Ge)return new br(e,i,t);if(t??(t={}),"canonical"in t||(t.canonical=!0),Array.isArray(i)&&2===i.length&&i[0]instanceof Ge&&i[1]instanceof Ge){if(!i[0].isInteger()||!i[1].isInteger())throw Error("Array argument to `boxNumber()` should be two integers");i=[$t(i[0].toString()),$t(i[1].toString())]}if(sn(i)){if(2!==i.length)throw Error("Array argument to `boxNumber()` should be two integers or two bignums");const[n,r]=i;if("bigint"==typeof n&&"bigint"==typeof r)return n===r?r===BigInt(0)?e._NAN:e._ONE:r===BigInt(1)?e.number(n,t):r===BigInt(-1)?e.number(-n,t):n===BigInt(1)&&r===BigInt(2)?e._HALF:new br(e,[n,r],t);if("number"!=typeof n||"number"!=typeof r)throw Error("Array argument to `boxNumber()` should be two integers or two bignums");if(!Number.isInteger(n)||!Number.isInteger(r))throw Error("Array argument to `boxNumber()` should be two integers");return r===n?0===r?e._NAN:e._ONE:1===r?e.number(n,t):-1===r?e.number(-n,t):1===n&&2===r?e._HALF:new br(e,[n,r],t)}if(i instanceof Ue.exports.Complex)return i.isNaN()?e._NAN:i.isZero()?e._ZERO:i.isInfinite()?e._COMPLEX_INFINITY:0===e.chop(i.im)?e.number(i.re,t):new br(e,i,t);let n="";if("string"==typeof i)n=i;else if("object"==typeof i&&"num"in i){if("number"==typeof i.num)return e.number(i.num,t);if("string"!=typeof i.num)throw Error("MathJSON `num` property should be a string of digits");n=i.num}if(n){if(n=n.toLowerCase(),/[0-9][nd]$/.test(n)&&(n=n.slice(0,-1)),n=n.replace(/[\u0009-\u000d\u0020\u00a0]/g,""),"nan"===n)return e._NAN;if("infinity"===n||"+infinity"===n)return e._POSITIVE_INFINITY;if("-infinity"===n)return e._NEGATIVE_INFINITY;if("0"===n)return e._ZERO;if("1"===n)return e._ONE;if("-1"===n)return e._NEGATIVE_ONE;if(/\([0-9]+\)/.test(n)){const[i,t,r,s]=n.match(/(.+)\(([0-9]+)\)(.+)?$/)??[];n=t+r.repeat(Math.ceil(e.precision/r.length))+(s??"")}return Nr(e,e.bignum(n),t)}return null}function _r(e,i,t){if(null===i)return e.error("missing");if("object"==typeof i&&i instanceof Pn)return i;if("string"==typeof(i=Ei(i)))return Sr(e,i,t);if(Array.isArray(i)){const n=i.map((i=>_r(e,i,t)));return new hr(e,n[0],n.slice(1))}if("object"==typeof i){if("dict"in i)return new nr(e,i.dict);if("fn"in i)return _r(e,i.fn,t);if("str"in i)return new vr(e,i.str);if("sym"in i)return Sr(e,i.sym,t);if("num"in i)return Sr(e,i.num,t)}return Sr(e,i,t)}function xr(e,i,t,n){if("Hold"===i)return new hr(e,"Hold",[_r(e,t[0],n)],{...n,canonical:!0});if("Error"===i||"ErrorCode"===i)return e._fn(i,t.map((i=>e.box(i,{canonical:!1}))),n.metadata);if("Domain"===i)return e.domain(t[0],n.metadata);if("Number"===i&&1===t.length)return Sr(e,t[0],n);if("String"===i)return 0===t.length?new vr(e,"",n.metadata):new vr(e,t.map((e=>wr(e)??"")).join(""),n.metadata);if("Symbol"===i&&t.length>0)return e.symbol(t.map((e=>wr(e)??"")).join(""),n);if(("Divide"===i||"Rational"===i)&&2===t.length){if(t[0]instanceof Pn&&t[1]instanceof Pn){const[i,r]=[en(t[0]),en(t[1])];if(i&&r)return e.number([i,r],n)}else{const[i,r]=[Xt(e,t[0]),Xt(e,t[1])];if(i&&r)return e.number([i,r],n)}i="Divide"}if("Complex"===i){if(1===t.length){const i=Sr(e,t[0],n),r=Rt(i);return null!==r&&0!==r?e.number(e.complex(0,r),n):e.mul([i,e._I])}if(2===t.length){const i=Sr(e,t[0],n),r=Sr(e,t[1],n),s=Rt(i),o=Rt(r);return null!==o&&null!==s?0===o&&0===s?e._ZERO:null!==o&&0!==o?e.number(e.complex(s,o),n):i:e.add([i,e.mul([r,e._I])],n.metadata)}}if("Negate"===i&&1===t.length){const i=t[0];if("number"==typeof i)return e.number(-i,n);if(i instanceof Ge)return e.number(i.neg(),n);const r=e.box(i,n).numericValue;if(null!==r){if("number"==typeof r)return e.number(-r,n);if(r instanceof Ge)return e.number(r.neg(),n);if(r instanceof Ue.exports.Complex)return e.number(r.neg());if(sn(r))return e.number(gn(r))}}if("Dictionary"===i){const i={};for(const n of t){const t=e.box(n),r=t.head;if("KeyValuePair"===r||"Pair"===r||"Tuple"===r&&2===t.nops){const e=t.op1;if(e.isValid&&!e.isNothing){const n=t.op2;let r=e.symbol??e.string;if(!r&&(null!==e.numericValue||e.string)){const i="number"==typeof e.numericValue?e.numericValue:Vt(e);i&&Number.isFinite(i)&&Number.isInteger(i)&&(r=i.toString())}r&&(i[r]=n)}}}return new nr(e,i,n)}return n.canonical?mr(e,i,t,n.metadata):new hr(e,i,t.map((i=>Sr(e,i,{canonical:!1}))),n)}function Sr(e,i,t){if(null==i)return e._fn("Sequence",[]);if(t??(t={}),"canonical"in t||(t.canonical=!0),i instanceof Pn)return t.canonical?i.canonical:i;if(Array.isArray(i)){if(on(i))return Number.isInteger(i[0])&&Number.isInteger(i[1])?e.number(i):xr(e,"Divide",i,t);if(an(i))return e.number(i);if("string"==typeof i[0])return xr(e,i[0],i.slice(1),t);const n=i.slice(1).map((i=>Sr(e,i,t))),r=Sr(e,i[0],t);return r.symbol?new hr(e,r.symbol,n):fr(r,n)}if("number"==typeof i||i instanceof Ue.exports.Complex||i instanceof Ge)return e.number(i);if("string"==typeof i)return i.startsWith("'")&&i.endsWith("'")?new vr(e,i.slice(1,-1)):/^[+-]?[0-9]/.test(i)?e.number(i):e.symbol(i,t);if("object"==typeof i){const n={latex:i.latex,wikidata:i.wikidata};if("dict"in i)return new nr(e,i.dict,{canonical:!0,metadata:n});if("fn"in i)return"string"==typeof i.fn[0]?xr(e,i.fn[0],i.fn.slice(1),t):new hr(e,Sr(e,i.fn[0],t),i.fn.slice(1).map((i=>Sr(e,i,t))),{metadata:n});if("str"in i)return new vr(e,i.str,n);if("sym"in i)return e.symbol(i.sym,t);if("num"in i)return e.number(i,t)}return e.symbol("Undefined")}function wr(e){if("string"==typeof e)return e;if(e instanceof Pn)return e.string??e.symbol??e.toString();if("object"==typeof e){if("str"in e)return e.str;if("fn"in e&&"String"===e.fn[0]&&"string"==typeof e.fn[1])return e.fn[1]}return Array.isArray(e)&&"String"===e[0]&&"string"==typeof e[1]?e[1]:null}class kr{constructor(e,i,t){if(this._isCanonical=!0,this._imaginary=0,this._posInfinityCount=0,this._negInfinityCount=0,this._naNCount=0,this._terms=[],t??(t={}),"canonical"in t||(t.canonical=!0),this._isCanonical=t.canonical,this.engine=e,this._rational=Yt(e)?[BigInt(0),BigInt(1)]:[0,1],this._bignum=e._BIGNUM_ZERO,this._number=0,i)for(const e of i)this.addTerm(e)}get isEmpty(){return this._isCanonical?0===this._terms.length&&un(this._rational)&&0===this._imaginary&&0===this._number&&this._bignum.isZero()&&0===this._negInfinityCount&&0===this._posInfinityCount&&0===this._naNCount:0===this._terms.length}addTerm(e,i){if(e.isNothing)return;if(e.isNaN||e.isImaginary&&!Kt(this.engine))return void(this._naNCount+=1);if(this._isCanonical&&null!==e.numericValue){if(e.isInfinity)return void(e.isPositive?this._posInfinityCount+=1:this._negInfinityCount+=1);const t=dn(e);if(t)return void(this._rational=yn(this._rational,void 0===i?t:vn(t,i)));const n=e.numericValue;if(null!==n&&"number"==typeof n)return void(Yt(this.engine)?this._bignum=this._bignum.add(n):this._number+=n);if(null!==n&&n instanceof Ge)return void(this._bignum=this._bignum.add(n));if(null!==n&&n instanceof je){let t=n.re,r=n.im;if(Number.isInteger(t)?(this._rational=yn(this._rational,vn([t,1],i??[1,1])),t=0):(Yt(this.engine)?this._bignum=this._bignum.add(t):this._number+=t,t=0),Number.isInteger(r)&&(void 0===i?this._imaginary+=r:on(i)?this._imaginary+=r*i[0]/i[1]:this._imaginary+=this.engine.bignum(i[0]).mul(r).div(this.engine.bignum(i[1])).toNumber(),r=0),0===t&&0===r)return;e=this.engine.number(this.engine.complex(t,r))}}let t;if([t,e]=xn(e),un(t))return;if(void 0!==i&&(t=vn(t,i)),"Negate"===e.head)return void this.addTerm(e.op1,gn(t));if("Add"===e.head){for(const i of e.ops)this.addTerm(i,t);return}let n=!1;if(null===e.numericValue)if(this._terms.length>500){const i=e.hash;for(let r=0;r<this._terms.length;r++)if(null===this._terms[r].term.numericValue&&i===this._terms[r].term.hash&&e.isSame(this._terms[r].term)){this._terms[r].coef=yn(this._terms[r].coef,t),n=!0;break}}else for(let i=0;i<this._terms.length;i++)if(null===this._terms[i].term.numericValue&&e.isSame(this._terms[i].term)){this._terms[i].coef=yn(this._terms[i].coef,t),n=!0;break}n||this._terms.push({term:e,coef:t})}terms(e){const i=this.engine;if(this._naNCount>0)return[i._NAN];if(0!==this._imaginary&&!Kt(i))return[i._NAN];if(this._posInfinityCount>0&&this._negInfinityCount>0)return[i._NAN];if(this._posInfinityCount>0)return[i._POSITIVE_INFINITY];if(this._negInfinityCount>0)return[i._NEGATIVE_INFINITY];const t=[];for(const{coef:e,term:n}of this._terms)un(e)||(ln(e)?t.push(n):cn(e)?t.push(i.neg(n)):1===mn(e)?t.push(i.mul([i.number(e[0]),n])):1===hn(e)?t.push(i.div(n,i.number(e[1]))):t.push(i.mul([i.number(e),n])));if("numeric"===e)if(Yt(this.engine)){let e=this._bignum.add(this._number);un(this._rational)||(e=e.add(i.bignum(this._rational[0]).div(i.bignum(this._rational[1])))),0!==this._imaginary?t.push(i.number(i.complex(e.toNumber(),this._imaginary))):0!==i.chop(e)&&t.push(i.number(e))}else{let e=this._bignum.toNumber()+this._number;un(this._rational)||(e+=hn(this._rational)/mn(this._rational)),0!==this._imaginary?t.push(i.number(i.complex(e,this._imaginary))):0!==i.chop(e)&&t.push(i.number(e))}else{if(un(this._rational)||t.push(i.number(this._rational)),0!==this._imaginary){if(!Kt(i))return[i._NAN];t.push(i.number(i.complex(0,this._imaginary)))}if(Yt(this.engine)){const e=this._bignum.add(this._number);0!==i.chop(e)&&t.push(i.number(e))}else 0!==i.chop(this._bignum)&&t.push(i.number(this._bignum)),0!==i.chop(this._number)&&t.push(i.number(this._number))}return wn(t,"Add")}asExpression(e){const i=this.engine,t=this.terms(e);return 0===t.length?i._ZERO:1===t.length?t[0]:i._fn("Add",Un(0,t))}}const Er=["Error","Dictionary","Function","List","Tuple","Intersection","Union","Maybe","Sequence","Interval","Range","Head","Symbol","Value"],Ir={NumericFunction:["Function",["Sequence","Number"],"Number"],RealFunction:["Function",["Sequence","ExtendedRealNumber"],"ExtendedRealNumber"],TrigonometricFunction:["Function","Number","Number"],LogicOperator:["Function","MaybeBoolean",["Maybe","MaybeBoolean"],"MaybeBoolean"],Predicate:["Function",["Sequence","Anything"],"MaybeBoolean"],RelationalOperator:["Function","Anything","Anything","MaybeBoolean"]},Ar={Anything:[],Value:"Anything",Domain:"Anything",DomainExpression:"Domain",Void:"Nothing",Nothing:["DomainExpression","Boolean","String","Symbol","Tuple","List","Dictionary","InfiniteSet","FiniteSet","ImaginaryNumber","TranscendentalNumber","PositiveInteger","NegativeInteger","NonPositiveInteger","NonNegativeInteger","PositiveNumber","NegativeNumber","NonPositiveNumber","NonNegativeNumber","Scalar","TrigonometricFunction","LogicOperator","RelationalOperator"],MaybeBoolean:"Value",Boolean:"MaybeBoolean",String:"Boolean",Symbol:"Boolean",Collection:"Value",List:"Collection",Dictionary:"Collection",Sequence:"Collection",Tuple:"Sequence",Set:"Collection",InfiniteSet:"Set",FiniteSet:"Set",Function:"Anything",Predicate:"Function",LogicOperator:"Predicate",RelationalOperator:"Predicate",NumericFunction:"Function",RealFunction:"NumericFunction",TrigonometricFunction:"RealFunction",Number:"Value",ExtendedComplexNumber:"Number",ComplexNumber:"ExtendedComplexNumber",ImaginaryNumber:"ComplexNumber",ExtendedRealNumber:"ExtendedComplexNumber",RealNumber:["ComplexNumber","ExtendedRealNumber"],PositiveNumber:"NonNegativeNumber",NonNegativeNumber:"RealNumber",NonPositiveNumber:"NegativeNumber",NegativeNumber:"RealNumber",TranscendentalNumber:"RealNumber",AlgebraicNumber:"RealNumber",RationalNumber:"AlgebraicNumber",Integer:"RationalNumber",PositiveInteger:"NonNegativeInteger",NonNegativeInteger:"Integer",NonPositiveInteger:"NegativeInteger",NegativeInteger:"Integer",Tensor:"Value",Matrix:"Tensor",Scalar:["Row","Column"],Row:"Vector",Column:"Vector",Vector:"Matrix"};let Mr;function qr(e){return!!e&&void 0!==Ar[e]}function Cr(e){if(Mr||(Mr={},Cr("Void")),Mr[e])return Array.from(Mr[e]);let i=[];if("string"!=typeof e||!Ar[e]){if(!Array.isArray(e))throw Error("Unknown domain literal "+e);if(!Er.includes(e[0]))throw Error("Unknown domain constructor "+e[0]);return"Function"===e[0]||"Head"===e[0]?Cr("Function"):"Symbol"===e[0]?Cr("Symbol"):"Tuple"===e[0]?Cr("Tuple"):"List"===e[0]?Cr("List"):"Dictionary"===e[0]?Cr("Dictionary"):"Range"===e[0]?Cr("Integer"):"Interval"===e[0]?Cr("RealNumberExtended"):"Maybe"===e[0]||"Sequence"===e[0]?Cr(e[1]):("Literal"===e[0]||"Union"===e[0]||e[0],["Anything"])}if("string"==typeof Ar[e])i=[Ar[e],...Cr(Ar[e])];else if(Array.isArray(Ar[e]))for(const t of Ar[e])i.push(t),i.push(...Cr(t));return Mr[e]=new Set(i),i}class Dr extends Pn{constructor(e,i,t){super(e,t),this._value=Tr(e,i)}get isCanonical(){return!0}get canonical(){return this}get isValid(){return"Error"!==this.ctor}get json(){const e=Br(this.engine,this._value);return"Error"===ui(e)?e:["Domain",e]}get literal(){return"string"==typeof this._value?this._value:null}get ctor(){return"string"==typeof this._value?null:this._value[0]}get domainArgs(){return"string"==typeof this._value?null:this._value.slice(1)}get domainArg1(){return"string"==typeof this._value?null:this._value[1]}get codomain(){return"string"==typeof this._value?null:this.engine.domain(this._value[this._value.length-1])}get hash(){return void 0===this._hash&&(this._hash=Jt(Gr(this._value))),this._hash}isEqual(e){return Zr(this._value,e)}isSame(e){return Zr(this._value,e)}is(e){return Zr(this._value,e)}isCompatible(e,i="covariant"){const t=this._value,n=e instanceof Dr?e._value:e,r=Array.isArray(n)?n[0]:null;if(r){const e=n[1];if("Covariant"===r)return zr(t,e);if("Contravariant"===r)return zr(e,t);if("Invariant"===r)return!zr(e,t)&&!zr(t,e);if("Bivariant"===r)return zr(t,e)&&zr(e,t)}return"covariant"===i?zr(t,n):"contravariant"===i?zr(n,t):"bivariant"===i?zr(n,t)&&zr(t,n):!zr(n,t)&&!zr(t,n)}match(e,i){return e instanceof Dr&&this.isSame(e)?{}:null}get head(){return"Domain"}get domain(){return this.engine.domain("Domain")}get isNothing(){return"Nothing"===this._value}get isFunction(){return"Function"===this.ctor||"Function"===this._value}get isNumeric(){return this.isCompatible(this.engine.domain("Number"))}get isRelationalOperator(){return"RelationalOperator"===this._value||"Function"===this.ctor&&2===this.domainArgs.length&&!!this.codomain.isCompatible("MaybeBoolean")}}function Fr(e,i,t){if(i instanceof Dr)return i;if(i instanceof Pn&&(i=i.json),"string"==typeof i){const n=Ir[i];if(n)return Fr(e,n);if(!qr(i))throw Error("Expected a domain literal, got "+i);return new Dr(e,i,t)}if(!Array.isArray(i)||0===i.length)throw Error("Expected a valid domain");const n=i[0];if(!Er.includes(n))throw Error("Expected domain constructor, got "+n);return new Dr(e,i,t)}function Tr(e,i){if("string"==typeof i){if(!qr(i))throw Error("Unknown domain literal");return i}if(i instanceof Dr)return i._value;const t=i[0];if("Range"===t){if(1===i.length)return"Integer";let t=1,n=1/0;2===i.length?n=i[1]:3===i.length&&(t=i[1],n=i[2]);const r=Or(e,t),s=Or(e,n);if(null===r||null===s)throw Error(`Invalid range [${r}, ${s}] `);return s<r&&([t,n]=[n,t]),r===-1/0&&s===1/0?"Integer":1===r&&s===1/0?"PositiveInteger":0===r&&s===1/0?"NonNegativeInteger":r===-1/0&&-1===s?"NegativeInteger":r===-1/0&&0===s?"NonPositiveInteger":["Range",e.number(r),e.number(s)]}if("Interval"===t){if(3!==i.length)throw Error("Invalid range "+i);let[t,n]=Pr(e,i[1]),[r,s]=Pr(e,i[2]);if(null===n||null===s)throw Error("Invalid range "+i);return s<n&&([n,s]=[s,n],[t,r]=[r,t]),0===n&&s===1/0?t?"PositiveNumber":"NonNegativeNumber":n===-1/0&&0===s?r?"NegativeNumber":"NonPositiveNumber":["Interval",t?["Open",e.number(n)]:e.number(n),r?["Open",e.number(s)]:e.number(s)]}if("Function"===t)return["Function",...i.slice(1).map((i=>Tr(e,i)))];if("Dictionary"===t)return["Dictionary",Tr(e,i[1])];if("List"===t)return["List",Tr(e,i[1])];if("Tuple"===t)return["Tuple",...i.slice(1).map((i=>Tr(e,i)))];if("Union"===t)return["Union",...i.slice(1).map((i=>Tr(e,i)))];if("Intersection"===t)return["Intersection",...i.slice(1).map((i=>Tr(e,i)))];if("Covariant"===t||"Contravariant"===t||"Invariant"===t)return[t,Tr(e,i[1])];if("Maybe"===t)return["Maybe",Tr(e,i[1])];if("Sequence"===t)return["Sequence",Tr(e,i[1])];if("Head"===t)return["Head",i[1]];if("Symbol"===t)return["Symbol",i[1]];if("Value"===t)return["Value",e.box(i[1])];if("Error"===t)return["Error",...i.slice(1).map((i=>e.box(i)))];throw Error("Unexpected domain constructor "+t)}function Or(e,i){if("number"==typeof i)return i;const t=e.box(i).evaluate();return t.isInfinity?t.isPositive?1/0:-1/0:Vt(t)}function Pr(e,i){return Array.isArray(i)&&"Open"===i[0]?[!0,Or(e,i[1])]:[!1,Or(e,i)]}function Rr(e){if(e instanceof Dr)return!0;if(e instanceof Pn&&(e=e.json),"string"==typeof e)return qr(e);if(Array.isArray(e)){if(e.length<=1)return!1;const i=e[0];return!("string"!=typeof i||!Er.includes(i))&&("List"===i?2===e.length&&Rr(e[1]):"Tuple"===i||"Function"===i||"Maybe"===i||"Sequence"===i||"Intersection"===i||"Union"===i?e.slice(1,-1).every((e=>Rr(e))):e.every((e=>null!==e)))}return!1}function zr(e,i){const[t,n]=Vr([e],i);return!(!t||0!==n.length)}function Vr(e,i){let t=e.shift();const n="string"==typeof i?i:null;if("Anything"===n)return[!0,e];const r="string"==typeof t?t:null;if(r&&n)return r===n?[!0,e]:[Cr(r).includes(n),e];if(n){const i=t[0];return"Function"===i?["Function"===n,e]:"Dictionary"===i?["Dictionary"===n,e]:"List"===i?["List"===n,e]:"Tuple"===i?["Tuple"===n,e]:"Interval"===i?[zr("ExtendedRealNumber",n),e]:"Range"===i?[zr("Integer",n),e]:[!0,e]}const s=i[0];if("Function"===s){if("Function"===r)return[!0,e];if(r)return[!1,e];if("Function"!==t[0])return[!1,e];if(1===t.length&&1===i.length)return[!0,e];if(!zr(t[t.length-1],i[i.length-1]))return[!1,e];const n=t.slice(1,-1);let s=i.slice(1,-1);for(let i=0;i<=n.length-1;i++){if(0===s.length)return"Maybe"!==(Array.isArray(n[i])?n[i][0]:null)?[!1,e]:[!0,e];{let t=!1;if([t,s]=Vr(s,n[i]),!t)return[!1,e]}}return[0===s.length,e]}if("Intersection"===s)return[i.slice(1,-1).every((e=>zr(t,e))),e];if("Union"===s)return[i.slice(1,-1).some((e=>zr(t,e))),e];if("Maybe"===s)return"Nothing"===r?[!0,e]:Vr([t,...e],i[1]);if("Sequence"===s){const n=i[1];if(!zr(t,n))return[!1,e];t=e.shift();let r=!0;for(;e.length>0&&r;)[r,e]=Vr(e,n),t=e.shift();return[!0,e]}if("Tuple"===s){if(!Array.isArray(t)||"Tuple"!==t[0])return[!1,e];if(t.length>i.length)return[!1,e];for(let n=1;n<=i.length-1;n++)if(!t[n]||!zr(t[n],i[n]))return[!1,e];return[!0,e]}if("Range"===s){if(!Array.isArray(t)||"Range"!==t[0])return[!1,e];const n=Rt(t[1]),r=Rt(t[2]),s=Rt(i[1]),o=Rt(i[2]);return[null!==n&&null!==r&&null!==s&&null!==o&&n>=s&&r<=o,e]}if("Interval"===s){if(!Array.isArray(t)||"Interval"!==t[0])return[!1,e];const n=Rt(t[1]),r=Rt(t[2]),s=Rt(i[1]),o=Rt(i[2]);return[null!==n&&null!==r&&null!==s&&null!==o&&n>=s&&r<=o,e]}return[!1,e]}function Lr(e,i){const t=$r(e),n=$r(i),r=[t,...Cr(t)],s=[n,...Cr(n)];for(;!s.includes(r[0]);)r.shift();return e.engine.domain(r[0])}function $r(e){let i=e.literal;return i||(i=e.ctor,"Maybe"===i?"Anything":"Interval"===i?"RealNumber":"Range"===i?"Integer":"Head"===i?"Function":"Union"===i||"Intersection"===i?"Anything":i)}function Br(e,i){if(i instanceof Pn)return i.json;if("string"==typeof i)return i;if("Error"===i[0])return i[2]?["Error",Br(e,i[1]),Br(e,i[2])]:["Error",Br(e,i[1])];const t=[er(e,i[0])];if(i.length>1)for(let n=1;n<=i.length-1;n++)t.push(Br(e,i[n]));return t}function Gr(e){if("string"==typeof e)return"domain:"+e;let i="domain:"+this.ctor;for(const e of this.domainArgs)i+=":"+Gr(e);return i}function Zr(e,i){if("string"==typeof i)return this._value===i;if(i instanceof Dr)return Zr(e,i._value);if("string"==typeof e)return e===i;if(!Array.isArray(i))return!1;if(e[0]!==i[0])return!1;if(i.length!==e.length)return!1;for(let t=1;t<=e.length-1;t++)if(e[t]instanceof Pn){if(!(i[t]instanceof Pn))return!1;if(!i[t].isEqual(i[t]))return!1}else if("string"==typeof e[t]){if("string"!=typeof i[t])return!1;if(e[t]!==i[t])return!1}else if(!Zr(e[t],i[t]))return!1;return!0}function Ur(e,i,t="evaluate"){if("N"===t&&"machine"===e.numericMode){const t=function(e){let i=0;for(const t of e){const e=t.numericValue;if("number"!=typeof e)return null;i+=e}return i}(i=i.map((e=>e.N())));if(null!==t)return e.number(t)}for(const n of i){if(n.isImaginary&&n.isInfinity)return e.symbol("ComplexInfinity");if(n.isNaN||"Undefined"===n.symbol)return e._NAN;n.isExact||(t="N")}return i="N"===t?i.map((e=>e.N())):i.map((e=>e.evaluate())),new kr(e,i).asExpression("N"===t?"numeric":"expression")}function jr(e,i,t,n){const r=i;let s=1,o=At,a="Nothing";if("Tuple"!==t.head&&"Triple"!==t.head&&"Pair"!==t.head&&"Single"!==t.head||(a=("Hold"===t.op1.head?t.op1.op1.symbol:t.op1.symbol)??"Nothing",s=Vt(t.op2)??1,o=Vt(t.op3)??At),"N"!==n&&(s>=o||o-s>=200))return;const u=e.context;if(e.context=r.scope??e.context,"simplify"===n){const i=[];if(r.scope)for(let t=s;t<=o;t++)e.set({[a]:t}),i.push(r.simplify());else for(let e=s;e<=o;e++)i.push(r.simplify());return e.context=u,e.add(i).simplify()}if("evaluate"===n){const i=[];if(r.scope)for(let t=s;t<=o;t++)e.set({[a]:t}),i.push(r.evaluate());else for(let e=s;e<=o;e++)i.push(r.evaluate());return e.context=u,e.add(i).evaluate()}let l=Yt(e)?[BigInt(1),BigInt(1)]:[0,1];if(r.scope)for(let i=s;i<=o;i++){e.set({[a]:i});const t=r.N();if(null===t.numericValue)return void(e.context=u);l=yn(l,t)}else for(let e=s;e<=o;e++){const e=r.N();if(null===e.numericValue)return;l=yn(l,e)}return e.context=u,on(l)?e.number(l[0]/l[1]):e.number(e.bignum(l[0]).div(e.bignum(l[1])))}function Hr(e){if("Negate"===e.head)return[-1,e.op1];const i=e.numericValue;if(null===i)return[1,e];const t=e.engine;return"number"==typeof i&&i<0?[-1,t.number(-i)]:i instanceof Ge&&i.isNegative()?[-1,t.number(i.neg())]:i instanceof je&&i.re<0?[-1,t.number(t.complex(-i.re,-i.im))]:on(i)&&i[0]<0||an(i)&&i[0]<0?[-1,t.number([-i[0],i[1]])]:[1,e]}function Qr(e,i,t,n){if(null!==e.numericValue)return e.engine.number(function(e,i,t,n){const r=e.numericValue,s=e.engine;return"number"==typeof r?Yt(s)&&t?s.chop(t(s.bignum(r))):s.chop(i(r)):r instanceof Ge?s.chop(t?.(r)??i(r.toNumber())):on(r)?Yt(s)&&t?s.chop(t(s.bignum(r[0]).div(r[1]))):s.chop(i(r[0]/r[1])):an(r)?t?s.chop(t(s.bignum(r[0]).div(s.bignum(r[1])))):s.chop(i(Number(r[0])/Number(r[1]))):r instanceof je&&n&&Kt(s)?s.chop(n(r)):NaN}(e,i,t,n))}function Wr(e,i,t,n,r){if(null!==e.numericValue&&null!==i.numericValue)return e.engine.number(function(e,i,t,n,r){const s=e.engine;let o=e.numericValue;on(o)&&(o=o[0]/o[1]);let a,u,l=i.numericValue;return on(l)&&(l=l[0]/l[1]),Yt(s)||"number"!=typeof o||"number"!=typeof l?(o instanceof Ge?a=o:an(o)?a=s.bignum(o[0]).div(s.bignum(o[1])):null!==o&&"number"==typeof o&&(a=s.bignum(o)),l instanceof Ge?u=l:an(l)?a=s.bignum(l[0]).div(s.bignum(l[1])):null!==l&&"number"==typeof l&&(u=s.bignum(l)),a&&u?n?.(a,u)??t(a.toNumber(),u.toNumber()):(o instanceof je||l instanceof je)&&r&&Kt(s)?r(s.complex(o??a?.toNumber()??NaN),s.complex(l??u?.toNumber()??NaN)):NaN):t(o,l)}(e,i,t,n,r))}function Yr(e,i,t,n){if("ComplexInfinity"===t.symbol)return e._NAN;if(t.isZero)return e._ONE;if(t.isOne)return i;if(t.isNegativeOne)return e.inv(i);if(null!==t.numericValue&&null!==i.numericValue){const r=Rt(i);if(1===r)return e._ONE;if(0===r){if(t.isPositive)return e._ZERO;if(t.isNegative)return e._COMPLEX_INFINITY}if(t.isNegativeOne)return e.inv(i);const s=Rt(t);if(.5===s||-.5===s){const t=Vt(i);if(null!==t&&t>0){const[r,o]=Ct(t,2);return 1===o&&1===r?e._ONE:1!==r?1===o?e.number(s>=0?r:[1,r]):e.mul([e.number(r),e._fn("Sqrt",[e.number(o)])]):s>0?e._fn("Sqrt",[i],n):e.inv(e._fn("Sqrt",[i]),n)}return s>0?e._fn("Power",[i,e._HALF],n):e._fn("Power",[i,e.number([-1,2])],n)}if(i.isInfinity){if(t.numericValue instanceof je){const i=t.numericValue.re;if(0===i)return e._NAN;if(i<0)return e._ZERO;if(i>0)return e._COMPLEX_INFINITY}if(i.isNegative){if(t.isInfinity)return e._NAN}else if(i.isPositive){if(t.isNegativeOne)return e._ZERO;if(t.isInfinity)return t.isNegative?e._ZERO:e._POSITIVE_INFINITY}}if(t.isInfinity&&(i.isOne||i.isNegativeOne))return e._NAN}if("Power"===i.head&&i.op1.isReal){const n=Vt(t);if(null!==n){const t=Vt(i.op2);if(null!==t)return e.pow(i.op1,e.number(n*t))}if(i.op1.isNonNegative){const n=dn(t);if(n){const t=dn(i.op2);if(t)return e.pow(i.op1,e.number(vn(n,t)))}}}return"Multiply"===i.head&&null!==Vt(t)?e._fn("Multiply",i.ops.map((i=>e.pow(i,t)))):e._fn("Power",[i,t],n)}function Kr(e,i){const t=i.numericValue;if("number"==typeof t)return e.number(t*t);if(t instanceof Ge)return e.number(t.pow(2));if(t instanceof je)return e.number(t.pow(2));if(on(t))return e.number([t[1]*t[1],t[0]*t[0]]);if(an(t))return e.number([t[1]*t[1],t[0]*t[0]]);if("Multiply"===i.head)return e._fn("Multiply",i.ops.map((i=>Kr(e,i))));if("Power"===i.head){const t=Vt(i.op2);return null!==t?e.pow(i.op1,e.number(2*t)):e.pow(i.op1,e.mul([e.number(2),i.op2]))}return e.pow(i,e.number(2))}function Jr(e,i,t){if(null===i.numericValue||null===t.numericValue)return;if(i.numericValue instanceof je)return t.numericValue instanceof je?e.number(i.numericValue.pow(t.numericValue)):e.number(i.numericValue.pow(Rt(t)??NaN));if(t.numericValue instanceof je){const n=Rt(i)??null;return null!==n?e.number(e.complex(n).pow(t.numericValue)):void 0}const n=function(e){if("number"==typeof e.numericValue){const i=1/e.numericValue;return Number.isInteger(i)?i:null}if(e.numericValue instanceof Ge){const i=e.engine._BIGNUM_ONE.div(e.numericValue);return i.isInt()?i.toNumber():null}if(!sn(e.numericValue))return null;const[i,t]=[hn(e.numericValue),mn(e.numericValue)];return 1!==i&&-1!==i?null:i*t}(t);if(Yt(e)||i.numericValue instanceof Ge||t.numericValue instanceof Ge){const r=zt(i),s=zt(t);if(!r||!s)return;if(2===n)return r.isNeg()?Kt(e)?e.number(e.complex(0,r.neg().sqrt().toNumber())):e._NAN:e.number(r.sqrt());if(!s.isInteger()&&r.isNeg()){if(!Kt(e))return e._NAN;const i=e.complex(r.toNumber()),t=e.complex(s.toNumber());return e.number(i.pow(t))}return e.number(r.pow(s))}const r=Rt(t)??NaN,s=Rt(i)??NaN;if(2===n)return s<0?Kt(e)?e.mul([e._I,e.number(Math.sqrt(-s))]):e._NAN:e.number(Math.sqrt(s));if(!Number.isInteger(r)&&s<0){if(!Kt(e))return e._NAN;const i=e.complex(s),t=e.complex(r);return e.number(i.pow(t))}return e.number(Math.pow(s,r))}function Xr(e,i,t,n){if("Multiply"===i.head){let r=Yt(e)?[BigInt(1),BigInt(1)]:[1,1];const s=[];for(const e of i.ops){const i=dn(e);i?r=vn(r,i):s.push(e)}if(!ln(r))return e.mul([es(e,e.number(r),n)??e._ONE,e.pow(Xr(e,e.mul(s),t,n)??e.mul(s),t)])}if("Power"===i.head){if(-1===Vt(i.op2)&&-1===Vt(t))return i.op1;const r=dn(i.op2),s=dn(t);if(r&&s){const t=vn(r,s);return un(t)?e._ONE:ln(t)?i.op1:e.pow(i.op1,t)}if("N"===n){const n=Rt(i.op2),r=Rt(t);if(null!==n&&null!==r){const t=n*r;return 0===t?e._ONE:1===t?i.op1:e.pow(i.op1,t)}}}if("N"!==n&&null!==i.numericValue&&i.isInteger){if(Vt(t))return Jr(e,i,t);const n=dn(t);if(n){const[r,s]=[hn(n),mn(n)];if(!(1!==r&&-1!==r||2!==s&&3!==s))if(Yt(e)||i.numericValue instanceof Ge){const n=en(i);if(s%2==0&&n<0&&!Kt(e))return e._NAN;const o=n<0?s%2==0?e._I:e._NEGATIVE_ONE:e._ONE,[a,u]=Gt(n>0?n:-n,s);if(u===BigInt(1)&&a===BigInt(1))return o;if(a!==BigInt(1))return u===BigInt(1)?e.mul([o,e.number(r>=0?a:[BigInt(1),a])]):e.mul([o,e.number(a),e.pow(e.number(u),t)])}else if("number"==typeof i.numericValue){if(i.numericValue<0&&s%2==0&&!Kt(e))return e._NAN;const[n,o]=Ct(Math.abs(i.numericValue),s),a=i.numericValue<0?s%2==0?e._I:e._NEGATIVE_ONE:e._ONE;if(1===o&&1===n)return a;if(1!==n)return 1===o?e.mul([a,e.number(r>=0?n:[1,n])]):e.mul([a,e.number(n),e.pow(e.number(o),t)])}return i.isNegative?Kt?e.mul([e._I,e.fn("Sqrt",[e.neg(i)])]):e._NAN:void 0}}if("simplify"!==n&&null!==i.numericValue&&null!==t.numericValue)return Jr(e,i,t)}function es(e,i,t){if(i.isOne)return e._ONE;if(i.isZero)return e._ZERO;if(i.isNegativeOne)return Kt(e)?e._I:e._NAN;if(i.isNegative&&!Kt(e))return e._NAN;const n=dn(i);if("N"===t||"evaluate"===t&&!n)return Qr(i,(i=>i<0?e.complex(i).sqrt():Math.sqrt(i)),(i=>i.isNeg()?e.complex(i.toNumber()).sqrt():i.sqrt()),(e=>e.sqrt()));const r=Vt(i);if(null!==r){const[i,t]=Ct(Math.abs(r),2);return r<0?(1===t&&e.mul([e.number(e.complex(0,i))]),e.mul([e.number(e.complex(0,i)),e.sqrt(e.number(t))])):1===t?e.number(i):e.mul([e.number(i),e.sqrt(e.number(t))])}if(n){if(on(n)&&!Yt(e)){const[i,t]=n;if(Math.abs(i)<Number.MAX_SAFE_INTEGER&&t<Number.MAX_SAFE_INTEGER){const[n,r]=Ct(Math.abs(i),2),[s,o]=Ct(t,2);return i<0?e.mul([e.number([n,s]),e.sqrt(e.number([r,o])),e._I]):e.mul([e.number([n,s]),e.sqrt(e.number([r,o]))])}}if(an(n)||Yt(e)){const i=$t(n[0]),[t,r]=Gt(i>0?i:-i,2),[s,o]=Gt($t(n[1]),2);return i<0?e.mul([e.number([t,s]),e.sqrt(e.number([r,o])),e._I]):e.mul([e.number([t,s]),e.sqrt(e.number([r,o]))])}}}function is(e,i){if(0===i.length)return e.number(1);if(1===i.length)return i[0];if(2===i.length)return ns(i[0],i[1]);const t=new Qn(e);for(const n of i){if(n.isNaN||"Undefined"===n.symbol)return e._NAN;t.addTerm(n)}return t.asExpression()}function ts(e,i,t="evaluate"){if("N"===t&&(i=i.map((e=>e.N())),"machine"===e.numericMode&&i.every((e=>"number"==typeof e.numericValue)))){let t=1;for(const e of i)t*=e.numericValue;return e.number(t)}for(const n of i){if(n.isNaN||"Undefined"===n.symbol)return e._NAN;n.isExact||(t="N")}return i="N"===t?i.map((e=>e.N())):i.map((e=>e.evaluate())),new Qn(e,i).asExpression(t)}function ns(e,i,t){const n=e.engine;if(null!==e.numericValue&&null!==i.numericValue&&e.isInteger&&i.isInteger)return Wr(e,i,((e,i)=>e*i),((e,i)=>e.mul(i)))??n._NAN;if(e.isNaN||i.isNaN||"Undefined"===e.symbol||"Undefined"===i.symbol)return n._NAN;if(e.isNothing)return i;if(i.isNothing)return e;if(null!==e.numericValue){if(e.isOne)return i;if(e.isNegativeOne)return In(i)}if(null!==i.numericValue){if(i.isOne)return e;if(i.isNegativeOne)return In(e)}let r=1,[s,o]=null!==e.numericValue?[e,i]:[i,e];if("Negate"===s.head&&(s=s.op1,r=-r),null!==o.numericValue){const e=dn(o);if(e){if(ln(e))return s;if(un(e))return n._ZERO;if("Add"===s.head)return r<0&&(o=In(o)),n.add(s.ops.map((e=>ns(o,e))),t);const i=dn(s);if(i){const s=vn(e,i);return n.number(r<0?gn(s):s,{metadata:t})}return r<0?n._fn("Multiply",[In(o),s],t):n._fn("Multiply",[o,s],t)}}if(o.hash===s.hash&&o.isSame(s))return Kr(n,o);const a=new Qn(n,[o,s]);return r>0?a.asExpression():In(a.asExpression(),t)}function rs(e,i,t,n){if("Lambda"!==i.head)return;const r=i.op1;let s=1,o=At;if("Tuple"!==t.head&&"Triple"!==t.head&&"Pair"!==t.head&&"Single"!==t.head||(s=Vt(t.op2)??1,o=Vt(t.op3)??At),s>=o||o-s>=200)return;if("evaluate"===n||"simplify"===n){const i=[];for(let t=s;t<=o;t++){const n=e.number(t);i.push(r.subs({_1:n,_:n}))}const t=e.mul(i);return"simplify"===n?t.simplify():t.evaluate()}let a=Yt(e)?[BigInt(1),BigInt(1)]:[1,1];for(let i=s;i<=o;i++){const t=e.number(i),n=r.subs({_1:t,_:t}).N();if(null===n.numericValue)return;a=vn(a,n)}return on(a)?e.number(a[0]/a[1]):e.number(e.bignum(a[0]).div(e.bignum(a[1])))}function ss(e,i,t){if(!i.isValid||!t.isValid)return e._fn("Divide",[i,t]);if("Negate"===i.head&&"Negate"===t.head&&(i=i.op1,t=t.op1),null!==i.numericValue&&null!==t.numericValue){if(t.isOne)return i;if(t.isNegativeOne)return e.neg(i);if(i.isOne)return e.inv(t);if(i.isNegativeOne)return e.neg(e.inv(t));const n=dn(i),r=dn(t);if(n&&r&&!un(r))return e.number(vn(n,pn(r)))}if(!("Divide"!==i.head&&"Rational"!==i.head||"Divide"!==t.head&&"Rational"!==t.head))return ss(e,e.mul([i.op1,t.op2]),e.mul([i.op2,t.op1]));const n=i.numericValue;if(null!==n){if(on(n)){const[i,r]=n;return ss(e,e.mul([e.number(i),t]),e.number(r))}if(an(n)){const[i,r]=n;return ss(e,e.mul([e.number(i),t]),e.number(r))}}const r=t.numericValue;if(null!==r){if(on(r)){const[t,n]=r;return ss(e,e.mul([i,e.number(n)]),e.number(t))}if(an(r)){const[t,n]=r;return ss(e,e.mul([i,e.number(n)]),e.number(t))}}if("Divide"===i.head||"Rational"===i.head)return ss(e,e.mul([i.op1,t]),i.op2);if("Divide"===t.head||"Rational"===t.head)return ss(e,e.mul([i,t.op2]),t.op1);const[s,o]=xn(i),[a,u]=xn(t);if(!ln(s)||!ln(a))return e.mul([e.number(vn(s,pn(a))),e.div(o,u)]);let[l,c]=Hr(i),[h,m]=Hr(t);return c=c.canonical,m=m.canonical,null!==m.numericValue&&m.isOne?l*h<0?In(c):c:l*h>0?e._fn("Divide",[c,m]):c.numericValue?e._fn("Divide",[In(c),m]):In(e._fn("Divide",[c,m]))}function os(e,i,t){if(null!==i.numericValue&&null!==t.numericValue){const n=dn(i),r=dn(t);if(n&&r&&!un(r))return e.number(vn(n,pn(r)))}const[n,r]=xn(i),[s,o]=xn(t);return ln(n)&&ln(s)?new Qn(e,[i,e.inv(t)]).asExpression():e.mul([e.number(vn(n,pn(s))),e.div(r,o)])}const as=[{Abs:{wikidata:"Q3317982",threadable:!0,idempotent:!0,complexity:1200,signature:{domain:["Function","Number","NonNegativeNumber"],simplify:(e,i)=>us(e,i[0],"simplify"),evaluate:(e,i)=>us(e,i[0],"evaluate"),N:(e,i)=>us(e,i[0],"N")}},Add:{wikidata:"Q32043",associative:!0,commutative:!0,threadable:!0,idempotent:!0,complexity:1300,hold:"all",signature:{domain:"NumericFunction",codomain:(e,i)=>function(e,i){let t=null;for(const e of i){if(!e.isNumeric)return null;t=t?Lr(t,e):e}return t}(0,i.map((e=>e.domain))),simplify:(e,i)=>function(e,i){const t=new kr(e);for(let n of i){if(n=n.simplify(),n.isImaginary&&n.isInfinity)return e.symbol("ComplexInfinity");if(n.isNaN||"Undefined"===n.symbol)return e._NAN;n.isZero||t.addTerm(n)}return t.asExpression("expression")}(e,i),evaluate:(e,i)=>Ur(e,i),N:(e,i)=>Ur(e,i,"N")}},Ceil:{description:"Rounds a number up to the next largest integer",complexity:1250,signature:{domain:["Function","Number","Integer"],evaluate:(e,i)=>Qr(i[0],Math.ceil,(e=>e.ceil()),(e=>e.ceil(0)))}},Chop:{associative:!0,threadable:!0,idempotent:!0,complexity:1200,signature:{domain:["Function","Number","Number"],evaluate:(e,i)=>Qr(i[0],(i=>e.chop(i)),(i=>e.chop(i)),(i=>e.chop(i)))}},Complex:{wikidata:"Q11567",complexity:500},Divide:{wikidata:"Q1226939",complexity:2500,signature:{domain:["Function","Number","Number","Number"],canonical:(e,i)=>2!==(i=lr(e,En(kn(i)),["Number","Number"])).length?e._fn("Divide",i):e.div(i[0],i[1]),simplify:(e,i)=>os(e,i[0],i[1]),evaluate:(e,i)=>Wr(i[0],i[1],((e,i)=>e/i),((e,i)=>e.div(i)),((e,i)=>e.div(i)))}},Exp:{wikidata:"Q168698",threadable:!0,complexity:3500,signature:{domain:["Function","Number","Number"],canonical:(e,i)=>1!==(i=lr(e,En(kn(i)),["Number"])).length?e._fn("Power",i):e.pow(e.symbol("ExponentialE"),i[0])}},Erf:{description:"Complementary Error Function",complexity:7500},Erfc:{description:"Complementary Error Function",complexity:7500},Factorial:{description:"The factorial function",wikidata:"Q120976",complexity:9e3,signature:{domain:["Function","Number","Number"],evaluate:(e,i)=>{const t=Vt(i[0]);if(null!==t&&t>=0)return Yt(e)?e.number(Rn(e,e.bignum(t))):e.number(function(e){if(!Number.isInteger(e)||e<0)return NaN;let i=1;for(let t=2;t<=e;t++)i*=t;return i}(t));const n=i[0].numericValue;if(null!==n&&n instanceof je)return e.number(n.add(1));const r=Rt(i[0]);return null!==r?e.number(Ot(1+r)):void 0}}},Floor:{wikidata:"Q56860783",complexity:1250,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Qr(i[0],Math.floor,(e=>e.floor()),(e=>e.floor(0)))}},Gamma:{wikidata:"Q190573",complexity:8e3,signature:{domain:["Function","Number","Number","Number"],N:(e,i)=>Qr(i[0],(e=>Ot(e)),(i=>Vn(e,i)),(e=>e))}},LogGamma:{complexity:8e3,signature:{domain:["Function","Number","Number","Number"],N:(e,i)=>Qr(i[0],(e=>Tt(e)),(i=>zn(e,i)),(e=>e))}},Ln:{description:"Natural Logarithm",wikidata:"Q204037",complexity:4e3,signature:{domain:["Function","Number","Number"],N:(e,i)=>Qr(i[0],(i=>i>=0?Math.log(i):e.complex(i).log()),(i=>i.isNeg()?e.complex(i.toNumber()).log():i.ln()),(e=>e.log()))}},Log:{description:"Log(z, b = 10) = Logarithm of base b",wikidata:"Q11197",complexity:4100,signature:{domain:["Function","Number",["Maybe","Number"],"Number"],canonical:(e,i)=>{if(1===(i=En(kn(i))).length)return e._fn("Log",[ar(e,i[0],"Number")]);if(2===i.length){const t=ar(e,i[0],"Number"),n=ar(e,i[1],"Number");return 10===n.numericValue?e._fn("Log",[t]):e._fn("Log",[t,n])}return e._fn("Log",sr(e,i,2))},N:(e,i)=>void 0===i[1]?Qr(i[0],(i=>i>=0?Math.log10(i):e.complex(i).log().div(Math.LN10)),(i=>i.isNeg()?e.complex(i.toNumber()).log().div(Math.LN10):Ge.log10(i)),(e=>e.log().div(Math.LN10))):Wr(i[0],i[1],((e,i)=>Math.log(e)/Math.log(i)),((e,i)=>e.log(i)),((e,i)=>e.log().div("number"==typeof i?Math.log(i):i.log())))}},Lb:{description:"Base-2 Logarithm",wikidata:"Q581168",complexity:4100,signature:{domain:["Function","Number","Number"],N:(e,i)=>Qr(i[0],(i=>i>=0?Math.log2(i):e.complex(i).log().div(Math.LN2)),(i=>i.isNeg()?Ge.log10(i):e.complex(i.toNumber()).log().div(Math.LN2)),(e=>e.log().div(Math.LN2)))}},Lg:{description:"Base-10 Logarithm",wikidata:"Q966582",complexity:4100,signature:{domain:["Function","Number","Number"],N:(e,i)=>Qr(i[0],(i=>i>=0?Math.log10(i):e.complex(i).log().div(Math.LN10)),(i=>i.isNeg()?e.complex(i.toNumber()).log().div(Math.LN10):Ge.log10(i)),(e=>e.log().div(Math.LN10)))}},Max:{description:"Maximum of two or more numbers",complexity:1200,signature:{domain:["Function",["Sequence","Number"],"Number"],simplify:(e,i)=>0===i.length?e._NEGATIVE_INFINITY:1===i.length?i[0]:e.box(["Max",...i]),evaluate:(e,i)=>{if(0===i.length)return e._NEGATIVE_INFINITY;let t;const n=[];for(const e of i)e.isNumber&&void 0!==e.numericValue?t&&!e.isGreater(t)||(t=e):n.push(e);return n.length>0?e.box(t?["Max",t,...n]:["Max",...n]):t??e._NAN}}},Min:{description:"Minimum of two or more numbers",complexity:1200,signature:{domain:["Function",["Sequence","Number"],"Number"],simplify:(e,i)=>0===i.length?e._NEGATIVE_INFINITY:1===i.length?i[0]:e.box(["Min",...i]),evaluate:(e,i)=>{if(0===i.length)return e._NEGATIVE_INFINITY;let t;const n=[];for(const e of i)e.isNumber&&void 0!==e.numericValue?t&&!e.isLess(t)||(t=e):n.push(e);return n.length>0?e.box(t?["Min",t,...n]:["Min",...n]):t??e._NAN}}},Multiply:{wikidata:"Q40276",associative:!0,commutative:!0,idempotent:!0,complexity:2100,hold:"all",signature:{domain:"NumericFunction",simplify:(e,i)=>function(e,i){const t=new Qn(e);for(let n of i){if(n=n.simplify(),n.isNaN||"Undefined"===n.symbol)return e._NAN;t.addTerm(n)}return t.asExpression()}(e,i),evaluate:(e,i)=>ts(e,i),N:(e,i)=>ts(e,i,"N")}},Negate:{description:"Additive Inverse",wikidata:"Q715358",complexity:2e3,signature:{domain:["Function","Number","Number"],codomain:(e,i)=>{const t=i[0].domain;if(!t.literal)return t;const n={PositiveNumber:"NegativeNumber",NonNegativeNumber:"NonPositiveNumber",NonPositiveNumber:"NonNegativeNumber",NegativeNumber:"PositiveNumber",PositiveInteger:"NegativeInteger",NonNegativeInteger:"NonPositiveInteger",NonPositiveInteger:"NonNegativeInteger",NegativeInteger:"PositiveInteger"}[t.literal];return n?e.domain(n):t},canonical:(e,i)=>1!==(i=lr(e,En(kn(i)),["Number"])).length?e._fn("Negate",i):In(i[0]),simplify:(e,i)=>An(0,i[0],"simplify"),evaluate:(e,i)=>An(0,i[0],"evaluate"),N:(e,i)=>An(0,i[0],"N"),sgn:(e,i)=>{const t=i[0].sgn;if(null!=t)return 0===t?0:t>0?-1:t<0?1:void 0}}},Power:{wikidata:"Q33456",commutative:!1,complexity:3500,signature:{domain:["Function","Number","Number","Number"],canonical:(e,i)=>2!==(i=lr(e,En(kn(i)),["Number","Number"])).length?e._fn("Power",i):e.pow(i[0],i[1]),simplify:(e,i)=>Xr(e,i[0],i[1],"simplify"),evaluate:(e,i)=>Xr(e,i[0],i[1],"evaluate"),N:(e,i)=>"machine"===e.numericMode&&"number"==typeof i[0].numericValue&&"number"==typeof i[1].numericValue?e.number(Math.pow(i[0].numericValue,i[1].numericValue)):Xr(e,i[0],i[1],"N")}},Product:{wikidata:"Q901718",complexity:1e3,hold:"first",signature:{domain:["Function","Anything","Tuple","Number"],canonical:(e,i)=>function(e,i,t){i??(i=e.error(["missing","Function"]));let n=null,r=null,s=null;return t&&"Tuple"!==t.head&&"Triple"!==t.head&&"Pair"!==t.head&&"Single"!==t.head?n=t:t&&(n=t.ops?.[0]??null,r=t.ops?.[1]?.canonical??null,s=t.ops?.[2]?.canonical??null),n&&"Hold"===n.head&&(n=n.op1),n&&"ReleaseHold"===n.head&&(n=n.op1.evaluate()),n??(n=e.symbol("Nothing")),n=n.symbol?e.hold(n):e.error(["incompatible-domain","Symbol",n.domain]),r&&(r=ar(e,r,"ExtendedRealNumber")),s&&(r=ar(e,s,"ExtendedRealNumber")),t=r&&s?e.tuple([n,r,s]):s?e.tuple([n,r??e._NEGATIVE_INFINITY,s]):r?e.tuple([n,r]):n,e._fn("Product",[i,t])}(e,i[0],i[1]),simplify:(e,i)=>rs(e,i[0],i[1],"simplify"),evaluate:(e,i)=>rs(e,i[0],i[1],"evaluate"),N:(e,i)=>rs(e,i[0],i[1],"N")}},Rational:{complexity:2400,signature:{domain:["Function","Number",["Maybe","Number"],"RationalNumber"],canonical:(e,i)=>0===(i=En(kn(i))).length?e._fn("Rational",[e.error(["missing","Number"])]):1===i.length?e._fn("Rational",[ar(e,i[0],"ExtendedRealNumber")]):2!==(i=lr(e,i,["Integer","Integer"])).length?e._fn("Rational",i):e.div(i[0],i[1]),simplify:(e,i)=>{if(2===i.length)return os(e,i[0],i[1])},evaluate:(e,i)=>{if(2===i.length){const[t,n]=[Vt(i[0]),Vt(i[1])];return null!==t&&null!==n?e.number([t,n]):void 0}const t=Rt(i[0].N());if(null!==t)return e.number(function(e){if(!Number.isFinite(e))return e;if(0==e%1)return e;let i=Math.floor(e),t=1,n=0,r=i,s=1;for(;e-i>1e-15*s*s;){i=Math.floor(e=1/(e-i));const o=t;t=r;const a=n;n=s,r=o+i*t,s=a+i*n}return[r,s]}(t))},N:(e,i)=>1===i.length?i[0]:Wr(i[0],i[1],((e,i)=>e/i),((e,i)=>e.div(i)),((e,i)=>e.div(i)))}},Root:{complexity:3200,signature:{domain:["Function","Number","Number","Number"],canonical:(e,i)=>{if((i=En(kn(i))).length>2)return e._fn("Root",sr(e,i,2));const[t,n]=[ar(e,i[0],"Number"),ar(e,i[1],"Number")];return n.isValid&&t.isValid?e.pow(t,e.inv(n)):e._fn("Root",[t,n])}}},Round:{complexity:1250,signature:{domain:["Function","Number","Number"],evaluate:(e,i)=>Qr(i[0],Math.round,(e=>e.round()),(e=>e.round(0)))}},Sign:{complexity:1200,signature:{domain:["Function","Number",["Range",-1,1]],simplify:(e,i)=>{const t=i[0].sgn;return 0===t?e._ZERO:1===t?e._ONE:-1===t?e._NEGATIVE_ONE:void 0},evaluate:(e,i)=>{const t=i[0].sgn;return 0===t?e._ZERO:1===t?e._ONE:-1===t?e._NEGATIVE_ONE:void 0},N:(e,i)=>{const t=i[0].sgn;return 0===t?e._ZERO:1===t?e._ONE:-1===t?e._NEGATIVE_ONE:void 0}}},SignGamma:{description:"The sign of the gamma function: -1 or +1",complexity:7900},Sqrt:{description:"Square Root",wikidata:"Q134237",complexity:3e3,signature:{domain:["Function","Number","Number"],canonical:(e,i)=>1!==(i=En(kn(i))).length?e._fn("Sqrt",i):e.pow(i[0],e._HALF),simplify:(e,i)=>es(e,i[0],"simplify"),evaluate:(e,i)=>es(e,i[0],"evaluate"),N:(e,i)=>es(e,i[0],"N")}},Square:{wikidata:"Q3075175",complexity:3100,signature:{domain:["Function","Number","Number"],canonical:(e,i)=>1!==(i=En(kn(i))).length?e._fn("Square",i):e.pow(i[0],e.number(2))}},Subtract:{wikidata:"Q40754",complexity:1350,signature:{domain:["Function","Number",["Maybe","Number"],"Number"],canonical:(e,i)=>1===(i=En(kn(i))).length?In(i[0]):2!==(i=sr(e,i,2)).length?e._fn("Subtract",i):i.every((e=>e.isValid))?e.add([i[0],In(i[1])]):e._fn("Subtract",i)}},Sum:{wikidata:"Q218005",complexity:1e3,hold:"all",signature:{domain:["Function","Anything","Tuple","Number"],canonical:(e,i)=>function(e,i,t){i??(i=e.error(["missing","Function"]));let n=null,r=null,s=null;t&&"Tuple"!==t.head&&"Triple"!==t.head&&"Pair"!==t.head&&"Single"!==t.head?n=t:t&&(n=t.ops?.[0]??null,r=t.ops?.[1]?.canonical??null,s=t.ops?.[2]?.canonical??null),"Hold"===n?.head&&(n=n.op1),"ReleaseHold"===n?.head&&(n=n.op1?.evaluate()),n??(n=e.symbol("Nothing")),n.symbol||(n=e.error(["incompatible-domain","Symbol",n.domain])),n.symbol&&e.pushScope({[n.symbol]:{domain:"Integer"}});const o=i.canonical;return n.symbol&&(e.popScope(),n=n=e.hold(n)),t=r&&s?e.tuple([n,r,s]):s?e.tuple([n,r??e._NEGATIVE_INFINITY,s]):r?e.tuple([n,r]):n,e._fn("Sum",[o,t])}(e,i[0],i[1]),simplify:(e,i)=>jr(e,i[0],i[1],"simplify"),evaluate:(e,i)=>jr(e,i[0],i[1],"evaluate"),N:(e,i)=>jr(e,i[0],i[1],"N")}}},{e:{domain:"TranscendentalNumber",constant:!0,holdUntil:"never",value:"ExponentialE"},i:{domain:"ImaginaryNumber",constant:!0,holdUntil:"never",flags:{imaginary:!0},value:"ImaginaryUnit"},MachineEpsilon:{domain:"RealNumber",holdUntil:"N",constant:!0,flags:{real:!0},value:{num:Number.EPSILON.toString()}},Half:{constant:!0,holdUntil:"never",value:["Rational",1,2]},ImaginaryUnit:{domain:"ImaginaryNumber",constant:!0,holdUntil:"evaluate",wikidata:"Q193796",flags:{imaginary:!0},value:["Complex",0,1]},ExponentialE:{domain:"TranscendentalNumber",flags:{algebraic:!1,real:!0},wikidata:"Q82435",constant:!0,holdUntil:"N",value:e=>Yt(e)?e._BIGNUM_ONE.exp():Math.exp(1)},GoldenRatio:{domain:"AlgebraicNumber",wikidata:"Q41690",constant:!0,flags:{algebraic:!0},holdUntil:"simplify",value:["Divide",["Add",1,["Sqrt",5]],2]},CatalanConstant:{domain:"RealNumber",flags:{algebraic:void 0},wikidata:"Q855282",constant:!0,holdUntil:"N",value:{num:"0.91596559417721901505460351493238411077414937428167\n                  21342664981196217630197762547694793565129261151062\n                  48574422619196199579035898803325859059431594737481\n                  15840699533202877331946051903872747816408786590902\n                  47064841521630002287276409423882599577415088163974\n                  70252482011560707644883807873370489900864775113225\n                  99713434074854075532307685653357680958352602193823\n                  23950800720680355761048235733942319149829836189977\n                  06903640418086217941101917532743149978233976105512\n                  24779530324875371878665828082360570225594194818097\n                  53509711315712615804242723636439850017382875977976\n                  53068370092980873887495610893659771940968726844441\n                  66804621624339864838916280448281506273022742073884\n                  31172218272190472255870531908685735423498539498309\n                  91911596738846450861515249962423704374517773723517\n                  75440708538464401321748392999947572446199754961975\n                  87064007474870701490937678873045869979860644874974\n                  64387206238513712392736304998503539223928787979063\n                  36440323547845358519277777872709060830319943013323\n                  16712476158709792455479119092126201854803963934243\n                  "}},EulerGamma:{domain:"RealNumber",flags:{algebraic:void 0},wikidata:"Q273023",holdUntil:"N",constant:!0,value:{num:"0.57721566490153286060651209008240243104215933593992359880576723488486772677766\n          467093694706329174674951463144724980708248096050401448654283622417399764492353\n          625350033374293733773767394279259525824709491600873520394816567085323315177661\n          152862119950150798479374508570574002992135478614669402960432542151905877553526\n          733139925401296742051375413954911168510280798423487758720503843109399736137255\n          306088933126760017247953783675927135157722610273492913940798430103417771778088\n          154957066107501016191663340152278935867965497252036212879226555953669628176388\n          792726801324310104765059637039473949576389065729679296010090151251959509222435\n          014093498712282479497471956469763185066761290638110518241974448678363808617494\n          551698927923018773910729457815543160050021828440960537724342032854783670151773\n          943987003023703395183286900015581939880427074115422278197165230110735658339673"}}},{PreIncrement:{signature:{domain:["Function","Number","Number"]}},PreDecrement:{signature:{domain:["Function","Number","Number"]}}}];function us(e,i,t){if("simplify"!==t){const n=i.numericValue;if(null!==n){if("number"==typeof n)return e.number(Math.abs(n));if(n instanceof Ge)return e.number(n.abs());if(n instanceof je)return e.number(n.abs());if(on(n))return e.number("N"===t?Math.abs(n[0]/n[1]):[Math.abs(n[0]),n[1]]);if(an(n)){const[i,r]=n;return e.number("N"===t?e.bignum(i).div(e.bignum(r)).abs():[i>0?i:-i,r])}}}return i.isNonNegative?i:i.isNegative?e.neg(i):void 0}const ls=[{Integrate:{wikidata:"Q80091",hold:"all",signature:{domain:["Function","Anything",["Union","Nothing","Tuple","Symbol"],"Number"],canonical:(e,i)=>{const t=i[0]??e.error(["missing","Function"]);let n=i[1],r=null,s=null,o=null;return n&&"Tuple"!==n.head&&"Triple"!==n.head&&"Pair"!==n.head&&"Single"!==n.head?r=n:n&&(r=n.ops?.[0]??null,s=n.ops?.[1]?.canonical??null,o=n.ops?.[2]?.canonical??null),r&&"Hold"===r.head&&(r=r.op1),r&&"ReleaseHold"===r.head&&(r=r.op1.evaluate()),r??(r=e.symbol("Nothing")),r.symbol||(r=e.error(["incompatible-domain","Symbol",r.domain])),s&&(s=ar(e,s,"Number")),o&&(o=ar(e,o,"Number")),n=s&&o?e.tuple([r,s,o]):o?e.tuple([r,e._NEGATIVE_INFINITY,o]):s?e.tuple([r,s]):r,e._fn("Integrate",[t,n])}}}}];function cs(e){return e[Math.floor(Math.random()*e.length)]}function hs(e,i){if("Add"===e||"Multiply"===e){const t=[];let n=1+Math.floor(12*Math.random());for(;n>0;)t.push(ms(i+1)),n-=1;return[e,...t]}return"Divide"===e||"Power"===e?[e,ms(i+1),ms(i+1)]:"Root"===e?[e,ms(i+1),ms(10)]:"trig"===e?[cs(["Cos","Sin","Tan","Sinh","Arccos","Arsinh",["InverseFunction","Cos"]]),cs(["Pi","-1","0","1",["Divide","Pi",-5],["Multiply",-2,["Divide","Pi",11]],["Multiply","Half","Pi"],["Multiply",5,"Pi"],["Multiply",12,"Pi"],["Divide","Pi",5],["Divide","Pi",9],["Multiply",5,["Divide","Pi",9]],["Multiply",2,["Divide","Pi",11]],["Multiply",2,["Divide","Pi",3]]])]:[e,ms(i+1)]}function ms(e){return e??(e=1),1===e?hs(cs(["Add","Add","Add","Add","Add","Multiply","Multiply","Multiply","Multiply","Divide","Divide","Divide","Root","Sqrt","Subtract","Negate","trig"]),1):2===e?Math.random()>.5?ms(3):Math.random()>.75?ms(1):hs(cs(["Multiply","Multiply","Add","Power","trig","Ln","Exp"]),2):cs([-12345e-9,-2,-2,-2,-3,-5,-6,-12,-1654e-60,0,0,12345e-8,1654e-60,1,2,2,2,2,3,3,5,5,6,6,1234.5678,5678.1234,10,15,18,30,60,1234e54,"123456789.12345678912345e200","987654321.12345678912345",["Rational",-6,10],["Rational",-12,15],["Rational",-15,12],["Rational",3,5],["Rational",12,15],["Rational",15,12],"ExponentialE","ImaginaryUnit",["Sqrt",3],["Sqrt",5],["Sqrt",15],["Sqrt",25],["Complex",-1.1,1.1],["Complex",4,5],"x","x","x","x",["Add","x",1],["Divide","x",3],["Square","x"],["Power","x",3],["Power","x",4],["Subtract","x",1],["Add","x",1],"a","b","Pi"])}const fs=[{Nothing:{domain:"Nothing"}},{List:{complexity:8200,signature:{domain:["Function",["Maybe",["Sequence","Anything"]],"List"]}},KeyValuePair:{description:"A key/value pair",complexity:8200,signature:{domain:["Function","String","Anything",["Tuple","String","Anything"]],codomain:(e,i)=>e.domain(["Tuple","String",i[1].domain]),canonical:(e,i)=>{const t=ar(e,i[0]?.canonical,"String"),n=ar(e,i[1]?.canonical,"Value");return e.tuple([t,n])}}},Single:{description:"A tuple with a single element",complexity:8200,signature:{domain:["Function","Anything",["Tuple","Anything"]],codomain:(e,i)=>e.domain(["Tuple",i[0].domain]),canonical:(e,i)=>e.tuple(sr(e,En(i),1))}},Pair:{description:"A tuple of two elements",complexity:8200,signature:{domain:["Function","Anything","Anything",["Tuple","Anything","Anything"]],codomain:(e,i)=>e.domain(["Tuple",i[0].domain,i[1].domain]),canonical:(e,i)=>e.tuple(sr(e,En(i),2))}},Triple:{description:"A tuple of three elements",complexity:8200,signature:{domain:["Function","Anything","Anything","Anything",["Tuple","Anything","Anything","Anything"]],codomain:(e,i)=>e.domain(["Tuple",i[0].domain,i[1].domain,i[2].domain]),canonical:(e,i)=>e.tuple(sr(e,En(i),3))}},Tuple:{description:"A fixed number of heterogeneous elements",complexity:8200,signature:{domain:["Function",["Sequence","Anything"],["Tuple",["Sequence","Anything"]]],canonical:(e,i)=>e.tuple(En(i)),codomain:(e,i)=>e.domain(["Tuple",...i.map((e=>e.domain))])}}},{BaseForm:{description:"`BaseForm(expr, base=10)`",complexity:9e3,inert:!0,signature:{domain:["Function","Value",["Maybe","Integer"],"Value"],codomain:(e,i)=>i[0].domain}},Delimiter:{complexity:9e3,hold:"first",signature:{domain:["Function","Anything",["Maybe","String"],["Maybe","String"],"Anything"],codomain:(e,i)=>i[0].domain,canonical:(e,i)=>i[0]?.canonical??e.box(["Sequence"])}},Error:{complexity:500,signature:{domain:["Function","Anything",["Maybe","Anything"],"Void"],canonical:(e,i)=>e._fn("Error",i)}},ErrorCode:{complexity:500,hold:"all",signature:{domain:["Function","String",["Maybe",["Sequence","Anything"]],"Anything"],canonical:(e,i)=>{const t=ar(e,i[0],"String").string;return"incompatible-domain"===t?e._fn("ErrorCode",[e.string(t),e.domain(i[1]??"Anything"),e.domain(i[2]??"Anything")]):e._fn("ErrorCode",i)}}},Hold:{hold:"all",signature:{domain:"Function",codomain:(e,i)=>i[0].symbol?e.domain("Symbol"):e.domain("Anything"),canonical:(e,i)=>1!==i.length?e._fn("Hold",sr(e,i,1)):e._fn("Hold",[ar(e,i[0],"Anything")])}},HorizontalSpacing:{signature:{domain:"Function",canonical:(e,i)=>2===i.length?i[0].canonical:e.box(["Sequence"])}},Style:{complexity:9e3,inert:!0,signature:{domain:["Function","Anything",["Maybe","Dictionary"],"Anything"]}}},{Apply:{signature:{domain:"Function",evaluate:(e,i)=>fr(i[0],i.slice(1))}},About:{signature:{domain:"Function"}},Block:{signature:{domain:"Function"}},Domain:{signature:{domain:["Function","Anything","Domain"],canonical:(e,i)=>e.domain(sr(e,En(i),1)[0])}},Evaluate:{hold:"all",signature:{domain:["Function","Anything","Anything"],codomain:(e,i)=>i[0].domain,canonical:(e,i)=>e._fn("Evaluate",sr(e,En(i),1)),evaluate:(e,i)=>i[0].evaluate()}},Head:{signature:{domain:"Function",evaluate:(e,i)=>{const t=i[0];return"string"==typeof t?.head?e.symbol(t.head):t?.head??e.symbol("Nothing")}}},Html:{signature:{domain:["Function","Value","String"],evaluate:(e,i)=>(i.length,e.string(""))}},Lambda:{wikidata:"Q567612",hold:"all",signature:{domain:["Function","Anything","Function"],codomain:(e,i)=>i[0].domain,canonical:(e,i)=>e._fn("Lambda",sr(e,i,1))}},Signatures:{signature:{domain:["Function","Symbol",["Maybe",["List","Domain"]]],canonical:(e,i)=>(i=sr(e,i,1))[0].symbol?e._fn("Signatures",i):e._fn("Signatures",[e.error(["incompatible-domain","Symbol",i[0].domain],i[0])]),evaluate:(e,i)=>{const t=i[0].symbol;if(!t)return e.symbol("Nothing");const n=e.lookupFunction(t);return n?e.fn("List",[n.signature.domain]):e.symbol("Nothing")}}},Subscript:{hold:"last",signature:{domain:["Function","Anything","Anything","Anything"],codomain:(e,i)=>(i[0].isFunction,i[0].domain),canonical:(e,i)=>{const t=i[0],n=i[1];if(t.string){const i=Vt(n);if(null!==i&&i>1&&i<=36){const[n,r]=Pt(t.string,i);return r?e.error(["unexpected-digit",r[0]],["Latex",e.string(t.string)]):e.number(n)}}if(t.symbol){if(t.symbolDefinition?.at)return e._fn("At",[t,n.canonical]);const i=n.string??n.symbol??Vt(n)?.toString();if(i)return e.symbol(t.symbol+"_"+i)}return"Sequence"===n.head&&e._fn("Subscript",[t,e._fn("List",n.ops)]),e._fn("Subscript",i)}}},Symbol:{complexity:500,description:"Construct a new symbol with a name formed by concatenating the arguments",threadable:!0,hold:"all",signature:{domain:["Function",["Sequence","Anything"],"Anything"],canonical:(e,i)=>{if(0===i.length)return e.symbol("Nothing");const t=i.map((e=>e.symbol??e.string??Vt(e)?.toString()??"")).join("");return t.length>0?e.symbol(t):e.symbol("Nothing")}}},Tail:{signature:{domain:["Function","Value",["List","Value"]],evaluate:(e,i)=>i[0]?e._fn("List",i[0].ops??[]):e._fn("List",[])}},Timing:{description:"`Timing(expr)` evaluates `expr` and return a `Pair` of the number of second elapsed for the evaluation, and the value of the evaluation",signature:{domain:["Function","Value",["Maybe","Integer"],["Tuple","Value","Number"]],evaluate:(e,i)=>{if("Nothing"===i[1].symbol){const t=globalThis.performance.now(),n=i[0].evaluate(),r=1e3*(globalThis.performance.now()-t);return e.pair(e.number(r),n)}let t,n=Math.max(3,Math.round(Vt(i[1])??3)),r=[];for(;n>0;){const e=globalThis.performance.now();t=i[0].evaluate(),r.push(1e3*(globalThis.performance.now()-e)),n-=1}const s=Math.max(...r),o=Math.min(...r);r=r.filter((e=>e>o&&e<s));const a=r.reduce(((e,i)=>e+i),0);return 0===a?e.pair(e.number(s),t):e.pair(e.number(a/r.length),t)}}}},{FromDigits:{description:"`FromDigits(s, base=10)`       return an integer representation of the string `s` in base `base`.",signature:{domain:["Function","String",["Maybe",["Range",1,36]],"Integer"],evaluate:(e,i)=>{const t=i[0];if(!t.string)return e.error(["incompatible-domain","String",t.domain],t);const n=i[1];if(n.isNothing)return e.number(Number.parseInt(t.string,10));if(null===n.numericValue)return e.error(["unexpected-base",n.latex],n);const r=Rt(n);if(!Number.isInteger(r)||r<2||r>36)return e.error(["unexpected-base",r],n);const[s,o]=Pt(t.string,r);return o?e.error(["unexpected-digit",o[0]],{str:o}):e.number(s)}}},IntegerString:{description:"`IntegerString(n, base=10)`       return a string representation of the integer `n` in base `base`.",signature:{domain:["Function","Integer",["Maybe","Integer"],"String"],evaluate:(e,i)=>{const t=i[0],n=Rt(t)??NaN;if(Number.isNaN(n)||!Number.isInteger(n))return e.error(["incompatible-domain","Integer",t.domain],t);const r=i[1];if(r.isNothing){const i=t.numericValue;return"number"==typeof i?e.string(Math.abs(i).toString()):i instanceof Ge?e.string(i.abs().toString()):e.string(Math.abs(Math.round(Rt(t)??NaN)).toString())}if(null===Vt(r))return e.error(["incompatible-domain","Integer",r.domain],r);const s=Vt(r);return s<2||s>36?e.error(["out-of-range",2,36,s],r):e.string(Math.abs(n).toString(s))}}},String:{threadable:!0,signature:{domain:["Function",["Maybe","Anything"],"String"],evaluate:(e,i)=>0===i.length?e.string(""):e.string(i.map((e=>e.string??e.toString())).join(""))}}},{JoinLatexTokens:{signature:{domain:["Function",["Maybe",["Sequence","Anything"]],"String"],evaluate:(e,i)=>e.box(["Latex",e.string(ei(i.map((e=>e.string??e.latex))))])}},Latex:{signature:{domain:["Function",["Maybe",["Sequence","Anything"]],"String"],evaluate:(e,i)=>0===i.length?e.string(""):e.string(Xe(i.map((e=>e.string??e.toString()))))}},SerializeLatex:{hold:"all",signature:{domain:["Function",["Maybe",["Sequence","Anything"]],"String"],evaluate:(e,i)=>e.box(["Latex",e.string(Xe(i.map((e=>e.latex))))])}},SplitAsLatexTokens:{description:"Split a LaTeX string into a list of LaTeX tokens",hold:"all",signature:{domain:["Function",["Maybe","Anything"],["List","String"]],evaluate:(e,i)=>{if(0===i.length)return e._fn("List",[]);let t="";return t="Latex"===i[0].head?i[0].op1.string??"":"LatexString"===i[0].head?Xe(i[0].ops.map((e=>e.latex))):i[0].latex,e._fn("List",Je(t,[]).map((i=>e.string(i))))}}},ParseLatex:{description:"Parse a LaTeX string and evaluate to a corresponding expression",signature:{domain:["Function",["Maybe","String"],"Anything"],evaluate:(e,i)=>0!==i.length&&i[0].string?e.parse(i[0].string)??e.box(["Sequence"]):e.box(["Sequence"])}}},{RandomExpression:{signature:{domain:"Function",evaluate:(e,i)=>e.box(ms())}}}],gs={True:{wikidata:"Q16751793",domain:"Boolean",constant:!0},False:{wikidata:"Q5432619",domain:"Boolean",constant:!0},Maybe:{wikidata:"Q781546",domain:"MaybeBoolean",constant:!0},And:{wikidata:"Q191081",threadable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:{domain:"LogicOperator",simplify:ps,evaluate:ps}},Or:{wikidata:"Q1651704",threadable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:{domain:"LogicOperator",simplify:ds,evaluate:ds}},Not:{wikidata:"Q190558",involution:!0,complexity:10100,signature:{domain:"LogicOperator",simplify:bs,evaluate:bs}},Equivalent:{wikidata:"Q220433",complexity:10200,signature:{domain:"LogicOperator",simplify:ys,evaluate:ys}},Implies:{wikidata:"Q7881229",complexity:10200,signature:{domain:"LogicOperator",simplify:vs,evaluate:vs}},Exists:{signature:{domain:"MaybeBoolean"}},If:{hold:"rest",signature:{domain:"Function",codomain:(e,i)=>e.domain(["Union",i[0],i[1]]),simplify:(e,i)=>{const t=i[0];return t&&"True"===t.symbol?i[1]?i[1].simplify():e.box("Nothing"):i[2]?i[2].simplify():e.box("Nothing")},evaluate:(e,i)=>{const t=i[0];return t&&"True"===t.symbol?i[1]?i[1].evaluate():e.box("Nothing"):i[2]?i[2].evaluate():e.box("Nothing")},N:(e,i)=>{const t=i[0];return t&&"True"===t.symbol?i[1]?i[1].N():e.box("Nothing"):i[2]?i[2].N():e.box("Nothing")}}},Loop:{hold:"all",signature:{domain:"Function",simplify:(e,i)=>i[0]?.simplify()??e.box("Nothing"),evaluate:(e,i)=>{const t=i[0]??e.box("Nothing");if(t.isNothing)return t;let n,r=0;do{n=t.evaluate(),r+=1}while("Return"!==n.head&&r<e.iterationLimit);return"Return"===n.head?n.op1:e.error("iteration-limit-exceeded")},N:(e,i)=>{const t=i[0];return t&&"True"===t.symbol?i[1]?i[1].N():e.box("Nothing"):i[2]?i[2].N():e.box("Nothing")}}},Which:{hold:"all",signature:{domain:"Function",codomain:(e,i)=>function(e,i){let t=null;for(let e=1;e<=i.length-1;e+=2)t=t?Lr(t,i[e].domain):i[e].domain;return t??e.domain("Nothing")}(e,i),evaluate:(e,i)=>Ns(e,i,"evaluate"),N:(e,i)=>Ns(e,i,"N")}}};function ps(e,i){if(0===i.length)return e.symbol("True");const t=[];for(const n of i){if("False"===n.symbol)return e.symbol("False");if("True"!==n.symbol){let i=!1;for(const r of t)if(r.isSame(n))i=!0;else if("Not"===n.head&&n.op1.isSame(r)||"Not"===r.head&&r.op1.isSame(n))return e.symbol("False");i||t.push(n)}}return 0===t.length?e.symbol("True"):1===t.length?t[0]:e._fn("And",t)}function ds(e,i){if(0===i.length)return e.symbol("True");const t=[];for(const n of i){if("True"===n.symbol)return e.symbol("True");if("False"!==n.symbol){let i=!1;for(const r of t)if(r.isSame(n))i=!0;else if("Not"===n.head&&n.op1.isSame(r)||"Not"===r.head&&r.op1.isSame(n))return e.symbol("True");i||t.push(n)}}return 0===t.length?e.symbol("True"):1===t.length?t[0]:e._fn("Or",t)}function bs(e,i){const t=i[0].symbol;return"True"===t?e.symbol("False"):"False"===t?e.symbol("True"):"Maybe"===t?e.symbol("Maybe"):void 0}function ys(e,i){const t=i[0].symbol,n=i[1].symbol;return"True"===t&&"True"===n||"False"===t&&"False"===n?e.symbol("True"):"True"===t&&"False"===n||"False"===t&&"True"===n?e.symbol("False"):"Maybe"===t||"Maybe"===n?e.symbol("Maybe"):void 0}function vs(e,i){const t=i[0].symbol,n=i[1].symbol;return"True"===t&&"True"===n||"False"===t&&"False"===n||"False"===t&&"True"===n?e.symbol("True"):"True"===t&&"False"===n?e.symbol("False"):"Maybe"===t||"Maybe"===n?e.symbol("Maybe"):void 0}function Ns(e,i,t){let n=0;for(;n<i.length-1;){if("True"===i[n].evaluate().symbol)return i[n+1]?"N"===t?i[n+1].N():i[n+1].evaluate():e.symbol("Undefined");n+=2}return e.symbol("Undefined")}const _s=[{Expand:{description:"Expand out products and positive integer powers",signature:{domain:["Function","Value","Value"],evaluate:(e,i)=>Cn(i[0])}}}],xs={Equal:{commutative:!0,complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Equal",wn(En(kn(i)),"Equal")),evaluate:(e,i)=>{if(i.length<2)return e.symbol("True");let t;for(const n of i)if(t){if(!0!==t.isEqual(n))return e.symbol("False")}else t=n;return e.symbol("True")}}},NotEqual:{wikidata:"Q28113351",commutative:!0,complexity:11e3,signature:{domain:"RelationalOperator",evaluate:(e,i)=>{if(i.length<2)return e.symbol("False");let t;for(const n of i)if(t){if(!0===t.isEqual(n))return e.symbol("False")}else t=n;return e.symbol("True")}}},Less:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Less",wn(En(kn(i)),"Less")),evaluate:(e,i)=>{if(i.length<2)return e.symbol("True");let t;for(const n of i){if(!n.isNumber)return;if(t){const i=e.fn("Subtract",[n,t]).N().sgn;if(null==i)return;if(i<=0)return e.symbol("False");t=n}else t=n}return e.symbol("True")}}},NotLess:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("Less",i)])}},Greater:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Less",i.reverse()),evaluate:(e,i)=>{if(i.length<2)return e.symbol("True");let t;for(const n of i){if(!n.isNumber)return;if(t){const i=e.fn("Subtract",[n,t]).N().sgn;if(null==i)return;if(i>=0)return e.symbol("False");t=n}else t=n}return e.symbol("True")}}},NotGreater:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("Greater",i)])}},LessEqual:{complexity:11e3,signature:{domain:"RelationalOperator",evaluate:(e,i)=>{if(i.length<2)return e.symbol("True");let t;for(const n of i){if(!n.isNumber)return;if(t){const i=e.fn("Subtract",[n,t]).N().sgn;if(null==i)return;if(i<0)return e.symbol("False");t=n}else t=n}return e.symbol("True")}}},NotLessNotEqual:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("LessEqual",i)])}},GreaterEqual:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("LessEqual",i.reverse()),evaluate:(e,i)=>{if(i.length<2)return e.symbol("True");let t;for(const n of i){if(!n.isNumber)return;if(t){const i=e.fn("Subtract",[n,t]).N().sgn;if(null==i)return;if(i>0)return e.symbol("False");t=n}else t=n}return e.symbol("True")}}},NotGreaterNotEqual:{complexity:11e3,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("GreaterEqual",i)])}},TildeFullEqual:{description:"Indicate isomorphism, congruence and homotopic equivalence",signature:{domain:"RelationalOperator"}},NotTildeFullEqual:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("TildeFullEqual",i)])}},TildeEqual:{description:"Approximately or asymptotically equal",complexity:11e3,signature:{domain:"RelationalOperator"}},NotTildeEqual:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("TildeEqual",i)])}},Approx:{complexity:11100,signature:{domain:"RelationalOperator"}},NotApprox:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("Approx",i)])}},ApproxEqual:{complexity:11100,signature:{domain:"RelationalOperator"}},NotApproxEqual:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("ApproxEqual",i)])}},ApproxNotEqual:{complexity:11100,signature:{domain:"RelationalOperator"}},NotApproxNotEqual:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("ApproxNotEqual",i)])}},Precedes:{complexity:11100,signature:{domain:"RelationalOperator"}},NotPrecedes:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("Precedes",i)])}},Succeeds:{signature:{domain:"RelationalOperator"}},NotSucceeds:{complexity:11100,signature:{domain:"RelationalOperator",canonical:(e,i)=>e._fn("Not",[e._fn("Succeeds",i)])}}},Ss={EmptySet:{domain:"Set",constant:!0,wikidata:"Q226183"},Element:{complexity:11200,hold:"all",signature:{domain:"Predicate",canonical:(e,i)=>2===(i=sr(e,kn(En(i)),2)).length&&Rr(i[1])?e._fn("Element",[i[0],e.domain(i[1])]):e._fn("Element",i),evaluate:(e,i)=>function(e,i){const[t,n]=i;if(n.string)return t.string&&n.string.includes(t.string)?e.symbol("True"):e.symbol("False");if(n.keys){if(t.string)for(const i of n.keys)if(i===t.string)return e.symbol("True");return e.symbol("False")}if("List"===n.head){if("List"===t.head){let i=!1;for(let r=0;r<n.nops-t.nops+1;++r){i=!0;for(let e=0;e<t.nops;++e)if(!n.ops[r+e].isEqual(t.ops[e])){i=!1;break}if(i)return e.symbol("True")}return e.symbol("False")}const i="Hold"===t.head?t.op1:t;for(const t of n.ops)if(i.isEqual(t))return e.symbol("True");return e.symbol("False")}return Rr(n)?t.domain.isCompatible(e.domain(n))?e.symbol("True"):e.symbol("False"):e._fn("Element",[t,n])}(e,i)}},NotElement:{complexity:11200,hold:"all",signature:{domain:"Predicate",canonical:(e,i)=>e.fn("Not",[e.fn("Element",i)])}},Subset:{complexity:11200,signature:{domain:"Predicate"}},NotSubset:{complexity:11200,signature:{domain:"Predicate",canonical:(e,i)=>e.fn("Not",[e.fn("Subset",i)])}},Superset:{complexity:11200,signature:{domain:"Predicate"}},SupersetEqual:{complexity:11200,signature:{domain:"Predicate"}},NotSuperset:{complexity:11200,signature:{domain:"Predicate",canonical:(e,i)=>e.fn("Not",[e.fn("Superset",i)])}},NotSupersetEqual:{complexity:11200,signature:{domain:"Predicate",canonical:(e,i)=>e.fn("Not",[e.fn("SupersetEqual",i)])}},SubsetEqual:{complexity:11200,signature:{domain:"Predicate"}},NotSubsetNotEqual:{complexity:11200,signature:{domain:"Predicate",canonical:(e,i)=>e.fn("Not",[e.fn("SubsetEqual",i)])}},CartesianProduct:{wikidata:"Q173740",signature:{domain:["Function","Set",["Sequence","Set"],"Set"]}},Complement:{wikidata:"Q242767",signature:{domain:["Function","Set","Set"]}},Intersection:{wikidata:"Q185837",threadable:!0,associative:!0,commutative:!0,involution:!0,signature:{domain:["Function","Set",["Sequence","Set"],"Set"],evaluate:function(e,i){return e.symbol("EmptySet")}}},Union:{wikidata:"Q185359",threadable:!0,associative:!0,commutative:!0,involution:!0,signature:{domain:["Function","Set",["Sequence","Set"],"Set"],evaluate:function(e,i){return e.symbol("False")}}},SetMinus:{wikidata:"Q18192442",signature:{domain:["Function","Set","Value","Set"],evaluate:function(e,i){return e.symbol("EmptySet")}}},SymmetricDifference:{wikidata:"Q1147242",signature:{domain:["Function","Set",["Sequence","Set"],"Set"]}}},ws=[{Pi:{domain:"TranscendentalNumber",flags:{algebraic:!1},constant:!0,holdUntil:"N",wikidata:"Q167",value:e=>Yt(e)?e._BIGNUM_PI:Math.PI}},{Degrees:{signature:{domain:["Function","Number","Number"],canonical:(e,i)=>{if(1!==(i=lr(e,kn(En(i)),["Number"])).length)return e.box(["Degrees",i]);const t=i[0];return null!==t.numericValue&&t.isValid?e.div(e.mul([t,e.symbol("Pi")]),e.number(180)):e.box(["Degrees",t])},evaluate:(e,i)=>e.mul([i[0],e.box(["Divide","Pi",180])])}},Hypot:{signature:{domain:["Function","Number","Number","NonNegativeNumber"],simplify:(e,i)=>e.box(["Sqrt",["Add",["Square",i[0]],["Square",i[1]]]]).simplify(),evaluate:["Lambda",["Sqrt",["Add",["Square","_1"],["Square","_2"]]]]}},Sin:{complexity:5e3,signature:{domain:["Function","Number",["Interval",-1,1]],simplify:(e,i)=>Cs(e,"Sin",i[0])?.simplify()??(Kt(e)?e.box(["Divide",["Subtract",["Exp",["Multiply","ImaginaryUnit",i[0]]],["Exp",["Multiply","ImaginaryUnit",["Negate",i[0]]]]],["Complex",0,2]]).simplify():void 0),evaluate:(e,i)=>Fs(e,"evaluate","Sin",i[0]),N:(e,i)=>Fs(e,"N","Sin",i[0])}}},{Arctan:{wikidata:"Q2257242",complexity:5200,signature:{domain:["Function","Number","ExtendedRealNumber"],simplify:(e,i)=>Cs(e,"Arctan",i[0])?.simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Arctan",i[0]),N:(e,i)=>Fs(e,"N","Arctan",i[0])}},Arctan2:{wikidata:"Q776598",complexity:5200,signature:{domain:["Function","Number","Number","Number"],N:(e,i)=>Wr(i[0],i[1],Math.atan2,((e,i)=>Ge.atan2(e,i)))}},Cos:{complexity:5050,signature:{domain:["Function","Number",["Interval",-1,1]],simplify:(e,i)=>Cs(e,"Cos",i[0])?.simplify()??e.box(["Sin",["Add",i[0],["Multiply","Half","Pi"]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Cos",i[0]),N:(e,i)=>Fs(e,"N","Cos",i[0])}},Tan:{complexity:5100,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Tan",i[0])?.simplify()??e.box(["Divide",["Sin",i[0]],["Cos",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Tan",i[0]),N:(e,i)=>Fs(e,"N","Tan",i[0])}}},{Arcosh:{complexity:6200,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Arcosh",i[0])?.simplify()??e.box(["Ln",["Add",i[0],["Sqrt",["Subtract",["Square",i[0]],1]]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Arcosh",i[0]),N:(e,i)=>Fs(e,"N","Arcosh",i[0])}},Arcsin:{complexity:5500,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Arcsin",i[0])?.simplify()??e.box(["Multiply",2,["Arctan2",i[0],["Add",1,["Sqrt",["Subtract",1,["Square",i[0]]]]]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Arcsin",i[0]),N:(e,i)=>Fs(e,"N","Arcsin",i[0])}},Arsinh:{complexity:6100,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Arsinh",i[0])?.simplify()??e.box(["Ln",["Add",i[0],["Sqrt",["Add",["Square",i[0]],1]]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Arsinh",i[0]),N:(e,i)=>Fs(e,"N","Arsinh",i[0])}},Artanh:{complexity:6300,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Artanh",i[0])?.simplify()??e.box(["Multiply","Half",["Ln",["Divide",["Add",1,i[0]],["Subtract",1,i[0]]]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Artanh",i[0]),N:(e,i)=>Fs(e,"N","Artanh",i[0])}},Cosh:{complexity:6050,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Cosh",i[0])?.simplify()??e.box(["Multiply","Half",["Add",["Exp",i[0]],["Exp",["Negate",i[0]]]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Cosh",i[0]),N:(e,i)=>Fs(e,"N","Cosh",i[0])}},Cot:{complexity:5600,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Cot",i[0])?.simplify()??e.box(["Divide",["Cos",i[0]],["Sin",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Cot",i[0]),N:(e,i)=>Fs(e,"N","Cot",i[0])}},Csc:{description:"Cosecant",complexity:5600,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Csc",i[0])?.simplify()??e.box(["Divide",1,["Sin",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Csc",i[0]),N:(e,i)=>Fs(e,"N","Csc",i[0])}},Haversine:{wikidata:"Q2528380",signature:{domain:["Function","ExtendedRealNumber",["Interval",0,1]],evaluate:["Lambda",["Divide",["Subtract",1,["Cos","_1"]],2]]}},InverseHaversine:{signature:{domain:["Function","ExtendedRealNumber","RealNumber"],evaluate:["Lambda",["Multiply",2,["Arcsin",["Sqrt","_1"]]]]}},Sec:{description:"Secant, inverse of cosine",complexity:5500,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Sec",i[0])?.simplify()??e.box(["Divide",1,["Cos",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Sec",i[0]),N:(e,i)=>Fs(e,"N","Sec",i[0])}},Sinh:{complexity:6e3,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Sinh",i[0])?.simplify()??e.box(["Multiply","Half",["Subtract",["Exp",i[0]],["Exp",["Negate",i[0]]]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Sinh",i[0]),N:(e,i)=>Fs(e,"N","Sinh",i[0])}}},{Csch:{complexity:6200,signature:{domain:["Function","Number","ExtendedRealNumber"],simplify:(e,i)=>Cs(e,"Csch",i[0])?.simplify()??e.box(["Divide",1,["Sinh",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Csch",i[0]),N:(e,i)=>Fs(e,"N","Csch",i[0])}},Sech:{complexity:6200,signature:{domain:["Function","Number",["Interval",-1,1]],simplify:(e,i)=>Cs(e,"Sech",i[0])?.simplify()??e.box(["Divide",1,["Cosh",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Sech",i[0]),N:(e,i)=>Fs(e,"N","Sech",i[0])}},Tanh:{complexity:6200,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Tanh",i[0])?.simplify()??e.box(["Divide",["Sinh",i[0]],["Cosh",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Tanh",i[0]),N:(e,i)=>Fs(e,"N","Tanh",i[0])}}},{Arccos:{complexity:5550,signature:{domain:["Function","Number","ExtendedRealNumber"],simplify:(e,i)=>Cs(e,"Arccos",i[0])?.simplify()??e.box(["Subtract",["Divide","Pi",2],["Arcsin",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Arccos",i[0]),N:(e,i)=>Fs(e,"N","Arccos",i[0])}},Arccot:{numeric:!0,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Fs(e,"evaluate","Arccot",i[0]),N:(e,i)=>Fs(e,"N","Arccot",i[0])}},Arcoth:{numeric:!0,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Fs(e,"evaluate","Arcoth",i[0]),N:(e,i)=>Fs(e,"N","Arcoth",i[0])}},Arcsch:{numeric:!0,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Fs(e,"evaluate","Arcsch",i[0]),N:(e,i)=>Fs(e,"N","Arcsch",i[0])}},Arcsec:{numeric:!0,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Fs(e,"evaluate","Arcsec",i[0]),N:(e,i)=>Fs(e,"N","Arcsec",i[0])}},Arsech:{numeric:!0,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Fs(e,"evaluate","Arsech",i[0]),N:(e,i)=>Fs(e,"N","Arsech",i[0])}},Arccsc:{numeric:!0,signature:{domain:["Function","Number","ExtendedRealNumber"],evaluate:(e,i)=>Fs(e,"evaluate","Arccsc",i[0]),N:(e,i)=>Fs(e,"N","Arccsc",i[0])}},Coth:{complexity:6300,signature:{domain:["Function","Number","Number"],simplify:(e,i)=>Cs(e,"Coth",i[0])?.simplify()??e.box(["Divide",1,["Tanh",i[0]]]).simplify(),evaluate:(e,i)=>Fs(e,"evaluate","Coth",i[0]),N:(e,i)=>Fs(e,"N","Coth",i[0])}},InverseFunction:{signature:{domain:["Function","Function","Function"],canonical:(e,i)=>Ds(e,i=sr(e,kn(En(i)),1))??e._fn("InverseFunction",i),simplify:(e,i)=>Ds(e,i),evaluate:(e,i)=>Ds(e,i)}}}],ks=["Sqrt",2],Es=["Sqrt",3],Is=["Sqrt",5],As=["Sqrt",6],Ms=[[[0,1],{Sin:0,Cos:1,Tan:0,Cot:NaN,Sec:1,Csc:NaN}],[[1,12],{Sin:["Divide",["Subtract",As,ks],4],Cos:["Divide",["Add",As,ks],4],Tan:["Subtract",2,Es],Cot:["Add",2,Es],Sec:["Subtract",As,ks],Csc:["Add",As,ks]}],[[1,10],{Sin:["Divide",["Subtract",Is,1],4],Cos:["Divide",["Sqrt",["Add",10,["Multiply",2,Is]]],4],Tan:["Divide",["Sqrt",["Subtract",25,["Multiply",10,Is]]],4],Cot:["Sqrt",["Add",5,["Multiply",2,Is]]],Sec:["Divide",["Sqrt",["Subtract",50,["Multiply",10,Is]]],5],Csc:["Add",1,Is]}],[[1,8],{Sin:"$\\frac\\sqrt{2-\\sqrt2}{2}$",Cos:"$\\frac {\\sqrt {2+{\\sqrt {2}}}}{2}$",Tan:"$\\sqrt{2} - 1$",Cot:"$\\sqrt{2} + 1$",Sec:"$\\sqrt{ 4 - 2\\sqrt{2}}$",Csc:"$\\sqrt{ 4 + 2\\sqrt{2}}$"}],[[1,6],{Sin:"$\\frac{1}{2}$",Cos:"$\\frac{\\sqrt{3}}{2}$",Tan:"$\\frac{\\sqrt{3}}{3}$",Cot:"$\\frac{2\\sqrt{3}}{3}$",Sec:"$\\sqrt{3}$",Csc:2}],[[1,5],{Sin:"$\\frac{\\sqrt{10- 2\\sqrt{5}}} {4}$",Cos:"$\\frac{1+ \\sqrt{5}} {4}$",Tan:"$\\sqrt{5-2\\sqrt5}$",Cot:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Sec:"$\\sqrt{5} - 1$",Csc:"$\\frac{\\sqrt{50+10\\sqrt{5}}} {5}$"}],[[1,4],{Sin:["Divide",ks,2],Cos:["Divide",ks,2],Tan:1,Cot:1,Sec:ks,Csc:ks}],[[3,10],{Sin:"$\\frac{1+ \\sqrt{5}} {4}$",Cos:"$\\frac{\\sqrt{10- 2\\sqrt{5}}} {4}$",Tan:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Cot:"$\\sqrt{5-2\\sqrt5}$",Sec:"$$",Csc:"$\\frac{\\sqrt{50+10\\sqrt{5}}} {5}$"}],[[1,3],{Sin:["Divide",Es,2],Cos:"Half",Tan:Es,Cot:["Divide",Es,3],Sec:2,Csc:["Divide",["Multiply",2,Es],3]}],[[3,8],{Sin:"$\\frac{ \\sqrt{2 + \\sqrt{2}} } {2}$",Cos:"$\\frac{ \\sqrt{2 - \\sqrt{2}} } {2}$",Tan:"$\\sqrt{2} + 1$",Cot:"$\\sqrt{2} - 1$",Sec:"$\\sqrt{ 4 + 2 \\sqrt{2} }$",Csc:"$\\sqrt{ 4 - 2 \\sqrt{2} }$"}],[[2,5],{Sin:"$\\frac{\\sqrt{10+ 2\\sqrt{5}}} {4}$",Cos:"$\\frac{\\sqrt{5}-1} {4}$",Tan:"$\\sqrt{5+2\\sqrt{5}}$",Cot:"$\\frac{\\sqrt{25-10\\sqrt{5}}} {5}$",Sec:"$1 + \\sqrt{5}$",Csc:"$\\frac{\\sqrt{50-10\\sqrt{5}}} {5}$"}],[[5,12],{Sin:"$\\frac{\\sqrt{6} + \\sqrt{2}} {4}$",Cos:"$\\frac{ \\sqrt{6} - \\sqrt{2}} {4}$",Tan:"$2+\\sqrt{3}$",Cot:"$2-\\sqrt{3}$",Sec:"$\\sqrt{6}+\\sqrt{2}$",Csc:"$\\sqrt{6} - \\sqrt{2}$"}],[[1,2],{Sin:1,Cos:0,Tan:NaN,Cot:0,Sec:NaN,Csc:1}]],qs={Sin:[[1,"Sin"],[1,"Cos"],[-1,"Sin"],[-1,"Cos"]],Cos:[[1,"Cos"],[-1,"Sin"],[-1,"Cos"],[1,"Sin"]],Sec:[[1,"Sec"],[-1,"Csc"],[-1,"Sec"],[1,"Csc"]],Csc:[[1,"Csc"],[1,"Sec"],[-1,"Csc"],[-1,"Sec"]],Tan:[[1,"Tan"],[-1,"Cot"],[1,"Tan"],[-1,"Cot"]],Cot:[[1,"Cot"],[-1,"Tan"],[1,"Cot"],[-1,"Tan"]]};function Cs(e,i,t){const n=e.cache("constructible-trigonometric-values",(()=>{const i=[];for(const[t,n]of Ms){const r={};for(const i of Object.keys(n))r[i]=e.parse(Ut(n[i]))??e.box(n[i]);i.push([t,r])}return i}),(e=>{for(const[i,t]of e)for(const e of Object.values(t))e.unbind();return e}));if(null===(t=t.N()).numericValue)return;let r=Rt(t)??null;if(null===r)return;r%=2*Math.PI;const s="Cos"!==i&&"Sec"!==i?Math.sign(r):1;r=Math.abs(r);const o=Math.floor(2*r/Math.PI);let a;r%=Math.PI/2,[a,i]=qs[i]?.[o]??[1,i],a*=s;for(const[[t,s],o]of n)if(o[i]&&0===e.chop(r-Math.PI*t/s))return a<0?In(o[i]):o[i]}function Ds(e,i){if(1!==i.length)return;const t=i[0],n=t.symbol;if("string"!=typeof n)return;if("InverseFunction"===n)return t.op1;const r={Sin:"Arcsin",Cos:"Arccos",Tan:"Arctan",Sec:"Arcsec",Csc:" Arccsc",Sinh:"Arsinh",Cosh:"Arcosh",Tanh:"Artanh",Sech:"Arcsech",Csch:"Arcsch",Arcosh:"Cosh",Arccos:"Cos",Arccsc:"Csc",Arcsch:"Csch",Arcsec:"Sec",Arcsin:"Sin",Arsinh:"Sinh",Arctan:"Tan",Artanh:"Tanh"}[n];return r?e.symbol(r):void 0}function Fs(e,i,t,n){if("evaluate"===i){const i=Cs(e,t,n)?.evaluate();if(i)return i;if(n.isExact)return}switch(t){case"Arccos":return Qr(n,Math.acos,(e=>e.acos()),(e=>e.acos()));case"Arccot":return Qr(n,(e=>Math.atan2(1,e)),(i=>Ge.atan2(e._BIGNUM_ONE,i)),(e=>e.inverse().atan()));case"Arccsc":return Qr(n,(e=>Math.asin(1/e)),(i=>e._BIGNUM_ONE.div(i).asin()),(e=>e.inverse().asin()));case"Arcosh":return Qr(n,Math.acosh,(e=>e.acosh()),(e=>e.acosh()));case"Arcoth":return Qr(n,(e=>e),(e=>e.acosh()),(e=>e.acosh()));case"Arcsch":return Qr(n,(e=>Math.log(1/e+Math.sqrt(1/(e*e)+1))),(i=>e._BIGNUM_ONE.div(i.mul(i)).add(e._BIGNUM_ONE).sqrt().add(e._BIGNUM_ONE.div(i)).log()),(e=>e.mul(e).inverse().add(1).sqrt().add(e.inverse()).log()));case"Arcsec":return Qr(n,(e=>Math.acos(1/e)),(i=>e._BIGNUM_ONE.div(i).acos()),(e=>e.inverse().acos()));case"Arcsin":return Qr(n,Math.asin,(e=>e.asin()),(e=>e.asin()));case"Arsech":return Qr(n,(e=>Math.log((1+Math.sqrt(1-e*e))/e)),(i=>e._BIGNUM_ONE.sub(i.mul(i).add(e._BIGNUM_ONE).div(i)).log()),(i=>e.complex(1).sub(i.mul(i)).add(1).div(i).log()));case"Arsinh":return Qr(n,Math.asinh,(e=>e.asinh()),(e=>e.asinh()));case"Arctan":return Qr(n,Math.atan,(e=>e.atan()),(e=>e.atan()));case"Artanh":return Qr(n,Math.atanh,(e=>e.atanh()),(e=>e.atanh()));case"Cos":return Qr(n,Math.cos,(i=>i.toSignificantDigits(e.precision+4).cos().toSignificantDigits(e.precision)),(e=>e.cos()));case"Cosh":return Qr(n,Math.cosh,(e=>e.cosh()),(e=>e.cosh()));case"Cot":return Qr(n,(e=>1/Math.tan(e)),(i=>e._BIGNUM_ONE.div(i.tan())),(e=>e.tan().inverse()));case"Coth":return Qr(n,(e=>1/Math.tanh(e)),(i=>e._BIGNUM_ONE.div(i.tanh())),(e=>e.tanh().inverse()));case"Csc":return Qr(n,(e=>1/Math.sin(e)),(i=>e._BIGNUM_ONE.div(i.sin())),(e=>e.sin().inverse()));case"Csch":return Qr(n,(e=>1/Math.sinh(e)),(i=>e._BIGNUM_ONE.div(i.sinh())),(e=>e.sinh().inverse()));case"Sec":return Qr(n,(e=>1/Math.cos(e)),(i=>e._BIGNUM_ONE.div(i.cos())),(e=>e.cos().inverse()));case"Sech":return Qr(n,(e=>1/Math.cosh(e)),(i=>e._BIGNUM_ONE.div(i.cosh())),(e=>e.cosh().inverse()));case"Sin":return Qr(n,Math.sin,(i=>i.toSignificantDigits(e.precision+4).sin().toSignificantDigits(e.precision)),(e=>e.sin()));case"Sinh":return Qr(n,Math.sinh,(e=>e.sinh()),(e=>e.sinh()));case"Tan":return Qr(n,Math.tan,(i=>i.toSignificantDigits(e.precision+4).tan().toSignificantDigits(e.precision)),(e=>e.tan()));case"Tanh":return Qr(n,Math.tanh,(e=>e.tanh()),(e=>e.tanh()))}}class Ts{constructor(e,i,t){if(!e.context)throw Error("No context available");this.name=i,this.wikidata=t.wikidata,this.description=t.description,this.url=t.url,this._engine=e,this.scope=e.context,this.name=i,this._flags=t.flags?Os(t.flags):void 0,this._domain=t.domain?e.domain(t.domain):void 0,this.constant=t.constant??!1,this.holdUntil=t.holdUntil??"simplify",this.constant?(this._defValue=t.value,this._value=null):(t.value?Zt(t.value)?this._value=e.parse(t.value)??e.symbol("Undefined"):"function"==typeof t.value?this._value=e.box(t.value(e)??"Undefined"):t.value instanceof Pn?this._value=t.value:this._value=e.box(t.value):this._value=void 0,this._value||!this._domain||t.flags||(this._flags=Ps(this._domain)))}reset(){this.constant&&(this._value=null)}get value(){if(null===this._value){const e=this._engine;if(Zt(this._defValue)?this._value=e.parse(this._defValue)??e.symbol("Undefined"):"function"==typeof this._defValue?this._value=e.box(this._defValue(e)??"Undefined"):this._defValue?this._value=e.box(this._defValue):this._value=void 0,this._value?.numericValue){const i=this._value.numericValue;!Yt(e)&&i instanceof Ge?this._value=e.number(i.toNumber()):!Kt(e)&&i instanceof je&&(this._value=e._NAN)}}return this._value??void 0}set value(e){if(this.constant)throw Error(`The value of the constant "${this.name}" cannot be changed`);if("number"==typeof e)"number"==typeof this._value?.numericValue?this._value._value=e:this._value=this._engine.number(e);else if(e){const i=this._engine.box(e);!this._domain||i.domain.isCompatible(this._domain)?this._value=i:this._value=void 0}else this._value=void 0;void 0!==this._value?this._flags=void 0:this._flags=Ps(this.domain)}get domain(){return this._domain??this._value?.domain??void 0}set domain(e){if(this.constant)throw Error(`The domain of the constant "${this.name}" cannot be changed`);if(!e)return this._defValue=void 0,this._value=void 0,this._flags=void 0,void(this._domain=void 0);if(e=this._engine.domain(e),this._domain?.isNumeric){if(!e.isNumeric)throw Error("Can't change from a numeric domain to a non-numeric one");return this._domain=e,void(this._value||(this._flags={...this._flags??{},...Ps(e)}))}if(this._domain)throw Error("Can't change a non-numeric domain");this._flags=void 0,this._domain=e,!this._value&&e.isNumeric&&(this._flags={...this._flags??{},...Ps(e)})}get number(){return this.value?.isNumber??this._flags?.number}set number(e){this.updateFlags({number:e})}get integer(){return this.value?.isInteger??this._flags?.integer}set integer(e){this.updateFlags({integer:e})}get rational(){return this.value?.isRational??this._flags?.rational}set rational(e){this.updateFlags({rational:e})}get algebraic(){return this.value?.isAlgebraic??this._flags?.algebraic}set algebraic(e){this.updateFlags({algebraic:e})}get real(){return this.value?.isReal??this._flags?.real}set real(e){this.updateFlags({real:e})}get extendedReal(){return this.value?.isExtendedReal??this._flags?.extendedReal}set extendedReal(e){this.updateFlags({extendedReal:e})}get complex(){return this.value?.isComplex??this._flags?.complex}set complex(e){this.updateFlags({complex:e})}get extendedComplex(){return this.value?.isExtendedComplex??this._flags?.extendedComplex}set extendedComplex(e){this.updateFlags({extendedComplex:e})}get imaginary(){return this.value?.isImaginary??this._flags?.imaginary}set imaginary(e){this.updateFlags({imaginary:e})}get positive(){return this.value?.isPositive??this._flags?.positive}set positive(e){this.updateFlags({positive:e})}get nonPositive(){return this.value?.isNonPositive??this._flags?.nonPositive}set nonPositive(e){this.updateFlags({nonPositive:e})}get negative(){return this.value?.isNegative??this._flags?.negative}set negative(e){this.updateFlags({negative:e})}get nonNegative(){return this.value?.isNonNegative??this._flags?.nonNegative}set nonNegative(e){this.updateFlags({nonNegative:e})}get zero(){return this.value?.isZero??this._flags?.zero}set zero(e){this.updateFlags({zero:e})}get notZero(){return this.value?.isNotZero??this._flags?.notZero}set notZero(e){this.updateFlags({notZero:e})}get one(){return this.value?.isOne??this._flags?.one}set one(e){this.updateFlags({one:e})}get negativeOne(){return this.value?.isNegativeOne??this._flags?.negativeOne}set negativeOne(e){this.updateFlags({negativeOne:e})}get infinity(){return this.value?.isInfinity??this._flags?.infinity}set infinity(e){this.updateFlags({infinity:e})}get finite(){return this.value?.isFinite??this._flags?.finite}set finite(e){this.updateFlags({finite:e})}get NaN(){return this.value?.isNaN??this._flags?.NaN}set NaN(e){this.updateFlags({NaN:e})}get even(){return this.value?.isEven??this._flags?.even}set even(e){this.updateFlags({even:e})}get odd(){return this.value?.isOdd??this._flags?.odd}set odd(e){this.updateFlags({odd:e})}get prime(){const e=this._value;return e?!(!e.isInteger||e.isNonPositive)&&dr(Rt(e)??NaN):this._flags?.prime}set prime(e){this.updateFlags({prime:e})}get composite(){const e=this._value;return e?!(!e.isInteger||e.isNonPositive||dr(Rt(e)??NaN)):this._flags?.composite}set composite(e){this.updateFlags({composite:e})}updateFlags(e){if(this.constant)throw Error("The flags of constant cannot be changed");if(!1===this.domain?.isNumeric)throw Error("Flags only apply to numeric domains");let i=0,t=!0;for(const n in Object.keys(e))if(i+=1,this._value&&void 0!==e[n])switch(n){case"number":t=this._value.isNumber===e.number;break;case"integer":t=this._value.isInteger===e.integer;break;case"rational":t=this._value.isRational===e.rational;break;case"algebraic":t=this._value.isAlgebraic===e.algebraic;break;case"real":t=this._value.isReal===e.real;break;case"extendedReal":t=this._value.isExtendedReal===e.extendedReal;break;case"complex":t=this._value.isComplex===e.complex;break;case"extendedComplex":t=this._value.isExtendedComplex===e.extendedComplex;break;case"imaginary":t=this._value.isImaginary===e.imaginary;break;case"positive":t=this._value.isPositive===e.positive;break;case"nonPositive":t=this._value.isNonPositive===e.nonPositive;break;case"negative":t=this._value.isNegative===e.negative;break;case"nonNegative":t=this._value.isNonNegative===e.nonNegative;break;case"zero":t=this._value.isZero===e.zero;break;case"notZero":t=this._value.isNotZero===e.notZero;break;case"one":t=this._value.isOne===e.one;break;case"negativeOne":t=this._value.isNegativeOne===e.negativeOne;break;case"infinity":t=this._value.isInfinity===e.infinity;break;case"NaN":t=this._value.isNaN===e.NaN;break;case"finite":t=this._value.isFinite===e.finite;break;case"even":t=this._value.isEven===e.even;break;case"odd":t=this._value.isOdd===e.odd;break;case"prime":t=this._value.isPrime===e.prime;break;case"composite":t=this._value.isComposite===e.composite}i>0&&(t||(this._defValue=void 0,this._value=void 0),this._domain=this._engine.domain("Number"),this._flags?this._flags={...this._flags,...Os(e)}:this._flags=Os(e))}}function Os(e){const i={...e};return(e.zero||e.one||e.negativeOne)&&(i.zero=e.zero&&!e.one&&!e.negativeOne,i.notZero=!e.zero||e.one||e.negativeOne,i.one=e.one&&!e.zero&&!e.negativeOne,i.negativeOne=e.negativeOne&&!e.zero&&!e.one,i.infinity=!1,i.NaN=!1,i.finite=!0,i.integer=!0,i.finite=!0,i.infinity=!1,i.NaN=!1,i.even=e.one,i.odd=!e.one,i.prime=!1,i.composite=!1),i.zero&&(i.positive=!1,i.negative=!1,i.nonPositive=!0,i.nonNegative=!0),!0===i.notZero&&(i.imaginary||(i.real=!0),i.zero=!1),i.one&&(i.positive=!0),i.negativeOne&&(i.nonPositive=!0),(i.positive||i.nonNegative)&&(i.negativeOne=!1),i.positive?(i.nonPositive=!1,i.negative=!1,i.nonNegative=!0):i.nonPositive?(i.positive=!1,i.negative=i.notZero,i.nonNegative=!i.zero):i.negative?(i.positive=!1,i.nonPositive=i.notZero,i.nonNegative=!1):i.nonNegative&&(i.positive=i.notZero,i.nonPositive=!i.zero,i.negative=!1),(i.positive||i.negative||i.nonPositive||i.nonNegative)&&(i.number=!0,i.finite?i.real=!0:i.finite||(i.complex=!0),i.imaginary=!1),i.finite&&(i.number=!0,i.complex=!0,i.infinity=!1,i.NaN=!1),i.infinity&&(i.finite=!1,i.NaN=!1),!1===i.infinity&&(i.extendedComplex=!1,i.extendedReal=!1),e.even&&(i.odd=!1),e.odd&&(i.even=!1),i.integer&&(i.rational=!0),i.rational&&(i.algebraic=!0),i.algebraic&&(i.real=!0),i.real&&(i.complex=!0),i.imaginary&&(i.complex=!0),i.complex&&(i.number=!0),i.real&&!1!==i.infinity&&(i.extendedReal=!0),i.complex&&!1!==i.infinity&&(i.extendedComplex=!0),(i.even||i.infinity||i.NaN||i.negative||i.imaginary||!1===i.integer)&&(i.prime=!1),i.number&&i.prime&&(i.composite=!1),i}function Ps(e){if(!e)return{};const i={};if(e.isNumeric){const t=e.literal;i.number=!0,"Integer"===t&&(i.integer=!0),"RationalNumber"===t&&(i.rational=!0),"AlgebraicNumber"===t&&(i.algebraic=!0),"TranscendentalNumber"===t&&(i.algebraic=!1,i.real=!0),"ExtendedRealNumber"===t&&(i.extendedReal=!0),"RealNumber"===t&&(i.real=!0),"ImaginaryNumber"===t&&(i.imaginary=!0),"ExtendedComplexNumber"===t&&(i.extendedComplex=!0),"ComplexNumber"===t&&(i.complex=!0),"PositiveNumber"===t&&(i.notZero=!0,i.real=!0,i.positive=!0),"NegativeNumber"===t&&(i.notZero=!0,i.real=!0,i.negative=!0),"NonNegativeNumber"===t&&(i.real=!0,i.positive=!0),"NonPositiveNumber"===t&&(i.real=!0,i.negative=!0),"PositiveInteger"===t&&(i.notZero=!0,i.integer=!0,i.positive=!0),"NegativeNumber"===t&&(i.notZero=!0,i.integer=!0,i.negative=!0),"NonNegativeNumber"===t&&(i.integer=!0,i.positive=!0),"NonPositiveNumber"===t&&(i.integer=!0,i.negative=!0)}else i.number=!1,i.integer=!1,i.rational=!1,i.algebraic=!1,i.real=!1,i.extendedReal=!1,i.complex=!1,i.extendedComplex=!1,i.imaginary=!1,i.positive=!1,i.nonPositive=!1,i.negative=!1,i.nonNegative=!1,i.zero=!1,i.notZero=!1,i.one=!1,i.negativeOne=!1,i.infinity=!1,i.NaN=!1,i.odd=!1,i.even=!1,i.prime=!1,i.composite=!1;return t=Os(i),Object.fromEntries(Object.entries(t).filter((([e,i])=>void 0!==i)));var t}class Rs{constructor(e,i,t){if(!e.context)throw Error("No context available");this.engine=e,this.scope=e.context;const n=t.idempotent??!1,r=t.involution??!1;if(n&&r)throw Error(`Function Definition "${i}": the 'idempotent' and 'involution' flags are mutually exclusive`);if(this.name=i,this.description=t.description,this.wikidata=t.wikidata,this.threadable=t.threadable??!1,this.associative=t.associative??!1,this.commutative=t.commutative??!1,this.idempotent=n,this.involution=r,this.inert=t.inert??!1,this.numeric=t.numeric??!1,this.pure=t.pure??!0,this.complexity=t.complexity??Zn,this.hold=t.hold??"none",this.inert){if(t.hold)throw Error(`Function Definition "${i}": an inert function should not have a hold`);if(this.hold="rest",t.signature){const e=t.signature;if("simplify"in e||"evaluate"in e||"N"in e||"evalDimension"in e||"sgn"in e||"compile"in e)throw Error(`Function Definition "${i}": an inert function should only have 'canonical' or 'codomain' handlers`)}if(this.threadable)throw Error(`Function Definition "${i}": an inert function should not be threadable`);if(this.associative)throw Error(`Function Definition "${i}": an inert function should not be associative`);if(this.commutative)throw Error(`Function Definition "${i}": an inert function should not be commutative`);if(this.idempotent)throw Error(`Function Definition "${i}": an inert function should not be idempotent`);if(this.involution)throw Error(`Function Definition "${i}": an inert function should not be involution`);if(!this.pure)throw Error(`Function Definition "${i}": an inert function should be pure`)}if(t.signature){const n=t.signature,r=n.domain?e.domain(n.domain):t.numeric?e.domain("NumericFunction"):e.domain("Function");if(!r.isValid)throw Error(`Function Definition "${i}": invalid domain ${JSON.stringify(n.domain)}`);const s=n.codomain??r.codomain??(t.numeric?e.domain("Number"):e.domain("Anything"));this.signature={domain:r,codomain:s,canonical:n.canonical,simplify:n.simplify,evaluate:n.evaluate?"function"==typeof n.evaluate?n.evaluate:e.box(n.evaluate,{canonical:!1}):void 0,N:n.N,evalDimension:n.evalDimension,sgn:n.sgn,compile:n.compile}}else t.numeric?this.signature={domain:e.domain("NumericFunction"),codomain:e.domain("Number")}:this.signature={domain:e.domain("Function"),codomain:e.domain("Anything")}}reset(){}}function zs(e,i,t){return t instanceof Rs?t:new Rs(e,i,t)}function Vs(e){return!!e&&"object"==typeof e&&("domain"in e||"value"in e||"constant"in e)}function Ls(e){return!!e&&"object"==typeof e&&("complexity"in e||"numeric"in e||"signature"in e)}function $s(e){if("all"===e)return $s(["domains","core","control-structures","logic","collections","relop","numeric","arithmetic","algebra","calculus","combinatorics","linear-algebra","other","physics","polynomials","statistics","trigonometry","dimensions","units"]);"string"==typeof e&&(e=[e]);const i=[];for(const t of e){const e=Bs[t];if(!e)throw Error("Unknown library category "+t);Array.isArray(e)?i.push(...e):i.push(e)}return i}const Bs={algebra:[],arithmetic:as,calculus:ls,combinatorics:[],"control-structures":[],dimensions:[],domains:[],core:fs,collections:[Ss,{Sequence:{signature:{domain:"Function"}}}],"linear-algebra":[],logic:gs,numeric:[],other:[],relop:xs,polynomials:_s,physics:{"Mu-0":{description:"Vaccum permeability",constant:!0,wikidata:"Q1515261",domain:"RealNumber",value:125663706212e-17}},statistics:[],trigonometry:ws,units:[]};function Gs(e){if(!si(e=e.normalize()))throw Error("Invalid definition name "+e);return e}function Zs(e,i){var t;if(!e.context)throw Error("No context available");(t=e.context).idTable??(t.idTable=new Map);const n=e.context.idTable;for(let t of Object.keys(i)){const r=i[t];if(t=Gs(t),Ls(r)){const i=zs(e,t,r);if(n.has(t))throw Error(`Duplicate function definition ${t}:\n${JSON.stringify(n.get(t))}\n${JSON.stringify(r)}`);n.set(t,i)}else if(Vs(r)){const i=new Ts(e,t,r);if(e.strict&&r.wikidata)for(const[e,i]of n)if(i.wikidata===r.wikidata)throw Error(`Duplicate entries with wikidata "${r.wikidata}": "${t}" and "${i.name}"`);if(n.has(t))throw Error(`Duplicate symbol definition "${t}"`);n.set(t,i)}else{const i=new Ts(e,t,{value:e.box(r)});n.set(t,i)}}}function Us(e){return Number.isInteger(e)&&0!==e?Math.floor(Math.log2(Math.abs(e))/Math.log2(10))+(e>0?1:2):2}const js=function e(i){if(i.symbol)return 1;const t=i.numericValue;if(null!==t){if(i.isZero)return 1;if(i.isInteger)return Us(Rt(i));if(sn(t))return on(t)?Us(t[0])+Us(t[1])+1:Us(Number(t[0]))+Us(Number(t[1]))+1;if(t instanceof je)return Us(t.re)+Us(t.im)+1;if(i.isNumber)return 2}const n=i.head;let r=2;return r="string"==typeof n?["Add","Divide"].includes(n)?3:["Subtract","Negate"].includes(n)?4:["Square","Sqrt","Multiply","Root"].includes(n)?5:["Power"].includes(n)?6:["Ln","Exp","Log"].includes(n)?7:8:e(n),r+(i.ops?.reduce(((i,t)=>i+e(t)),0)??0)};class Hs{constructor(e){this._items=e?e instanceof Hs?new Map(e._items):new Map(e):new Map}has(e){for(const i of this._items.keys())if(i.isSame(e))return!0;return!1}get(e){for(const[i,t]of this._items)if(i.isSame(e))return t}clear(){this._items.clear()}set(e,i){for(const t of this._items.keys())if(t.isSame(e))return void this._items.set(t,i);this._items.set(e,i)}delete(e){this._items.delete(e)}[Symbol.iterator](){return this._items.entries()}entries(){return this._items.entries()}}class Qs extends Pn{constructor(e,i,t){super(e,t),this._pattern=Zt(i)?e.parse(i,{canonical:!1}):e.box(i,{canonical:!1})}get hash(){return Jt("Pattern")^this._pattern.hash}unbind(){this._pattern.unbind()}get json(){return Xn(this.engine,"Pattern",[this._pattern])}get head(){return"Pattern"}get domain(){return this.engine.domain("Pattern")}get isCanonical(){return!0}set isCanonical(e){}isSame(e){return this===e||e instanceof Qs&&this._pattern.isSame(e._pattern)}isEqual(e){return e instanceof Qs&&this._pattern.isEqual(e._pattern)}match(e,i){return function(e,i,t){return Ks(e,i,t.substitution??{},{numericTolerance:t?.numericTolerance??Et})||null}(e,this._pattern,{recursive:i?.recursive??!1,numericTolerance:i?.numericTolerance??0,substitution:i?.substitution??{}})}test(e,i){return null!==this.match(e,i)}count(e,i){let t=0;for(const n of e)null!==this.match(n,i)&&(t+=1);return t}subs(e,i){return this._pattern.subs(e,i)}}function Ws(e){if("string"==typeof e)return e.startsWith("_");if(e.symbol?.startsWith("_"))return!0;if(e.ops)return Ws(e.head)||e.ops.some(Ws);if(e.keys)for(const i of e.keys)if(Ws(e.getKey(i)))return!0;return!1}function Ys(e,i,t){const n=function(e){const i=e.match(/^(__?_?[a-zA-Z0-9]+)/);return null===i?"":i[1]}(e);return""===n?t:void 0!==t[n]?i.isSame(t[n])?t:null:Ws(i)?null:{...t,[n]:i}}function Ks(e,i,t,n){const r=e.engine;if("Pattern"===i.head)return i.match(e,{substitution:t,...n});if(i instanceof br)return e instanceof br?0===n.numericTolerance?i.isSame(e)?t:null:i.isEqualWithTolerance(e,n.numericTolerance)?t:null:null;const s=i.string;if(null!==s)return e.string===s?t:null;const o=i.symbol;if(null!==o)return o.startsWith("_")?Ys(o,e,t):o===e.symbol?t:null;if(i.nops!==e.nops)return null;const a=i.keys;if(null!==a){const i=e.keys;if(null===i)return null;for(const e of a){const r=Ks(i[e],a[e],t,n);if(null===r)return null;t=r}return t}if(i.ops){const s=i.head;if("string"==typeof s&&s.startsWith("_"))return Ys(s,r.box(e.head),t);let o;if("string"==typeof s&&"string"==typeof e.head){if(s!==e.head)return null;o=r.lookupFunction(s)}else{const i=Ks(r.box(e.head,{canonical:!1}),r.box(s,{canonical:!1}),t,n);if(null===i)return null;t=i}return o?.commutative?function(e,i,t,n){const r=function(e){const i=[],t=(e,n=[])=>{if(0===e.length)i.push(n);else for(let i=0;i<e.length;i++){const r=e.slice(),s=r.splice(i,1);t(r.slice(),n.concat(s))}};return t(e),i}(i.ops);for(const i of r){const r=Js(e.engine,e.ops,i,t,n);if(null!==r)return r}return null}(e,i,t,n):function(e,i,t,n){const r=e.engine,s=[...e.ops];let o={...t},a=0;const u=i.ops;for(;a<i.nops;){const e=u[a],i=e.symbol;if(null!==i)if(i.startsWith("__")){let e=0;if(void 0===u[a+1])e=s.length+1;else{let i=!1;for(;!i&&e<s.length;)i=null!==Ks(s[e],u[a+1],o,n),e+=1;if(!i)return null}if(!i.startsWith("___")&&e<=1)return null;o=Ys(i,r.fn("Sequence",s.splice(0,e-1)),o)}else if(i.startsWith("_"))o=Ys(i,s.shift(),o);else{const i=Ks(s.shift(),e,o,n);if(null===i)return null;o=i}else{const i=Ks(s.shift(),e,o,n);if(null===i)return null;o=i}if(null===o)return null;a+=1}return o}(e,i,t,n)}return null}function Js(e,i,t,n,r){let s={...n};i=[...i];let o=!1;for(const e of t)if("__"===e.symbol)o=!0;else{let t=null;if(e.symbol?.startsWith("_")){for(let n=0;n<=i.length-1;n++)if(t=Ys(e.symbol,i[n],s),null!==t){i.splice(n,1);break}}else for(let n=0;n<=i.length-1;n++)if(t=Ks(i[n],e,s,r),null!==t){i.splice(n,1);break}if(null===t)return null;s=t}return!o&&i.length>0?null:(null!==s&&o&&(s.__=e._fn("Sequence",i)),s)}function Xs(e){return null!=e&&"constant"in e}class eo extends Pn{constructor(e,i,t){super(e,t?.metadata),this._name=i,this._scope=t?.canonical?e.context:null,this._def=t?.def??null}get hash(){return void 0===this._hash&&(this._hash=Jt(this._name)),this._hash}unbind(){this._def?.reset(),this._def=null}get isPure(){return(this.symbolDefinition?.constant&&this.symbolDefinition.value?.isPure)??this.functionDefinition?.pure??!1}get json(){return er(this.engine,this._name,{latex:this._latex,wikidata:this._wikidata})}get scope(){return this._scope}get isFree(){const e=this._def??this.engine.lookupSymbol(this._name,this._wikidata);return!Xs(e)||void 0===e.value}get isConstant(){const e=this._def??this.engine.lookupSymbol(this._name,this._wikidata);return!Xs(e)||e.constant}get isCanonical(){return null!==this._scope}set isCanonical(e){this._scope=e?this.engine.context:null,this._def=null}get canonical(){return this._scope?this:this.engine.box(this._name)}get wikidata(){return this._wikidata??this.baseDefinition?.wikidata??void 0}get description(){if(this.baseDefinition&&this.baseDefinition.description)return"string"==typeof this.baseDefinition.description?[this.baseDefinition.description]:this.baseDefinition.description}get url(){return this.baseDefinition?.url??void 0}get complexity(){return 7}get head(){return"Symbol"}get symbol(){return this._name}get isNothing(){return"Nothing"===this._name}get baseDefinition(){return null===this._def&&this.bind(this._scope),this._def??void 0}get symbolDefinition(){return null===this._def&&this.bind(this._scope),Xs(this._def)?this._def:void 0}get functionDefinition(){return null===this._def&&this.bind(this._scope),null!=(e=this._def)&&"signature"in e?this._def:void 0;var e}bind(e){if(null===e)return void(this._def=void 0);let i;if(i=this.engine.lookupSymbol(this._name,this._wikidata,e),i?.wikidata&&this._wikidata&&i.wikidata!==this._wikidata&&(i=void 0),i)return this._name=i.name,void(this._def=i);i=this.engine.lookupFunction(this._name,e),i?this._def=i:null!==this.engine.defaultDomain&&(this._def=this.engine.defineSymbol(this._name,{wikidata:this._wikidata,domain:this.engine.defaultDomain}),this._name=this._def.name)}get value(){return this.symbolDefinition?.value}set value(e){if("_"===this._name[0])throw Error(`The value of the wildcard "${this._name}" cannot be changed`);let i;if(this.engine.forget(this._name),void 0!==e){const t=this.engine.box(e);i=t.value??t.evaluate()}if(i?.domain.isCompatible("Function"))this._def=this.engine.defineFunction(this._name,{signature:{domain:i.domain,evaluate:i}});else if(this._def&&Xs(this._def))this._def.value=i;else{let e=i?.domain;e?.isNumeric&&(e=this.engine.domain("Number")),this._def=this.engine.defineSymbol(this._name,{value:i,domain:e??void 0})}}get domain(){return this.functionDefinition?this.engine.domain("Function"):this.symbolDefinition?.domain??this.engine.defaultDomain??this.engine.domain("Value")}set domain(e){if("_"===this._name[0])throw Error(`The domain of the wildcard "${this._name}" cannot be changed`);const i=this.engine.domain(e);i.isCompatible("Function")?(this.engine.forget(this._name),this._def=this.engine.defineFunction(this._name,{signature:{domain:i}})):Xs(this._def)?this._def.domain=i:(this.engine.forget(this._name),this._def=this.engine.defineSymbol(this._name,{domain:i}))}get explicitDomain(){return this.functionDefinition?this.engine.domain("Function"):this.symbolDefinition?.domain??void 0}get sgn(){const e=this.value;if(e&&e!==this){const i=e.sgn;if(void 0!==i)return i}const i=this.symbolDefinition;return i?!0===i.zero?0:!0===i.positive?1:!0===i.negative?-1:void 0:null}has(e){return"string"==typeof e?this._name===e:e.includes(this._name)}isSame(e){return this===e||e instanceof eo&&this._name===e._name}match(e,i){return e instanceof eo&&this._name===e._name?{}:null}isEqual(e){if(!this.isCanonical)return this.canonical.isEqual(e);if(this===(e=e.canonical))return!0;if(null!==e.symbol)return e.symbol===this._name;const i=this.symbolDefinition?.value?.N();if(i)return i.isEqual(e.N());if(e.isZero){if(this.isZero)return!0;if(this.isNotZero)return!1}return!(this.isZero&&e.isNotZero||!(this.engine.ask(["Equal",this,e]).length>0)&&(this.engine.ask(["NotEqual",this,e]).length,1))}isLess(e){if(null!==e.symbol&&e.symbol===this._name)return!1;const i=this.symbolDefinition?.value?.N();if(i)return i.isLess(e.N());if(e.isZero){const e=this.sgn;if(null===e)return!1;if(void 0!==e)return e<0}}isLessEqual(e){if(null!==e.symbol&&e.symbol===this._name)return!0;const i=this.symbolDefinition?.value?.N();if(i)return i.isLessEqual(e.N());if(e.isZero){const e=this.sgn;if(null===e)return!1;if(void 0!==e)return e<=0}return this.isLess(e)||this.isEqual(e)}isGreater(e){if(null!==e.symbol&&e.symbol===this._name)return!1;const i=this.symbolDefinition?.value?.N();if(i)return i.isGreater(e.N());if(e.isZero){const e=this.sgn;if(null===e)return!1;if(void 0!==e)return e>0}}isGreaterEqual(e){if(null!==e.symbol&&e.symbol===this._name)return!0;const i=this.symbolDefinition?.value?.N();if(i)return i.isGreaterEqual(e.N());if(e.isZero){const e=this.sgn;if(null===e)return!1;if(void 0!==e)return e>=0}return this.isGreater(e)||this.isEqual(e)}get isFunction(){return!!this.functionDefinition}get isZero(){return this.symbolDefinition?.zero}get isNotZero(){return this.symbolDefinition?.notZero}get isOne(){return this.symbolDefinition?.one}get isNegativeOne(){return this.symbolDefinition?.negativeOne}get isOdd(){return this.symbolDefinition?.odd}get isEven(){return this.symbolDefinition?.even}get isPrime(){return this.symbolDefinition?.prime}get isComposite(){return this.symbolDefinition?.composite}get isInfinity(){return this.symbolDefinition?.infinity}get isNaN(){return this.symbolDefinition?.NaN}get isPositive(){return this.symbolDefinition?.positive}get isNonPositive(){return this.symbolDefinition?.nonPositive}get isNegative(){return this.symbolDefinition?.negative}get isNonNegative(){return this.symbolDefinition?.nonNegative}get isNumber(){return this.symbolDefinition?.number}get isInteger(){return this.symbolDefinition?.integer}get isRational(){return this.symbolDefinition?.rational}get isAlgebraic(){return this.symbolDefinition?.rational}get isReal(){return this.symbolDefinition?.real}get isExtendedReal(){return this.symbolDefinition?.extendedReal}get isComplex(){return this.symbolDefinition?.complex}get isImaginary(){return this.symbolDefinition?.imaginary}simplify(e){const i=this.symbolDefinition;return"never"!==i?.holdUntil&&"simplify"!==i?.holdUntil||!i.value?e?.rules?this.replace(e.rules)??this:this:i.value.simplify(e)}evaluate(e){const i=this.symbolDefinition;return"N"!==i?.holdUntil?i?.value?.evaluate(e)??this:this}N(e){return this.symbolDefinition?.value?.N(e)??this}replace(e,i){return rn(this,e,i)}subs(e,i){return void 0===e[this._name]?i?.canonical?this.canonical:this:this.engine.box(e[this._name],i)}}function io(e,i){const t=e.lookupSymbol(i,void 0,e.context);return"never"===t?.holdUntil&&t.value?t.value:new eo(e,i,{canonical:!0,def:t})}class to{static getStandardLibrary(e="all"){return $s(e)}constructor(e){if(this._cache={},this._commonSymbols={True:null,False:null,Maybe:null,All:null,Nothing:null,None:null,Undefined:null,Function:null,Pi:null,ImaginaryUnit:null},this._commonNumbers={"-5":null,"-4":null,"-3":null,"-2":null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,36:null},this._commonDomains={Anything:null,Nothing:null,Boolean:null,MaybeBoolean:null,String:null,Domain:null,Symbol:null,Integer:null,RationalNumber:null,AlgebraicNumber:null,RealNumber:null,ExtendedRealNumber:null,ImaginaryNumber:null,ComplexNumber:null,ExtendedComplexNumber:null,Number:null,PositiveInteger:null,TranscendentalNumber:null,PositiveNumber:null,Function:null,NumericFunction:null,RealFunction:null,TrigonometricFunction:null,LogicOperator:null,Predicate:null,RelationalOperator:null},void 0!==e&&"object"!=typeof e)throw Error("Unexpected argument");this.strict=!0,this._latexDictionary=e?.latexDictionary,this._jsonSerializationOptions={exclude:[],shorthands:["function","symbol","string","dictionary","number"],metadata:[],precision:"max",repeatingDecimals:!0},this._useRawJsonSerializationOptions=!1,this._rawJsonSerializationOptions={exclude:[],shorthands:["function","symbol","string","dictionary","number"],metadata:[],precision:"max",repeatingDecimals:!1},this._stats={highwaterMark:0,symbols:new Set,expressions:new Set},this._defaultDomain=null,this._numericMode=e?.numericMode??"auto",this._precision=Math.max(e?.numericPrecision??100,Math.floor(kt)),this._bignum=Ge.clone({precision:this._precision}),this.tolerance=e?.tolerance??Et,this._ZERO=new br(this,0),this._ONE=new br(this,1),this._HALF=new br(this,[1,2]),this._NEGATIVE_ONE=new br(this,-1),this._I=new br(this,Ue.exports.Complex.I),this._NAN=new br(this,NaN),this._POSITIVE_INFINITY=new br(this,1/0),this._NEGATIVE_INFINITY=new br(this,-1/0),this._COMPLEX_INFINITY=new br(this,Ue.exports.Complex.INFINITY),this.reset(),this.context={assumptions:new Hs,timeLimit:2,memoryLimit:1,recursionLimit:1024,iterationLimit:1/0};const i=e?.ids??to.getStandardLibrary();for(const e of i)Zs(this,e);for(const e of Object.keys(this._commonDomains))this._commonDomains[e]&&!this._commonDomains[e].symbolDefinition?this._commonDomains[e].bind(this.context):this._commonDomains[e]=Fr(this,e);for(const e of Object.keys(this._commonSymbols))this._commonSymbols[e]=new eo(this,e,{canonical:!0}),this._commonSymbols[e].bind(this.context);if(e?.defaultDomain){const i=this.domain(e.defaultDomain);i.isValid?this._defaultDomain=i:this._defaultDomain=this.domain("ExtendedRealNumber")}else this._defaultDomain=this.domain("ExtendedRealNumber");this.pushScope()}reset(){this._BIGNUM_NEGATIVE_ONE=this.bignum(-1),this._BIGNUM_NAN=this.bignum(NaN),this._BIGNUM_ZERO=this.bignum(0),this._BIGNUM_ONE=this.bignum(1),this._BIGNUM_TWO=this.bignum(2),this._BIGNUM_HALF=this._BIGNUM_ONE.div(this._BIGNUM_TWO),this._BIGNUM_PI=this._BIGNUM_NEGATIVE_ONE.acos();const e=this._stats.symbols.values(),i=this._stats.expressions.values();this._stats.symbols=new Set,this._stats.expressions=new Set;for(const i of e)i.unbind();for(const e of i)e.unbind();for(const e of Object.values(this._commonDomains))e?.unbind();for(const e of Object.values(this._commonSymbols))e?.unbind();let t=this.context;for(;t;){if(t.idTable)for(const[e,i]of t.idTable)i.reset();t=t.parentScope??null}for(const e of Object.keys(this._cache))this._cache[e].value&&(this._cache[e].purge?this._cache[e].value=this._cache[e].purge(this._cache[e].value):delete this._cache[e])}_register(e){this._stats.highwaterMark+=1}_unregister(e){}get stats(){const e=this._stats.expressions;return this._stats.expressions=null,this._stats.expressions=e,{...this._stats}}get precision(){return"machine"===this._numericMode||"complex"===this._numericMode?Math.floor(kt):this._precision}set precision(e){if("machine"===e&&(e=Math.floor(kt)),e!==this._precision){if("number"!=typeof e||e<=0)throw Error('Expected "machine" or a positive number');this._latexSyntax?.updateOptions({precision:e,avoidExponentsInRange:[-6,e]}),this._precision=Math.max(e,Math.floor(kt)),this.jsonSerializationOptions.precision>this._precision&&(this.jsonSerializationOptions={precision:this._precision}),"auto"!==this._numericMode&&"bignum"!==this._numericMode&&this._precision>Math.floor(kt)&&(this._numericMode="auto"),this._bignum=this._bignum.config({precision:this._precision}),this.reset()}}get numericMode(){return this._numericMode}set numericMode(e){if(e!==this._numericMode){if("string"!=typeof e)throw Error("Expected a string");this._numericMode=e,"complex"!==e&&"machine"!==e||(this._precision=Math.floor(kt)),this._latexSyntax&&this.latexSyntax.options.precision>this._precision&&this.latexSyntax.updateOptions({precision:this._precision}),this.jsonSerializationOptions.precision>this._precision&&(this.jsonSerializationOptions={precision:this._precision}),this.reset()}}get timeLimit(){let e=this.context;for(;e;){if(void 0!==e.timeLimit)return e.timeLimit;e=e.parentScope??null}return 2}get iterationLimit(){let e=this.context;for(;e;){if(void 0!==e.iterationLimit)return e.iterationLimit;e=e.parentScope??null}return 1024}get recursionLimit(){let e=this.context;for(;e;){if(void 0!==e.recursionLimit)return e.recursionLimit;e=e.parentScope??null}return 1024}get defaultDomain(){return this._defaultDomain}set defaultDomain(e){if(null===e)this._defaultDomain=null;else{const i=this.domain(e);if(!i.isValid)throw Error("Invalid domain "+e);this._defaultDomain=i}}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance="number"==typeof e&&Number.isFinite(e)?Math.max(e,0):Et,this._bignumTolerance=this.bignum(this._tolerance)}bignum(e){return"bigint"==typeof e?new this._bignum(e.toString()):new this._bignum(e)}complex(e,i){return new Ue.exports.Complex(e,i)}chop(e){return"number"==typeof e&&Math.abs(e)<=this._tolerance||e instanceof Ge&&e.abs().lte(this._bignumTolerance)||e instanceof Ue.exports.Complex&&Math.abs(e.re)<=this._tolerance&&Math.abs(e.im)<=this._tolerance?0:e}get latexSyntax(){return this._latexSyntax||(this._latexSyntax=new wt({computeEngine:this,dictionary:this._latexDictionary,precision:this.precision,avoidExponentsInRange:[-6,this.precision],onError:e=>{throw Error(e[0].message.toString())}})),this._latexSyntax}static getLatexDictionary(e="all"){return wt.getDictionary(e)}set costFunction(e){"function"!=typeof e&&(this._cost=js),this._cost=e}get costFunction(){return this._cost??js}lookupSymbol(e,i,t){if(!this.strict){for(t??(t=this.context??void 0);t;){const i=t.idTable?.get(e);if(Vs(i))return i;t=t.parentScope}return}if("string"!=typeof e)throw Error("Expected a string");if(0===e.length||!this.context)return;const n=t??this.context;if(i)for(t=n;t;){if(t.idTable)for(const[e,n]of t.idTable)if(Vs(n)&&n.wikidata===i)return n;t=t.parentScope}for(t=n;t;){const i=t.idTable?.get(e);if(Vs(i))return i;t=t.parentScope}}lookupFunction(e,i){if("string"==typeof e&&this.context)for(i??(i=this.context);i;){const t=i.idTable?.get(e);if(Ls(t))return t;i=i.parentScope}}defineSymbol(e,i){if(!this.context)throw Error("Symbol cannot be defined: no scope available");if(0===e.length||!si(e))throw Error("Invalid identifier "+e);this.context.idTable||(this.context.idTable=new Map);const t=new Ts(this,e,i);return t.name&&this.context.idTable.set(t.name,t),t}defineFunction(e,i){if(!this.context)throw Error("Function cannot be defined: no scope available");if(0===e.length||!si(e))throw Error("Invalid identifier "+e);this.context.idTable||(this.context.idTable=new Map);const t=zs(this,e,i);return t.name&&this.context.idTable.set(e,t),t}pushScope(e,i){if(null===this.context)throw Error("No parent scope available");if(this.context={timeLimit:this.context.timeLimit,memoryLimit:this.context.memoryLimit,recursionLimit:this.context.recursionLimit,iterationLimit:this.context.iterationLimit,...i??{},parentScope:this.context,assumptions:new Hs(this.context.assumptions)},e)if(Array.isArray(e))for(const i of e)Zs(this,i);else Zs(this,e)}popScope(){if(!this.context)throw Error("No scope available");const e=this.context?.parentScope;this.context=e??null}set(e){if(this.strict){for(const i of Object.keys(e))if("Nothing"!==i){const t=this.lookupSymbol(i),n=e[i];if(null==n)t&&(t.value=void 0);else{const e=this.box(n);if(t){if(t.domain&&!e.domain.isCompatible(t.domain))throw Error(`Expected value with domain ${t.domain.toString()} for "${i}"`);t.value=e}else e.domain.isNumeric?this.defineSymbol(i,{value:e,domain:"Number"}):this.defineSymbol(i,{value:e})}}}else for(const i of Object.keys(e))if("Nothing"!==i){const t=this.lookupSymbol(i),n=e[i];if(t)t.value=n??void 0;else if(null!=n){const e=this.box(n);e.domain.isNumeric?this.defineSymbol(i,{value:e,domain:"Number"}):this.defineSymbol(i,{value:e})}}}let(e){for(const i of Object.keys(e))if("Nothing"!==i){const t=e[i];Vs(t)?this.defineSymbol(i,t):Ls(t)?this.defineFunction(i,t):this.set({[i]:e[i]})}}get assumptions(){if(!this.context)throw Error("No scope available");return this.context.assumptions||(this.context.assumptions=new Hs),this.context.assumptions}shouldContinueExecution(){return void 0===this.deadline||this.deadline>=Date.now()}checkContinueExecution(){if(!this.shouldContinueExecution())throw Error("timeout")}cache(e,i,t){if(void 0===this._cache[e])try{this._cache[e]={build:i,purge:t,value:i()}}catch(e){}return this._cache[e]?.value}box(e,i){return Sr(this,e,i)}canonical(e){if(!e.every((e=>e instanceof Pn)))return e.map((e=>this.box(e)));const i=e;return i.every((e=>e.isCanonical))?i:i.map((e=>e.canonical))}fn(e,i,t){return xr(this,e,i,{metadata:t,canonical:!0})}_fn(e,i,t){return new hr(this,e,i,{metadata:t,canonical:!0,def:this.lookupFunction(e,this.context)})}error(e,i){if(i instanceof Pn?i=this.rawJson(i):i&&Array.isArray(i)&&"Latex"===i[0]&&(void 0!==i[1]&&i[1]||(i=""),"object"==typeof i[1]&&"str"in i[1]&&!i[1].str&&(i="")),Array.isArray(e)&&"invalid-domain"===e[0])return Fr(this,["Error",["ErrorCode","'invalid-domain'",e[1]]]);const t="string"==typeof e?this.string(e):new hr(this,"ErrorCode",[this.string(e[0]),...e.slice(1).map((e=>this.box(e,{canonical:!1})))]);return new hr(this,"Error",i?[t,this.box(i,{canonical:!1})]:[t],{canonical:!1})}hold(e){return this._fn("Hold",[this.box(e,{canonical:!1})])}add(e,i){const t=function(e,i){if(0===(i=i.filter((e=>null===e.numericValue||!e.isZero))).length)return e.number(0);if(1===i.length)return i[0];if(2===i.length){let t=0,n=0;if(n=Rt(i[0]),null!==n&&0!==n?t=jt(i[1]):(t=jt(i[0]),0!==t&&null!==i[1].numericValue&&(n=Rt(i[1]))),null!==n&&null!==t&&0!==t)return e.number(e.complex(n,t))}return i.length>1&&(i=Un(0,i)),e._fn("Add",i)}(this,wn(kn(e),"Add"));return void 0!==i?.latex&&(t.latex=i.latex),void 0!==i?.wikidata&&(t.wikidata=i.wikidata),t}neg(e,i){return In(e,i)}mul(e,i){const t=is(this,wn(kn(e)," Multiply"));return void 0!==i?.latex&&(t.latex=i.latex),void 0!==i?.wikidata&&(t.wikidata=i.wikidata),t}div(e,i,t){const n=ss(this,e,i);return void 0!==t?.latex&&(n.latex=t.latex),void 0!==t?.wikidata&&(n.wikidata=t.wikidata),n}sqrt(e,i){return Yr(this,e,this._HALF,i)}pow(e,i,t){if(i instanceof Pn){const e=i.numericValue;null!==e&&("number"==typeof e&&(i=e),sn(e)&&(i=e))}let n=null;if("number"==typeof i?n=i:sn(i)&&(on(i)&&1===i[1]?n=i[0]:an(i)&&i[1]===BigInt(1)&&(n=Number(i[0]))),1===n)return e;const r=e.numericValue;if(-1===n&&null!==r){if("number"==typeof r&&Number.isInteger(r))return this.number([1,r]);if(r instanceof Ge&&r.isInteger())return this.number([BigInt(1),$t(r)]);if(sn(r))return this.number([r[1],r[0]])}return("number"==typeof i||sn(i))&&(i=this.number(i)),Yr(this,e,i,t)}inv(e,i){if(e.isOne)return this._ONE;if(e.isNegativeOne)return this._NEGATIVE_ONE;if(e.isInfinity)return this._ZERO;const t=e.numericValue;if(null!==t)return sn(t)?this.number(pn(t),{metadata:i}):"number"==typeof t&&Number.isInteger(t)?this.number([1,t],{metadata:i}):t instanceof Ge&&t.isInteger()?this.number([BigInt(1),$t(t)],{metadata:i}):this._fn("Divide",[this._ONE,e],i);if("Sqrt"===e.head)return this._fn("Sqrt",[this.inv(e.op1)],i);if("Divide"===e.head)return this._fn("Divide",[e[1],e[0]],i);if("Rational"===e.head)return this.number([e[1],e[0]],{metadata:i});let n=this._NEGATIVE_ONE;if("Power"===e.head){if(e.op2.isNegativeOne)return e.op1;n=In(e.op2),e=e.op1}return n.isNegativeOne?this._fn("Divide",[this._ONE,e],i):this._fn("Power",[e,n],i)}pair(e,i,t){return new hr(this,"Tuple",[e,i],{metadata:t,canonical:!0})}tuple(e,i){return new hr(this,"Tuple",En(e),{metadata:i,canonical:!0})}string(e,i){return new vr(this,e,i)}symbol(e,i){if(i??(i={}),"canonical"in i||(i.canonical=!0),"NaN"===(e=e.normalize()))return this._NAN;if("Infinity"===e)return this._POSITIVE_INFINITY;if("+Infinity"===e)return this._POSITIVE_INFINITY;if("-Infinity"===e)return this._NEGATIVE_INFINITY;if("Half"===e)return this._HALF;if(this.strict&&!si(e)){const t=i?.metadata?.latex,n=`'${e}'`;if(t)return this.error(["invalid-symbol-name",n],t?["Latex",`'${t}'`]:n)}if(void 0!==i?.metadata?.latex&&!i.canonical)return new eo(this,e,i);const t=this._commonSymbols[e];return t?i?.metadata?.wikidata&&t.wikidata&&t.wikidata!==i.metadata.wikidata?i.canonical?io(this,e):new eo(this,e,i):t:i.canonical?io(this,e):new eo(this,e,i)}domain(e,i){return e instanceof Dr?e:(e instanceof Pn&&e.symbol&&(e=e.symbol),"string"==typeof e&&this._commonDomains[e]?this._commonDomains[e]:Rr(e)?Fr(this,e,i):this.error(["invalid-domain",{str:JSON.stringify(e)}],["Latex",{str:i?.latex??""}]))}number(e,i){if(i??(i={}),"canonical"in i||(i.canonical=!0),void 0===i.metadata){if("bigint"==typeof e){if(e===BigInt(1))return this._ONE;if(e===BigInt(0))return this._ZERO;if(e===BigInt(-1))return this._NEGATIVE_ONE}if("number"==typeof e){const i=e;if(1===i)return this._ONE;if(0===i)return this._ZERO;if(-1===i)return this._NEGATIVE_ONE;if(Number.isInteger(i)&&void 0!==this._commonNumbers[i])return null===this._commonNumbers[i]&&(this._commonNumbers[i]=Nr(this,e)??this._NAN),this._commonNumbers[i];if(Number.isNaN(i))return this._NAN;if(!Number.isFinite(i))return i<0?this._NEGATIVE_INFINITY:this._POSITIVE_INFINITY}}return"bigint"==typeof e&&(e=this.bignum(e)),Nr(this,e,i)??this._NAN}rules(e){return tn(this,e)}pattern(e){return new Qs(this,e)}parse(e,i){return"string"!=typeof e?null:this.box(this.latexSyntax.parse(Ut(e)??e),i)}serialize(e){if("object"==typeof e&&"json"in e){const i="engine"in e?e.engine:this;return this.latexSyntax.serialize(this.rawJson(i.box(e,{canonical:!1})))}return this.latexSyntax.serialize(e)}get latexOptions(){const e=this.latexSyntax;return new Proxy({...this.latexSyntax.options,...this.latexSyntax.serializer.options},{set:(i,t,n)=>t in i&&(e.updateOptions({[t]:n}),!0)})}set latexOptions(e){this.latexSyntax.updateOptions(e)}get jsonSerializationOptions(){return this._useRawJsonSerializationOptions?this._rawJsonSerializationOptions:this._jsonSerializationOptions}set jsonSerializationOptions(e){e.exclude&&(this._jsonSerializationOptions.exclude=[...e.exclude]),e.shorthands&&("all"===e.shorthands||e.shorthands.includes("all")?this._jsonSerializationOptions.shorthands=["function","symbol","string","dictionary","number"]:this._jsonSerializationOptions.shorthands=[...e.shorthands]),e.metadata&&("all"===e.metadata||e.metadata.includes("all")?this._jsonSerializationOptions.metadata=["latex","wikidata"]:this._jsonSerializationOptions.metadata=[...e.metadata]),"number"==typeof e.precision&&e.precision>0&&(this._jsonSerializationOptions.precision=e.precision),"boolean"==typeof e.repeatingDecimals&&(this._jsonSerializationOptions.repeatingDecimals=e.repeatingDecimals)}rawJson(e){const i=this._useRawJsonSerializationOptions;this._useRawJsonSerializationOptions=!0;const t=e.json;return this._useRawJsonSerializationOptions=i,t}ask(e){const i=this.pattern(e),t=[];for(const[e,n]of this.assumptions){const r=i.match(e,{numericTolerance:this._tolerance});null!==r&&!0===n&&t.push(r)}return t}infer(e,i){if("string"!=typeof e){if(!e.symbol)return"internal-error";e=e.symbol}return"ok"}assume(e,i){try{const t=Ut(e),n=t?this.parse(t,{canonical:!1}):this.box(e,{canonical:!1});return i?Rr(i)?Tn(this.box(["Element",n,this.domain(i)])):Tn(this.box(["Equal",n,i])):Tn(n)}catch(e){return"internal-error"}}forget(e){if(!this.context)throw Error("No scope available");if(void 0!==e){if(Array.isArray(e))for(const i of e)this.forget(i);else if("string"==typeof e){if(this.context.idTable){const i=this.context.idTable.get(e);Vs(i)&&(i.value=void 0,i.domain?.isNumeric?i.domain=this.defaultDomain??this.domain("Number"):i.domain=void 0)}for(const[i,t]of this.assumptions)i.symbols.includes(e)&&this.assumptions.delete(i)}}else{if(this.context.idTable)for(const e of this.context.idTable.keys())this.forget(e);this.assumptions.clear()}}}globalThis[Symbol.for("io.cortexjs.compute-engine")]={ComputeEngine:to.prototype.constructor,version:"0.12.2"},e.ComputeEngine=to,e.isEnvironmentEntry=a,e.isFunctionEntry=t,e.isInfixEntry=r,e.isMatchfixEntry=n,e.isPostfixEntry=o,e.isPrefixEntry=s,e.isSymbolEntry=i,e.version="0.12.2",Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).ComputeEngine={});